$PBExportHeader$w_custom_report.srw
forward
global type w_custom_report from pfc_w_main
end type
type p_1 from picture within w_custom_report
end type
type cb_close from commandbutton within w_custom_report
end type
type dw_audit from u_dw within w_custom_report
end type
type cb_view_alias from commandbutton within w_custom_report
end type
type tab_1 from tab within w_custom_report
end type
type tabpage_browse from userobject within tab_1
end type
type cb_23 from commandbutton within tabpage_browse
end type
type cb_security from commandbutton within tabpage_browse
end type
type cb_find from commandbutton within tabpage_browse
end type
type cb_select from commandbutton within tabpage_browse
end type
type dw_report_list from u_dw within tabpage_browse
end type
type cb_next_1 from commandbutton within tabpage_browse
end type
type cb_delete from commandbutton within tabpage_browse
end type
type cb_new from commandbutton within tabpage_browse
end type
type cb_copy from commandbutton within tabpage_browse
end type
type cbx_goto from checkbox within tabpage_browse
end type
type cb_1 from commandbutton within tabpage_browse
end type
type cb_properties from commandbutton within tabpage_browse
end type
type cb_25 from commandbutton within tabpage_browse
end type
type cb_27 from commandbutton within tabpage_browse
end type
type cb_26 from commandbutton within tabpage_browse
end type
type sle_search from singlelineedit within tabpage_browse
end type
type cb_clear from commandbutton within tabpage_browse
end type
type dw_detail from u_dw within tabpage_browse
end type
type gb_3 from groupbox within tabpage_browse
end type
type tabpage_browse from userobject within tab_1
cb_23 cb_23
cb_security cb_security
cb_find cb_find
cb_select cb_select
dw_report_list dw_report_list
cb_next_1 cb_next_1
cb_delete cb_delete
cb_new cb_new
cb_copy cb_copy
cbx_goto cbx_goto
cb_1 cb_1
cb_properties cb_properties
cb_25 cb_25
cb_27 cb_27
cb_26 cb_26
sle_search sle_search
cb_clear cb_clear
dw_detail dw_detail
gb_3 gb_3
end type
type tabpage_tables from userobject within tab_1
end type
type cb_quick_select from commandbutton within tabpage_tables
end type
type cb_15 from commandbutton within tabpage_tables
end type
type cb_11 from commandbutton within tabpage_tables
end type
type cb_10 from commandbutton within tabpage_tables
end type
type cb_8 from commandbutton within tabpage_tables
end type
type cbx_advanced from checkbox within tabpage_tables
end type
type dw_5 from datawindow within tabpage_tables
end type
type dw_1 from datawindow within tabpage_tables
end type
type cb_coll_tables from commandbutton within tabpage_tables
end type
type st_auto_link from statictext within tabpage_tables
end type
type cb_view_add_tbl from commandbutton within tabpage_tables
end type
type cb_view_del_tbl from commandbutton within tabpage_tables
end type
type cb_next_2 from commandbutton within tabpage_tables
end type
type cb_view_del_link from commandbutton within tabpage_tables
end type
type cb_auto_link from commandbutton within tabpage_tables
end type
type cb_qhelp from commandbutton within tabpage_tables
end type
type cbx_distinct from checkbox within tabpage_tables
end type
type dw_view_tables from datawindow within tabpage_tables
end type
type dw_view_links from datawindow within tabpage_tables
end type
type cb_view_add_link from commandbutton within tabpage_tables
end type
type tv_tables from u_tvs_rpt within tabpage_tables
end type
type tabpage_tables from userobject within tab_1
cb_quick_select cb_quick_select
cb_15 cb_15
cb_11 cb_11
cb_10 cb_10
cb_8 cb_8
cbx_advanced cbx_advanced
dw_5 dw_5
dw_1 dw_1
cb_coll_tables cb_coll_tables
st_auto_link st_auto_link
cb_view_add_tbl cb_view_add_tbl
cb_view_del_tbl cb_view_del_tbl
cb_next_2 cb_next_2
cb_view_del_link cb_view_del_link
cb_auto_link cb_auto_link
cb_qhelp cb_qhelp
cbx_distinct cbx_distinct
dw_view_tables dw_view_tables
dw_view_links dw_view_links
cb_view_add_link cb_view_add_link
tv_tables tv_tables
end type
type tabpage_columns from userobject within tab_1
end type
type cb_expand from commandbutton within tabpage_columns
end type
type cb_selection from commandbutton within tabpage_columns
end type
type cb_move_left from commandbutton within tabpage_columns
end type
type cb_move_right from commandbutton within tabpage_columns
end type
type cb_collapse from commandbutton within tabpage_columns
end type
type cb_next_3 from commandbutton within tabpage_columns
end type
type cb_move_up from commandbutton within tabpage_columns
end type
type cb_move_down from commandbutton within tabpage_columns
end type
type cb_add_comp from commandbutton within tabpage_columns
end type
type cb_edit_comp from commandbutton within tabpage_columns
end type
type dw_all_fields from datawindow within tabpage_columns
end type
type dw_view_fields_edit from u_dw within tabpage_columns
end type
type dw_view_fields from u_dw within tabpage_columns
end type
type dw_2 from datawindow within tabpage_columns
end type
type tv_fields from u_tvs_rpt within tabpage_columns
end type
type tabpage_columns from userobject within tab_1
cb_expand cb_expand
cb_selection cb_selection
cb_move_left cb_move_left
cb_move_right cb_move_right
cb_collapse cb_collapse
cb_next_3 cb_next_3
cb_move_up cb_move_up
cb_move_down cb_move_down
cb_add_comp cb_add_comp
cb_edit_comp cb_edit_comp
dw_all_fields dw_all_fields
dw_view_fields_edit dw_view_fields_edit
dw_view_fields dw_view_fields
dw_2 dw_2
tv_fields tv_fields
end type
type tabpage_filter from userobject within tab_1
end type
type dw_view_where from u_dw within tabpage_filter
end type
type cb_24 from commandbutton within tabpage_filter
end type
type sle_2 from singlelineedit within tabpage_filter
end type
type sle_1 from singlelineedit within tabpage_filter
end type
type cb_3 from commandbutton within tabpage_filter
end type
type cb_16 from commandbutton within tabpage_filter
end type
type cb_12 from commandbutton within tabpage_filter
end type
type cb_next_4 from commandbutton within tabpage_filter
end type
type tabpage_filter from userobject within tab_1
dw_view_where dw_view_where
cb_24 cb_24
sle_2 sle_2
sle_1 sle_1
cb_3 cb_3
cb_16 cb_16
cb_12 cb_12
cb_next_4 cb_next_4
end type
type tabpage_sort from userobject within tab_1
end type
type cb_22 from commandbutton within tabpage_sort
end type
type cb_21 from commandbutton within tabpage_sort
end type
type cb_20 from commandbutton within tabpage_sort
end type
type cb_19 from commandbutton within tabpage_sort
end type
type dw_4 from datawindow within tabpage_sort
end type
type dw_view_sort from u_dw within tabpage_sort
end type
type cb_next_5 from commandbutton within tabpage_sort
end type
type cb_col_all from commandbutton within tabpage_sort
end type
type tv_sort from u_tvs_rpt within tabpage_sort
end type
type tabpage_sort from userobject within tab_1
cb_22 cb_22
cb_21 cb_21
cb_20 cb_20
cb_19 cb_19
dw_4 dw_4
dw_view_sort dw_view_sort
cb_next_5 cb_next_5
cb_col_all cb_col_all
tv_sort tv_sort
end type
type tabpage_preview from userobject within tab_1
end type
type gb_1 from groupbox within tabpage_preview
end type
type st_left from statictext within tabpage_preview
end type
type st_5 from statictext within tabpage_preview
end type
type st_center from statictext within tabpage_preview
end type
type st_right from statictext within tabpage_preview
end type
type st_f_right from statictext within tabpage_preview
end type
type st_f_center from statictext within tabpage_preview
end type
type st_f_left from statictext within tabpage_preview
end type
type st_6 from statictext within tabpage_preview
end type
type dw_label from datawindow within tabpage_preview
end type
type st_4 from statictext within tabpage_preview
end type
type hsb_2 from hscrollbar within tabpage_preview
end type
type st_3 from statictext within tabpage_preview
end type
type st_1 from statictext within tabpage_preview
end type
type hsb_1 from hscrollbar within tabpage_preview
end type
type cbx_move_all from checkbox within tabpage_preview
end type
type dw_preview from u_dw within tabpage_preview
end type
type st_7 from statictext within tabpage_preview
end type
type st_bold from statictext within tabpage_preview
end type
type st_italic from statictext within tabpage_preview
end type
type st_underline from statictext within tabpage_preview
end type
type st_normal from statictext within tabpage_preview
end type
type cb_14 from commandbutton within tabpage_preview
end type
type cb_7 from commandbutton within tabpage_preview
end type
type cb_advanced_screen from commandbutton within tabpage_preview
end type
type cb_clear_design from commandbutton within tabpage_preview
end type
type cb_clear_help from commandbutton within tabpage_preview
end type
type dw_display from u_dw within tabpage_preview
end type
type rb_p from radiobutton within tabpage_preview
end type
type rb_l from radiobutton within tabpage_preview
end type
type cbx_crit from checkbox within tabpage_preview
end type
type gb_2 from groupbox within tabpage_preview
end type
type st_font from statictext within tabpage_preview
end type
type em_font from editmask within tabpage_preview
end type
type cb_ruler from commandbutton within tabpage_preview
end type
type st_obj_name from statictext within tabpage_preview
end type
type tabpage_preview from userobject within tab_1
gb_1 gb_1
st_left st_left
st_5 st_5
st_center st_center
st_right st_right
st_f_right st_f_right
st_f_center st_f_center
st_f_left st_f_left
st_6 st_6
dw_label dw_label
st_4 st_4
hsb_2 hsb_2
st_3 st_3
st_1 st_1
hsb_1 hsb_1
cbx_move_all cbx_move_all
dw_preview dw_preview
st_7 st_7
st_bold st_bold
st_italic st_italic
st_underline st_underline
st_normal st_normal
cb_14 cb_14
cb_7 cb_7
cb_advanced_screen cb_advanced_screen
cb_clear_design cb_clear_design
cb_clear_help cb_clear_help
dw_display dw_display
rb_p rb_p
rb_l rb_l
cbx_crit cbx_crit
gb_2 gb_2
st_font st_font
em_font em_font
cb_ruler cb_ruler
st_obj_name st_obj_name
end type
type tabpage_run from userobject within tab_1
end type
type cb_store from commandbutton within tabpage_run
end type
type dw_run from u_dw within tabpage_run
end type
type dw_save_sql from datawindow within tabpage_run
end type
type st_sql from statictext within tabpage_run
end type
type dw_wizard from u_dw within tabpage_run
end type
type cb_saveas from commandbutton within tabpage_run
end type
type cb_print from commandbutton within tabpage_run
end type
type cb_batch_filter from commandbutton within tabpage_run
end type
type cb_filter from commandbutton within tabpage_run
end type
type cb_sort from commandbutton within tabpage_run
end type
type cb_13 from commandbutton within tabpage_run
end type
type cb_showsql from commandbutton within tabpage_run
end type
type cb_sql from commandbutton within tabpage_run
end type
type cb_next_run from commandbutton within tabpage_run
end type
type cb_17 from commandbutton within tabpage_run
end type
type st_step from statictext within tabpage_run
end type
type tabpage_run from userobject within tab_1
cb_store cb_store
dw_run dw_run
dw_save_sql dw_save_sql
st_sql st_sql
dw_wizard dw_wizard
cb_saveas cb_saveas
cb_print cb_print
cb_batch_filter cb_batch_filter
cb_filter cb_filter
cb_sort cb_sort
cb_13 cb_13
cb_showsql cb_showsql
cb_sql cb_sql
cb_next_run cb_next_run
cb_17 cb_17
st_step st_step
end type
type tab_1 from tab within w_custom_report
tabpage_browse tabpage_browse
tabpage_tables tabpage_tables
tabpage_columns tabpage_columns
tabpage_filter tabpage_filter
tabpage_sort tabpage_sort
tabpage_preview tabpage_preview
tabpage_run tabpage_run
end type
end forward

global type w_custom_report from pfc_w_main
integer x = 0
integer y = 0
integer width = 4485
integer height = 2240
string title = "IntelliReport"
long backcolor = 33551856
event type string of_get_lookupdesc_multi ( string as_lookup_code )
event type integer pfc_cst_print_report ( )
p_1 p_1
cb_close cb_close
dw_audit dw_audit
cb_view_alias cb_view_alias
tab_1 tab_1
end type
global w_custom_report w_custom_report

type variables
Long il_v_scroll_position
Integer ii_with_data = 0
Integer ii_total_where_values
Integer ii_current_wizard_step = 1
Integer ii_total_wizard_steps = 0
integer ii_facil_security
Integer ii_dept_security_on = 0
integer ii_appt_stat[] //maha 11.03.2014
integer ii_data_stat[] //maha 11.03.2014
Integer ii_with_ruler = 0 //Added by Appeon long.zhang 12.08.2014(V14.2 Testing/Bug# 4331 - Hide Ruler not set correct when come back to Design Tab)

String is_drag_object
String is_object_type
String is_wizard_lookup_name[]
String is_wizard_lookup_type[]
String is_wizard_field_name[]
String is_sql_where
String is_wizard_compare_field[]
string is_facility_name
string is_mod_user
string is_sort_synt
string is_address_types
string is_net_dev_types
string is_appl_name
String is_Origin_Syntax //Evan 08.31.2010
String is_PreObject_Name,is_PreObject_Color,is_CurObject_Name //Evan 08.31.2010
string is_appmnt_status //maha 11.03.2014
string is_data_status //maha 11.03.2014
string is_status_table //maha 11.04.2014
string is_my_reports = "" //maha 10.28.2015
string is_report_name //maha 07.25.2016 - for run audit

Boolean ib_group_report = True
Boolean ib_retrieving = False
boolean ib_show_all_fields_in_select = false  //maha 01.20.2011
Boolean ib_security = false  //maha 06.29.2011
boolean ib_retrieveend = true  //maha 11.04.2014

Integer ii_project_id = 99

Integer ii_nr

Integer ii_col_count

Integer ii_tag

Long il_view_id

Long il_next_table_id
Long il_next_link_id
Long il_next_where_id

Long il_next_field_id  
Long il_next_sort_id

String is_filter

String is_obj_name

String ls_label_name[]
String ls_column_name[]
string is_user

Boolean ib_new

//--------------------------- APPEON BEGIN ---------------------------
//$<add> 2007-12-06 By: Andy
Long il_module
Long il_data_view_id
//$<add> 02.29.2008 by  Andy 
str_intellireport istr_ds[]
pfc_cst_nv_data_entry_functions inv_data_entry

//$<add> 02.29.2008 by Andy
Boolean ib_advanced
String  is_screen_lookup_type[]
String  is_wizard_coltype[]
String  is_wizard_field_label[]

n_ds ids_tables
n_ds ids_fields
//---------Begin Added by (Appeon)Toney 06.11.2013 for V141 ISG-CLX--------
Boolean ib_AutoRetrieve = true
Boolean ib_Select = false
//---------End Added ------------------------------------------------------------------


Protected:


n_ds ids_sort



//$<add> 03.05.2008 by Andy
//Reason:Round APB BUG
Integer ii_oldindex//,ii_newindex
boolean ib_AutoClicked = False
//---------------------------- APPEON END ----------------------------

str_dashboard istr_dashboard
Boolean ib_auto_locate //Ken.Guo 2008-09-27

long il_resize_number=0//Added by  Nova 07.10.2009------------------------
Boolean ib_group_break=False////Added by  Nova 08.19.2010 --V10.5 SK IntelliReport

datetime	idt_priordate // Evan 08.31.2010
//---------Begin Added by (Appeon)Toney 06.11.2013 for V141 ISG-CLX--------
boolean ib_access_filter//Ken.Guo 2009-04-21
//---------End Added ------------------------------------------------------------------

//---------Begin Added by (Appeon)Stephen 04.22.2014 for V142 Schedule IntelliReport--------
Long il_data_view_id_cont
integer ii_drag_start
string is_run_error
string is_message
string is_font_column[] 
boolean ib_run_sucess = false
boolean ib_sche = false
boolean ib_leave=true
datastore ids_view_modle
n_cst_message inv_message
//---------End Added ------------------------------------------------------

DataStore ids_Screen //Added by Gavin 2017-10-18
end variables

forward prototypes
public function integer of_save ()
public function integer of_get_next_ids ()
public function integer of_help (string selected_tab, string option)
public function integer of_wizard_setup ()
public function integer of_next_wizard ()
public function integer of_clean_up ()
public function integer of_retrieve_report (long al_view)
public function integer of_retrieve_detail (long al_view)
public function integer of_preview_old (datawindow adw_preview)
public function string of_getfrom ()
public function integer of_getargs (u_tvs_rpt atv_args, long al_parent, integer ai_level, ref any aa_arg[20])
public subroutine of_expandcollapseall (commandbutton acb_args, u_tvs_rpt atv_args)
public function long of_get_image (string as_v_name, long al_datalength, ref blob ablb_data)
public subroutine of_tv_doubleclicked (long al_handle)
public subroutine of_delete_row ()
public subroutine of_create_dynamic_dw (ref str_intellireport astr_ds)
public subroutine of_init_dynamic_dw ()
public function long of_check_fields ()
public function long of_check_tables ()
public function long of_check_filter ()
public subroutine of_save_tables ()
public subroutine of_selecttab (integer ai_index)
public function integer of_tabchanging (integer ai_oldindex, integer ai_newindex)
public function string of_replace (string arg_str, string arg_old, string arg_new)
public subroutine of_dashboard (long ai_id)
public function integer of_readonly_security ()
public function string of_build_view_sql (integer as_flag)
public subroutine of_modify_dw (datawindow adw_preview)
public subroutine of_refreshdisplaysyntax ()
public function string of_getsyntax (long al_view_id)
public subroutine of_adjust_object_width (long al_step)
public subroutine of_move_object_position (long al_step)
public subroutine of_adjust_font_style ()
public subroutine of_show_selection ()
public function integer of_getgroupcolumns (datawindow adw_syntax, integer ai_bandindex, ref string as_column[])
public function integer of_preview (datawindow adw_preview, integer as_flag)
public function boolean of_creategroup (datawindow adw_report)
public function integer of_getgroupcolumns (string as_syntax, integer ai_bandindex, ref string as_column[])
public function integer of_preview_01 (datawindow adw_preview, integer as_flag)
public function integer of_report_retrieve ()
public function integer of_set_wizardtype (string as_vfieldname, long as_row)
public subroutine of_get_filter_status ()
public function boolean wf_check_link_column ()
public function string of_build_ctx_access_sql (string as_table_col)
public function string of_filter_template_ctx (string as_table_col)
public subroutine of_setobjectenabled (boolean ab_value)
public function integer of_checkselectcontent (string as_content, string as_codename, string as_operator)
public function string of_get_lookupdesc_multi (string as_lookup_code)
public function integer of_run_report (long al_report_id, string as_output_file, string as_error)
public function integer of_sched_savefile (u_dw adw_report, string as_filepath)
public function integer of_sched_run (long al_report_id, string as_filepath, ref string as_message)
public function string of_get_field_type (string as_v_name, string as_c_name)
public function long of_get_lookup_data (string as_v_name, string as_c_name, ref string as_display, ref string as_lookup_type, ref string as_lookup_name)
public function integer of_link_cred_cont (datawindow adw_tables)
public function integer of_drag_order (long al_row)
public function integer of_export_report (u_dw adw_report)
public function boolean of_check_ctxgroup (string as_table_name)
public function integer of_set_fontsize (string as_object_name, string as_object_type, integer ai_size)
public function integer of_get_module (string as_view_name)
public function integer of_check_viewid (string as_table_name)
public function integer of_filter_report_list ()
public function integer of_revise_filter (string as_operator, ref string as_filter_value)
public function integer of_link_buttons (string as_from)
public function integer of_audit_set (string as_data)
public function string of_get_join_filter (string as_table)
public function string of_get_first_table (string as_table, datawindow adw_tables)
end prototypes

event type string of_get_lookupdesc_multi(string as_lookup_code);//====================================================================
//$<Event>: of_get_lookupdesc_multi
//$<Arguments>:
// 	value    string    as_lookup_code
//$<Return>:  string
//$<Description>: 
//$<Author>: (Appeon) Toney 06.13.2013 (V141 ISG-CLX)
//--------------------------------------------------------------------
//$<Modify History>:
//====================================================================
Long 		ll_Cycle, ll_cnt
string 	ls_desc, ls_temp, ls_lookupcode[]

n_cst_string lnv_string

IF IsNull(as_lookup_code) OR LEN(TRIM(as_lookup_code)) < 1 THEN RETURN ""

lnv_string.of_parsetoarray(as_lookup_code, ",", ls_lookupcode)

FOR ll_Cycle = 1 to UpperBound(ls_lookupcode)
	ls_temp = gnv_data.of_GetItem("code_lookup","code","lookup_code = " + ls_lookupcode[ll_Cycle])
	IF IsNull(ls_temp) OR Len(Trim(ls_temp)) < 1 THEN CONTINUE
	IF Len(Trim(ls_desc)) < 1 THEN
		ls_desc = "'" + ls_temp + "'"
	ELSE
		ls_desc += ", '" + ls_temp + "'"
	END IF
NEXT

RETURN ls_desc

end event

event type integer pfc_cst_print_report();//====================================================================
//$<Event>: pfc_cst_print_report()
//$<Arguments>:
//$<Return>: integer
//$<Description>: Print the report directly -  Work around the Ticket # 00044328: Can't print from IReport 
//$<Author>: (Appeon) Alfee 10.21.2013
//--------------------------------------------------------------------------------------------------------------------------
//$<Modify History>:
//====================================================================
integer	li_rc

if tab_1.selectedtab <> 7 then 
	return 0
end if

li_rc = tab_1.tabpage_run.dw_run.Print (true)

return li_rc



end event

public function integer of_save ();Integer 	li_rc
Integer 	li_found
Integer 	i
Integer 	l
Integer 	ll_cnt
String 	ls_tbl_nm,ls_FtblNm,ls_TtblNm
String 	ls_fld_nm
String 	ls_table_nm
String 	ls_table_ids[]
String 	ls_field
String 	ls_field_v_scroll_position
//comment 12.11.2007 by: Andy
//String 	ls_table_v_scroll_position
Long		ll_Cycle,ll_Count
Boolean	lb_Flag
Long     ll_sel_table_id //<add> 12.18.2007 by: Andy
DataWindowChild dwchild
//<add> 05.21.2008 by: Andy
Long     ll_FieldCnt = 0
String   ls_table_fields[]
//end add
//---------Begin Added by (Appeon)Toney 06.13.2013 for V141 ISG-CLX--------
Boolean	lbn_retrieve = False	//Added By Mark Lee 06/04/12
//---------End Added ------------------------------------------------------------------

//Start Code Change ----06.07.2016 #V152 maha - removed the deleterows calls

SetRedraw( False )

tab_1.tabpage_tables.dw_view_tables.AcceptText( )


li_rc = tab_1.tabpage_tables.dw_view_tables.RowCount()
//$<add> 02.14.2008 by Andy
IF li_rc = 0 THEN tab_1.tabpage_tables.dw_5.Modify("t_2.visible='0' t_3.visible='0' t_3.text='' p_1.visible='0' t_1.visible='0' t_1.text=''")
//end of add
FOR i = 1 To li_rc
	ls_table_ids[i] = tab_1.tabpage_tables.dw_view_tables.GetItemString( i, "conv_view_table_table_name" )
	END FOR
	
	ll_Count = UpperBound(ls_table_ids) //Added by Scofield on 2007-08-23
	
	//--------------------------- APPEON BEGIN ---------------------------
	//$< Add  > 2007-08-23 By: Scofield
	//$<Reason> Refresh the link column
	li_rc = tab_1.tabpage_tables.dw_view_links.RowCount()
	FOR i = 1 To li_rc
		ls_FtblNm = tab_1.tabpage_tables.dw_view_links.GetItemString( i, "link_from_table_nm" )
		ls_TtblNm = tab_1.tabpage_tables.dw_view_links.GetItemString( i, "link_to_table_nm" )
		
		lb_Flag = False
		FOR ll_Cycle = 1 To ll_Count
			IF ls_table_ids[ll_Cycle] = ls_FtblNm THEN
				lb_Flag = True
				EXIT
			END IF
		NEXT
		
		IF lb_Flag THEN
			lb_Flag = False
			FOR ll_Cycle = 1 To ll_Count
				IF ls_table_ids[ll_Cycle] = ls_TtblNm THEN
					lb_Flag = True
					EXIT
				END IF
			NEXT
		END IF
		
		IF Not lb_Flag THEN
			//tab_1.tabpage_tables.dw_view_links.DeleteRow(i)
			i = i - 1
			li_rc = li_rc - 1
		END IF
		END FOR
		//---------------------------- APPEON END ----------------------------
		//---------Begin Added by (Appeon)Toney 06.13.2013 for V141 ISG-CLX--------
		//Added By Mark Lee 06/06/12 email subject 'RE: possible bug FW: Incorrect reporting for Multi header'
		//$Reason:allow next code to execute only when the report belongs to IntelliContract
		IF il_module = 1 THEN lbn_retrieve = wf_check_link_column()		
		//---------End Added ------------------------------------------------------------------

		li_rc = tab_1.tabpage_columns.dw_view_fields.RowCount()
		FOR i = 1 To li_rc
			//<add> 12.18.2007 by: Andy
			//Fixed a bug from John
			//if the field is a compute field,then ignore.
			ll_sel_table_id = tab_1.tabpage_columns.dw_view_fields.GetItemNumber( i, "sel_table_id" )
			//if ll_sel_table_id = 0 then continue
			//end of add
			ls_tbl_nm = tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "table_name" )
			ls_fld_nm = tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "field_name" )
			//--------Begin Added by Nova 07.28.2008------------------------
			IF ll_sel_table_id = 0 THEN
				ll_FieldCnt ++
				//ls_table_fields[ll_FieldCnt] = ls_tbl_nm + "." + ls_fld_nm //modified by nova 09.22.2008
				//ls_table_fields[ll_FieldCnt] =  ls_fld_nm//Commented by (Appeon)Harry 06.24.2015
				ls_table_fields[ll_FieldCnt] = ls_tbl_nm + "." + ls_fld_nm  //(Appeon)Harry 06.24.2015 - Bug id 4574 - Computed field Filter on Filter tab does not save
				CONTINUE
			END IF
			//--------End Added --------------------------------------------
			//--------------------------- APPEON BEGIN ---------------------------
			//$< Add  > 2007-08-23 By: Scofield
			//$<Reason> Refresh the dw_view_fields column
			
			lb_Flag = False
			FOR ll_Cycle = 1 To ll_Count
				IF ls_table_ids[ll_Cycle] = ls_tbl_nm THEN
					lb_Flag = True
					EXIT
				END IF
			NEXT
			
			IF Not lb_Flag THEN
				//tab_1.tabpage_columns.dw_view_fields.DeleteRow(i)
				i = i - 1
				li_rc = li_rc - 1
				CONTINUE
			END IF
			
			//$<add> 05.21.2008 by Andy
			ll_FieldCnt ++
			ls_table_fields[ll_FieldCnt] = ls_tbl_nm + "." + ls_fld_nm
			//end 05.21.2008
			//---------------------------- APPEON END ----------------------------
			//comment 12.13.2007 by: Andy
			//	li_found = tab_1.tabpage_columns.dw_fields_list.Find( "table_name = '" + ls_tbl_nm + "' AND field_name ='" + ls_fld_nm + "'" , 1, 1000 )
			//	IF li_found > 0 THEN
			//		tab_1.tabpage_columns.dw_fields_list.DeleteRow( li_found )
			//	END IF	
			END FOR
			
			//--------------------------- APPEON BEGIN ---------------------------
			//$< Add  > 2007-08-23 By: Scofield
			//$<Reason> Refresh the filter column
			li_rc = tab_1.tabpage_filter.dw_view_where.RowCount()
			FOR i = 1 To li_rc
				ls_field = tab_1.tabpage_filter.dw_view_where.GetItemString( i, "table_field_name" )
				lb_Flag = False

				FOR ll_Cycle = 1 To ll_FieldCnt
					IF ls_table_fields[ll_Cycle] = ls_field THEN
						lb_Flag = True
						EXIT
					END IF
				NEXT
				//end modify 05.21.2008
				
				IF Not lb_Flag THEN
					//tab_1.tabpage_filter.dw_view_where.DeleteRow(i)
					i = i - 1
					li_rc = li_rc - 1
				END IF
				END FOR
				//---------------------------- APPEON END ----------------------------
				
				li_rc = tab_1.tabpage_sort.dw_view_sort.RowCount()
				FOR i = 1 To li_rc
					ls_field = tab_1.tabpage_sort.dw_view_sort.GetItemString( i, "field_name" )
					//--------------------------- APPEON BEGIN ---------------------------
					//$< Add  > 2007-08-23 By: Scofield
					//$<Reason> Refresh the sort column
					
					ls_tbl_nm = tab_1.tabpage_sort.dw_view_sort.GetItemString( i, "table_name" )
					
					lb_Flag = False

					FOR ll_Cycle = 1 To ll_FieldCnt
						IF ls_table_fields[ll_Cycle] = (ls_tbl_nm + "." + ls_field) THEN
							lb_Flag = True
							EXIT
						END IF
					NEXT
					//end modify 05.21.2008
					
					IF Not lb_Flag THEN
						//tab_1.tabpage_sort.dw_view_sort.DeleteRow(i)
						i = i - 1
						li_rc = li_rc - 1
						CONTINUE
					END IF

					END FOR
					//---------------------------- APPEON END ----------------------------
					//comment 12.11.2007 by: Andy

					//---------Begin Added by (Appeon)Toney 06.13.2013 for V141 ISG-CLX--------
					//$Reason:allow next code to execute only when the report belongs to IntelliContract
					IF il_module = 1 THEN tab_1.tabpage_tables.dw_view_links.AcceptText( )			//Added By Mark Lee 06/04/12
					//---------End Added ------------------------------------------------------------------

					gnv_appeondb.of_StartQueue()
					tab_1.tabpage_filter.dw_view_where.Update( )
					tab_1.tabpage_tables.dw_view_tables.Update( )
					tab_1.tabpage_tables.dw_view_links.Update( )
					tab_1.tabpage_columns.dw_view_fields.Update( )
					tab_1.tabpage_sort.dw_view_sort.Update( )
					tab_1.tabpage_browse.dw_detail.Update( )
					//$<modify> 04.16.2008 by Andy
					//tab_1.tabpage_tables.dw_view_tables.Retrieve( il_view_id )
					IF ll_Count > 0 THEN
						tab_1.tabpage_columns.dw_all_fields.Retrieve(  ls_table_ids  )
					END IF
					//end modify 04.16.2008
					//---------Begin Added by (Appeon)Toney 06.13.2013 for V141 ISG-CLX--------
					//$Reason:allow next code to execute only when the report belongs to IntelliContract
					//Added By Mark Lee 06/04/12
					IF il_module = 1 THEN
						If	lbn_retrieve = True	Then
							tab_1.tabpage_tables.dw_view_links.retrieve(il_view_id)
						End If
					END IF
					//---------End Added ------------------------------------------------------------------

					gnv_appeondb.of_CommitQueue()
					
					
					SetRedraw( True )
					RETURN 0

end function

public function integer of_get_next_ids ();SELECT Max( table_id )  
INTO :il_next_table_id  
FROM conv_view_table;

IF IsNull( il_next_table_id ) THEN
	il_next_table_id = 1
END IF

SELECT Max( link_id )  
INTO :il_next_link_id  
FROM conv_view_links;

IF IsNull( il_next_link_id ) THEN
	il_next_link_id = 1
END IF


SELECT Max( sort_id )  
INTO :il_next_sort_id  
FROM conv_view_sort;

IF IsNull( il_next_sort_id ) THEN
	il_next_sort_id = 1
END IF


SELECT Max( field_id )  
INTO :il_next_field_id  
FROM conv_view_fields;

IF IsNull( il_next_field_id ) THEN
	il_next_field_id = 1
END IF

SELECT Max( where_id )  
INTO :il_next_where_id  
FROM conv_view_where;

IF IsNull( il_next_where_id ) THEN
	il_next_where_id = 1
END IF

Return 0
end function

public function integer of_help (string selected_tab, string option);//st_help_1.Visible = False
//st_help_2.Visible = False
//
//IF selected_tab = "browse" AND option = "" THEN
//	st_help_1.Visible = True
//	st_help_1.Text = "The browse tab displays all of the custom reports currently available and also allows you to create New custom reports.~n~r~n~r" +&
//			     "NEW            -  Create a new custom report.~n~r" +&
//				"DELETE       -  Delete a custom report.~n~r" +&
//				"SELECT       -  Select a custom report for edit or preview.  ( Double clicking the entry also selects the report.)"						
//END IF
//

Return 0
end function

public function integer of_wizard_setup ();Integer i
Integer li_cnt
Integer li_rc
String  ls_screen_lookup_type //$<add> 03.28.2008 by Andy
string ls_wiz  //maha 11.04.2014
Long    ll_Find

li_rc = tab_1.tabpage_columns.dw_view_fields.RowCount()

FOR i = 1 TO li_rc
	ls_wiz =  tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "field_wizard_name" ) 
	IF lenA(ls_wiz) > 0 THEN
		li_cnt++		
		is_wizard_lookup_name[ li_cnt ] = ls_wiz     //maha 11.04.2014           tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "field_wizard_name" )
		is_wizard_lookup_type[ li_cnt ] = tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "field_wizard_type" )
		//$<Modify> 02.22.2008 by Andy
		//$Reason:  if the field come from different selected table,then it will pop a error messagebox.
		//				(fixed bug:BugG022204)
		//is_wizard_field_name[ li_cnt ] = tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "field_name" )
		is_wizard_field_name[ li_cnt ] = tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "table_name" ) + "." + tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "field_name" )
		//end of modify 02.22.2008
		//--------Begin Added by Nova 07.28.2008------------------------
		if PosA(is_wizard_field_name[ li_cnt ],"v_",1) > PosA(is_wizard_field_name[ li_cnt ],".",1) then 
				if gs_dbtype = "ASA" then
				is_wizard_field_name[ li_cnt ]= MidA(is_wizard_field_name[ li_cnt ],1,PosA(is_wizard_field_name[ li_cnt ],".",1) - 1) //get computed field name
			else
				is_wizard_field_name[ li_cnt ]=MidA(is_wizard_field_name[ li_cnt ],PosA(is_wizard_field_name[ li_cnt ],".",1) + 1)
			end if
		end if 	
		//--------End Added --------------------------------------------

		is_wizard_compare_field[ li_cnt ] = tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "field_options" )		
		//$<add> 03.28.2008 by Andy
		ls_screen_lookup_type = tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "lookup_type" )
		if isNull(ls_screen_lookup_type) then ls_screen_lookup_type = ""
		is_screen_lookup_type[li_cnt] = ls_screen_lookup_type
		//$<add> 03.31.2008 by Andy
		ll_Find = ids_fields.Find("c_name='" + tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "field_name" ) + "' and table_name='" + tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "table_name" ) + "'",0,ids_fields.RowCount())
		if ll_Find > 0 then
			is_wizard_coltype[li_cnt] = ids_fields.GetItemString(ll_Find,"coltype")
		else
			//$<add> 07.11.2008 by Andy
			is_wizard_coltype[li_cnt] = ''
		end if
		//$<add> 04.18.2008 by Andy
		is_wizard_field_label[li_cnt] = tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "label_text" )
	END IF
END FOR



is_facility_name = ""
ii_total_wizard_steps = li_cnt
ii_current_wizard_step = 0
ii_total_where_values = 0
is_sql_where = ""
is_address_types = ""
is_net_dev_types = ""
//---------Begin Added by (Appeon)Toney 06.13.2013 for V141 ISG-CLX--------
datetime ldt_temp
idt_priordate = ldt_temp	//Jervis 12.16.2009
//---------End Added ------------------------------------------------------------------


of_next_wizard()

//tab_1.tabpage_run.dw_wizard.SetTransObject( SQLCA )
//tab_1.tabpage_run.dw_wizard.Retrieve( is_wizard_lookup_name[ 1 ] )
//tab_1.tabpage_run.dw_wizard.Modify( "st_name.text = '" + is_wizard_lookup_name[ 1 ] + "'" )
//
Return 0
end function

public function integer of_next_wizard ();//creates wizard filter values calls of_preview if last step called from of_wizard_setup
string ddd
Integer li_rc
Integer i
Integer li_first_param
integer li_nd_cnt
Integer li_select_all //alfee 12.30.2009
integer li_as_cnt  //maha 11.03.2014
integer li_appt_stat[] //maha 11.03.2014
integer li_data_stat[] //maha 11.03.2014
String ls_from_date
String ls_to_date
string ls_facility_name
string ls_action_type
string ls_action_status
string ls_nd_actions
string ls_app_name
long ll_prac_id
string ls_street
string ls_name
boolean lb_true //maha 11.02.2011

IF ii_current_wizard_step = 0 THEN //this is called before the next button has ever been clicked  
	//ii_total_where_values = 0  done in reset
	/*comment 06/26/2007 by: Andy
	IF tab_1.tabpage_tables.dw_view_tables.RowCount() = 1 THEN		//if only 1 table  maha 092402 to fix single table queries
		if tab_1.tabpage_filter.dw_view_where.RowCount() < 1 then // if no filters
			is_sql_where = " WHERE "
		end if		
	ELSE //more than 1 table 
			is_sql_where = " AND "
	END IF
	*/
	//<add> 06/26/2007 by: Andy (inner join/left join)
	if tab_1.tabpage_filter.dw_view_where.RowCount() < 1 then // if no filters
			is_sql_where = " WHERE "		
	ELSE //more than 1 table 
			is_sql_where = " AND "
	END IF
	//end of add
END IF

//Process current wizard step
//debugbreak()
IF ii_current_wizard_step > 0 THEN 
	IF RightA( is_sql_where, 5 ) = " AND " or RightA( is_sql_where, 7 ) = " WHERE " THEN //maha changed 101602
		//messagebox("","no add")
	else
		//messagebox("","and add")
		is_sql_where = is_sql_where + " AND "
	end if

	tab_1.tabpage_run.dw_wizard.AcceptText()
	li_first_param=0
	
	IF tab_1.tabpage_run.dw_wizard.DataObject = "d_crit_date_range_custom" THEN
		ls_from_date = String( tab_1.tabpage_run.dw_wizard.GetItemDate( 1, "from_date" ) ) //modify by evan 04.18.2011
		ls_to_date = String( tab_1.tabpage_run.dw_wizard.GetItemDate( 1, "to_date" ) ) //modify by evan 04.18.2011
		IF LenA( is_filter ) > 1 THEN
			is_filter = is_filter + " : "
		END IF
		is_filter = is_filter + "Date Range=" + ls_from_date + " - " + ls_to_date
		//IF NOT IsNull( ls_from_date + ls_to_date ) AND ls_from_date + ls_to_date <> "" THEN //Comment by Appeon long.zhang 06.08.2015 (intellireport date range filters bug_id #4550)
		IF NOT (IsNull( ls_from_date ) or IsNull( ls_to_date )) AND ls_from_date + ls_to_date <> "" THEN //Walkaround for WEB, by Appeon long.zhang 06.08.2015 (intellireport date range filters bug_id #4550)	
			//--------------------------- APPEON BEGIN ---------------------------
			//$<modify> 21/05/2007 By: Jervis
			//$<reason> 
			/*
			is_sql_where = is_sql_where + "( Date( " + is_wizard_field_name[ ii_current_wizard_step ] + " )  >= Cast('" + ls_from_date + "' AS DATE ) AND " +&
				                           "Date( " + is_wizard_field_name[ ii_current_wizard_step ] + " )  <= Cast('" + ls_to_date + "' AS DATE ) )"		
			*/
			//is_sql_where = is_sql_where + "( Convert(datetime, " + is_wizard_field_name[ ii_current_wizard_step ] + ",102 )  >= Convert(datetime,'" + ls_from_date + "',102) AND " +&
			//	                           "Convert(datetime, " + is_wizard_field_name[ ii_current_wizard_step ] + ",102 )  <= Convert(datetime,'" + ls_to_date + "' ,102 ) )" //delete by 02.11.2011
			//---------------------------- APPEON END ----------------------------
			
			//------------------- APPEON BEGIN -------------------
			//$<add> Evan 04.18.2011
			//$<reason> Fixed bug and performance tuning.			
			ls_from_date = String(date(ls_from_date), "yyyy-mm-dd") + " 00:00:00"
			ls_to_date = String(date(ls_to_date), "yyyy-mm-dd") + " 23:59:59"
			is_sql_where = is_sql_where + "(" + is_wizard_field_name[ii_current_wizard_step] + " >= '" + ls_from_date + "' AND " + &
				                                 is_wizard_field_name[ii_current_wizard_step] + " <= '" + ls_to_date + "')"
			//------------------- APPEON END ---------------------
			
			ii_total_where_values++								
		END IF
	ELSEIF tab_1.tabpage_run.dw_wizard.DataObject = "d_crit_single_date_custom" THEN
		IF LenA( is_filter ) > 1 THEN
			is_filter = is_filter + " : "
		END IF		
		is_filter = is_filter + "Date=" + String( tab_1.tabpage_run.dw_wizard.GetItemDate( 1, "from_date" ), 'mm/dd/yyyy' )
		//--------------------------- APPEON BEGIN ---------------------------
		//$<modify> 12.01.2006 By: Davis
		//$<reason> Fix a defect.
		//is_sql_where = is_sql_where + "DateFormat( " + is_wizard_field_name[ ii_current_wizard_step ] + ", 'mm/dd/yyyy' ) = '" + String( tab_1.tabpage_run.dw_wizard.GetItemDate( 1, "from_date" ), 'mm/dd/yyyy' ) + "'"		
		is_sql_where = is_sql_where + "Convert(varchar(10), " + is_wizard_field_name[ ii_current_wizard_step ] + ", 101 ) = '" + String( tab_1.tabpage_run.dw_wizard.GetItemDate( 1, "from_date" ), 'mm/dd/yyyy' ) + "'"		
		//---------------------------- APPEON END ----------------------------
		ii_total_where_values++	
	elseif tab_1.tabpage_run.dw_wizard.DataObject = "d_crit_address_type_ir" THEN //address type
		is_filter = is_filter + "  Address Type = " 
		is_address_types = "  ("
		IF tab_1.tabpage_run.dw_wizard.GetItemNumber( 1, "primary" ) = 1 THEN
			is_address_types = is_address_types + " v_address_link.primary_office = 1 OR "
			is_filter = is_filter + "Primary, "
		END IF
		IF tab_1.tabpage_run.dw_wizard.GetItemNumber( 1, "additional" ) = 1 THEN
			is_address_types = is_address_types + " v_address_link.additional_office = 1 OR "
			is_filter = is_filter + "Additional, "			
		END IF			
		IF tab_1.tabpage_run.dw_wizard.GetItemNumber( 1, "billing" ) = 1 THEN
			is_address_types = is_address_types + " v_address_link.billing = 1 OR "
			is_filter = is_filter + "Billing, "			
		END IF						
		IF tab_1.tabpage_run.dw_wizard.GetItemNumber( 1, "home" ) = 1 THEN
			is_address_types = is_address_types + " v_address_link.home_address = 1 OR "
			is_filter = is_filter + "Home, "			
		END IF
		IF tab_1.tabpage_run.dw_wizard.GetItemNumber( 1, "mailing" ) = 1 THEN
			is_address_types = is_address_types + " v_address_link.mailing = 1 OR "
			is_filter = is_filter + "Mailing, "			
		END IF
			is_address_types = MidA( is_address_types, 1, LenA( is_address_types ) -3 ) + ")"
			is_filter = MidA( is_filter, 1, LenA( is_filter ) -2 ) 
		IF is_address_types = ")" THEN
			//---------Begin Modified by (Appeon)Stephen 04.23.2014 for V142 Schedule IntelliReport--------
			//MessageBox("Selection Error", "You must select at least one address Type. ")			
			inv_message.of_messagebox("Selection Error", "You must select at least one address Type. ", true)
			is_run_error = "Selection Error: You must select at least one address Type."
			ib_run_sucess = false
			//---------End Modfiied ------------------------------------------------------
			Return -1
		END IF
		is_sql_where = is_sql_where + is_address_types
	ELSEIF tab_1.tabpage_run.dw_wizard.DataObject = "d_crit_net_dev_type_ir" then //maha 071604
			IF LenA( is_filter ) > 1 THEN
				is_filter = is_filter + " : "
			END IF		
		
			IF tab_1.tabpage_run.dw_wizard.GetItemNumber( 1, "selected" ) = 1 THEN
				is_filter = is_filter + " Net Dev Type = ALL"
				is_net_dev_types = ""
			ELSE

				is_net_dev_types = ""
				li_rc = tab_1.tabpage_run.dw_wizard.RowCount()
				
				is_filter = is_filter + " Net Dev Type = "
				
				FOR i = 1 TO li_rc
					IF tab_1.tabpage_run.dw_wizard.GetItemNumber( i, "selected" ) = 1 THEN
						li_nd_cnt++ //check to see if there will be ORs
						ls_action_status = tab_1.tabpage_run.dw_wizard.GetItemString( i, "custom_3" ) 
						is_filter = is_filter + ls_action_status
						IF ls_action_status = '' OR IsNull( ls_action_status ) THEN
							//MessageBox("Incomplete", "If you select an Action Type you must select and Action Status." )
							//---------Begin Modified by (Appeon)Stephen 04.23.2014 for V142 Schedule IntelliReport--------
							//MessageBox("Incomplete", "If you select an Action Type you must select an Action Status." )
							inv_message.of_messagebox("Incomplete", "If you select an Action Type you must select an Action Status.", true)
							is_run_error = "Incomplete: If you select an Action Type you must select an Action Status."
							ib_run_sucess = false
							//---------End Modfiied ------------------------------------------------------
							Return -1
						END IF
						ls_action_type =  tab_1.tabpage_run.dw_wizard.GetItemString( i, "code" )
						ls_nd_actions = "( v_net_dev_actions.action_type_code = '" + ls_action_type + "' AND v_net_dev_actions.action_status_code = '" + ls_action_status + "') OR"
						is_net_dev_types = is_net_dev_types + ls_nd_actions + " "
					END IF
				END FOR
	
				is_filter = MidA( is_filter, 1, LenA( is_filter ) -2 ) 
				is_net_dev_types = MidA( is_net_dev_types, 1, LenA( is_net_dev_types ) -3 )
				
				if li_nd_cnt > 1 then //surround the 'ORs'
					is_net_dev_types = " (" + is_net_dev_types + ") "
				end if
				
				IF LenA( is_net_dev_types ) < 4 THEN
					//---------Begin Modified by (Appeon)Stephen 04.23.2014 for V142 Schedule IntelliReport--------
					//MessageBox("Selection Error", "You must check off at least one Action Type or select All." )
					inv_message.of_messagebox("Selection Error", "You must check off at least one Action Type or select All.", true)
					is_run_error = "Selection Error: You must check off at least one Action Type or select All."
					ib_run_sucess = false
					//---------End Modfiied ------------------------------------------------------
					Return -1
				END IF		
			END IF		
			is_sql_where = is_sql_where + is_net_dev_types
			//Messagebox("", is_net_dev_types )
//	ELSEIF tab_1.tabpage_run.dw_wizard.DataObject = "d_crit_app_payor" then //maha 071604
//		if tab_1.tabpage_run.dw_wizard.GetItemNumber( 1, "selected" ) = 1 then
//			//skip
//		else
//			if tab_1.tabpage_run.dw_wizard.RowCount() > 1 then //trap
//				for i = 2 to tab_1.tabpage_run.dw_wizard.RowCount()
//					if tab_1.tabpage_run.dw_wizard.GetItemNumber( i, "selected" ) = 1 THEN
//						ls_app_name = tab_1.tabpage_run.dw_wizard.GetItemString( i, "application_name" )
//						is_sql_where = is_sql_where + " (" + ls_app_name + ") "
//						continue
//					end if
//				next
//			end if
//		end if


//Start Code Change ----11.03.2014 #V14.2 maha
		ELSEIF tab_1.tabpage_run.dw_wizard.DataObject =  "d_crit_appmnt_status_ireport"  then 
			is_appmnt_status = ""
			ii_appt_stat[] = li_appt_stat[] 
			IF tab_1.tabpage_run.dw_wizard.GetItemNumber( 1, "active" ) = 1 THEN
				is_appmnt_status = is_appmnt_status + "1,"
				li_as_cnt++
				ii_appt_stat[li_as_cnt] = 1
			END IF
			IF tab_1.tabpage_run.dw_wizard.GetItemNumber( 1, "pending" ) = 1 THEN
				is_appmnt_status = is_appmnt_status + "4,"
				li_as_cnt++
				ii_appt_stat[li_as_cnt] = 4
			END IF			
			IF tab_1.tabpage_run.dw_wizard.GetItemNumber( 1, "inactive" ) = 1 THEN
				is_appmnt_status = is_appmnt_status + "3,"
				li_as_cnt++
				ii_appt_stat[li_as_cnt] = 3
			END IF						
			IF tab_1.tabpage_run.dw_wizard.GetItemNumber( 1, "history1" ) = 1 THEN
				is_appmnt_status = is_appmnt_status + "0,"
				li_as_cnt++
				ii_appt_stat[li_as_cnt] = 0
			END IF
			//Start Code Change ----10.10.2014 #V14.2 maha
			IF tab_1.tabpage_run.dw_wizard.GetItemNumber( 1, "midcycle" ) = 1 THEN
				is_appmnt_status = is_appmnt_status + "6,"
				li_as_cnt++
				ii_appt_stat[li_as_cnt] = 0
			END IF
			//End Code Change ----10.10.2014
			if is_appmnt_status = "" then
				MessageBox("Selection Error", "You must select at least one Appointment Status. ")
				Return -1
			ELSE
				is_appmnt_status =  MidA( is_appmnt_status, 1, LenA( is_appmnt_status ) -1 )
			end if
			
			is_sql_where = is_sql_where + " v_affil_stat.active_status in (" + is_appmnt_status + ") "
			
		ELSEIF tab_1.tabpage_run.dw_wizard.DataObject =  "d_crit_active_status"  then 
			is_data_status = ""
			ii_data_stat[] = li_data_stat[] 
			IF tab_1.tabpage_run.dw_wizard.GetItemNumber( 1, "active" ) = 1 THEN
				is_data_status = is_data_status + "1,"
				li_as_cnt++
				ii_data_stat[li_as_cnt] = 1
			END IF
			IF tab_1.tabpage_run.dw_wizard.GetItemNumber( 1, "recent" ) = 1 THEN
				is_data_status = is_data_status + "2,"
				li_as_cnt++
				ii_data_stat[li_as_cnt] = 4
			END IF			
			IF tab_1.tabpage_run.dw_wizard.GetItemNumber( 1, "inactive" ) = 1 THEN
				is_data_status = is_data_status + "0,"
				li_as_cnt++
				ii_data_stat[li_as_cnt] = 3
			END IF						

			if is_data_status = "" then
				MessageBox("Selection Error", "You must select at least one status. ")
				Return -1
			ELSE
				is_data_status =  MidA( is_data_status, 1, LenA( is_data_status ) -1 )
			end if
			
			is_sql_where = is_sql_where + is_wizard_field_name[ii_current_wizard_step] + " in (" + is_data_status + ") "
			
//End Code Change ----11.03.2014	
	ELSE
		//$<modify> 07.11.2008 by Andy
		//$<Reason> fixed BugG071101
		//IF tab_1.tabpage_run.dw_wizard.GetItemNumber( 1, "selected" ) = 0 THEN  //if all is not selected
		//--------Begin modified by Alfee 12.30.2009 --------------------------------
		//<$Reason>facility security control 
		//IF tab_1.tabpage_run.dw_wizard.GetItemNumber( 1, "selected" ) = 0 and &
		//		tab_1.tabpage_run.dw_wizard.Find("selected=1",1,tab_1.tabpage_run.dw_wizard.RowCount()) > 0 THEN  //if all is not selected and exists selected item
		li_rc = tab_1.tabpage_run.dw_wizard.RowCount()
		li_select_all = tab_1.tabpage_run.dw_wizard.GetItemNumber(1, "selected")		
		IF (li_select_all = 0 OR (li_select_all = 1 AND is_wizard_lookup_type[ii_current_wizard_step] = "F" )) AND & 
			tab_1.tabpage_run.dw_wizard.Find("selected=1", 1, li_rc) > 0 THEN 
			//li_rc = tab_1.tabpage_run.dw_wizard.RowCount()			
		//--------End Modified ------------------------------------------------------					
		//end modify 07.11.2008
			li_rc = tab_1.tabpage_run.dw_wizard.RowCount()	
			FOR i = 1 TO li_rc
				IF i = 1 AND is_wizard_lookup_type[ii_current_wizard_step] = "F" THEN Continue //facility secutiry control - alfee 12.30.2009				
				
				ii_total_where_values ++
				//IF tab_1.tabpage_run.dw_wizard.GetItemNumber( i, "selected" ) = 1 THEN
				IF tab_1.tabpage_run.dw_wizard.GetItemNumber( i, "selected" ) = 1 OR li_select_all = 1 then //facility security control - alfee 12.30.2009
					li_first_param++
					IF li_first_param = 1 THEN
						is_sql_where = is_sql_where + "("
					END IF
					IF PosA( is_filter, is_wizard_lookup_name[ ii_current_wizard_step ] ) = 0 THEN
						IF LenA( is_filter ) > 1 THEN
							is_filter = is_filter + " : "
						END IF
						if li_select_all <> 1 then is_filter = is_filter + is_wizard_lookup_name[ ii_current_wizard_step ] + " = " //facility security control - alfee 12.30.2009	
						//is_filter = is_filter + is_wizard_lookup_name[ ii_current_wizard_step ] + " = "
					END IF
					is_sql_where = is_sql_where + is_wizard_field_name[ ii_current_wizard_step ] + " = '" 
					IF is_wizard_lookup_type[ ii_current_wizard_step ] = "C" THEN  //code lookup
						IF is_wizard_compare_field[ ii_current_wizard_step ] = "C" THEN //code field
							//$<modify> 03.28.2008 by Andy 
							//Reason:The field saved the Code Lookup values if the Code Lookup is used for the field in the Screen View Data,
							//       so the where clause should use the Code Lookup values,not code or description,
							//       otherwise the report will no results returned if select the values from the list. 
							//is_sql_where = is_sql_where + tab_1.tabpage_run.dw_wizard.GetItemString( i, "code" ) + "' OR " 	
							IF Upper(is_screen_lookup_type[ ii_current_wizard_step ]) = "C" THEN
								is_sql_where = is_sql_where + String(tab_1.tabpage_run.dw_wizard.GetItemNumber( i, "lookup_code" )) + "' OR " 	
								//167:varchar,175:char
								//If column type is char or varchar,maybe it will return lookup code or description,
								//so the where clause should also use the code or description values.
								if is_wizard_coltype[ ii_current_wizard_step ] = '167' OR is_wizard_coltype[ ii_current_wizard_step ] = '175' OR &
									is_wizard_coltype[ ii_current_wizard_step ] = 'varchar' OR is_wizard_coltype[ ii_current_wizard_step ] = 'char' THEN
									is_sql_where = is_sql_where + is_wizard_field_name[ ii_current_wizard_step ] + " = '" + tab_1.tabpage_run.dw_wizard.GetItemString( i, "code" ) + "' OR " 	
								END IF
							ELSE
								is_sql_where = is_sql_where + tab_1.tabpage_run.dw_wizard.GetItemString( i, "code" ) + "' OR " 	
							END IF
							//End modify 03.28.2008
							is_filter = is_filter + " " + tab_1.tabpage_run.dw_wizard.GetItemString( i, "code" ) + ","
						ELSE //description
							//$<modify> 03.28.2008 by Andy
							//is_sql_where = is_sql_where + tab_1.tabpage_run.dw_wizard.GetItemString( i, "description" ) + "' OR " 
							IF Upper(is_screen_lookup_type[ ii_current_wizard_step ]) = "C" THEN
								is_sql_where = is_sql_where + String(tab_1.tabpage_run.dw_wizard.GetItemNumber( i, "lookup_code" )) + "' OR "
								//167:varchar,175:char
								if is_wizard_coltype[ ii_current_wizard_step ] = '167' OR is_wizard_coltype[ ii_current_wizard_step ] = '175' OR &
									is_wizard_coltype[ ii_current_wizard_step ] = 'varchar' OR is_wizard_coltype[ ii_current_wizard_step ] = 'char' THEN
									//------------------- APPEON BEGIN -------------------
									//$<modify> Stephen 09.02.2011
									//$<reason> Bug 2599 - IntelliReport
									/*
									is_sql_where = is_sql_where + is_wizard_field_name[ ii_current_wizard_step ] + " = '" + tab_1.tabpage_run.dw_wizard.GetItemString( i, "description" ) + "' OR " 	
									
									*/
									ls_name = tab_1.tabpage_run.dw_wizard.GetItemString( i, "description" )
									ls_name =  of_replace(ls_name,"'","''")
									is_sql_where = is_sql_where + is_wizard_field_name[ ii_current_wizard_step ] + " = '" + ls_name + "' OR " 	
									//------------------- APPEON END ---------------------	
								END IF
							ELSE
								//------------------- APPEON BEGIN -------------------
								//$<modify> Stephen 09.02.2011
								//$<reason> Bug 2599 - IntelliReport
								/*
								is_sql_where = is_sql_where + tab_1.tabpage_run.dw_wizard.GetItemString( i, "description" ) + "' OR " 
								*/
								ls_name = tab_1.tabpage_run.dw_wizard.GetItemString( i, "description" )
								ls_name =  of_replace(ls_name,"'","''")
								is_sql_where = is_sql_where + ls_name + "' OR " 
								//------------------- APPEON END ---------------------	
							END IF
							//End modify 03.28.2008
							is_filter = is_filter + " " + tab_1.tabpage_run.dw_wizard.GetItemString( i, "description" ) + ","
						END IF
					ELSEIF is_wizard_lookup_type[ ii_current_wizard_step ] = "A" THEN //address_lookup
						IF is_wizard_compare_field[ ii_current_wizard_step ] = "C" THEN		//code
							//$<modify> 03.28.2008 by Andy
							//is_sql_where = is_sql_where + tab_1.tabpage_run.dw_wizard.GetItemString( i, "code" ) + "' OR " 		
							IF Upper(is_screen_lookup_type[ ii_current_wizard_step ]) = "A" THEN
								is_sql_where = is_sql_where + String(tab_1.tabpage_run.dw_wizard.GetItemNumber( i, "lookup_code" )) + "' OR " 
								//167:varchar,175:char
								if is_wizard_coltype[ ii_current_wizard_step ] = '167' OR is_wizard_coltype[ ii_current_wizard_step ] = '175' OR &
									is_wizard_coltype[ ii_current_wizard_step ] = 'varchar' OR is_wizard_coltype[ ii_current_wizard_step ] = 'char' THEN
									is_sql_where = is_sql_where + is_wizard_field_name[ ii_current_wizard_step ] + " = '" + tab_1.tabpage_run.dw_wizard.GetItemString( i, "code" ) + "' OR " 	
								END IF
							ELSE
								is_sql_where = is_sql_where + tab_1.tabpage_run.dw_wizard.GetItemString( i, "code" ) + "' OR " 										
							end if
							//End modify 03.28.2008
							is_filter = is_filter + " " + tab_1.tabpage_run.dw_wizard.GetItemString( i, "code" ) + ","							
						ELSE //entity_name
							//$<modify> 03.28.2008 by Andy
							//is_sql_where = is_sql_where + tab_1.tabpage_run.dw_wizard.GetItemString( i, "entity_name" ) + "' OR " 
							IF Upper(is_screen_lookup_type[ ii_current_wizard_step ]) = "A" THEN
								is_sql_where = is_sql_where + String(tab_1.tabpage_run.dw_wizard.GetItemNumber( i, "lookup_code" )) + "' OR "
								//167:varchar,175:char
								if is_wizard_coltype[ ii_current_wizard_step ] = '167' OR is_wizard_coltype[ ii_current_wizard_step ] = '175' OR &
									is_wizard_coltype[ ii_current_wizard_step ] = 'varchar' OR is_wizard_coltype[ ii_current_wizard_step ] = 'char' THEN
									//------------------- APPEON BEGIN -------------------
									//$<modify> Stephen 09.02.2011
									//$<reason> Bug 2599 - IntelliReport
									/*
									is_sql_where = is_sql_where + is_wizard_field_name[ ii_current_wizard_step ] + " = '" + tab_1.tabpage_run.dw_wizard.GetItemString( i, "entity_name" ) + "' OR " 	
									*/
									ls_name = tab_1.tabpage_run.dw_wizard.GetItemString( i, "entity_name" )
									ls_name =  of_replace(ls_name,"'","''")
									is_sql_where = is_sql_where + is_wizard_field_name[ ii_current_wizard_step ] + " = '" + ls_name + "' OR " 	
									//------------------- APPEON END ---------------------									
								END IF
							ELSE
								//------------------- APPEON BEGIN -------------------
								//$<modify> Stephen 09.02.2011
								//$<reason> Bug 2599 - IntelliReport
								/*
								is_sql_where = is_sql_where + tab_1.tabpage_run.dw_wizard.GetItemString( i, "entity_name" ) + "' OR " 
								*/
								ls_name = tab_1.tabpage_run.dw_wizard.GetItemString( i, "entity_name" )
								ls_name =  of_replace(ls_name,"'","''")
								is_sql_where = is_sql_where + ls_name + "' OR " 
								//------------------- APPEON END ---------------------
							END IF
							//End modify 03.28.2008
							is_filter = is_filter + " " + tab_1.tabpage_run.dw_wizard.GetItemString( i, "entity_name" ) + ","														
						END IF
					ELSEIF  is_wizard_lookup_type[ ii_current_wizard_step ] = "F" THEN //facility
							ls_facility_name =  tab_1.tabpage_run.dw_wizard.GetItemString( i, "facility_name" )
							//added by nova 07.22.2008
							ls_facility_name =  of_replace(ls_facility_name,"'","''")
							
							is_facility_name = is_facility_name + ", " + ls_facility_name //maha 101602
							is_sql_where = is_sql_where + ls_facility_name + "' OR " 
							if li_select_all <> 1 then is_filter = is_filter + " " + ls_facility_name + "," //facility security control - alfee 12.30.2009
							//is_filter = is_filter + " " + ls_facility_name + ","														
					ELSEIF  is_wizard_lookup_type[ ii_current_wizard_step ] = "P" THEN //facility
							ls_app_name =  tab_1.tabpage_run.dw_wizard.GetItemString( i, "application_name" )
							is_filter = is_filter + " " + ls_app_name + ","																					
							ls_app_name = of_replace(ls_app_name,"'","''") //Stephen 09.02.2011 Bug 2599 - IntelliReport
							is_appl_name = is_appl_name + ", " + ls_app_name //maha 101602
							is_sql_where = is_sql_where + ls_app_name + "' OR " 	
					//--------Begin Added by Nova 08.19.2010------------------------
					//V10.5 SK IntelliReport
					ELSEIF  is_wizard_lookup_type[ ii_current_wizard_step ] = "X" THEN //08.19
							ll_prac_id =  tab_1.tabpage_run.dw_wizard.GetItemNumber( i, "prac_id" )
							is_filter = is_filter + " " + string(ll_prac_id) + ","																					
							is_sql_where = is_sql_where + string(ll_prac_id) + "' OR " 
					ELSEIF  is_wizard_lookup_type[ ii_current_wizard_step ] = "Y" THEN //08.19
						ls_street =  tab_1.tabpage_run.dw_wizard.GetItemString( i, "street" )
						is_filter = is_filter + " " + string(ls_street) + ","		
						ls_street = of_replace(ls_street,"'","''") //Stephen 09.02.2011 Bug 2599 - IntelliReport
						is_sql_where = is_sql_where + string(ls_street) + "' OR " 		
					//--------End Added --------------------------------------------
					elseif is_wizard_lookup_type[ ii_current_wizard_step ] = "L" THEN //address type
						is_address_types = " And ("
						IF tab_1.tabpage_run.dw_wizard.GetItemNumber( 1, "primary" ) = 1 THEN
							is_address_types = is_address_types + " pd_address_link.primary_office = 1 OR "
							is_filter = is_filter + " Primary ,"														
						END IF
						IF tab_1.tabpage_run.dw_wizard.GetItemNumber( 1, "additional" ) = 1 THEN
							is_address_types = is_address_types + " pd_address_link.additional_office = 1 OR "
							is_filter = is_filter + " Additional ,"																					
						END IF			
						IF tab_1.tabpage_run.dw_wizard.GetItemNumber( 1, "billing" ) = 1 THEN
							is_address_types = is_address_types + " pd_address_link.billing = 1 OR "
							is_filter = is_filter + " Billing ,"																					
						END IF						
						IF tab_1.tabpage_run.dw_wizard.GetItemNumber( 1, "home" ) = 1 THEN
							is_address_types = is_address_types + " pd_address_link.home_address = 1 OR "
							is_filter = is_filter + " Home ,"																					
						END IF
						IF tab_1.tabpage_run.dw_wizard.GetItemNumber( 1, "mailing" ) = 1 THEN
							is_address_types = is_address_types + " pd_address_link.mailing = 1 OR "
							is_filter = is_filter + " Mailing ,"																					
						END IF
						is_address_types = MidA( is_address_types, 1, LenA( is_address_types ) -3 ) + ")"
			
						IF is_address_types = " And (" THEN
							//---------Begin Modified by (Appeon)Stephen 04.23.2014 for V142 Schedule IntelliReport--------
							//MessageBox("Selection Error", "You must select at least one address Type. ")
							inv_message.of_messagebox("Selection Error", "You must select at least one address Type. ", true)
							is_run_error = "Selection Error: You must select at least one address Type. "
							ib_run_sucess = false
							//---------End Modfiied ------------------------------------------------------
							Return -1
						END IF
						
					//Start Code Change ----11.03.2014 #V14.2 maha
					elseif is_wizard_lookup_type[ ii_current_wizard_step ] = "S" THEN 
						
					elseif is_wizard_lookup_type[ ii_current_wizard_step ] = "T" THEN 
						
					elseif is_wizard_lookup_type[ ii_current_wizard_step ] = "N" THEN //action type	maha 071404
						//dw_wizard.DataObject = "d_crit_net_dev_type"
					END IF
				ELSE
					//is_filter = is_filter + " " + is_wizard_lookup_name[ ii_current_wizard_step ] + " All "
				END IF
			END FOR
			
			//$<Modify> 02.22.2008 by Andy
			//$Reason:fixed a bug from Robert Goemans
			//is_filter = Mid( is_filter, 1, Len( is_filter ) -2 )
			is_filter = MidA( is_filter, 1, LenA( is_filter ) -1 )
			//end of modify 02.22.2008
			is_address_types = MidA( is_address_types, 1, LenA( is_address_types ) -3 ) + ")"

			if is_wizard_lookup_type[ ii_current_wizard_step ] = "F" THEN //facility
				is_facility_name = MidA(	is_facility_name, 3)
			end if
			if is_wizard_lookup_type[ ii_current_wizard_step ] = "P" THEN //Application
				is_appl_name = MidA(	is_appl_name, 3)
			end if
			is_sql_where = MidA( is_sql_where, 1, LenA( is_sql_where ) -3 ) + ")"		//get rid of " or "
			IF li_first_param = 0 THEN
				is_sql_where = MidA( is_sql_where, 1, LenA( is_sql_where ) -2 )
			END IF
		ELSE 
			if is_wizard_lookup_type[ ii_current_wizard_step ] = "F" THEN //maha 101602
				is_facility_name = "All Facilities"
			end if
		END IF
	END IF
END IF

//MessageBox("", is_sql_where )

ii_current_wizard_step++
//Goto next wizard step or run report if its the last step
IF ii_current_wizard_step > ii_total_wizard_steps THEN 
	///*************run report********************
	//\/maha 112102 for user facility security
	//if ii_facil_security = 1 then
	//if ii_facil_security = 1 and (not gb_contract_version) then	//08.28.2007 By Jervis
	if ii_facil_security = 1 and (il_module=2) then //04.03.2008 by Andy Reason:fixed BugG040302
		IF RightA( is_sql_where, 5 ) = " AND " or RightA( is_sql_where, 7 ) = " WHERE " THEN //maha changed 101602
		else
			is_sql_where = is_sql_where + " AND "
		end if		
		is_sql_where = is_sql_where + " security_user_facilities.facility_id = v_affil_stat.parent_facility_id and  security_user_facilities.access_rights = 1 and security_user_facilities.user_id = '" + gs_user_id + "'~r "
	end if
	
	//jad department security
	//if ii_dept_security_on = 1  and (not gb_contract_version) then	//08.28.2007 By Jervis
	if ii_dept_security_on = 1  and (il_module=2) then //04.03.2008 by Andy Reason:fixed BugG040302
		IF RightA( is_sql_where, 5 ) = " AND " or RightA( is_sql_where, 7 ) = " WHERE " THEN //maha changed 101602
		else
			is_sql_where = is_sql_where + " AND "
		end if
		//<Modify> 08/11/2007 by: Andy
		//is_sql_where = is_sql_where + " security_user_department.department_id = v_dept.dept_id and  security_user_department.access_rights = 1 and security_user_department.user_id = '" + gs_user_id + "'~r "
		//is_sql_where = is_sql_where + " security_user_department.access_rights = 1 and security_user_department.user_id = '" + gs_user_id + "'~r "
		is_sql_where = is_sql_where + " security_user_department.department_id = v_affil_dept.dept_id and  security_user_department.access_rights = 1 and security_user_department.user_id = '" + gs_user_id + "'~r "
		//end of modify
	end if	
	
	//\maha
	IF RightA( is_sql_where, 5 ) = " AND " THEN
		is_sql_where = MidA( is_sql_where, 1, LenA( is_sql_where ) -5 )
	END IF			
	IF RightA( is_sql_where, 7 ) = " WHERE " THEN
		is_sql_where = MidA( is_sql_where, 1, LenA( is_sql_where ) -7 )
	END IF				
	//IF Len( is_sql_where ) = 5 THEN
	//	is_sql_where = ""
	//END IF
	
	//--------------------------- APPEON BEGIN ---------------------------
	//$<add> 2007-12-19 By: Andy
	//$<Reason> Preview area should take up the whole area of the window to the left.
	tab_1.tabpage_run.dw_wizard.visible = false
	tab_1.tabpage_run.dw_run.x = 32
	tab_1.tabpage_run.dw_run.width = tab_1.tabpage_run.width - 64
	//tab_1.tabpage_run.dw_run.bringtotop = True
	//---------------------------- APPEON END ----------------------------

	tab_1.tabpage_run.dw_run.SetRedraw(false)
	//--------Begin Modified by  Nova 08.18.2010------------------------
	//V10.5 SK IntelliReport
	//of_preview( tab_1.tabpage_run.dw_run )
	
//@@@@@@RUN the REPORT@@@@@@@@@@@@@@@@

	of_preview( tab_1.tabpage_run.dw_run,1 )
	//--------End Modified --------------------------------------------			
	of_modify_dw(tab_1.tabpage_run.dw_run)	// Evan 09.02.2010 (V10.5-Advanced Report)
	//tab_1.tabpage_run.dw_run.retrieve()   //add by stephen 12.27.2012 Bug 3358 : Report is not pulling the correct data //long.zhang 02.19.2014 commented IntelliReport runs query twice
	
	tab_1.tabpage_run.dw_run.SetRedraw(true)
	
	//Start Code Change ----12.18.2007 #V8 maha -- removed because it does not allow reset on reports only using filter wizards
//	//--------------------------- APPEON BEGIN ---------------------------
//	//$< Add  > 2007-08-24 By: Scofield
//	//$<Reason> if this is no where clause then disable the reset button 
//	if tab_1.tabpage_filter.dw_view_where.RowCount() <= 0 then
//		tab_1.tabpage_run.cb_17.Enabled = false	//Disable the reset button
//	else
//		tab_1.tabpage_run.cb_17.Enabled = true		//Enable the reset button
//	end if
//	//---------------------------- APPEON END ----------------------------
	//End Code Change---12.18.2007
	
	ii_current_wizard_step = 0
	tab_1.tabpage_run.dw_wizard.Reset()
	tab_1.tabpage_run.cb_next_run.Enabled = False
	tab_1.tabpage_run.cb_sql.Enabled = True	
	
	//Start Code Change ----11.02.2011 #V12 maha - added trap
	if tab_1.tabpage_run.dw_run.Describe("v_basic_info_prac_id.ColType") <> "!" then
		lb_true = true
	elseif tab_1.tabpage_run.dw_run.Describe("v_full_name_prac_id.ColType") <> "!" then
		lb_true = true
	elseif tab_1.tabpage_run.dw_run.Describe("v_full_basic_prac_id.ColType") <> "!" then
		lb_true = true
	elseif tab_1.tabpage_run.dw_run.Describe("v_basic_prac_id.ColType") <> "!" then
		lb_true = true
	elseif tab_1.tabpage_run.dw_run.Describe("prac_id.ColType") <> "!" then
		lb_true = true	
	else	
		lb_true = false
	end if
	
	of_export_report(tab_1.tabpage_run.dw_run) //(Appeon)Stephen 05.15.2014 - IntelliReport Modifications 14.2
	tab_1.tabpage_run.cb_batch_filter.enabled = lb_true
	//End Code Change ----11.02.2011 
	
ELSE //create next wizard
	tab_1.tabpage_run.st_step.Text = "Step " + String( ii_current_wizard_step ) + " of " + String( ii_total_wizard_steps )
	IF is_wizard_lookup_type[ ii_current_wizard_step ] = "C" THEN
		tab_1.tabpage_run.dw_wizard.DataObject = "d_crit_custom"		
	//if its a date range
	ELSEIF is_wizard_lookup_type[ ii_current_wizard_step ] = "R" THEN
		//tab_1.tabpage_run.dw_wizard.Reset()
		//tab_1.tabpage_run.dw_wizard.DataObject = "d_app_note"				
		//tab_1.tabpage_run.dw_wizard.of_setTransObject(sqlca)
		tab_1.tabpage_run.dw_wizard.Reset()		
		tab_1.tabpage_run.dw_wizard.DataObject = "d_crit_date_range_custom"		
		//tab_1.tabpage_run.dw_wizard.of_settransobject(sqlca)
	ELSEIF is_wizard_lookup_type[ ii_current_wizard_step ] = "D" THEN		
		tab_1.tabpage_run.dw_wizard.Reset()		
		tab_1.tabpage_run.dw_wizard.DataObject = "d_crit_single_date_custom"				
	ELSEIF is_wizard_lookup_type[ ii_current_wizard_step ] = "F" THEN		
		tab_1.tabpage_run.dw_wizard.DataObject = "d_crit_facility"
	ELSEIF is_wizard_lookup_type[ ii_current_wizard_step ] = "L" THEN	
		//messagebox("","")
		tab_1.tabpage_run.dw_wizard.DataObject = "d_crit_address_type_ir"		
	elseif is_wizard_lookup_type[ ii_current_wizard_step ] = "N" THEN	 //maha 071404
		tab_1.tabpage_run.dw_wizard.DataObject = "d_crit_net_dev_type_ir"	
	elseif is_wizard_lookup_type[ ii_current_wizard_step ] = "P" THEN		//maha 071604
		tab_1.tabpage_run.dw_wizard.DataObject = "d_crit_app_payor"	
	//--------Begin Added by Nova 08.19.2010------------------------
	//V10.5 SK IntelliReport	
	elseif is_wizard_lookup_type[ ii_current_wizard_step ] = "X" THEN		
		tab_1.tabpage_run.dw_wizard.DataObject = "d_crit_practitioner"	
	elseif is_wizard_lookup_type[ ii_current_wizard_step ] = "Y" THEN		
		tab_1.tabpage_run.dw_wizard.DataObject = "d_crit_practice_locations"		
	//--------End Added --------------------------------------------
	//Start Code Change ----11.03.2014 #V14.2 maha - added for active ststus
	elseif is_wizard_lookup_type[ ii_current_wizard_step ] = "S" THEN		
		tab_1.tabpage_run.dw_wizard.DataObject = "d_crit_appmnt_status_ireport"	
	elseif is_wizard_lookup_type[ ii_current_wizard_step ] = "T" THEN		
		tab_1.tabpage_run.dw_wizard.DataObject = "d_crit_active_status"		
	//End Code Change ----11.03.2014
	ELSE
		tab_1.tabpage_run.dw_wizard.DataObject = "d_crit_custom_address"
	END IF
	tab_1.tabpage_run.dw_wizard.of_SetRowManager( TRUE )
	tab_1.tabpage_run.dw_wizard.of_SetReqColumn(True)

	tab_1.tabpage_run.dw_wizard.of_SetDropDownCalendar( TRUE )
	tab_1.tabpage_run.dw_wizard.iuo_calendar.of_UnRegister()	//Add By Jervis 10-06-2008
	tab_1.tabpage_run.dw_wizard.iuo_calendar.of_Register(tab_1.tabpage_run.dw_wizard.iuo_calendar.DDLB)
	
	tab_1.tabpage_run.dw_wizard.SetTransObject( SQLCA )
	if tab_1.tabpage_run.dw_wizard.DataObject = "d_crit_facility" then
		tab_1.tabpage_run.dw_wizard.Retrieve( gs_user_id ) //maha 111902 lij
	//Start Code Change ----11.03.2014 #V14.2 maha	
	elseif tab_1.tabpage_run.dw_wizard.DataObject = "d_crit_appmnt_status_ireport" or tab_1.tabpage_run.dw_wizard.DataObject = "d_crit_active_status" then
		//debugbreak()
	//	tab_1.tabpage_run.dw_wizard.insertrow(1)
	//End Code Change ----11.03.2014
	else
		tab_1.tabpage_run.dw_wizard.Retrieve( is_wizard_lookup_name[ ii_current_wizard_step ] )
	end if
	//---------Begin Added by (Appeon)Toney 06.11.2013 for V141 ISG-CLX--------
	//Added By Ken.Guo 09/19/2012. Workaround PB11.5's Bug. External DW don't trigger RetrieveEnd Event.
	If tab_1.tabpage_run.dw_wizard.RowCount() = 0 Then
		tab_1.tabpage_run.dw_wizard.event retrieveend(0)
	End If	
	//---------End Added ------------------------------------------------------------------

	//$<Modify> 04.18.2008 by Andy
	//Reason:Fixed issue from John. Column label + " Filter" as the text.
	//tab_1.tabpage_run.dw_wizard.Modify( "st_name.text = '" + is_wizard_lookup_name[ ii_current_wizard_step ] + " for " + is_wizard_field_name[ ii_current_wizard_step ] + "'" )
	tab_1.tabpage_run.dw_wizard.Modify( "st_name.text = '" + is_wizard_field_label[ ii_current_wizard_step ] + " Filter'" )
	//end modify 04.18.2008
END IF
//		tab_rpt.tabpage_criteria.dw_criteria.InsertRow( 1 )
//		tab_rpt.tabpage_criteria.dw_criteria.SetItem( 1, "lookup_code", 0 )
//		tab_rpt.tabpage_criteria.dw_criteria.SetItem( 1, "code", "All" )		
//		tab_rpt.tabpage_criteria.dw_criteria.SetItem( 1, "description", "Include All Selections" )		
//		tab_rpt.tabpage_criteria.dw_criteria.SetItem( 1, "selected", 1 )
RETURN 0
end function

public function integer of_clean_up ();
tab_1.tabpage_tables.dw_view_tables.Reset()
tab_1.tabpage_tables.dw_view_links.Reset()
tab_1.tabpage_columns.dw_view_fields.Reset()
tab_1.tabpage_filter.dw_view_where.Reset()
tab_1.tabpage_sort.dw_view_sort.Reset()
is_facility_name = ""
ii_total_wizard_steps = 0
ii_current_wizard_step = 0
ii_total_where_values = 0
is_sql_where = ""
is_address_types = ""
is_net_dev_types = ""

Return 1
end function

public function integer of_retrieve_report (long al_view);//moved from doubleclicked event of report browse
Integer li_rc
Integer i
Integer li_found
Integer li_add_rec_fld
Integer li_distinct_sql
String ls_field
String ls_table_ids[]
Long    ll_advanced //$<add> 03.27.2008 by Andy

ib_new = False

if upper(is_mod_user) = upper(gs_user_id) then //maha 111902
	tab_1.tabpage_columns.Enabled = True
	tab_1.tabpage_filter.Enabled = True
	tab_1.tabpage_preview.Enabled = True
	tab_1.tabpage_sort.Enabled = True
	tab_1.tabpage_tables.Enabled = True
else
	tab_1.tabpage_columns.Enabled = false
	tab_1.tabpage_filter.Enabled = false
	tab_1.tabpage_preview.Enabled = false
	tab_1.tabpage_sort.Enabled = false
	tab_1.tabpage_tables.Enabled = false	
end if

tab_1.tabpage_run.Enabled = True
//--------------------------- APPEON BEGIN ---------------------------
//$<ID> PT-04
//$<modify> 02.08.2006 By: Rodger Wu
//$<reason> Performance tuning
//$<modification> Collect all SQL statements and datawindow for retrieving data and integrate them into 
//$<modification> Appeon Queue Labels to reduce the client-server interactions to improve runtime performance.
/*
tab_1.tabpage_tables.dw_view_tables.Retrieve( al_view )
of_get_next_ids()
*/
gnv_appeonDb.of_StartQueue()

tab_1.tabpage_tables.dw_view_tables.Retrieve( al_view )
SELECT Max( table_id )  
INTO :il_next_table_id  
FROM conv_view_table;

SELECT Max( link_id )  
INTO :il_next_link_id  
FROM conv_view_links;

SELECT Max( sort_id )  
INTO :il_next_sort_id  
FROM conv_view_sort;

SELECT Max( field_id )  
INTO :il_next_field_id  
FROM conv_view_fields;

SELECT Max( where_id )  
INTO :il_next_where_id  
FROM conv_view_where;

gnv_appeondb.of_CommitQueue()

IF IsNull( il_next_table_id ) THEN
	il_next_table_id = 1
END IF

IF IsNull( il_next_link_id ) THEN
	il_next_link_id = 1
END IF

IF IsNull( il_next_field_id ) THEN
	il_next_field_id = 1
END IF

IF IsNull( il_next_sort_id ) THEN
	il_next_sort_id = 1
END IF

IF IsNull( il_next_where_id ) THEN
	il_next_where_id = 1
END IF

//---------------------------- APPEON END ----------------------------

li_rc = tab_1.tabpage_tables.dw_view_tables.RowCount()
FOR i = 1 TO li_rc
	ls_table_ids[i] = tab_1.tabpage_tables.dw_view_tables.GetItemString( i, "conv_view_table_table_name" ) 
END FOR
//--------------------------- APPEON BEGIN ---------------------------
//$<ID> PT-05
//$<modify> 02.08.2006 By: Rodger Wu
//$<reason> Performance tuning
//$<reason> Collect SQL statements and DataWindows for retrieving data and integrate them into 
//$<reason> Appeon Queue Labels to reduce client-server interactions to improve runtime performance.
/*
IF li_rc > 0 THEN
	tab_1.tabpage_columns.dw_fields_list.Retrieve( ls_table_ids )
	tab_1.tabpage_columns.dw_all_fields.Retrieve( ls_table_ids )
END IF	

tab_1.tabpage_tables.dw_view_links.Retrieve( al_view )
tab_1.tabpage_columns.dw_view_fields.Retrieve( al_view )
tab_1.tabpage_filter.dw_view_where.Retrieve( al_view )

li_rc = tab_1.tabpage_columns.dw_view_fields.RowCount()
FOR i = 1 TO li_rc
	ls_field = tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "table_field" )
	li_found = tab_1.tabpage_columns.dw_fields_list.Find( "table_field = '" + ls_field + "'", 1, 10000 )
	IF li_found > 0 THEN
		tab_1.tabpage_columns.dw_fields_list.DeleteRow( li_found )
	END IF
END FOR

SELECT conv_view.add_rec_id_fld  
INTO :li_add_rec_fld  
FROM conv_view  
WHERE conv_view.view_id = :al_view   ;

IF li_add_rec_fld  = 1 THEN
	//cbx_rec_id.Checked = True
ELSE
	//cbx_rec_id.Checked = False
END IF

SELECT conv_view.distinct_sql
INTO :li_distinct_sql  
FROM conv_view  
WHERE conv_view.view_id = :al_view   ;
*/
gnv_appeondb.of_StartQueue()
IF li_rc > 0 THEN
	//comment 12.13.2007 by: Andy
//	tab_1.tabpage_columns.dw_fields_list.Retrieve( ls_table_ids )
	tab_1.tabpage_columns.dw_all_fields.Retrieve( ls_table_ids )
	//$<add> 07.11.2008 by Andy
	//---------Begin Modified by (Appeon)Stephen 06.26.2014 for IntelliReport Modifications 14.2--------
	//ids_fields.Retrieve( ls_table_ids,il_data_view_id )
	ids_fields.Retrieve( ls_table_ids,il_data_view_id,  il_data_view_id_cont)
	//---------End Modfiied ------------------------------------------------------	
END IF	

tab_1.tabpage_tables.dw_view_links.Retrieve( al_view )
tab_1.tabpage_columns.dw_view_fields.Retrieve( al_view )
tab_1.tabpage_filter.dw_view_where.Retrieve( al_view )
//$<add> 04.16.2008 by Andy
tab_1.tabpage_sort.dw_view_sort.Retrieve(  al_view  )
//end add 04.16.2008

SELECT conv_view.add_rec_id_fld, conv_view.distinct_sql, conv_view.advanced_linking
INTO :li_add_rec_fld, :li_distinct_sql, :ll_advanced
FROM conv_view  
WHERE conv_view.view_id = :al_view   ;
gnv_appeondb.of_CommitQueue()

li_rc = tab_1.tabpage_columns.dw_view_fields.RowCount()
//comment 12.13.2007 by: Andy
//FOR i = 1 TO li_rc
//	ls_field = tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "table_field" )
//	li_found = tab_1.tabpage_columns.dw_fields_list.Find( "table_field = '" + ls_field + "'", 1, 10000 )
//	IF li_found > 0 THEN
//		tab_1.tabpage_columns.dw_fields_list.DeleteRow( li_found )
//	END IF
//END FOR

IF li_add_rec_fld  = 1 THEN
	//cbx_rec_id.Checked = True
ELSE
	//cbx_rec_id.Checked = False
END IF
//---------------------------- APPEON END ----------------------------

IF li_distinct_sql  = 1 THEN
	tab_1.tabpage_tables.cbx_distinct.Checked = True
ELSE
	tab_1.tabpage_tables.cbx_distinct.Checked = False
END IF

//$<add> 03.27.2008 by Andy
IF ll_advanced = 1 THEN
	tab_1.tabpage_tables.cbx_advanced.Checked = True
ELSE
	tab_1.tabpage_tables.cbx_advanced.Checked = False
END IF
tab_1.tabpage_tables.cbx_advanced.event clicked( )

//$<add> 04.25.2008 by Andy
//$<Reason> fixed a issue from John
tab_1.tabpage_preview.cbx_move_all.checked = False

return 1
end function

public function integer of_retrieve_detail (long al_view);long ll_vid
long ll_module
integer li_ret
string ls_name
datawindowchild 	dwchild
//--------------------------- APPEON BEGIN ---------------------------
//$<ID> PT-06
//$<comment> 02.07.2006 By: Rodger Wu
//$<reason> Performance tuning
//$<modification> Move the following script into the Open event of w_custom_report 
//$<modification> due to the usage of CreateOnDemand.
//tab_1.tabpage_browse.dw_detail.settransobject(sqlca)
//---------------------------- APPEON END ----------------------------
tab_1.tabpage_browse.dw_detail.retrieve(al_view)
il_view_id = al_view
//  Added by  Nova 07.23.2009------------------------
if tab_1.tabpage_browse.dw_detail.rowcount( )<1 then return -1

is_mod_user = tab_1.tabpage_browse.dw_detail.getitemstring(1,"mod_user")
ls_name = tab_1.tabpage_browse.dw_detail.getitemstring(1,"view_name")
this.title = "IntelliReport ( " + ls_name + " )"  //maha 093004

if is_mod_user = "All" then is_mod_user = gs_user_id //if set that any user can modify set to the same as the global user

//---------Begin Added by (Appeon)Stephen 08.11.2014 for IntelliReport Modifications 14.2--------
ll_module = tab_1.tabpage_browse.dw_detail.getitemnumber(1,"module")
li_Ret = tab_1.tabpage_browse.dw_detail.GetChild( "data_view_id", dwchild ) 
if li_Ret = 1 then
	dwchild.settransobject(sqlca)
	//filter data
	if ll_module = 1 then 
		dwchild.setfilter( "UPPER(type_c)='C'" )
		dwchild.filter( )
	elseif ll_module = 2 or ll_module = 4 then 
		dwchild.setfilter( "UPPER(type_c)='P'" )
		dwchild.filter( )		
	end if	
end if

if ll_module = 4 then 
	li_Ret = tab_1.tabpage_browse.dw_detail.GetChild( "data_view_id_cont", dwchild ) 
	if li_Ret = 1 then
		dwchild.settransobject(sqlca)
		dwchild.setfilter( "UPPER(type_c)='C'" )
		dwchild.filter( )
	end if
end if
//---------End Added ------------------------------------------------------

tab_1.tabpage_columns.Enabled = false
tab_1.tabpage_filter.Enabled = false
tab_1.tabpage_preview.Enabled = false
tab_1.tabpage_sort.Enabled = false
tab_1.tabpage_tables.Enabled = false
tab_1.tabpage_run.Enabled = false
tab_1.tabpage_browse.cb_next_1.enabled = false

if upper(is_mod_user) <> upper(gs_user_id) then
	tab_1.tabpage_browse.cb_delete.enabled = false
	tab_1.tabpage_browse.dw_detail.enabled = false
	tab_1.tabpage_browse.cb_select.enabled = true
	tab_1.tabpage_browse.cb_copy.enabled = true			//Added by Scofield on 2007-08-23
	tab_1.tabpage_browse.dw_detail.object.category.background.color = 12632256 //grey
	tab_1.tabpage_browse.dw_detail.object.view_name.background.color = 12632256
	tab_1.tabpage_browse.dw_detail.object.mod_user.background.color = 12632256
else
	tab_1.tabpage_browse.cb_delete.enabled = true
	tab_1.tabpage_browse.dw_detail.enabled = true
	tab_1.tabpage_browse.cb_select.enabled = true
	tab_1.tabpage_browse.cb_copy.enabled = true			//Added by Scofield on 2007-08-23
	tab_1.tabpage_browse.dw_detail.object.category.background.color = rgb(255,255,255) //white
	tab_1.tabpage_browse.dw_detail.object.view_name.background.color = rgb(255,255,255)
	tab_1.tabpage_browse.dw_detail.object.mod_user.background.color = rgb(255,255,255)
end if

return 1

end function

public function integer of_preview_old (datawindow adw_preview);//this builds the datawindow calls of_build_view_sql()
//messagebox("of_preview","")
String ls_table_field
String ls_group_syntax
String ls_grey
String ls_align
String ls_white
String ls_presentation_str
String ls_dwsyntax_str
String ls_sql
String Errors
String ls_font
Integer z
Integer li_cnt
Integer li_return
Integer i
Integer li_FileNum
Long ll_last_fld_width
Long ll_start_position
Long ll_longest_width
Long ll_fld_x
Long ll_last_fld_x
Long ll_fld_id
Long ll_fld_width
String ls_db_nm
String ls_imp_file_nm
String ls_data_line
String ls_data_all
string ls_syntax //maha 111502

SetPointer( HourGlass! )

//This.SetRedraw( False )

//ls_sql = of_build_view_sql()
//messagebox("", ls_sql)
//debugbreak()

adw_preview.Reset()
adw_preview.DataObject = ''

//"Style ( Type=value property=value ... )
//	DataWindow ( property=value ... )
//	Column ( property=value ... )
//	Group groupby_colnum1 Fby_colnum2 ... property ... )
//	Text property=value ... )
//	Title ( 'titlestring' )"
//


//new_syntax = SyntaxFromSQL("SELECT employee_id, salary FROM employee",
//"Style(Type=Group) Group(1)", Error)


ls_group_syntax = ""

ls_grey = String(rgb(192,192,192))
ls_white = String(rgb(255,255,255))
//ls_presentation_str = "style( type=Group) Group(1) Column(Border=0) Datawindow(Color=" + ls_white + " )" + "Text(Border=6 Background.Color=" + ls_grey + ")"
//IF adw_preview = tab_1.tabpage_preview.dw_preview THEN
	ls_presentation_str = "style( type=Group) Column(Border=0) Datawindow(Color=" + ls_white + " )" + "Text(Border=6 Background.Color=" + ls_grey + ")"
//ELSE
//	ls_presentation_str = "style( type=grid ) Group(1) Column(Border=0) Datawindow(Color=" + ls_white + " )" + "Text(Border=6 Background.Color=" + ls_grey + ")"	
//END IF

//ls_presentation_str = "style( type=grid ) Group(1) Column(Border=0) Datawindow(Color=" + ls_white + " )" + "Text(Border=6 Background.Color=" + ls_grey + ")"


//messagebox("", ls_presentation_str)
ls_dwsyntax_str = SQLCA.SyntaxFromSQL(ls_sql, &
	ls_presentation_str, ERRORS)

IF LenA(ERRORS) > 0 THEN
	//---------Begin Modified by (Appeon)Stephen 05.05.2014 for V142 Schedule IntelliReport--------
	//MessageBox("Caution", &
	//"SyntaxFromSQL caused these errors: " + ERRORS)
	//RETURN -1	
	inv_message.of_messagebox("Caution", "SyntaxFromSQL caused these errors: " + ERRORS, true)
	is_run_error = "SyntaxFromSQL caused these errors: " + ERRORS
	ib_run_sucess = false
	return -1
	//---------End Modfiied ------------------------------------------------------	
END IF

//Open( w_preview_data )

adw_preview.Create( ls_dwsyntax_str, ERRORS)

IF LenA(ERRORS) > 0 THEN	
	//---------Begin Modified by (Appeon)Stephen 05.05.2014 for V142 Schedule IntelliReport--------
	//MessageBox("Caution", &
	//"Create cause these errors: " + ERRORS)
	//RETURN -1
	inv_message.of_messagebox("Caution", "Create cause these errors: " + ERRORS, true)
	is_run_error = "Create cause these errors: " + ERRORS
	ib_run_sucess = false
	return -1
	//---------End Modfiied ------------------------------------------------------	
END IF

//ls_syntax = adw_preview.describe("DataWindow.Syntax")
//clipboard(ls_syntax)
//messagebox("",ls_syntax)





Integer li_rc
String ls_label
String ls_column
String ls_label_text
String ls_title
String ls_x
String ls_field_allias
Long ll_width

adw_preview.SetTransObject( SQLCA )
adw_preview.Modify("DataWindow.Header.Height='420'")
//adw_preview.Modify("DataWindow.Header.width='2857'")
//adw_preview.Modify("DataWindow.Detail.width='2857'")
//adw_preview.Modify("DataWindow.Detail.Height='500'")
li_rc = tab_1.tabpage_columns.dw_view_fields.RowCount()

ii_col_count = li_rc


FOR i = 1 TO li_rc
	ls_field_allias = tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "field_alias" ) 
	ls_label = ls_field_allias + "_t"
	ls_column = ls_field_allias
	
	//ls_table_field = tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "table_field" )
	//ls_table_field = Mid( ls_table_field, POS( ls_table_field, "=" ) + 1 , 1000 )
	//ls_label = ls_table_field + "_t"
	//ls_label = Mid( ls_column, 1, POS( ls_column, "." ) -1 ) + "_" + Mid( ls_column, POS( ls_column, "." ) +1, 100 )
	//messagebox("", ls_column)
	
	
//	IF tab_1.tabpage_columns.dw_view_fields.GetItemNumber( i, "sel_field_id" ) > 0 THEN
//		IF tab_1.tabpage_tables.dw_view_tables.RowCount() > 1 THEN
//			ls_label = tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "table_field" )
//			ls_column	= Mid( ls_label, 1, POS( ls_label, "." )-1 ) + "_" + Mid( ls_label, POS( ls_label, "." ) + 1 , 100 )		
//			ls_label = Mid( ls_label, 1, POS( ls_label, "." )-1 ) + "_" + Mid( ls_label, POS( ls_label, "." ) + 1 , 100 ) + "_t"					
//		ELSE
//			ls_label = tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "field_name" )
//			ls_column  = ls_label			
//			ls_label = ls_label + "_t"
//		END IF
//	ELSE
//		ls_label = tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "table_name" )
//		//ls_label = tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "table_field" )
//		ls_column = ls_label
//		ls_label = ls_label + '_t'
//	END IF
//	
	ls_column = MidA( ls_column, 1, 40 )
	ls_label = MidA( ls_label, 1, 40 )
	
	string ls_return
	//messagebox("column name 1", adw_preview.describe( "#1.name" ))
	//messagebox("column name 2", adw_preview.describe( "#2.name" ))
	//messagebox("column name 3", adw_preview.describe( "#3.name" ))	
	//messagebox("label variable", ls_label )
	ls_return = adw_preview.Modify( ls_label + ".y='260'")	
	//messagebox("return value", ls_return)

	//ls_label_text = tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "field_alias" ) 
	ls_label_text = tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "label_text" ) 
	adw_preview.Modify( ls_label + ".Text='" + ls_label_text + "'")	
	
	adw_preview.Modify( ls_label + ".height='120'")		

	adw_preview.Modify( ls_label + ".Border='1'")		

	ls_label_name[i] = adw_preview.Describe( ls_label + ".name")			
	ls_column_name[i] = adw_preview.Describe( ls_column + ".name")			
	adw_preview.Modify( ls_label + ".tag ='" + String( i ) + "'")			
	adw_preview.Modify( ls_column + ".tag ='" + String( i ) + "'")			
	
	//adw_preview.Modify(ls_column + ".Border='2'")
	
	IF IsNull( tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "field_display_width" ) ) OR +&
		tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "field_display_width" ) = ""  THEN		
		ll_width = Long( adw_preview.Describe( ls_column + ".width") )
		tab_1.tabpage_columns.dw_view_fields.SetItem( i, "field_display_width", String( ll_width ) )	
	ELSE
		ll_width = Long(tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "field_display_width" ))
		//adw_preview.Modify( ls_label + ".width ='" + String( ll_width ) + "'")			
		//adw_preview.Modify( ls_column + ".width ='" + String( ll_width ) + "'")			
	END IF

	IF tab_1.tabpage_columns.dw_view_fields.GetItemNumber( i, "field_visible" ) = 0 THEN				
		ll_width = 0
	END IF
	adw_preview.Modify( ls_label + ".width ='" + String( ll_width ) + "'")			
	adw_preview.Modify( ls_column + ".width ='" + String( ll_width ) + "'")			



		IF IsNull( tab_1.tabpage_columns.dw_view_fields.GetItemNumber( i, "field_x" ) ) OR +&
			tab_1.tabpage_columns.dw_view_fields.GetItemNumber( i, "field_x" ) = 0  THEN
			//Messagebox("", "field_x = 0")
			IF NOT ib_new THEN
				//MessageBox("", "not new" )
				ll_last_fld_x = 0
				FOR z = 1 TO li_rc
					ll_fld_x = tab_1.tabpage_columns.dw_view_fields.GetItemNumber( z, "field_x" ) 
					IF ll_fld_x > ll_last_fld_x THEN
						ll_last_fld_x = ll_fld_x
						ll_last_fld_width = Long( tab_1.tabpage_columns.dw_view_fields.GetItemString( z, "field_display_width" ) )
					END IF
				END FOR
				ls_x = String( ll_last_fld_x + ll_last_fld_width + 20 )
				tab_1.tabpage_columns.dw_view_fields.SetItem( i, "field_x", ll_last_fld_x + ll_last_fld_width + 20 )			
				adw_preview.Modify( ls_label + ".x ='"  + ls_x  + "'")			
				adw_preview.Modify( ls_column + ".x ='" + ls_x  + "'")										
			ELSE	
				ls_x = adw_preview.Describe( ls_column + ".x") 
				tab_1.tabpage_columns.dw_view_fields.SetItem( i, "field_x", Long(ls_x)  )
			END IF
		ELSE
			ls_x = String(tab_1.tabpage_columns.dw_view_fields.GetItemNumber( i, "field_x" ))
			adw_preview.Modify( ls_label + ".x ='"  + ls_x  + "'")			
			adw_preview.Modify( ls_column + ".x ='" + ls_x  + "'")					
			tab_1.tabpage_columns.dw_view_fields.SetItem( i, "field_x", Long(ls_x)  )								
		END IF	


END FOR

ls_title = tab_1.tabpage_browse.dw_report_list.GetItemString( tab_1.tabpage_browse.dw_report_list.GetRow(), "view_name" )

IF tab_1.tabpage_browse.dw_report_list.GetItemString( tab_1.tabpage_browse.dw_report_list.GetRow(), "orientation" ) =  "P" THEN
	adw_preview.Modify("DataWindow.Print.Orientation= '2'")
	tab_1.tabpage_preview.rb_p.Checked = True
	tab_1.tabpage_preview.rb_l.Checked = False	
ELSE
	adw_preview.Modify("DataWindow.Print.Orientation= '1'")	
	tab_1.tabpage_preview.rb_p.Checked = False
	tab_1.tabpage_preview.rb_l.Checked = True	
END IF

if LenA(is_facility_name) > 0 then
	is_facility_name = " :  " + is_facility_name
end if

adw_preview.Modify("create text(band=header text='Report: " + ls_title + is_facility_name +"' border='0' color='0' x='10' y='10' height='60' width='2000'  font.face='Segoe UI' font.height='-11' font.weight='600'  font.family='2' font.pitch='2' font.charset='0' background.mode='1' background.color='553648127' name=title1_t" )
adw_preview.Modify("create text(band=header text='Date: " + String( Today() ) + "' border='0' color='0' x='10' y='80' height='60' width='1400'  font.face='Segoe UI' font.height='-11' font.weight='600'  font.family='2' font.pitch='2' font.charset='0' background.mode='1' background.color='553648127' name=title2_t" )
adw_preview.Modify("create text(band=header text='Filter: " + is_filter + "' border='0' color='0' x='10' y='150' height='60' width='1400'  font.face='MS Sans Serif' font.height='-11' font.weight='600'  font.family='2' font.pitch='2' font.charset='0' background.mode='1' background.color='553648127' name=title3_t" )


ls_syntax = adw_preview.describe("DataWindow.Syntax")
//clipboard(ls_syntax)
//messagebox("",ls_syntax)


adw_preview.Create(ls_syntax)
adw_preview.settransobject(sqlca)



IF adw_preview = tab_1.tabpage_run.dw_run OR ii_with_data = 1 THEN
	adw_preview.Retrieve()
END IF


tab_1.tabpage_preview.st_left.BorderStyle = StyleRaised!
tab_1.tabpage_preview.st_center.BorderStyle = StyleRaised!
tab_1.tabpage_preview.st_right.BorderStyle = StyleRaised!		
tab_1.tabpage_preview.st_f_left.BorderStyle = StyleRaised!
tab_1.tabpage_preview.st_f_center.BorderStyle = StyleRaised!
tab_1.tabpage_preview.st_f_right.BorderStyle = StyleRaised!		

IF IsNull( tab_1.tabpage_browse.dw_report_list.GetItemNumber( tab_1.tabpage_browse.dw_report_list.GetRow(), "font_size" ) ) THEN
	ls_font = MidA( adw_preview.Describe( ls_column_name[ 1 ] + ".Font.Height" ),2,100)	
	tab_1.tabpage_preview.em_font.Text = ls_font
ELSE
	ls_font = String( tab_1.tabpage_browse.dw_report_list.GetItemNumber( tab_1.tabpage_browse.dw_report_list.GetRow(), "font_size" ))
	tab_1.tabpage_preview.em_font.Text = ls_font
END IF

FOR i = 1 TO ii_col_count
	adw_preview.Modify( ls_column_name[ i ] + ".Font.Face='Segoe UI'")		
	adw_preview.Modify( ls_column_name[ i ] + ".Font.Height='-" + ls_font + "'")	
	adw_preview.Modify( ls_label_name[ i ] + ".Font.Height='-" + ls_font + "'")	
	IF adw_preview.Describe( ls_column_name[ i ] + ".coltype" ) = "datetime" THEN
		adw_preview.SetFormat( ls_column_name[ i ], "mm/dd/yyyy" )
	END IF	
	ls_align = String( tab_1.tabpage_columns.dw_view_fields.GetItemNumber( i, "field_align" )	)
	adw_preview.Modify( ls_column_name[ i ] + ".alignment = '" + ls_align + "'" )		
	ls_align = String( tab_1.tabpage_columns.dw_view_fields.GetItemNumber( i, "label_align" )	)
	adw_preview.Modify( ls_label_name[ i ] + ".alignment = '" + ls_align + "'" )			
END FOR


IF adw_preview.Title = "" THEN
	adw_preview.Modify("DataWindow.Print.Preview=No")
ELSE
	adw_preview.Modify("DataWindow.Print.Preview=Yes")
END IF

//adw_preview.Modify("DataWindow.Print.Preview.Rulers=Yes")

//messagebox("", adw_preview.Describe("DataWindow.Syntax") )

adw_preview.Modify("DataWindow.Grid.Lines='1'" )
debugbreak()
//This.SetRedraw( True )


Return 0


end function

public function string of_getfrom ();/***************************************************************
Function  :of_getfrom() returns string
arguements:
Describe  :Get from statement(INNER JOIN / LEFT JOIN used in inner/outer link)
Author    :Andy 06/26/2007
****************************************************************/
string			ls_col1, ls_col2, ls_from
string			ls_table1, ls_table2, ls_Deal = '/'
String			ls_Relate, ls_Tmp, ls_TableList[], ls_Null[], ls_Temp[]
string 		ls_join_filter  //maha 06.05.2017
long				ll_row, ll_Num
Long				ll_Pos, ll_Find, ll_Cnt,ll_find_type
datawindow		ldw
DataStore		lds
Str_Join			lstr_join[], lstr_Tmp, lstr_Null[], lstr_store[]
n_cst_string	luo_str
long				ll_rc,ll_Cycle
long           ll_pos1
string ls_field_type,ls_c_name
//---------Begin Added by (Appeon)Toney 06.13.2013 for V141 ISG-CLX--------
Boolean lb_ctx_table_exist = false
String ls_ctx_id_col //Added by Ken.Guo on 2009-02-23
String ls_table1_arr[],ls_table2_arr[],ls_Relate_arr[] //Added by Ken.Guo on 2009-02-23
//---------End Added ------------------------------------------------------------------
integer res //maha 07.09.2015


ldw = tab_1.tabpage_tables.dw_view_links
ldw.AcceptText()

// save links info into lstr_Join
ls_from = ''
lds = Create DataStore
lds.Dataobject = ldw.DataObject
lds.SetTransObject(SQLCA)
ldw.RowsCopy(1, ldw.RowCount(), Primary!, lds, 1, Primary!)

//--------------------------- APPEON BEGIN ---------------------------
//$<  Add > 2007-07-17 By: Scofield
//$<Reason> Add process to the single table
If lds.RowCount() = 0 then
	ll_rc = tab_1.tabpage_tables.dw_view_tables.RowCount()

	For ll_Cycle = 1 To ll_rc
		//---------Begin Added by (Appeon)Toney 06.13.2013 for V141 ISG-CLX--------
		IF il_module = 1 THEN ls_table1_arr[ll_Cycle] = tab_1.tabpage_tables.dw_view_tables.GetItemString(ll_Cycle, "conv_view_table_table_name" ) //Added by Ken.Guo on 2009-02-23		
		//---------End Added ------------------------------------------------------------------
		ls_from += "~t" + tab_1.tabpage_tables.dw_view_tables.GetItemString(ll_Cycle, "conv_view_table_table_name" ) + ", "  + "~r~n"
	Next
	
	ls_from = LeftA( ls_from, LenA( ls_from ) - LenA("~r~n") - 2) + " "
else
//---------------------------- APPEON END ----------------------------
	For ll_Row = 1 To lds.RowCount()
		ls_Relate = lds.GetItemString(ll_Row, 'link_type')
		if trim(ls_Relate) = '='  then ls_Relate = 'INNER JOIN'
		if trim(ls_Relate) = '*=' then ls_Relate = 'LEFT outer JOIN'
		ls_Col1	 = lds.GetItemString(ll_Row, 'from_table_field')
		ls_Col2	 = lds.GetItemString(ll_Row, 'to_table_field')
			
		ls_Table1 = LeftA(ls_Col1, PosA(ls_Col1, ".") - 1)
		ls_Table2 = LeftA(ls_Col2, PosA(ls_Col2, ".") - 1)
		//---------Begin Added by (Appeon)Toney 06.13.2013 for V141 ISG-CLX--------
			//--------------------------- APPEON BEGIN ---------------------------
			//$<add> 02.23.2009 By: Ken.Guo
			//$<reason> 
			ls_table1_arr[ll_Row] = ls_Table1
			ls_table2_arr[ll_Row] = ls_Table2
			ls_Relate_arr[ll_Row] = ls_Relate
			//---------------------------- APPEON END ----------------------------
			
			//--------------------------- APPEON BEGIN ---------------------------
			//$<add> 02.17.2009 By: Ken.Guo
			//$<reason> Filter ctx data by access
			If Upper(ls_Table1) =  Upper('v_ctx_basic_info') Or &
				(Upper(ls_Table2) = Upper('v_ctx_basic_info') And ls_Relate <> 'LEFT outer JOIN') Then
				lb_ctx_table_exist = True
				If Upper(ls_Table1) =  Upper('v_ctx_basic_info') Then
					ls_ctx_id_col = ls_Col1
				Else
					ls_ctx_id_col = ls_Col2				
				End If
			End If
			//---------------------------- APPEON END ----------------------------
		//---------End Added ------------------------------------------------------------------

		If luo_str.of_IsEmpty(ls_Table1) Or luo_str.of_IsEmpty(ls_Table2) Then
			lds.RowsMove(ll_Row, ll_Row,Primary!, lds, lds.RowCount() + 1, Primary!)
			ls_Relate = lds.GetItemString(ll_Row, 'link_type')
			if trim(ls_Relate) = '='  then ls_Relate = 'INNER JOIN'
			if trim(ls_Relate) = '*=' then ls_Relate = 'LEFT outer JOIN'
			ls_Col1	 = lds.GetItemString(ll_Row, 'from_table_field')
			ls_Col2	 = lds.GetItemString(ll_Row, 'to_table_field')
				
			ls_Table1 = LeftA(ls_Col1, PosA(ls_Col1, ".") - 1)
			ls_Table2 = LeftA(ls_Col2, PosA(ls_Col2, ".") - 1)
		End If
		
		ll_Find = 0
		For ll_Cnt = 1 To UpperBound(lstr_Join[])
			If (lstr_Join[ll_Cnt].table1 = ls_table1 And (lstr_join[ll_Cnt].table2 = ls_table2 Or luo_str.of_IsEmpty(ls_table2))) OR &
				((lstr_Join[ll_Cnt].table1 = ls_table2 Or luo_str.of_IsEmpty(ls_table2)) And lstr_join[ll_Cnt].table2 = ls_table1) Then
				ll_Find = ll_Cnt
				Exit
			End IF
		Next
		If ll_Find > 0 Then
			lstr_Join[ll_Cnt].relation[UpperBound(lstr_Join[ll_Cnt].relation[]) + 1] = ls_Col1 + "=" +ls_Col2
		Else
			lstr_Tmp.key = ls_relate
			lstr_Tmp.table1 = ls_Table1
			lstr_Tmp.table2 = ls_Table2
			lstr_Tmp.relation[1] = ls_Col1 + "=" + ls_Col2
			
			lstr_Join[UpperBound(lstr_Join[]) + 1] = lstr_Tmp
		End IF
	Next
end if
//debugbreak()
// generate links info
DO While UpperBound(lstr_Join[]) > 0
	If UpperBound(ls_TableList[]) = 0 Then
		If Trim(ls_From) <> '' And Not IsNull(ls_From) Then ls_From += ', ~r~n'
		
		ls_TableList[1] = lstr_join[1].table1
		ls_TableList[2] = lstr_Join[1].table2
		
		ls_Tmp = ''
		For ll_Num = 1 To UpperBound(lstr_Join[1].relation[])
			If ll_Num > 1 Then
				ls_Tmp += " and "
			End IF
			ls_Tmp += lstr_Join[1].relation[ll_Num]
		Next
		ls_From += ls_TableList[1]+" "+lstr_Join[1].key+" "+ls_TableList[2]+" on ("+ls_Tmp+") "
		
		if ls_TableList[2] = "v_address_link" then debugbreak()

		//Start Code Change ----06.06.2017 #V154 maha
		if pos(ls_from, "LEFT outer JOIN", 1) > 0 then
			ls_join_filter = of_get_join_filter( ls_TableList[2] )  
			if ls_join_filter <> "Cancel" then
				ls_from = ls_from + ls_join_filter
			end if
		end if
		//Start Code Change ----06.06.2017

		//cut
		For ll_Cnt = 2 To UpperBound(lstr_Join[])
			lstr_store[UpperBound(lstr_store[]) + 1] = lstr_Join[ll_Cnt]
		Next
		lstr_Join[] = lstr_Store[]
		lstr_Store[] = lstr_Null[]
	End IF
	
	For ll_Pos = 1 To UpperBound(ls_TableList[])
		ls_Deal += ls_TableList[ll_Pos] + "/"
		For ll_Cnt = 1 To UpperBound(lstr_Join[])
			ls_Tmp = ''
			//match table1 first
			If ls_TableList[ll_Pos] = lstr_Join[ll_Cnt].table1 Then
				If Trim(ls_From) <> '' And Not IsNull(ls_From) Then ls_From += ' ~r~n'
				For ll_Num = 1 To UpperBound(lstr_Join[ll_Cnt].relation[])
					If ll_Num > 1 Then
						ls_Tmp += " and "
					End IF
					ls_Tmp += lstr_Join[ll_Cnt].relation[ll_Num]
				Next
				
				ll_pos1 = PosA(lower(ls_From),lower(lstr_Join[ll_Cnt].key+" "+lstr_Join[ll_Cnt].table2+" on (")) 
				if ll_pos1 > 0 then
					ls_From = LeftA(ls_From,ll_pos1 + LenA(lstr_Join[ll_Cnt].key+" "+lstr_Join[ll_Cnt].table2+" on (") - 1) + ls_Tmp + " and " + MidA(ls_From,ll_pos1 + LenA(lstr_Join[ll_Cnt].key+" "+lstr_Join[ll_Cnt].table2+" on ("),LenA(ls_From))
				else
					ls_From += lstr_Join[ll_Cnt].key+" "+lstr_Join[ll_Cnt].table2+" on ("+ls_Tmp+") "
				end if
				//Start Code Change ----06.06.2017 #V154 maha
				if pos(ls_from, "LEFT outer JOIN", 1) > 0 then
					ls_join_filter = of_get_join_filter( lstr_Join[ll_Cnt].table2 )  
					if ls_join_filter <> "Cancel" then
						ls_from = ls_from + ls_join_filter
					end if
				end if
				//Start Code Change ----06.06.2017	
			
				//save relative table
				ls_Temp[UpperBound(ls_Temp[]) + 1] = lstr_Join[ll_Cnt].table2
			//then match table2
			ElseIf ls_TableList[ll_Pos] = lstr_Join[ll_Cnt].table2 Then
				If Trim(ls_From) <> '' And Not IsNull(ls_From) Then ls_From += ' ~r~n'
				For ll_Num = 1 To UpperBound(lstr_Join[ll_Cnt].relation[])
					If ll_Num > 1 Then
						ls_Tmp += " and "
					End IF
					ls_Tmp += lstr_Join[ll_Cnt].relation[ll_Num]
				Next
				
				ll_pos1 = PosA(lower(ls_From),lower(lstr_Join[ll_Cnt].key+" "+lstr_Join[ll_Cnt].table1+" on (")) 
				if ll_pos1 > 0 then
					ls_From = LeftA(ls_From,ll_pos1 + LenA(lstr_Join[ll_Cnt].key+" "+lstr_Join[ll_Cnt].table1+" on (") - 1) + ls_Tmp + " and " + MidA(ls_From,ll_pos1 + LenA(lstr_Join[ll_Cnt].key+" "+lstr_Join[ll_Cnt].table1+" on ("),LenA(ls_From))
				else
					ls_From += lstr_Join[ll_Cnt].key+" "+lstr_Join[ll_Cnt].table1+" on ("+ls_Tmp+") "
				end if
				
				//Start Code Change ----06.06.2017 #V154 maha
				if pos(ls_from, "LEFT outer JOIN", 1) > 0 then
					ls_join_filter = of_get_join_filter( lstr_Join[ll_Cnt].table2 )  
					if ls_join_filter <> "Cancel" then
						ls_from = ls_from + ls_join_filter
					end if
				end if
				//Start Code Change ----06.06.2017	
				
				//save relative table
				ls_Temp[UpperBound(ls_Temp[]) + 1] = lstr_Join[ll_Cnt].table1
			//miss match
			Else
				//save miss match
				lstr_store[UpperBound(lstr_store[]) + 1] = lstr_Join[ll_Cnt]
			End IF
		Next
		//reset
		lstr_Join[] = lstr_store[]
		lstr_Store[] = lstr_Null[]
	Next
	//reset ls_TableList
	ls_TableList[] = ls_Null[]
	For ll_Pos = 1 To UpperBound(ls_Temp[])
		IF PosA(ls_Deal, "/" + ls_Temp[ll_Pos] + "/") < 1 Then
			ls_TableList[UpperBound(ls_TableList[]) + 1] = ls_Temp[ll_Pos]
		End IF
	Next
	ls_Temp[] = ls_Null[]
	ls_Deal = '/'
Loop

//$<add> 02.21.2008 by Andy
//Reason:Dynamically link to the lookup table
String ls_Find, ls_field_alias, ls_table_name
String ls_field_name
String ls_lookup_type,ls_lu_field_name

ll_Cnt  = tab_1.tabpage_columns.dw_view_fields.RowCount()
ll_Find = 0
ls_Find = "Len(trim(lu_field_name)) > 0"
DO WHILE (1=1)
	
	ll_Find = tab_1.tabpage_columns.dw_view_fields.Find(ls_Find,ll_Find,ll_Cnt)
	if ll_Find < 1 then exit
	
	ls_table_name = tab_1.tabpage_columns.dw_view_fields.GetItemString( ll_Find, "table_name" )
	ls_field_name = tab_1.tabpage_columns.dw_view_fields.GetItemString( ll_Find, "field_name" )
	ls_field_alias= tab_1.tabpage_columns.dw_view_fields.GetItemString( ll_Find, "field_alias")
	ls_lookup_type= tab_1.tabpage_columns.dw_view_fields.GetItemString( ll_Find, "lookup_type" )
	//--------Begin Added by Nova 07.28.2008------------------------
	//get field type
	//--------Begin Added by Nova 08.06.2008------------------------
	ls_field_type = ''
	ls_c_name = tab_1.tabpage_columns.dw_view_fields.GetItemString( ll_Find, "table_field" )
	ll_Find_type = ids_fields.Find("c_name='" + ls_c_name + "' and table_name='" + ls_table_name + "'",0,ids_fields.RowCount())
	IF ll_Find_type > 0 THEN
		ls_field_type = ids_fields.GetItemString(ll_Find_type,"coltype")
	END IF
	//--------End Added --------------------------------------------
	ls_lu_field_name = tab_1.tabpage_columns.dw_view_fields.GetItemString( ll_Find, "lu_field_name" )
	IF IsNull(ls_lookup_type) THEN ls_lookup_type = "C"
	IF ls_lookup_type = "C" THEN
		IF  ls_field_type = '106' Or ls_field_type = '108' Or ls_field_type = '60' Or ls_field_type = '122' THEN
			ls_from = ls_from + '~r~n' + "Left outer Join code_lookup AS code_lookup_" + ls_field_alias + " ON ( CONVERT ( VARCHAR, CONVERT( decimal(18,0)," + ls_table_name + "." + ls_field_name + ") ) = CONVERT(VARCHAR,code_lookup_" + ls_field_alias + ".lookup_code" + " ))"
		ELSE
			ls_from = ls_from + '~r~n' + "Left outer Join code_lookup AS code_lookup_" + ls_field_alias + " ON ( CONVERT ( VARCHAR," + ls_table_name + "." + ls_field_name + ") = CONVERT(VARCHAR,code_lookup_" + ls_field_alias + ".lookup_code" + " ))"
		END IF
	ELSE
		IF  ls_field_type = '106' Or ls_field_type = '108' Or ls_field_type = '60' Or ls_field_type = '122' THEN
			ls_from = ls_from + '~r~n' + "Left outer Join address_lookup AS address_lookup_" + ls_field_alias + " ON ( CONVERT ( VARCHAR, CONVERT  (decimal(18,0)," + ls_table_name + "." + ls_field_name + ") ) = CONVERT(VARCHAR,address_lookup_" + ls_field_alias + ".lookup_code" + " ))"
		ELSE
			ls_from = ls_from + '~r~n' + "Left outer Join address_lookup AS address_lookup_" + ls_field_alias + " ON ( CONVERT ( VARCHAR," + ls_table_name + "." + ls_field_name + ") = CONVERT(VARCHAR,address_lookup_" + ls_field_alias + ".lookup_code" + " ))"
		END IF
	END IF
	//--------End Added --------------------------------------------


	
	ll_Find ++
	if ll_Find > ll_Cnt then exit
LOOP
//end of add 02.21.2008

//if ii_facil_security = 1  and (not gb_contract_version) then	//08.28.2007 By Jervisthen
if ii_facil_security = 1  and (il_module=2) then //04.03.2008 by Andy Fixed BugG040302
	ls_From = ls_From + ', ~r~n' + "security_user_facilities " 
end if

//IF ii_dept_security_on = 1  and (not gb_contract_version) then	//08.28.2007 By Jervisthen
IF ii_dept_security_on = 1  and (il_module=2) then //04.03.2008 by Andy Fixed BugG040302
	ls_From = ls_From + ', ~r~n' + "security_user_department " 	
END IF
//---------Begin Added by (Appeon)Toney 06.13.2013 for V141 ISG-CLX--------
IF il_module = 1 THEN
	//--------------------------- APPEON BEGIN ---------------------------
	//$<add> 02.17.2009 By: Ken.Guo. 2009-08-25. filter template ctx.
	//$<reason> Filter ctx data by access
	DataStore lds_view_columns
	
	//use access to filter
	If lb_ctx_table_exist Then
		//Filter template data in ctx_basic_info
		ls_From = ls_From + of_filter_template_ctx(ls_ctx_id_col)
		//Filter No access ctx
		If ib_access_filter Then 
			ls_From = ls_From + of_build_ctx_access_sql(ls_ctx_id_col)
		End If
	Else	
		//Filter by *.ctx_id
		lds_view_columns = Create DataStore
		lds_view_columns.Dataobject = 'd_view_columns'
		lds_view_columns.SetTransObject(SQLCA)
		
		If lds.RowCount() = 0 then
			//If no data in link DW
			lds_view_columns.Retrieve(ls_table1_arr[])
			For ll_Num = 1 to UpperBound(ls_table1_arr[])
				ll_Find = lds_view_columns.Find('v_name = "' + ls_table1_arr[ll_Num] +'" And '+ 'Upper(c_name) = "CTX_ID"',1,lds_view_columns.RowCount())
				If ll_find > 0 Then
					ls_ctx_id_col = ls_table1_arr[ll_Num] + '.ctx_id' 
					Exit
				End If
			Next		
		Else
			//Filter by other table that have ctx_id column
			lds_view_columns.Retrieve(ls_table1_arr)
			//Search in table1
			For ll_Num = 1 to UpperBound(ls_table1_arr[])
				ll_Find = lds_view_columns.Find('v_name = "' + ls_table1_arr[ll_Num] +'" And '+ 'Upper(c_name) = "CTX_ID"',1,lds_view_columns.RowCount())
				If ll_find > 0 Then
					ls_ctx_id_col = ls_table1_arr[ll_Num] + '.ctx_id' 
					Exit
				End If
			Next
			//Then search in table2 if table1 have no ctx_id.
			If ls_ctx_id_col = '' Then
				lds_view_columns.Retrieve(ls_table2_arr)
				For ll_Num = 1 to UpperBound(ls_table2_arr[])
					If ls_Relate_arr[ll_num] = 'LEFT outer JOIN' Then Continue
					ll_Find = lds_view_columns.Find('v_name = "' + ls_table2_arr[ll_Num] +'" And '+ 'Upper(c_name) = "CTX_ID"',1,lds_view_columns.RowCount())
					If ll_find > 0 Then
						ls_ctx_id_col = ls_table2_arr[ll_Num] + '.ctx_id' 
						Exit
					End If
				Next		
			End If
		End If
		If ls_ctx_id_col <> '' Then
			//Filter template data from ctx_basic_info
			ls_From = ls_From + of_filter_template_ctx(ls_ctx_id_col)
			If ib_access_filter Then 
				//Filter no right ctx.
				ls_From = ls_From + of_build_ctx_access_sql(ls_ctx_id_col)
			End IF
		End If
	
	End If
	//---------------------------- APPEON END ----------------------------	
END IF
//---------End Added ------------------------------------------------------------------

// //Start Code Change ----07.09.2015 #V15 maha - test for bad linking
//if pos(ls_from, ", ", 1) > 0 then
//	IF AppeonGetClientType() <> "WEB" THEN  //client/server
//		res = messagebox("Possible Cartesian Join!","It looks like there is a table that is not linked to the other tables used in this report.  A Cartesian join is a table or tables not linked properly to other tables in the query.~r~rThis can cause a massive increase in the number of rows that will be returned by the report, which may cause the program to freeze. It can also affect the performance of the database server, and could even cause the database server to crash.~r~rClick Cancel to go back to the Tables tab and correct the table links. If you are absolutely certain that your table links are correct, click OK to continue running the report.~r~rContact ISG Support for assistance.", stopsign!, okcancel!,2)
//		if res = 2 then
//			res = messagebox("Possible Cartesian Join!","Are you positive?  Click NO to CANCEL.", stopsign!, yesno!,2)
//		end if		
//	ELSE
//		inv_message.of_messagebox("Possible Cartesian Join!","It looks like there is a table that is not linked to the other tables used in this report.  A Cartesian join is a table or tables not linked properly to other tables in the query.~r~rThis can cause a massive increase in the number of rows that will be returned by the report, which may cause the program to freeze. It can also affect the performance of the database server, and could even cause the database server to crash.~r~rCheck the report linking on the Tables tab.~rRetrieval canceled.~r~rContact ISG Support for assistance if necessary.", true)
//		res = 2
//	END IF
//end if
//
//tab_1.tabpage_run.st_sql = ls_from //07.27.2015 - maha - 
//
//if res = 2 then return "Cancel"
// //End Code Change ----07.09.2015



Return ls_From
end function

public function integer of_getargs (u_tvs_rpt atv_args, long al_parent, integer ai_level, ref any aa_arg[20]);//====================================================================
// Event: w_custom_report.of_getargs()
//--------------------------------------------------------------------
// Description:
//--------------------------------------------------------------------
// Arguments:
//    value       treeview atv_args
// 	value    	long   	al_parent 	
// 	value    	integer	ai_level  	
// 	reference	any    	aa_arg[20]	
//--------------------------------------------------------------------
// Returns:  integer
//--------------------------------------------------------------------
// Author:	Andy		Date: Dec 07,2007
//--------------------------------------------------------------------
//	
//--------------------------------------------------------------------
// Modify History:
//				Andy		Date: Dec 10,2007
//====================================================================
Integer				li_Index
TreeViewItem		ltvi_Item

// check arguments
If (al_parent < 0) or IsNull(al_parent) Then Return -1
If (ai_level < 1) or IsNull(ai_level) Then Return -1

// Determine level 
li_Index = UpperBound(atv_args.inv_attrib)
If ai_Level > li_Index Then
	Return -1
Else
	li_Index = ai_Level
End If

if al_Parent <> 0 then
	If atv_args.GetItem(al_Parent, ltvi_Item) = -1 Then Return -1
end if
CHOOSE CASE tab_1.selectedtab
	CASE 2
		CHOOSE CASE ai_level
			CASE 1
				aa_arg[1] = il_module
				
			CASE 2
				aa_arg[1] = ltvi_Item.data
				//$<add> 02.20.2008 by Andy
				aa_arg[2] = il_view_id
				
		END CHOOSE
		
	CASE 3,5
		CHOOSE CASE ai_level
			CASE 1
				aa_arg[1] = il_view_id
				
			CASE 2
				aa_arg[1] = il_view_id
				aa_arg[2] = ltvi_Item.data
				
			CASE 3
				aa_arg[1] = ltvi_Item.data
				aa_arg[2] = il_data_view_id
				//$<modify> 02.20.2008 by Andy
				//if tab_1.selectedtab = 5 then aa_arg[3] = il_view_id
				aa_arg[3] = il_view_id
				//$<add> 04.03.2008 by Andy
				
				//---------Begin modified by (Appeon)Stephen 06.26.2014 for IntelliReport Modifications 14.2--------				
				//if tab_1.selectedtab = 3 then aa_arg[4] = 1
				if il_module<>4 then il_data_view_id_cont = il_data_view_id
				if tab_1.selectedtab = 3 then 
					aa_arg[4] = 1
					aa_arg[5] = il_data_view_id_cont
				else
					aa_arg[4] = il_data_view_id_cont
				end if				
				//---------End Added ------------------------------------------------------
		END CHOOSE
	
END CHOOSE

Return 1

end function

public subroutine of_expandcollapseall (commandbutton acb_args, u_tvs_rpt atv_args);//--------------------------- APPEON BEGIN ---------------------------
//$<add> 2007-12-11 By: Andy
Long   ll_Root,ll_FirstRoot
String ls_Type

if lower(acb_args.text) = '&expand all' then
	acb_args.text = '&Collapse All'
	ls_Type = 'expandall'
else
	acb_args.text = '&Expand All'
	ls_Type = 'collapseall'
end if

ll_Root = atv_args.FindItem(RootTreeItem!, 0)
ll_FirstRoot = ll_Root

DO WHILE (1=1)
	if ll_Root < 1 then exit
	
	if lower(ls_Type) = 'expandall' then
		atv_args.ExpandAll ( ll_Root )
	else
		atv_args.collapseItem ( ll_Root )
		//delete all child
		//atv_args.of_reset( ll_Root )
	end if
	
	ll_Root = atv_args.FindItem(NextTreeItem!, ll_Root)
LOOP 

atv_args.selectItem(ll_FirstRoot)
atv_args.setfocus()
//---------------------------- APPEON END ----------------------------
end subroutine

public function long of_get_image (string as_v_name, long al_datalength, ref blob ablb_data);//====================================================================
// Event: w_custom_report.of_get_image()
//--------------------------------------------------------------------
// Description:
//--------------------------------------------------------------------
// Arguments:
// 	value    	string	as_v_name    	
// 	value    	long  	al_datalength	
// 	reference	blob  	ablb_data    	
//--------------------------------------------------------------------
// Returns:  long
//--------------------------------------------------------------------
// Author:	Andy		Date: Dec 18,2007
//--------------------------------------------------------------------
//	
//--------------------------------------------------------------------
// Modify History:
//
//====================================================================
Integer li_counter
Integer li_loops
String ls_sql
String ls_all_sql
Long   ll_start
blob  lblb_data

if al_datalength < 1 then return -1

IF appeongetclienttype() = 'PB' then
	IF al_datalength > 8000 THEN 
		 IF Mod(al_datalength,8000) = 0 THEN 
			  li_loops = al_datalength/8000 
		 ELSE 
			  li_loops = (al_datalength/8000) + 1 
		 END IF 
	ELSE 
		 li_loops = 1 
	END IF 
	
	FOR li_counter = 1 to li_loops
		ll_start = (li_counter - 1) * 8000 + 1
		SELECTBLOB substring(v_image,:ll_start,8000)
		INTO :lblb_data
		FROM view_alias 
		WHERE v_name = :as_v_name;
		
		if SQLCA.SQLCODE <> 0 THEN RETURN -1
		ablb_data += lblb_data
	NEXT 
ELSE
	SELECTBLOB v_image
	INTO :ablb_data
	FROM view_alias 
	WHERE v_name = :as_v_name;
	
	if SQLCA.SQLCODE <> 0 THEN RETURN -1	
END IF

return 1
end function

public subroutine of_tv_doubleclicked (long al_handle);//====================================================================
// Event: w_custom_report.of_tv_doubleclicked()
//--------------------------------------------------------------------
// Description:
//--------------------------------------------------------------------
// Arguments:
// 	value	long	al_handle	
//--------------------------------------------------------------------
// Returns:  (none)
//--------------------------------------------------------------------
// Author:	Andy		Date: Jan 15,2008
//--------------------------------------------------------------------
//	
//--------------------------------------------------------------------
// Modify History: 02.14.2008 by Andy
//                 03.28.2008 by Andy
//====================================================================
Long ll_index,ll_table_id,ll_field_id
Integer li_nr,li_level
String  ls_v_name,ls_c_name,ls_c_alias
Long    ll_Find,ll_Cnt,ll_PrtHandle
TreeViewItem ltvi_item,ltvi_prt
String  ls_width
Long    ll_Max_Order
String  ls_screen
Boolean lb_Flag
Long    ll_i,ll_j,ll_dsCnt,ll_fCnt
String  ls_DddwName,ls_Display
String  ls_lookup_type
String  ls_lookup_name,ls_table_ids[]
string   ls_field_type  //add by stephen 05.07.2014

ll_index = tab_1.SelectedTab
CHOOSE CASE ll_index
	CASE 2
		if tab_1.tabpage_tables.tv_tables.getItem(al_handle,ltvi_item) = 1 then
			//$<add> 02.20.2008 by Andy
			tab_1.tabpage_tables.tv_tables.il_dragsource = 0
			
			ls_v_name = String(ltvi_item.data)
			li_level  = ltvi_item.level
			ll_Cnt = UPPERBOUND(tab_1.tabpage_tables.tv_tables.inv_attrib)
			if ll_Cnt <> li_level then return
			
			ll_Cnt  = tab_1.tabpage_tables.dw_view_tables.RowCount()
			ll_Find = tab_1.tabpage_tables.dw_view_tables.Find( "conv_view_table_table_name='" + ls_v_name + "'", 0, ll_Cnt)
			if ll_Find > 0 then Return
			
			li_nr = tab_1.tabpage_tables.dw_view_tables.Insertrow( 0 )
			
			//il_next_table_id++  --delete by stephen 03.07.2013 -IntelliReport primary key issues
			il_next_table_id = gnv_app.of_get_irep_id("conv_view_table", 1)  //add by stephen 03.07.2013 -IntelliReport primary key issues
			
			tab_1.tabpage_tables.dw_view_tables.SetItem( li_nr, "project_id", ii_project_id )
			tab_1.tabpage_tables.dw_view_tables.SetItem( li_nr, "view_id", il_view_id )	
			tab_1.tabpage_tables.dw_view_tables.SetItem( li_nr, "table_id", il_next_table_id )
			tab_1.tabpage_tables.dw_view_tables.SetItem( li_nr, "conv_view_table_table_name", ls_v_name)
			
			//Start Code Change ----06.06.2017 #V154 maha
			choose case ls_v_name
					case "v_full_name", "v_full_basic", "v_basic"
						tab_1.tabpage_tables.dw_view_tables.SetItem( li_nr, "set_sort", 0)
					case "v_affil_stat"
						tab_1.tabpage_tables.dw_view_tables.SetItem( li_nr, "set_sort", 1)	
					case else
						tab_1.tabpage_tables.dw_view_tables.SetItem( li_nr, "set_sort", 2)	
			end choose
			////Start Code Change ----06.06.2017
			
			//$<add> 04.18.2008 by Andy
			tab_1.tabpage_tables.dw_view_tables.SetItem( li_nr, "table_name", ls_v_name)
			//end add 04.18.2008
			
			ll_Cnt = UPPERBOUND(tab_1.tabpage_tables.tv_tables.inv_attrib)
			if ll_Cnt >= li_level then
				//tab_1.tabpage_tables.tv_tables.inv_attrib[li_level].ids_obj
				ll_Find = ids_tables.Find("v_name='" + ls_v_name + "'",0,ids_tables.RowCount())
				if ll_Find > 0 then
					tab_1.tabpage_tables.dw_view_tables.SetItem( li_nr, "cust_table_name", ids_tables.GetItemNumber( ll_Find, "table_id" ) )		
					//$<add> 02.29.2008 by Andy
					ls_screen = ids_tables.GetItemString( ll_Find, "screen" )
				end if
			end if
			
			//$<add> 03.31.2008 by Andy
			tab_1.tabpage_tables.dw_view_tables.scrolltorow( li_nr )
			tab_1.tabpage_tables.dw_view_tables.setrow( li_nr )
			//End add 03.31.2008
			
			//tab_1.tabpage_tables.tv_tables.DeleteItem ( al_handle )
			tab_1.tabpage_tables.dw_view_tables.AcceptText()
			tab_1.tabpage_tables.dw_view_tables.Update( )
			
			//$<add> 04.16.2008 by Andy
			ll_Cnt = tab_1.tabpage_tables.dw_view_tables.RowCount()
			FOR ll_i = 1 TO ll_Cnt
				ls_table_ids[ll_i] = tab_1.tabpage_tables.dw_view_tables.GetItemString( ll_i, "conv_view_table_table_name" ) 
			END FOR	
			IF ll_Cnt > 0 THEN
				tab_1.tabpage_columns.dw_all_fields.Retrieve(  ls_table_ids  )
			END IF
			
			//$<add> 02.20.2008 by Andy
			ltvi_item.pictureindex = 6
			ltvi_item.SelectedPictureIndex = 6
			tab_1.tabpage_tables.tv_tables.setItem(al_handle,ltvi_item)
			//end of add 02.20.2008
			
			//$<add> 02.29.2008 by Andy
			ll_Cnt = UPPERBOUND(istr_ds)
			FOR ll_i = 1 to ll_Cnt
				IF istr_ds[ll_i].ls_v_name = ls_v_name then
					lb_Flag = true
					exit
				end if
			NEXT
			//Create dynamic dw
			if Not lb_Flag then 
				ll_Cnt ++
				istr_ds[ll_Cnt].ll_module = il_module
				istr_ds[ll_Cnt].ll_data_view_id = il_data_view_id
				istr_ds[ll_Cnt].ls_v_name = ls_v_name				
				istr_ds[ll_Cnt].ls_screen = ls_screen
				of_create_dynamic_dw(istr_ds[ll_Cnt])
			end if
			//end of add 02.29.2008
		end if
		
	CASE 3
		if tab_1.tabpage_columns.tv_fields.getItem(al_handle,ltvi_item) = 1 then
			//$<add> 02.20.2008 by Andy
			tab_1.tabpage_columns.tv_fields.il_dragsource = 0
			
			ls_c_name = String(ltvi_item.data)
			ls_c_alias= String(ltvi_item.label)
			li_level  = ltvi_item.level
			ll_Cnt = UPPERBOUND(tab_1.tabpage_columns.tv_fields.inv_attrib)			
			if ll_Cnt <> li_level then return
			
			//$<Modify> 02.21.2008 by Andy
			ll_PrtHandle = tab_1.tabpage_columns.tv_fields.FindItem(ParentTreeItem!,al_handle)
			if ll_PrtHandle > 0 then
				if tab_1.tabpage_columns.tv_fields.getItem(ll_PrtHandle,ltvi_prt) = 1 then
					ls_v_name = String(ltvi_prt.data)
				end if
			end if
			
			ll_Cnt  = tab_1.tabpage_columns.dw_view_fields.RowCount()
			ll_Find = tab_1.tabpage_columns.dw_view_fields.Find( "table_name = '" + ls_v_name + "' and field_name='" + ls_c_name + "'", 0, ll_Cnt)
			if ll_Find > 0 then return
			
			//---------Begin Added by (Appeon)Stephen 05.06.2014 for IntelliReport Modifications 14.2--------
			ll_Find = tab_1.tabpage_columns.dw_view_fields.Find(" lower(field_alias)='" + lower(ls_c_name) + "'", 0, ll_Cnt) //(Appeon)Stephen 08.06.2014 add'lower()'- BugH071804
			if ll_Find > 0 then 
				inv_message.of_messagebox( "Duplicate Fields", ls_c_name + " has a duplicate field alias ( with row " + string(ll_find) + ").  Modify one to continue.", true)
				return
			end if
			//---------End Added ------------------------------------------------------

			ll_Find = ids_fields.Find("c_name='" + ls_c_name + "' and table_name='" + ls_v_name + "'",0,ids_fields.RowCount())
			//ll_Find = ids_fields.Find("c_name='" + ls_c_name + "'",0,ids_fields.RowCount())
			if ll_Find > 0 then 
				//ls_v_name = ids_fields.GetItemString( ll_Find, "table_name" ) 
				ll_table_id = ids_fields.GetItemNumber( ll_Find, "field_id" ) 
				ll_field_id = ids_fields.GetItemNumber( ll_Find, "table_id" ) 
				ls_width    = String(ids_fields.GetItemNumber( ll_Find, "length" ))
			end if
			//end of modify 02.21.2008
			
			li_nr = tab_1.tabpage_columns.dw_view_fields.InsertRow( 0 )
			
			//il_next_field_id++  --delete by stephen 03.07.2013 -IntelliReport primary key issues
			il_next_field_id = gnv_app.of_get_irep_id("conv_view_fields", 1)  //add by stephen 03.07.2013 -IntelliReport primary key issues
			
			tab_1.tabpage_columns.dw_view_fields.SetItem( li_nr, "field_id", il_next_field_id )
			tab_1.tabpage_columns.dw_view_fields.SetItem( li_nr, "project_id", ii_project_id )
			tab_1.tabpage_columns.dw_view_fields.SetItem( li_nr, "view_id", il_view_id )
			
			tab_1.tabpage_columns.dw_view_fields.SetItem( li_nr, "field_name", ls_c_name )
			tab_1.tabpage_columns.dw_view_fields.SetItem( li_nr, "field_alias", ls_c_name )
			tab_1.tabpage_columns.dw_view_fields.SetItem( li_nr, "label_text", ls_c_alias )
		
			tab_1.tabpage_columns.dw_view_fields.SetItem( li_nr, "field_order",li_nr * 10 )
			tab_1.tabpage_columns.dw_view_fields.SetItem( li_nr, "field_x", 0 )
		
			tab_1.tabpage_columns.dw_view_fields.SetItem( li_nr, "field_align", 0 )
			tab_1.tabpage_columns.dw_view_fields.SetItem( li_nr, "label_align", 2 )
			
			tab_1.tabpage_columns.dw_view_fields.SetItem( li_nr, "table_name", ls_v_name )
			tab_1.tabpage_columns.dw_view_fields.SetItem( li_nr, "sel_field_id", ll_table_id )
			tab_1.tabpage_columns.dw_view_fields.SetItem( li_nr, "sel_table_id", ll_field_id )
			tab_1.tabpage_columns.dw_view_fields.SetItem( li_nr, "format_date", 1 ) //(Appeon)Stephen 05.22.2014 - IntelliReport Modifications 14.2
			//tab_1.tabpage_columns.dw_view_fields.SetItem( li_nr, "field_display_width", ls_width )
			
			//----------------appeon begin------------------
			//<$>Commented:long.zhang 04.29.2013
			//<$>reason:	FW: IntelliReport: Lookup Column to Display option being automatically used when not needed
			//$<modify> 03.28.2008 by Andy
			//Automatic set Code Lookup Display Field
			IF of_get_lookup_data(ls_v_name,ls_c_name,ls_Display,ls_lookup_type,ls_lookup_name) = 1 THEN //uncommented long.zhang 11.21.2013 Ticket # 00045139	
			//IF lower(ls_Display) = 'code' then ls_Display = 'Code' else ls_Display = 'Description'
			//	tab_1.tabpage_columns.dw_view_fields.SetItem( li_nr, "lu_field_name", ls_Display )
				tab_1.tabpage_columns.dw_view_fields.SetItem( li_nr, "lookup_type", ls_lookup_type )	//uncommented long.zhang 11.21.2013 Ticket # 00045139								
			END IF
			//end modify 03.28.2008
			//------------------appeon end-------------------------
			
			//---------Begin Added by (Appeon)Stephen 05.07.2014 for IntelliReport Modifications 14.2--------
			ls_field_type = of_get_field_type(ls_v_name,ls_c_name)
			if len(ls_field_type) > 0 then
				tab_1.tabpage_columns.dw_view_fields.SetItem( li_nr, "field_type", ls_field_type )
			end if
			//---------End Added ------------------------------------------------------

			//tab_1.tabpage_columns.tv_fields.DeleteItem ( al_handle )
			tab_1.tabpage_columns.dw_view_fields.AcceptText()
			tab_1.tabpage_columns.dw_view_fields.Update( )
			
			tab_1.tabpage_columns.dw_view_fields.scrolltorow(li_nr)
			tab_1.tabpage_columns.dw_view_fields.setrow(li_nr)
			tab_1.tabpage_columns.dw_view_fields.selectrow(0,false)
			tab_1.tabpage_columns.dw_view_fields.selectrow(li_nr,true)	
			
			//$<add> 02.20.2008 by Andy
			ltvi_item.pictureindex = 6
			ltvi_item.SelectedPictureIndex = 6
			tab_1.tabpage_columns.tv_fields.setItem(al_handle,ltvi_item)
			//end of add 02.20.2008
		end if
		
	CASE 5
		if tab_1.tabpage_sort.tv_sort.getItem(al_handle,ltvi_item) = 1 then
			//$<add> 02.20.2008 by Andy
			tab_1.tabpage_sort.tv_sort.il_dragsource = 0
			
			ls_c_name = String(ltvi_item.data)
			li_level  = ltvi_item.level
			ll_Cnt = UPPERBOUND(tab_1.tabpage_sort.tv_sort.inv_attrib)
			if ll_Cnt <> li_level then return
			
			ll_PrtHandle = tab_1.tabpage_sort.tv_sort.FindItem(ParentTreeItem!,al_handle)
			if ll_PrtHandle > 0 then
				if tab_1.tabpage_sort.tv_sort.getItem(ll_PrtHandle,ltvi_prt) = 1 then
					ls_v_name = String(ltvi_prt.data)
				end if
			end if
			
			ll_Cnt    = tab_1.tabpage_sort.dw_view_sort.RowCount()
			ll_Find = tab_1.tabpage_sort.dw_view_sort.Find( "table_name = '" + ls_v_name + "' and field_name='" + ls_c_name + "'", 0, ll_Cnt)
			if ll_Find > 0 then return
			
			li_nr = tab_1.tabpage_sort.dw_view_sort.Insertrow( 0 )
		
			tab_1.tabpage_sort.dw_view_sort.SetItem( li_nr, "project_id", ii_project_id )
			tab_1.tabpage_sort.dw_view_sort.SetItem( li_nr, "view_id", il_view_id )
		
			//il_next_sort_id++  --delete by stephen 03.07.2013 -IntelliReport primary key issues
			il_next_sort_id = gnv_app.of_get_irep_id("conv_view_sort", 1)  //add by stephen 03.07.2013 -IntelliReport primary key issues

			tab_1.tabpage_sort.dw_view_sort.SetItem( li_nr, "sort_id", il_next_sort_id )
			
			tab_1.tabpage_sort.dw_view_sort.SetItem( li_nr, "field_name", ls_c_name )
			tab_1.tabpage_sort.dw_view_sort.SetItem( li_nr, "table_name", ls_v_name )
			//$<add> 03.31.2008 by Andy
			tab_1.tabpage_sort.dw_view_sort.SetItem( li_nr, "dbname", ls_v_name + '.' + ls_c_name )
			//end add 03.31.2008
			
			tab_1.tabpage_sort.dw_view_sort.SetItem( li_nr, "sort_dir", "D" )
			
			SELECT Max(conv_view_sort.sort_order)
			  INTO :ll_Max_Order
			  FROM conv_view_sort  
			 WHERE conv_view_sort.view_id = :il_view_id ;
		
			if IsNull(ll_Max_Order) then ll_Max_Order = 0
			
			ll_Max_Order++
			tab_1.tabpage_sort.dw_view_sort.SetItem( li_nr, "sort_order",ll_Max_Order)

			//$<add> 04.01.2008 by Andy
			tab_1.tabpage_sort.dw_view_sort.scrolltorow( li_nr )
			tab_1.tabpage_sort.dw_view_sort.setrow( li_nr )
			//End add 04.01.2008
			
			//tv_sort.DeleteItem ( al_handle )
			tab_1.tabpage_sort.dw_view_sort.AcceptText()
			tab_1.tabpage_sort.dw_view_sort.Update( )	
			
			//$<add> 02.20.2008 by Andy
			ltvi_item.pictureindex = 6
			ltvi_item.SelectedPictureIndex = 6
			tab_1.tabpage_sort.tv_sort.setItem(al_handle,ltvi_item)
			//end of add 02.20.2008
		end if	
	CASE ELSE
		//DO NOTHING
		RETURN
		
END CHOOSE

end subroutine

public subroutine of_delete_row ();//====================================================================
// Event: w_custom_report.of_delete_row()
//--------------------------------------------------------------------
// Description:
//--------------------------------------------------------------------
// Arguments:
// 		
//--------------------------------------------------------------------
// Returns:  (none)
//--------------------------------------------------------------------
// Author:	Andy		Date: Feb 20,2008
//--------------------------------------------------------------------
//	
//--------------------------------------------------------------------
// Modify History:
// Andy		Date: Feb 21,2008
//====================================================================
Long   ll_index
String ls_v_name,ls_c_name
Long   ll_Find,ll_module,ll_handle
TreeViewItem ltvi_item
Long   ll_Row

ll_index = tab_1.SelectedTab
CHOOSE CASE ll_index
	CASE 2
		ll_Row    = tab_1.tabpage_tables.dw_view_tables.GetRow()
		if ll_Row < 1 then return
		
		ls_v_name = tab_1.tabpage_tables.dw_view_tables.GetItemString(ll_Row,"conv_view_table_table_name")
		ll_Find = ids_tables.Find("v_name='" + ls_v_name + "'",0,ids_tables.RowCount())
		if ll_Find > 0 then
			ll_module = ids_tables.GetItemNumber( ll_Find , "module" )
			ll_handle = tab_1.tabpage_tables.tv_tables.of_finditem(ll_module,ls_v_name,'')
			if ll_handle > 0 then 			
				if tab_1.tabpage_tables.tv_tables.GetItem(ll_handle,ltvi_item) = 1 then
					ltvi_item.pictureindex = ltvi_item.level
					//--------Begin Modified by  Nova 07.08.2009------------------------
					//set SelectedPictureIndex=5 (Corrected BugN060402)
					//ltvi_item.SelectedPictureIndex = ltvi_item.level
					ltvi_item.SelectedPictureIndex = 5
					//--------End Modified --------------------------------------------
					tab_1.tabpage_tables.tv_tables.SetItem(ll_handle,ltvi_item)
				end if
			end if
		end if
		tab_1.tabpage_tables.dw_view_tables.DeleteRow( ll_Row )
	
	CASE 3
		ll_Row    = tab_1.tabpage_columns.dw_view_fields.GetRow()
		if ll_Row < 1 then return		
		ls_c_name = tab_1.tabpage_columns.dw_view_fields.Getitemstring(ll_Row,"field_name")
		ls_v_name = tab_1.tabpage_columns.dw_view_fields.GetItemString(ll_Row,"table_name")
		
		ll_Find = ids_fields.Find("c_name='" + ls_c_name + "' and table_name='" + ls_v_name + "'",0,ids_fields.RowCount())
		if ll_Find > 0 then
			ll_module = ids_fields.GetItemNumber( ll_Find , "module" )
			ll_handle = tab_1.tabpage_columns.tv_fields.of_finditem(ll_module,ls_v_name,ls_c_name)
			if ll_handle > 0 then 			
				if tab_1.tabpage_columns.tv_fields.GetItem(ll_handle,ltvi_item) = 1 then
					ltvi_item.pictureindex = ltvi_item.level
					//--------Begin Modified by  Nova 07.08.2009------------------------
					//set SelectedPictureIndex=5 (Corrected BugN060402)
					//ltvi_item.SelectedPictureIndex = ltvi_item.level
					ltvi_item.SelectedPictureIndex = 5
					//--------End Modified --------------------------------------------
					tab_1.tabpage_columns.tv_fields.SetItem(ll_handle,ltvi_item)
				end if
			end if
		end if	
		tab_1.tabpage_columns.dw_view_fields.DeleteRow( ll_Row )
		//$<add> 04.17.2008 by Andy
		ll_Row = tab_1.tabpage_columns.dw_view_fields.getrow( )
		if ll_Row > 0 then 
			tab_1.tabpage_columns.dw_view_fields.event Rowfocuschanged( ll_Row )
		end if 
		//end add 04.17.2008
	CASE 5
		ll_Row    = tab_1.tabpage_sort.dw_view_sort.GetRow()
		if ll_Row < 1 then return		
		ls_c_name = tab_1.tabpage_sort.dw_view_sort.Getitemstring(ll_Row,"field_name")
		ls_v_name = tab_1.tabpage_sort.dw_view_sort.GetItemString(ll_Row,"table_name")
		
		ll_Find = ids_sort.Find("c_name='" + ls_c_name + "' and table_name='" + ls_v_name + "'",0,ids_sort.RowCount())
		if ll_Find > 0 then
			ll_module = ids_sort.GetItemNumber( ll_Find , "module" )
			ll_handle = tab_1.tabpage_sort.tv_sort.of_finditem(ll_module,ls_v_name,ls_c_name)
			if ll_handle > 0 then 			
				if tab_1.tabpage_sort.tv_sort.GetItem(ll_handle,ltvi_item) = 1 then
					ltvi_item.pictureindex = ltvi_item.level
					//--------Begin Modified by  Nova 07.08.2009------------------------
					//set SelectedPictureIndex=5 (Corrected BugN060402)
					//ltvi_item.SelectedPictureIndex = ltvi_item.level
					ltvi_item.SelectedPictureIndex = 5
					//--------End Modified --------------------------------------------
					tab_1.tabpage_sort.tv_sort.SetItem(ll_handle,ltvi_item)
				end if
			end if
		end if
		tab_1.tabpage_sort.dw_view_sort.DeleteRow( ll_Row )
		
	CASE ELSE
		return
		
END CHOOSE

of_save()

end subroutine

public subroutine of_create_dynamic_dw (ref str_intellireport astr_ds);//====================================================================
// Event: w_custom_report.of_create_dynamic_dw()
//--------------------------------------------------------------------
// Description:create dynamic dw
//--------------------------------------------------------------------
// Arguments:
// 	ref	str_intellireport	astr_ds	
//--------------------------------------------------------------------
// Returns:  (none)
//--------------------------------------------------------------------
// Author:	Andy		Date: Feb 29,2008
//--------------------------------------------------------------------
//	
//--------------------------------------------------------------------
// Modify History:
//
//====================================================================
String ls_screen,ls_ScreenArray[]
Long   ll_ScreenCnt,ll_i,ll_screenID
n_cst_string lnvo_string
String ls_dwsyntax,ls_screenID,ls_ERRORS
Long   ll_Find

ls_screen = astr_ds.ls_screen
ls_Screen = ls_Screen + ','
lnvo_string.of_parsetoarray( ls_Screen, ',', ls_ScreenArray )
ll_ScreenCnt = UpperBound(ls_ScreenArray)

FOR ll_i = 1 to ll_ScreenCnt
	astr_ds.lds[ll_i] = create n_ds
	ls_screenID = ls_ScreenArray[ll_i]
	if Not IsNumber(ls_screenID) then 
		astr_ds.lds[ll_i].dataobject = ls_screenID
	else
		ll_screenID = Long(ls_screenID)		
		if astr_ds.ll_module = 1 then
			//$<modify> 07.01.2008 by Andy 
			//$<Reason> fixed BugG070101(add:if statement)
			//ls_dwsyntax = f_get_screen_sql(astr_ds.ll_data_view_id,ll_screenID)
			//---------Begin Modified by (Appeon)Toney 06.13.2013 for V141 ISG-CLX--------			
			  /*
				IF AppeonGetClientType() = "WEB" THEN
					SELECT dw_sql
					INTO :ls_dwsyntax
					FROM ctx_screen 
					WHERE data_view_id = :astr_ds.ll_data_view_id 
					AND screen_id = :ll_screenID;
				ELSE
					ls_dwsyntax = f_get_screen_sql(astr_ds.ll_data_view_id,ll_screenID)				
				END IF	
			  */
			string   ls_screen_style
			IF AppeonGetClientType() = "WEB" THEN
				SELECT ( case when screen_style = 'G' Then grid_sql else dw_sql end ) 
				INTO :ls_dwsyntax
				FROM ctx_screen 
				WHERE data_view_id = :astr_ds.ll_data_view_id 
				AND screen_id = :ll_screenID;
			ELSE
				/********************************************///added by gavins 20120313 grid
				SELECT screen_style
					INTO :ls_Screen_style
					FROM ctx_screen 
					WHERE data_view_id = :astr_ds.ll_data_view_id 
					AND screen_id = :ll_screenID;
				/********************************************/		
				If ls_Screen_style = 'G' Then
					ls_dwsyntax = f_get_screen_gridsql(astr_ds.ll_data_view_id,ll_screenID,false)  //add false argu -jervis 10.11.2011
				Else
					ls_dwsyntax = f_get_screen_sql(astr_ds.ll_data_view_id,ll_screenID,false)  //add false argu -jervis 10.11.2011
				End If					
			END IF			  
			//---------End Modfiied ------------------------------------------------------------------			
			//end 07.01.2008
			astr_ds.lds[ll_i].Create( ls_dwsyntax, ls_ERRORS)
		/*
		elseif astr_ds.ll_module = 2 then		
			inv_data_entry.of_create_dynamic_ds(0, astr_ds.ll_data_view_id, ll_screenID, astr_ds.lds[ll_i], 0, SQLCA)
		*/
		end if
	end if
NEXT

end subroutine

public subroutine of_init_dynamic_dw ();//====================================================================
// Event: w_custom_report.of_init_dynamic_dw()
//--------------------------------------------------------------------
// Description:
//--------------------------------------------------------------------
// Arguments:
// 		
//--------------------------------------------------------------------
// Returns:  (none)
//--------------------------------------------------------------------
// Author:	Andy		Date: Feb 29,2008
//--------------------------------------------------------------------
//	
//--------------------------------------------------------------------
// Modify History:
//
//====================================================================
Long    ll_i,ll_Cnt
Boolean lb_Flag
Long    ll_N,ll_tCnt
String  ls_v_name,ls_screen
Long    ll_Find

ll_tCnt= tab_1.tabpage_tables.dw_view_tables.RowCount( )
ll_Cnt = UPPERBOUND(istr_ds)

FOR ll_N = 1 to ll_tCnt
	ls_v_name = tab_1.tabpage_tables.dw_view_tables.GetItemString(ll_N,"conv_view_table_table_name")
	lb_Flag = False
	FOR ll_i = 1 to ll_Cnt
		IF istr_ds[ll_i].ls_v_name = ls_v_name then
			lb_Flag = true
			exit
		end if
	NEXT
	//Create dynamic dw
	if Not lb_Flag then
		ll_Find = ids_tables.Find("v_name='" + ls_v_name + "'",0,ids_tables.RowCount())
		if ll_Find > 0 then
			ls_screen = ids_tables.GetItemString( ll_Find, "screen" )
		end if
		
		ll_Cnt ++
		istr_ds[ll_Cnt].ll_module = il_module
		istr_ds[ll_Cnt].ll_data_view_id = il_data_view_id
		istr_ds[ll_Cnt].ls_v_name = ls_v_name				
		istr_ds[ll_Cnt].ls_screen = ls_screen
		of_create_dynamic_dw(istr_ds[ll_Cnt])
	end if
NEXT

end subroutine

public function long of_check_fields ();//====================================================================
// Event: w_custom_report.of_check_fields()
//--------------------------------------------------------------------
// Description:Come from cb_next_3.clicked()
//--------------------------------------------------------------------
// Arguments:
//--------------------------------------------------------------------
// Returns:  (none)
//--------------------------------------------------------------------
// Author:	Andy		Date: Mar 04,2008
//--------------------------------------------------------------------
//	
//--------------------------------------------------------------------
// Modify History:
//
//====================================================================

Integer li_rc
Integer i
integer c
Integer li_total_agg
string  ls_alias
string ls_wiz  //maha 11.03.2014
string ls_luf
Integer li_cnt_fld,li_sum_fld,li_avg_fld

IF tab_1.tabpage_columns.dw_view_fields.RowCount() = 0 THEN
	//---------Begin Modified by (Appeon)Stephen 04.23.2014 for V142 Schedule IntelliReport--------
	//MessageBox( "Fields", "You must select at least one field to report on." )
	inv_message.of_messagebox("Fields", "You must select at least one field to report on.", true)
	is_run_error = "Fields: You must select at least one field to report on."
	ib_run_sucess = false
	//---------End Modfiied ------------------------------------------------------	
	Return -1
END IF

li_rc = tab_1.tabpage_columns.dw_view_fields.RowCount()

tab_1.tabpage_columns.dw_view_fields.AcceptText()
tab_1.tabpage_columns.dw_view_fields_edit.AcceptText()

FOR i = 1 TO li_rc
	//$<Modify> 04.24.2008 by Andy
	//if field_wizard_name = 'Date Range Comparison',then ignore.
//Start Code Change ----11.4.2014 #V14.2 maha- rewrote using variable
	ls_wiz =  tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "field_wizard_name")
	ls_luf = tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "lu_field_name")
	IF Not IsNull( ls_wiz )  then
		if ls_wiz  <> 'Date Range Comparison' and ls_wiz <> 'Single Date Comparison' and  ls_wiz <> 'Active Status (Appt)' THEN
			IF IsNull( tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "field_options" ) ) OR Trim(tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "field_options" ))  = '' THEN
				//---------Begin Modified by (Appeon)Stephen 04.23.2014 for V142 Schedule IntelliReport--------
				//MessageBox("", "You need to fill in the Compare To column." )
				inv_message.of_messagebox("", "You need to fill in the Compare To column.", true)
				is_run_error = "You need to fill in the Compare To column."
				ib_run_sucess = false
				//---------End Modfiied ------------------------------------------------------
				tab_1.tabpage_columns.dw_view_fields.SetRow( i )
				tab_1.tabpage_columns.dw_view_fields.ScrollToRow( i )
				tab_1.tabpage_columns.dw_view_fields_edit.SetColumn( "field_options" )
				tab_1.tabpage_columns.dw_view_fields_edit.setfocus( )
				Return -1
			END IF	
		end if
	//End Code Change ----11.4.2014
	END IF
	
	IF IsNull( tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "field_alias" ) ) OR tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "field_alias" )  = '' THEN
		//---------Begin Modified by (Appeon)Stephen 04.23.2014 for V142 Schedule IntelliReport--------
		//MessageBox("", "You need to fill in the Field Alias column." )
		inv_message.of_messagebox("", "You need to fill in the Field Alias column.", true)
		is_run_error = "You need to fill in the Field Alias column."
		ib_run_sucess = false
		//---------End Modfiied ------------------------------------------------------
		tab_1.tabpage_columns.dw_view_fields.SetRow( i )
		tab_1.tabpage_columns.dw_view_fields.ScrollToRow( i )
		tab_1.tabpage_columns.dw_view_fields_edit.SetColumn( "field_alias" )
		tab_1.tabpage_columns.dw_view_fields_edit.setfocus( )
		Return -1
	END IF
		
	li_cnt_fld = tab_1.tabpage_columns.dw_view_fields.GetItemNumber( i, "count_fld" )
	li_sum_fld = tab_1.tabpage_columns.dw_view_fields.GetItemNumber( i, "sum_fld" )
	li_avg_fld = tab_1.tabpage_columns.dw_view_fields.GetItemNumber( i, "avg_fld" )
	if IsNull(li_cnt_fld) then li_cnt_fld = 0
	if IsNull(li_sum_fld) then li_sum_fld = 0
	if IsNull(li_avg_fld) then li_avg_fld = 0
	li_total_agg = li_cnt_fld + li_sum_fld + li_avg_fld
	
	//MESSAGEBOX("", "I" + tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "aggregate_type" ) +"I" )		
	IF IsNull(tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "aggregate_type" ) ) OR +&
				 tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "aggregate_type" ) = "" OR +&
				 tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "aggregate_type" ) = " " THEN		 
		//li_total_agg = tab_1.tabpage_columns.dw_view_fields.GetItemNumber( i, "count_fld" ) + tab_1.tabpage_columns.dw_view_fields.GetItemNumber( i, "sum_fld" ) + tab_1.tabpage_columns.dw_view_fields.GetItemNumber( i, "avg_fld" ) 		 		
		IF li_total_agg > 0 THEN
			//MessageBox( "Aggregate Field Setup Error", "You have selected an aggregate calculation but not an aggregate type.  Please correct." )
 			//---------Begin Modified by (Appeon)Stephen 04.23.2014 for V142 Schedule IntelliReport--------
			// MessageBox( "Aggregate Field Setup Error", "You have selected an aggregate calculation but no aggregate type.  Please correct." )
			inv_message.of_messagebox("Aggregate Field Setup Error", "You have selected an aggregate calculation but no aggregate type.  Please correct.", true)
			is_run_error = "Aggregate Field Setup Error: You have selected an aggregate calculation but no aggregate type.  Please correct."
			ib_run_sucess = false
			//---------End Modfiied ------------------------------------------------------
			tab_1.tabpage_columns.dw_view_fields.SetRow( i )
			tab_1.tabpage_columns.dw_view_fields.ScrollToRow( i )
			tab_1.tabpage_columns.dw_view_fields_edit.SetColumn( "aggregate_type" )
			tab_1.tabpage_columns.dw_view_fields_edit.setfocus( )
			Return -1			
		END IF
	END IF
	
	IF LenA( Trim(tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "aggregate_type" )) ) > 1 THEN
		//li_total_agg = tab_1.tabpage_columns.dw_view_fields.GetItemNumber( i, "count_fld" ) + tab_1.tabpage_columns.dw_view_fields.GetItemNumber( i, "sum_fld" ) + tab_1.tabpage_columns.dw_view_fields.GetItemNumber( i, "avg_fld" ) 
		IF li_total_agg = 0 THEN
			//---------Begin Modified by (Appeon)Stephen 04.23.2014 for V142 Schedule IntelliReport--------
			//MessageBox( "Aggregate Field Setup Error", "You have selected an aggregate type but no aggregate function ( ex. Sum, Count, Average).  Please correct." )
			inv_message.of_messagebox( "Aggregate Field Setup Error", "You have selected an aggregate type but no aggregate function ( ex. Sum, Count, Average).  Please correct.", true)
			is_run_error = "Aggregate Field Setup Error: You have selected an aggregate type but no aggregate function ( ex. Sum, Count, Average).  Please correct."
			ib_run_sucess = false
			//---------End Modfiied ------------------------------------------------------
			tab_1.tabpage_columns.dw_view_fields.SetRow( i )
			tab_1.tabpage_columns.dw_view_fields.ScrollToRow( i )
			tab_1.tabpage_columns.dw_view_fields_edit.SetColumn( "aggregate_type" )
			tab_1.tabpage_columns.dw_view_fields_edit.setfocus( )
			Return -1			
		END IF
	END IF
END FOR

FOR i = 1 TO li_rc - 1 //duplicate alias check maha 020304
	ls_alias = tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "field_alias" )
	for c = i + 1 TO li_rc 
		if ls_alias = tab_1.tabpage_columns.dw_view_fields.GetItemString( c, "field_alias" )then 
			//messagebox("Duplicate Fields", ls_alias + " on row " + string(c) + " has a duplicate field alias ( to row " + string(i) + ").  Modify one to continue.")
 			//---------Begin Modified by (Appeon)Stephen 04.23.2014 for V142 Schedule IntelliReport--------
			// messagebox("Duplicate Fields", ls_alias + " on row " + string(c) + " has a duplicate field alias ( with row " + string(i) + ").  Modify one to continue.")
			inv_message.of_messagebox( "Duplicate Fields", ls_alias + " on row " + string(c) + " has a duplicate field alias ( with row " + string(i) + ").  Modify one to continue.", true)
			is_run_error = "Duplicate Fields: " + ls_alias + " on row " + string(c) + " has a duplicate field alias ( with row " + string(i) + ").  Modify one to continue."
			ib_run_sucess = false
			//---------End Modfiied ------------------------------------------------------
			tab_1.tabpage_columns.dw_view_fields.SetRow( c )
			tab_1.tabpage_columns.dw_view_fields.ScrollToRow( c )
			tab_1.tabpage_columns.dw_view_fields_edit.SetColumn( "field_alias" )
			tab_1.tabpage_columns.dw_view_fields_edit.setfocus( )
			return -1
		end if
	next
next

return 1
end function

public function long of_check_tables ();//====================================================================
// Event: w_custom_report.of_check_tables()
//--------------------------------------------------------------------
// Description:Come from cb_next_2.clicked()
//--------------------------------------------------------------------
// Arguments:
//--------------------------------------------------------------------
// Returns:  (none)
//--------------------------------------------------------------------
// Author:	Andy		Date: July 08,2008
//--------------------------------------------------------------------
//	
//--------------------------------------------------------------------
// Modify History:   07.08.2008 by Andy
//
//====================================================================

integer i
string ls_def
integer p
integer a = 0
long t
string ls_tname


IF tab_1.tabpage_tables.dw_view_tables.RowCount() = 0 THEN
	//---------Begin Modified by (Appeon)Stephen 05.05.2014 for V142 Schedule IntelliReport--------
	//MessageBox( "Tables", "You must select at least one table to report on." )
	inv_message.of_messagebox("Tables", "You must select at least one table to report on.", true)
	is_run_error = "You must select at least one table to report on."
	ib_run_sucess = false
	//---------End Modfiied ------------------------------------------------------	
	Return -1
END IF

//$<add> 03.27.2008 by Andy
IF Not tab_1.tabpage_tables.cbx_advanced.checked THEN
	IF tab_1.tabpage_tables.dw_view_tables.RowCount() > 1 AND tab_1.tabpage_tables.dw_view_links.RowCount() = 0  THEN
		tab_1.tabpage_tables.cb_auto_link.event clicked()
		IF  tab_1.tabpage_tables.dw_view_links.RowCount() = 0 OR tab_1.tabpage_tables.dw_view_tables.RowCount() - 1   > tab_1.tabpage_tables.dw_view_links.RowCount() THEN
			//---------Begin Modified by (Appeon)Stephen 05.05.2014 for V142 Schedule IntelliReport--------
			//MessageBox( "Linking Error", "IntelliReport is having trouble figuring out the appropriate Report Table links and needs your help.")
			inv_message.of_messagebox("Linking Error", "IntelliReport is having trouble figuring out the appropriate Report Table links and needs your help.", true)
			is_run_error = "Linking Error: IntelliReport is having trouble figuring out the appropriate Report Table links and needs your help."
			ib_run_sucess = false
			//---------End Modfiied ------------------------------------------------------	
			tab_1.tabpage_tables.cbx_advanced.checked = True
			tab_1.tabpage_tables.cbx_advanced.Event clicked()
			RETURN -1
		END IF
	END IF
	
	//$<add> 04.22.2008 by Andy
	IF tab_1.tabpage_tables.dw_view_tables.RowCount() - 1   > tab_1.tabpage_tables.dw_view_links.RowCount()  THEN
		tab_1.tabpage_tables.cb_auto_link.event clicked()
		IF  tab_1.tabpage_tables.dw_view_links.RowCount() = 0 OR tab_1.tabpage_tables.dw_view_tables.RowCount() - 1   > tab_1.tabpage_tables.dw_view_links.RowCount() THEN
			//---------Begin Modified by (Appeon)Stephen 05.05.2014 for V142 Schedule IntelliReport--------
			//MessageBox( "Linking Error", "IntelliReport is having trouble figuring out the appropriate Report Table links and needs your help.")
			inv_message.of_messagebox("Linking Error", "IntelliReport is having trouble figuring out the appropriate Report Table links and needs your help.", true)
			is_run_error = "Linking Error: IntelliReport is having trouble figuring out the appropriate Report Table links and needs your help."
			ib_run_sucess = false
			//---------End Modfiied ------------------------------------------------------
			tab_1.tabpage_tables.cbx_advanced.checked = True
			tab_1.tabpage_tables.cbx_advanced.Event clicked()
			RETURN -1
		END IF 
	END IF
END IF
//end add 03.27.2008

IF tab_1.tabpage_tables.dw_view_tables.RowCount() > 1 AND tab_1.tabpage_tables.dw_view_links.RowCount() = 0  THEN
	//$<modify> 02.29.2008 by Andy
	//MessageBox( "Links", "You have more than 1 table selected but no links.  Please link the tables in the Create View Table Links Box." )	
	//---------Begin Modified by (Appeon)Stephen 05.05.2014 for V142 Schedule IntelliReport--------
	//MessageBox( "Links", "You have more than 1 table selected but no links. Please click Auto Link to have system link tables for you or click Add Link to link tables in the Create View Table Links box." )
	inv_message.of_messagebox("Links", "You have more than 1 table selected but no links. Please click Auto Link to have system link tables for you or click Add Link to link tables in the Create View Table Links box.", true)
	is_run_error = "Links: You have more than 1 table selected but no links. Please click Auto Link to have system link tables for you or click Add Link to link tables in the Create View Table Links box."
	ib_run_sucess = false
	//---------End Modfiied ------------------------------------------------------
	Return -1
END IF

IF tab_1.tabpage_tables.dw_view_tables.RowCount() - 1   > tab_1.tabpage_tables.dw_view_links.RowCount()  THEN //maha 111902
	//---------Begin Modified by (Appeon)Stephen 05.05.2014 for V142 Schedule IntelliReport--------
	//MessageBox( "Linking Error", "You do not have enough links for the number of tables selected.  Please verify all tables are linked." )
	inv_message.of_messagebox("Linking Error", "You do not have enough links for the number of tables selected.  Please verify all tables are linked." , true)
	is_run_error = "Linking Error: You do not have enough links for the number of tables selected.  Please verify all tables are linked." 
	ib_run_sucess = false
	//---------End Modfiied ------------------------------------------------------
	//$<add> 03.27.2008 by Andy
	IF Not tab_1.tabpage_tables.cbx_advanced.checked THEN
		tab_1.tabpage_tables.cbx_advanced.checked = True
		tab_1.tabpage_tables.cbx_advanced.Event clicked()
	END IF
	//end add 03.27.2008
	Return -1
END IF

//$<comment> 04.15.2008
//IF of_save() = -1 THEN
//	Return -1
//END IF
//end comment 04.15.2008

//if (ii_facil_security = 1) and (Not gb_contract_version) then			//Modified by Scofield on 2007-08-23: Add "and (Not gb_contract_version)"
if (ii_facil_security = 1) and (il_module=2) then //04.03.2008 by Andy Fixed BugG040302
	for i = 1 to tab_1.tabpage_tables.dw_view_tables.RowCount()
		ls_tname = tab_1.tabpage_tables.dw_view_tables.getitemstring(i,"table_name")
		
//Start Code Change ---- 10.05.2007 #V7 maha  changed test logic because the original way a pd_affil_stat view not named v_affil_stat would not be trapped
		
//		//--------------------------- APPEON BEGIN ---------------------------
//		//$<modify> 2005-11-11 By: owen chen
//		//$<reason> add database option for sql excution
//		choose case gs_dbtype
//			case 'ASA'
//				select view_def into :ls_def from systable where table_name = :ls_tname;		
//			case 'SQL'
//				select view_def into :ls_def from v_systable where table_name = :ls_tname;
//		end choose
//		//---------------------------- APPEON END ----------------------------
//				
//		if  pos(ls_def,"pd_affil_stat",1) > 0 then
		if  lower(ls_tname) = "v_affil_stat" then //Start Code Change ---- 10.05.2007 #V7 maha 
			a = 1
		end if
	next
//End Code Change---10.05.2007
	if a = 0 then
		//$<modify> 04.03.2008 by Andy
		//messagebox("Table Select error","Facility Security is turned on so the v_affil_stat must be used in all reports.")
		//---------Begin Modified by (Appeon)Stephen 05.05.2014 for V142 Schedule IntelliReport--------
		//messagebox("Table Select error","Facility Security is turned on so the Appointment Status must be used in all reports.")
		inv_message.of_messagebox("Table Select error", "Facility Security is turned on so the Appointment Status must be used in all reports." , true)
		is_run_error = "Table Select error: Facility Security is turned on so the Appointment Status must be used in all reports."
		ib_run_sucess = false
		//---------End Modfiied ------------------------------------------------------
		//end modify 04.03.2008
		return -1
	end if
end if

a=0

//if department security is turned on then do this.
//if ii_dept_security_on = 1 and (Not gb_contract_version) then			//Modified by Scofield on 2007-08-23: Add "and (Not gb_contract_version)"
if ii_dept_security_on = 1 and (il_module=2) then //04.03.2008 by Andy Fixed BugG040302
	for i = 1 to tab_1.tabpage_tables.dw_view_tables.RowCount()
		ls_tname = tab_1.tabpage_tables.dw_view_tables.getitemstring(i,"table_name")
		//Start Code Change ---- 10.05.2007 #V7 maha  changed test logic because the original way a department view not named v_affil_stat would not be trapped

//		//--------------------------- APPEON BEGIN ---------------------------
//		//$<modify> 2005-11-11 By: owen chen
//		//$<reason> add database option for sql excution
//		choose case gs_dbtype
//			case 'ASA'
//				select view_def into :ls_def from systable where table_name = :ls_tname;
//			case 'SQL'
//				select view_def into :ls_def from v_systable where table_name = :ls_tname;
//		end choose
//		//---------------------------- APPEON END ----------------------------
//		
//		if  pos(ls_def,"pd_affil_dept",1) > 0 then
		if  lower(ls_tname) = "v_affil_dept" then //Start Code Change ---- 10.05.2007 #V7 maha 
			a = 1
		end if
	next	
	if a = 0 then
		//$<modify> 04.03.2008 by Andy
		//messagebox("Table Select error","Department Security is turned on so the v_affil_dept must be used in all reports.  If you do not have this view contact intellisoft support.")
		//---------Begin Modified by (Appeon)Stephen 05.05.2014 for V142 Schedule IntelliReport--------
		//messagebox("Table Select error","Department Security is turned on so the Affil Department must be used in all reports.  If you do not have this view contact intellisoft support.")
		inv_message.of_messagebox("Table Select error", "Department Security is turned on so the Affil Department must be used in all reports.  If you do not have this view contact intellisoft support." , true)
		is_run_error = "Table Select error: Department Security is turned on so the Affil Department must be used in all reports.  If you do not have this view contact intellisoft support."
		ib_run_sucess = false
		//---------End Modfiied ------------------------------------------------------
		//end modify 04.03.2008
		return -1
	end if
end if
	
return 1
end function

public function long of_check_filter ();//====================================================================
// Event: w_custom_report.of_check_filter()
//--------------------------------------------------------------------
// Description:
//--------------------------------------------------------------------
// Arguments:
// 		
//--------------------------------------------------------------------
// Returns:  long
//--------------------------------------------------------------------
// Author:	Andy		Date: Apr 16,2008
//--------------------------------------------------------------------
//	
//--------------------------------------------------------------------
// Modify History:
//
//====================================================================
Long ll_rc,i
tab_1.tabpage_filter.dw_view_where.accepttext( )

ll_rc = tab_1.tabpage_filter.dw_view_where.RowCount( )
FOR i = 1 TO ll_rc
	IF IsNull( tab_1.tabpage_filter.dw_view_where.GetItemString( i, "table_field_name" ) ) OR +&
		IsNull( tab_1.tabpage_filter.dw_view_where.GetItemString( i, "operator" ) ) OR +&
		IsNull( tab_1.tabpage_filter.dw_view_where.GetItemString( i, "value" ) ) THEN
		//---------Begin Modified by (Appeon)Stephen 05.05.2014 for V142 Schedule IntelliReport--------
		//MessageBox("Missing Data", "All fields must be completed." )
		inv_message.of_messagebox("Missing Data", "All fields must be completed." , true)
		is_run_error = "Missing Data: All fields must be completed." 
		ib_run_sucess = false
		//---------End Modfiied ------------------------------------------------------
		tab_1.tabpage_filter.dw_view_where.SetColumn( "table_field_name" )
		tab_1.tabpage_filter.dw_view_where.SetRow( i )
		tab_1.tabpage_filter.dw_view_where.SetFocus( )		
		SetRedraw( True )
		Return -1
	END IF
END FOR

Return 1
end function

public subroutine of_save_tables ();//====================================================================
// Event: w_custom_report.of_save_tables()
//--------------------------------------------------------------------
// Description:Come from tab_1.selectchanging event,update tables.
//--------------------------------------------------------------------
// Arguments:
// 		
//--------------------------------------------------------------------
// Returns:  (none)
//--------------------------------------------------------------------
// Author:	Andy		Date: Jul 08,2008
//--------------------------------------------------------------------
//	
//--------------------------------------------------------------------
// Modify History:
//
//====================================================================
//---------Begin Added by (Appeon)Toney 06.13.2013 for V141 ISG-CLX--------
Boolean 	lbn_retrieve 
//---------End Added ------------------------------------------------------------------

IF tab_1.tabpage_tables.cbx_distinct.Checked THEN
	UPDATE conv_view
	SET distinct_sql = 1
	WHERE conv_view.view_id = :il_view_id ;
ELSE
	UPDATE conv_view
	SET distinct_sql = 0
	WHERE conv_view.view_id = :il_view_id ;	
END IF
IF SQLCA.SQLCODE = -1 THEN
	//---------Begin Modified by (Appeon)Stephen 05.05.2014 for V142 Schedule IntelliReport--------
	//MessageBox("DB Error", SQLCA.SQLERRTEXT )
	inv_message.of_messagebox("DB Error", SQLCA.SQLERRTEXT , true)
	is_run_error = "DB Error:" + SQLCA.SQLERRTEXT
	ib_run_sucess = false
	//---------End Modfiied ------------------------------------------------------
END IF

//$<add> 03.27.2008 by Andy
IF tab_1.tabpage_tables.cbx_advanced.Checked THEN
	UPDATE conv_view
	SET advanced_linking = 1
	WHERE conv_view.view_id = :il_view_id ;
ELSE
	UPDATE conv_view
	SET advanced_linking = 0
	WHERE conv_view.view_id = :il_view_id ;	
END IF
IF SQLCA.SQLCODE = -1 THEN
	//---------Begin Modified by (Appeon)Stephen 05.05.2014 for V142 Schedule IntelliReport--------
	//MessageBox("DB Error", SQLCA.SQLERRTEXT )	
	inv_message.of_messagebox("DB Error", SQLCA.SQLERRTEXT , true)
	is_run_error = "DB Error:" + SQLCA.SQLERRTEXT
	ib_run_sucess = false
	//---------End Modfiied ------------------------------------------------------
END IF

//$<Modify>  04.15.2008 by Andy
//$Reason:fixed BugJ022602 and Optimize speed.
//of_save()

//---------Begin Added by (Appeon)Toney 06.13.2013 for V141 ISG-CLX--------
//Added By Mark Lee 06/04/12
IF il_module = 1 THEN lbn_retrieve = wf_check_link_column()
//---------End Added ------------------------------------------------------------------


tab_1.tabpage_tables.dw_view_tables.Update()
tab_1.tabpage_tables.dw_view_links.Update()
//--------Begin Added by Nova 08.27.2010------------------------
//V10.5 SK IntelliReport
if isvalid(w_custom_report_selection) then
	tab_1.tabpage_columns.dw_view_fields.Update()
end if
//--------End Added --------------------------------------------
//end Modify 04.15.2008

//---------Begin Added by (Appeon)Toney 06.13.2013 for V141 ISG-CLX--------
//Added By Mark Lee 06/04/12
IF il_module = 1 THEN
	If lbn_retrieve = True Then
		tab_1.tabpage_tables.dw_view_links.retrieve(il_view_id )
	End If
END IF
//---------End Added ------------------------------------------------------------------

end subroutine

public subroutine of_selecttab (integer ai_index);//====================================================================
// Event: w_custom_report.of_selecttab()
//--------------------------------------------------------------------
// Description:
//--------------------------------------------------------------------
// Arguments:
// 	value	integer	ai_index	
//--------------------------------------------------------------------
// Returns:  (none)
//--------------------------------------------------------------------
// Author:	Andy		Date: Jul 08,2008
//--------------------------------------------------------------------
//	
//--------------------------------------------------------------------
// Modify History:
//
//====================================================================

//$<add> 07.08.2008 by Andy
//Reason:Round APB BUG
IF Upper( appeongetclienttype() ) = 'WEB' then
	ib_AutoClicked = true
end if
tab_1.SelectTab( ai_index )
IF Upper( appeongetclienttype() ) = 'WEB' THEN
	ii_oldindex = 0 
	//ii_newindex = 0
	ib_AutoClicked = false
END IF

end subroutine

public function integer of_tabchanging (integer ai_oldindex, integer ai_newindex);//====================================================================
// Event: w_custom_report.of_tabchanging()
//--------------------------------------------------------------------
// Description:
// Workround a APB5.0 BUG
// (In WEB Versoin,SelectTab function will trigger selectionchanging two times, 
// then the same messagebox will pop two times,so add code round it.)
//--------------------------------------------------------------------
// Arguments:
// 	value	integer	ai_oldindex	
// 	value	integer	ai_newindex	
//--------------------------------------------------------------------
// Returns:  integer 1:prevent continue tab change/0:continue
//--------------------------------------------------------------------
// Author:	Andy		Date: Jul 08,2008
//--------------------------------------------------------------------
//	
//--------------------------------------------------------------------
// Modify History:
//
//====================================================================
//$<add> 07.08.2008 by Andy
boolean lb_flag = true
Long    ll_Ret

CHOOSE CASE ai_oldindex
	CASE 2,3
		if ai_newindex > ai_oldindex then
			// If APB5.0 BUG is fixed,use
			// "if ai_oldindex = 2 then ll_Ret = of_check_tables() else ll_Ret = of_check_fields()
			//  if ll_Ret = -1 then return 1
			// " replace it.
			IF Upper( appeongetclienttype() ) = 'WEB' and ib_AutoClicked THEN
				if ii_oldindex = ai_oldindex then lb_flag = false//and ii_newindex = newindex
			END IF
			if lb_flag then
				if ai_oldindex = 2 then ll_Ret = of_check_tables() else ll_Ret = of_check_fields()
				if ll_Ret = -1 then
					IF Upper( appeongetclienttype() ) = 'WEB' and ib_AutoClicked THEN
						ii_oldindex = ai_oldindex 
						//ii_newindex = newindex
					END IF
					return 1
				end if
			end if 
			IF Upper( appeongetclienttype() ) = 'WEB' and ib_AutoClicked THEN
				ii_oldindex = ai_oldindex 
				//ii_newindex = newindex
			END IF		
		end if
		
	CASE ELSE
		//DO NOTHING
		
END CHOOSE	
	
return 0
end function

public function string of_replace (string arg_str, string arg_old, string arg_new);Long start_pos = 1
string ls_return
// Find the first occurrence of old_str.

start_pos = PosA(arg_str, arg_old, start_pos)

// Only enter the loop if you find old_str.

DO WHILE start_pos > 0
	
	// Replace old_str with new_str.
	
	arg_str = ReplaceA(arg_str, start_pos, LenA(arg_old), arg_new)
	
	// Find the next occurrence of old_str.
	
	start_pos = PosA(arg_str, arg_old, start_pos+LenA(arg_new))
	
LOOP

return arg_str
end function

public subroutine of_dashboard (long ai_id);//////////////////////////////////////////////////////////////////////
// $<function>w_custom_report::of_dashboard()
// $<arguments>
//		value	long	ai_id		
// $<returns> (none)
// $<description>
// $<description> For Dashboard
//////////////////////////////////////////////////////////////////////
// $<add> 09.16.2008 by Ken.Guo
//////////////////////////////////////////////////////////////////////

long ll_find
ll_find=tab_1.tabpage_browse.dw_report_list.find("view_id="+string(ai_id), 1, tab_1.tabpage_browse.dw_report_list.rowcount())
if ll_find>0 then
	tab_1.tabpage_browse.dw_report_list.selectrow( 0, false)
	tab_1.tabpage_browse.dw_report_list.scrolltorow(ll_find)
	//---------Begin Added by (Appeon)Toney 06.13.2013 for V141 ISG-CLX--------
	tab_1.tabpage_browse.dw_report_list.setrow(ll_find)
	of_retrieve_detail(ai_id)		
	//---------End Added ------------------------------------------------------------------
	tab_1.tabpage_browse.dw_report_list.selectrow(ll_find, true)
	If This.WindowState = Minimized! Then This.windowstate = Normal!
	
	//---------Begin Added by (Appeon)Toney 06.13.2013 for V141 ISG-CLX--------
	//run report
	tab_1.tabpage_run.Enabled = True
	tab_1.tabpage_run.dw_run.Reset()
	tab_1.tabpage_browse.cb_select.Post Event Clicked()	
	//---------End Added ------------------------------------------------------------------
end if 
end subroutine

public function integer of_readonly_security ();//Start Code Change ----03.15.2009 #V92 maha - added readonly security
tab_1.tabpage_browse.cb_copy.visible = false
tab_1.tabpage_browse.cb_delete.visible = false
tab_1.tabpage_browse.cb_new.visible = false
tab_1.tabpage_browse.cb_properties.visible = false
tab_1.tabpage_browse.cbx_goto.visible = false
tab_1.tabpage_browse.cb_next_1.visible = false
tab_1.tabpage_browse.cb_security.visible = false  //Start Code Change ----06.24.2011 #V11 maha 

tab_1.tabpage_tables.visible = false
tab_1.tabpage_columns.visible = false
tab_1.tabpage_filter.visible = false
tab_1.tabpage_sort.visible = false
tab_1.tabpage_preview.visible = false

//tab_1.tabpage_run.cb_print.visible = False
//tab_1.tabpage_run.cb_saveas.visible = False
//tab_1.tabpage_run.cb_showsql .visible = False
tab_1.tabpage_run.cb_sql.visible = False

return 1


end function

public function string of_build_view_sql (integer as_flag);//MAIN SQL function
Integer i
Integer li_add_rec_fld  
Integer li_distinct_sql
Integer li_rc
Integer li_remove_len = 5
integer p

Long ll_filter_len //nova 01232009
Long ll_sigle_pos = 0//nova 01232009
Long ll_double_pos = 0//nova 01232009
Long    ll_Find,ll_field_width //Andy 03032008
Long ll_dot = 0//nova 03302009
Long ll_befor = 0//nova 03302009
Long ll_after = 0//nova 03302009

String ls_sql
String ls_table_name
String ls_tname
String ls_table_field
string ls_dir //maha 111802
string ls_sort //maha 111802
String  ls_lu_field //Andy 02212008
String  ls_str //Andy 02292008
String  ls_lookup_type,ls_c_name //Andy 03032008
String  ls_field_type
String ls_filter_value //nova 01232009
string ls_alias  //maha 11.04.2014
string ls_from //maha 07.09.2015
String ls_filter_value_display
string  ls_sort_field //Stephen 06.27.2012
			
Boolean 	lb_multi_table

lb_multi_table = False
is_sort_synt = ""

//$<add> 07.08.2008 by Andy
//$Reason:(APB BUG)
// In WEB Versoin,SelectTab function will trigger selectionchanging two times, 
// then the same messagebox will pop two times,so add code round it.
// If APB BUG is fixed,del it.
boolean lb_flag = true
IF Upper( appeongetclienttype() ) = 'WEB' and ib_AutoClicked THEN
	if ii_oldindex = 7 then lb_flag = false//and ii_newindex = newindex
END IF
if Not lb_flag then return ls_sql 
IF Upper( appeongetclienttype() ) = 'WEB' and ib_AutoClicked THEN
	ii_oldindex = 7 
	//ii_newindex = newindex
END IF
//end APB BUG

//$<add> 07.08.2008 by Andy		
if of_check_tables() = -1 then return ls_sql else of_save_tables()
if of_check_fields() = -1 then return ls_sql
//$<modify> 04.16.2008 by Andy Reason:Optimize speed.
//of_save()
if of_check_filter() = -1 then return ls_sql
//end modify 04.16.2008
//--------------------------- APPEON BEGIN ---------------------------
//$<ID> PT-02
//$<modify> 02.09.2006 By: Rodger Wu
//$<reason> Performance tuning
//$<modification> Collect two SQL statements and merge them into one SQL to reduce
//$<modification> client-server interactions. Refer to PT-03 for more information.
/*
SELECT conv_view.distinct_sql
INTO :li_distinct_sql  
FROM conv_view  
WHERE conv_view.view_id = :il_view_id   ;
*/
SELECT conv_view.distinct_sql, conv_view.add_rec_id_fld
INTO :li_distinct_sql, :li_add_rec_fld
FROM conv_view  
WHERE conv_view.view_id = :il_view_id   ;
//---------------------------- APPEON END ----------------------------
//--------Begin Modified by  Nova 08.18.2010------------------------
//V10.5 SK IntelliReport
//IF li_distinct_sql  = 1 THEN
//	ls_sql = "SELECT DISTINCT"  + "~n"
//ELSE
//	ls_sql = "SELECT "  + "~n"
//END IF
IF li_distinct_sql  = 1 THEN
	IF as_flag=0 THEN
		ls_sql = "SELECT DISTINCT TOP 100 "  + "~n"
	ELSE
		ls_sql = "SELECT DISTINCT "  + "~n"
	END IF
ELSE
   IF as_flag=0 THEN
		ls_sql = "SELECT TOP 100 "  + "~n"
	ELSE
		ls_sql = "SELECT "  + "~n"
	END IF
END IF
//--------End Modified --------------------------------------------
//build the select field 
li_rc = tab_1.tabpage_columns.dw_view_fields.RowCount()

FOR i = 1 TO li_rc
	ls_table_name =  tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "table_name" )
	//$<add> 02.21.2008 by Andy
	ls_lu_field   =  tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "lu_field_name" )
	ls_table_field = tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "table_field" ) //Start Code Change ----11.04.2014 #V14.2 maha - moved here
	ls_alias = tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "field_alias" )
	//debugbreak()
	IF PosA( tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "compute_name" ), "=" ) > 0 THEN //trap for computed fields
		//ls_table_field = tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "table_field" )
		//$<comment> 04.07.2008 by Andy
		//$Reason: fixed a bug Robert
		//If table_field = "CASE when v_ctx_basic_info.custom_5 = '117372' then 'Templates' else 'Other' end",
		//then the "CASE when v_ctx_basic_info.custom_5 = " is lost.
		//ls_table_field = Mid( ls_table_field, POS( ls_table_field, "=" ) + 1 , 1000 )
		//end comment 04.07.2008
		//ls_sql = ls_sql + "~t" + tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "field_alias" ) + " = " + ls_table_field + ",  " + "~n"
		ls_sql = ls_sql + "~t" + ls_alias  + " = " +  ls_table_field + ",  " + "~n"  //maha 11.04.2014 - changed to variable
		//ls_sql = ls_sql + "~t" + tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "field_alias" ) + " = " + ls_table_name + "." + ls_table_field + ",  " + "~n"			
	ELSE
		//Start Code Change ----03.02.2010 #V10 maha - if NO DISPLAY then don't add to field list
		//Start Code Change ----01.20.2011 #V11 maha - check sow all fields option (set in open event set_34)
		if ib_show_all_fields_in_select = false then
			if tab_1.tabpage_columns.dw_view_fields.GetItemnumber( i, "field_visible" ) = 0 then continue
		end if
		//End Code Change---03.02.2010
		//End Code Change ----01.20.2011
		
		//$<Modify> 02.21.2008 by Andy
		//ls_sql = ls_sql + "~t" + tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "field_alias" ) + " = " + ls_table_name + "." + tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "table_field" ) + ",  " + "~n"	
		if IsNull(ls_lu_field) or Trim(ls_lu_field) = "" then
			//ls_sql = ls_sql + "~t" + tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "field_alias" ) + " = " + ls_table_name + "." + tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "table_field" ) + ",  " + "~n"	
			ls_sql = ls_sql + "~t" + ls_alias + " = " + ls_table_name + "." + ls_table_field + ",  " + "~n"	
		else
			
			//Dynamically link to the lookup table (lookup table alias = field_alias )
			//ls_sql = ls_sql + "~t" + tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "field_alias" ) + " = code_lookup_" + tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "field_alias" ) + "." + ls_lu_field + ",  " + "~n"	
			ls_lookup_type = tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "lookup_type" )
			if isNull(ls_lookup_type) then ls_lookup_type = "C"
			if ls_lookup_type = "C" or ls_lookup_type = "A" then
				//get field width
				ll_field_width = 0
				//ls_c_name = tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "table_field" )
				ls_c_name = ls_table_field
				ll_Find = ids_fields.Find("c_name='" + ls_c_name + "' and table_name='" + ls_table_name + "'",0,ids_fields.RowCount())
				if ll_Find > 0 then
					ll_field_width = ids_fields.GetItemNumber(ll_Find,"length")				
				end if
				if ll_field_width < 30 then ll_field_width = 30
				
				if ls_lookup_type = "C" then ls_str = " code_lookup_" else ls_str = " address_lookup_" 
				if ls_lookup_type = "A" and lower(ls_lu_field) = 'description' then ls_lu_field = 'entity_name'
				ls_str += tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "field_alias" ) + "." + ls_lu_field
				//$<modify> 04.10.2008 by Andy
				//Reason:   Round a APB bug
				//ls_sql = ls_sql + "~t" + tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "field_alias" ) + " = CASE WHEN " + ls_str + " IS NULL THEN CONVERT(VARCHAR(" + String(ll_field_width) + ")," + ls_table_name + "." + ls_c_name + ") ELSE " + ls_str + " END ,  " + "~n"				
				ls_sql = ls_sql + "~t" + "( CASE WHEN " + ls_str + " IS NULL THEN CONVERT(VARCHAR(" + String(ll_field_width) + ")," + ls_table_name + "." + ls_c_name + ") ELSE " + ls_str + " END ) " + tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "field_alias" ) + " ,  " + "~n"				
				//end modify
			end if	
		end if
		//end of modify 02.21.2008
	END IF
END FOR

//Start Code Change ----03.30.2010 #V10 maha - test for no fields selected
if ls_sql = "SELECT "  + "~n" or ls_sql = "SELECT DISTINCT"  + "~n" then
	//---------Begin Modified by (Appeon)Stephen 05.05.2014 for V142 Schedule IntelliReport--------
	//messagebox("Report Error","There are no fields selected for display on the columns tab.")
	inv_message.of_messagebox("Report Error", "There are no fields selected for display on the columns tab." , true)
	is_run_error = "Report Error: There are no fields selected for display on the columns tab."
	ib_run_sucess = false
	//---------End Modfiied ------------------------------------------------------
	return ""
end if
//End Code Change ----03.30.2019


ls_sql = LeftA( ls_sql, LenA( ls_sql ) - 4 ) + "~n"
//--------------------------- APPEON BEGIN ---------------------------
//$<ID> PT-03
//$<comment> 02.09.2006 By: Rodger Wu
//$<reason> Performance tuning
//$<reason> The SQL statement below is merged to the previous SQL statement in PT-02.
/*
SELECT conv_view.add_rec_id_fld  
INTO :li_add_rec_fld  
FROM conv_view  
WHERE conv_view.view_id = :il_view_id   ;
*/
//---------------------------- APPEON END ----------------------------

IF li_add_rec_fld  = 1 THEN
	ls_sql = ls_sql + "~t, rec_id = 100000000~n"
END IF

//build from clause
ls_sql = ls_sql + " FROM " + "~n"

/* comment 06/26/2007 by: Andy
li_rc = tab_1.tabpage_tables.dw_view_tables.RowCount()

FOR i = 1 TO li_rc
	ls_sql = ls_sql + "~t" + "" + tab_1.tabpage_tables.dw_view_tables.GetItemString( i, "table_name" ) + ", "  + "~n"
END FOR

if ii_facil_security = 1 then
	ls_sql = ls_sql + "~t" + "security_user_facilities" + ", " + "~n"
end if

IF ii_dept_security_on = 1 then
	ls_sql = ls_sql + "~t" + "security_user_department" + " " + "~n"		
END IF

ls_sql = Left( ls_sql, Len( ls_sql ) - 3 ) + "~n"

//build where clause for joins
li_rc = tab_1.tabpage_tables.dw_view_links.RowCount()

IF li_rc > 0 THEN
	ls_sql = ls_sql + "WHERE " + "~n"	
	FOR i = 1 TO li_rc
		lb_multi_table = True
		ls_sql = ls_sql + "~t" + "(" + tab_1.tabpage_tables.dw_view_links.GetItemString( i, "from_table_field" ) 
		ls_sql = ls_sql + " " + tab_1.tabpage_tables.dw_view_links.GetItemString( i, "link_type" ) + " "
		ls_sql = ls_sql + tab_1.tabpage_tables.dw_view_links.GetItemString( i, "to_table_field" ) 	+ ") AND ~n"
	END FOR

	ls_sql = Left( ls_sql, Len( ls_sql ) - 5 ) 
END IF
*/

//<add> 06/26/2007 by: Andy
 //Start Code Change ----07.09.2015 #V15 maha - added check
ls_from = of_getfrom()
if ls_from = "Cancel" then
	return ""
else
	ls_sql = ls_sql + ls_from
end if
//ls_sql = ls_sql + of_getfrom()
 //End Code Change ----07.09.2015 
//end of add

//build where filter
li_rc = tab_1.tabpage_filter.dw_view_where.RowCount()
IF li_rc > 0 THEN
	IF lb_multi_table = True THEN
		ls_sql = ls_sql + " AND ~n"
	ELSE
		ls_sql = ls_sql + " WHERE " + "~n"	
	END IF
	FOR i = 1 TO li_rc
		ls_tname = tab_1.tabpage_filter.dw_view_where.GetItemString( i, "table_field_name" )
		
		if PosA(ls_tname,"v_",1) > PosA(ls_tname,".",1) then //would designate a computed field //maha 020304
			//--------------------------- APPEON BEGIN ---------------------------
			//$<modify> 2006-08-28 By: Liu HongXin
			//$<reason> It is unsupported in Sql Server, when computed column in where sub_clause.
			/*
			ls_sql = ls_sql + "~t" + "(" + mid(ls_tname,1,pos(ls_tname,".",1) - 1) //get computed field name
			*/
			if gs_dbtype = "ASA" then
				ls_sql = ls_sql + "~t" + "(" + MidA(ls_tname,1,PosA(ls_tname,".",1) - 1) //get computed field name
			else
				ls_sql = ls_sql + "~t" + "(" + MidA(ls_tname,PosA(ls_tname,".",1) + 1)
			end if
			//---------------------------- APPEON END ----------------------------
			
		else //all other fields
			ls_sql = ls_sql + "~t" + "(" + ls_tname 
		end if
		ls_sql = ls_sql + " " + tab_1.tabpage_filter.dw_view_where.GetItemString( i, "operator" ) + " "
		
		//------------------- APPEON BEGIN -------------------
		//<$>added:long.zhang 02.14.2016
		//<$>reason:Moved following scripts to a new funciton of_revise_filter (Bug id 4989 - Quotation Mark causing error in Intellireport)

//		//--------Begin Added by Nova 01.23.2009------------------------
//		//$Reason:If there is information with an apostrophe, intellireport creates an error
//		ls_filter_value = Trim(tab_1.tabpage_filter.dw_view_where.GetItemString( i, "value" ))
//		//------------------- APPEON BEGIN -------------------
//		//$<delete> Michael 11.02.2011
//		//$<reason> Ticket # 00032597: Syntax error in Intellireport
//		/*
//		//------------------- APPEON BEGIN -------------------
//		//$<add> Stephen 09.02.2011
//		//$<reason> Bug 2599 IntelliReport
//		if left(ls_filter_value,1) = "'" and right(ls_filter_value,1) = "'"then
//			ls_filter_value = mid(ls_filter_value,2, len(ls_filter_value) - 2)
//			ls_filter_value = "'" + of_reviseexpvalue(ls_filter_value,"'")+ "'" 
//		else
//			ls_filter_value = of_reviseexpvalue(ls_filter_value,"'")
//		end if		
//		//------------------- APPEON END -------------------
//		*/
//		//------------------- APPEON END ---------------------
//		ll_filter_len = LenA(ls_filter_value)
//		IF LeftA(ls_filter_value,1) = "'" And RightA(ls_filter_value,1) = "'"  And LenA(ls_filter_value) > 2 THEN
//			ll_double_pos = PosA(ls_filter_value,"''",2)
//			ll_sigle_pos = PosA(ls_filter_value,"'",2)
//			//check if have ',' or ' and '
//			//--------Begin Modified by  Nova 07.14.2009------------------------
//			////fix bug about adds double qoutes to in-between filter
//			//ll_dot = Pos(ls_filter_value,",",2)
//			IF	tab_1.tabpage_filter.dw_view_where.GetItemString( i, "operator" ) = "Between" THEN
//				ll_dot = PosA(lower(ls_filter_value)," and ",2)
//			ELSE
//				ll_dot = PosA(ls_filter_value,",",2)
//			END IF
//			//--------End Modified --------------------------------------------
//			//added by nova.zhang on 03.30.2009
//			//$Reason:choosing more than one practitioner, the program sees the comma as a text delimiter and adds another apostrophe
//			IF ll_dot > 0 And ll_sigle_pos > ll_dot THEN
//				ll_befor = LenA(MidA(ls_filter_value,1,ll_dot -1)) -LenA(Trim(MidA(ls_filter_value,1,ll_dot -1)))
//				ll_after = LenA(MidA(ls_filter_value,ll_dot +1)) -LenA(Trim(MidA(ls_filter_value,ll_dot +1)))
//			ELSE
//				ll_befor = LenA(MidA(ls_filter_value,1,ll_sigle_pos -1)) -LenA(Trim(MidA(ls_filter_value,1,ll_sigle_pos -1)))
//				ll_after = LenA(MidA(ls_filter_value,ll_sigle_pos +1)) -LenA(Trim(MidA(ls_filter_value,ll_sigle_pos +1)))
//			END IF
//			//commented by nova.zhang on 03302009
////						DO UNTIL ll_sigle_pos = 0 Or ll_sigle_pos = ll_filter_len
////							IF ll_double_pos = 0  Or(ll_double_pos <> ll_sigle_pos) THEN
////								ls_filter_value = Replace(ls_filter_value, ll_sigle_pos, 1, "''")
////								ll_filter_len++
////							END IF
////							ll_sigle_pos = Pos(ls_filter_value,"'",ll_sigle_pos +2 )
////							IF ll_double_pos = ll_sigle_pos THEN
////								ll_double_pos = Pos(ls_filter_value,"''",ll_double_pos +2)
////							ELSE
////								ll_double_pos = Pos(ls_filter_value,"''",ll_sigle_pos)
////							END IF
////						LOOP
//			//commented by nova.zhang on 03302009
//			DO UNTIL ll_sigle_pos = 0 Or ll_sigle_pos = ll_filter_len
//				IF ll_double_pos = 0  Or(ll_double_pos <> ll_sigle_pos) THEN
//				//added by nova.zhang on 03.30.2009
//					IF (ll_dot=0 and ((ll_befor=0) and (ll_after=0))) or(ll_dot>0 and ((ll_befor=0) and (ll_after=0)) and(ll_dot -ll_sigle_pos>1)  )  THEN
//						ls_filter_value = ReplaceA(ls_filter_value, ll_sigle_pos, 1, "''")
//						ll_filter_len++
//						//added by nova.zhang on 03.30.2009
//						IF ll_dot > 0 THEN ll_dot++
//					END IF
//				END IF
//				IF ll_dot = 0    THEN// if not have ','
//					ll_befor = 0
//					ll_after = 0
//					ll_sigle_pos = PosA(ls_filter_value,"'",ll_sigle_pos +2 )
//					IF ll_double_pos = ll_sigle_pos THEN
//						ll_double_pos = PosA(ls_filter_value,"''",ll_double_pos +2)
//					ELSE
//						ll_double_pos = PosA(ls_filter_value,"''",ll_sigle_pos)
//					END IF
//				ELSEIF ll_dot > 0 THEN//// if  have ','
//					ll_sigle_pos = PosA(ls_filter_value,"'",ll_dot+1)
//					ll_sigle_pos = PosA(ls_filter_value,"'",ll_sigle_pos+1)
//					//--------Begin Modified by  Nova 07.14.2009------------------------
//					//fix bug about adds double qoutes to in-between filter
//					//	ll_dot = Pos(ls_filter_value,",",ll_dot +1)
//					IF	tab_1.tabpage_filter.dw_view_where.GetItemString( i, "operator" ) = "Between" THEN
//						ll_dot = PosA(lower(ls_filter_value)," and ",ll_dot +1)
//					Else
//						ll_dot = PosA(ls_filter_value,",",ll_dot +1)
//					END IF
//					//--------End Modified --------------------------------------------
//					IF ll_dot > 0 And ll_sigle_pos > ll_dot THEN
//						ll_befor = LenA(MidA(ls_filter_value,1,ll_dot -1)) -LenA(Trim(MidA(ls_filter_value,1,ll_dot -1)))
//						ll_after = LenA(MidA(ls_filter_value,ll_dot +1)) -LenA(Trim(MidA(ls_filter_value,ll_dot +1)))
//					ELSE
//						ll_befor = LenA(MidA(ls_filter_value,1,ll_sigle_pos -1)) -LenA(Trim(MidA(ls_filter_value,1,ll_sigle_pos -1)))
//						ll_after = LenA(MidA(ls_filter_value,ll_sigle_pos +1)) -LenA(Trim(MidA(ls_filter_value,ll_sigle_pos +1)))
//					END IF
//					IF ll_double_pos = ll_sigle_pos THEN
//						ll_double_pos = PosA(ls_filter_value,"''",ll_double_pos +2)
//					ELSE
//						ll_double_pos = PosA(ls_filter_value,"''",ll_sigle_pos)
//					END IF
//				END IF
//			LOOP
//		END IF
		ls_filter_value = tab_1.tabpage_filter.dw_view_where.GetItemString( i, "value" )
		This.of_revise_filter(tab_1.tabpage_filter.dw_view_where.GetItemString( i, "operator" ), ls_filter_value)		
		//------------------- APPEON END -------------------		

		 //$<comment> 01232009 by nova.zhang
		 //$Reason: fixed a bug Robert
		 //		IF tab_1.tabpage_filter.dw_view_where.GetItemString( i, "operator" ) = "In" THEN
		 //			ls_sql = ls_sql + "(" + tab_1.tabpage_filter.dw_view_where.GetItemString( i, "value" ) + ")"
		 //		else
		 //			ls_sql = ls_sql + tab_1.tabpage_filter.dw_view_where.GetItemString( i, "value" )
		 //		END IF	
		 //comment 01232009 by nova.zhang
		IF tab_1.tabpage_filter.dw_view_where.GetItemString( i, "operator" ) = "In" THEN
			ls_sql = ls_sql + "(" + ls_filter_value + ")"
		ELSE
			ls_sql = ls_sql + ls_filter_value
		END IF
		//--------End Added --------------------------------------------
		 
			//li_remove_len = 6

		
		//$<add> 05.19.2008 by Andy
		ls_lookup_type = tab_1.tabpage_filter.dw_view_where.GetItemString(i,"lookup_type")
		ls_field_type  = tab_1.tabpage_filter.dw_view_where.GetItemString(i,"field_type")
		if (Upper(ls_lookup_type) = 'C' or Upper(ls_lookup_type) = 'A') and ls_field_type = 'C' then
			//---------Begin Modified by (Appeon)Toney 06.13.2013 for V141 ISG-CLX--------			
			  /*
				ls_sql = ls_sql + " OR " + ls_tname + " " + tab_1.tabpage_filter.dw_view_where.GetItemString( i, "operator" ) + " "	
			  */
			If  tab_1.tabpage_filter.dw_view_where.GetItemString( i, "operator" ) = '<>' Then //Added By Ken.Guo 06/19/2012
				ls_sql = ls_sql + " AND " + ls_tname + " " + tab_1.tabpage_filter.dw_view_where.GetItemString( i, "operator" ) + " "
			Else
				ls_sql = ls_sql + " OR " + ls_tname + " " + tab_1.tabpage_filter.dw_view_where.GetItemString( i, "operator" ) + " "
			End If
			 
			//---------End Modfiied ------------------------------------------------------------------	
			
			//------------------- APPEON BEGIN -------------------
			//<$>added:long.zhang 02.14.2016
			//<$>reason: Bug id 4989 - Quotation Mark causing error in Intellireport
			ls_filter_value_display = tab_1.tabpage_filter.dw_view_where.GetItemString( i, "value_display" )
			This.of_revise_filter(tab_1.tabpage_filter.dw_view_where.GetItemString( i, "operator" ), ls_filter_value_display)
			
//			IF tab_1.tabpage_filter.dw_view_where.GetItemString( i, "operator" ) = "In" THEN
//				ls_sql = ls_sql + "(" + tab_1.tabpage_filter.dw_view_where.GetItemString( i, "value_display" ) + ")"
//			else
//				ls_sql = ls_sql + tab_1.tabpage_filter.dw_view_where.GetItemString( i, "value_display" )
//			END IF	
			IF tab_1.tabpage_filter.dw_view_where.GetItemString( i, "operator" ) = "In" THEN
				ls_sql = ls_sql + "(" + ls_filter_value_display + ")"
			else
				ls_sql = ls_sql + ls_filter_value_display
			END IF	
			//------------------- APPEON END -------------------
			
		end if
		//End add 05.19.2008
		
		ls_sql = ls_sql +  ") AND ~n"	
	END FOR
	ls_sql = LeftA( ls_sql, LenA( ls_sql ) - 5 ) + "~n"	
END IF

//bring in wizard SQL
IF LenA( is_sql_where ) > 0 THEN 
	ls_sql = ls_sql + is_sql_where
END IF

//build order by clause
li_rc = tab_1.tabpage_sort.dw_view_sort.RowCount()
IF li_rc > 0 THEN
	
	IF RightA( ls_sql, 5 ) = " AND " THEN
		ls_sql = MidA( ls_sql, 1, LenA( ls_sql ) -5 )
	END IF
	
	//ls_sql = ls_sql + "ORDER BY " + "~n"//Commented by (Appeon)Toney 12.03.2013 - V141 ISG-CLX,Fix history BugT111202
	string ls_sortstr=""//(Appeon)Toney 12.03.2013 - V141 ISG-CLX,Fix history BugT111202
	FOR i = 1 TO li_rc	
		//is_sort_synt maha modified 012704 to put sort fields into variable to be used after end of group by
//		ls_sql = ls_sql + "~t" + tab_1.tabpage_sort.dw_view_sort.GetItemString( i, "table_name" ) + "."
		//$<Modify> 02.21.2008 by Andy 
		//Reason:If select the same field from different table,then the error is happened.
		//       (fixed bug:BugG022101)
		//ls_sql = ls_sql + tab_1.tabpage_sort.dw_view_sort.GetItemString( i, "field_name" ) + " "
		
		//------------------- APPEON BEGIN -------------------
		//$<add> Stephen 06.27.2012
		//$<reason> V12.2 SQL Server 2008 Support
		//---------Begin Modified by (Appeon)Toney 12.03.2013 for V141 ISG-CLX--------
		//$Reason:Fix history BugT111202,sort field(s) string can't contain invisible field.
		  /*
		if tab_1.tabpage_tables.cbx_distinct.checked then 
			ls_sort_field = tab_1.tabpage_sort.dw_view_sort.GetItemString( i, "field_name" )
			ll_Find = tab_1.tabpage_columns.dw_view_fields.find("field_name='"+ls_sort_field+"'",1, tab_1.tabpage_columns.dw_view_fields.rowcount() )
			if ll_Find > 0 then
				is_sort_synt = is_sort_synt + tab_1.tabpage_columns.dw_view_fields.GetItemString(ll_Find, "field_alias" ) + " "
				ls_sql = ls_sql + tab_1.tabpage_columns.dw_view_fields.GetItemString(ll_Find, "field_alias" ) + " "
			end if				
		  */
		ls_sort_field = tab_1.tabpage_sort.dw_view_sort.GetItemString( i, "field_name" )
		ll_Find = tab_1.tabpage_columns.dw_view_fields.find("field_name='"+ls_sort_field+"'",1, tab_1.tabpage_columns.dw_view_fields.rowcount() )
		IF ll_Find <= 0 THEN Continue
		IF Not ib_show_all_fields_in_select THEN
			IF tab_1.tabpage_columns.dw_view_fields.GetItemNumber(ll_Find,"field_visible") = 0 THEN Continue
		END IF
		if tab_1.tabpage_tables.cbx_distinct.checked then 			
			is_sort_synt = is_sort_synt + tab_1.tabpage_columns.dw_view_fields.GetItemString(ll_Find, "field_alias" ) + " "
			ls_sortstr = ls_sortstr + tab_1.tabpage_columns.dw_view_fields.GetItemString(ll_Find, "field_alias" ) + " "			
		//---------End Modfiied ------------------------------------------------------------------
		else
		//------------------- APPEON END -------------------
			//(Appeon)Toney 12.03.2013 - V141 ISG-CLX,Fix history BugT111202
			//ls_sql = ls_sql + tab_1.tabpage_sort.dw_view_sort.GetItemString( i, "table_name" ) + "." + tab_1.tabpage_sort.dw_view_sort.GetItemString( i, "field_name" ) + " "
			ls_sortstr = ls_sortstr + tab_1.tabpage_sort.dw_view_sort.GetItemString( i, "table_name" ) + "." + tab_1.tabpage_sort.dw_view_sort.GetItemString( i, "field_name" ) + " "
			//end of modify 02.21.2008
			is_sort_synt = is_sort_synt + tab_1.tabpage_sort.dw_view_sort.GetItemString( i, "field_name" ) + " " //which is really the field alias maha 012704
			//ls_sql = ls_sql + tab_1.tabpage_sort.dw_view_sort.GetItemString( i, "field_alias" ) + " "
		end if
		
		ls_dir = tab_1.tabpage_sort.dw_view_sort.GetItemString( i, "sort_dir" )
		if ls_dir = "D" then
			ls_sort = "DESC"
		else
			ls_dir = "A"
			ls_sort = "ASC"
		end if
		ls_sortstr = ls_sortstr + ls_sort + ","//ls_sql = ls_sql + ls_sort + ","//(Appeon)Toney 12.03.2013 - V141 ISG-CLX,Fix history BugT111202
		is_sort_synt = is_sort_synt + ls_dir + ","
	END FOR
	IF LenA(ls_sortstr) > 0 THEN ls_sql = ls_sql +" Order By " +  LeftA(ls_sortstr, LenA( ls_sortstr ) - 1 )+"~n"//ls_sql = LeftA(ls_sql, LenA( ls_sql ) - 1 ) + "~n"	//get rid of extra comma//(Appeon)Toney 12.03.2013 - V141 ISG-CLX,Fix history BugT111202
	is_sort_synt = LeftA( is_sort_synt, LenA( is_sort_synt ) - 1 ) + "~n"	//get rid of extra comma
	//ls_sql = ls_sql + is_sort_synt
	
END IF
IF RightA( is_sql_where, 5 ) = " AND " THEN
	ls_sql = MidA( ls_sql, 1, LenA( ls_sql ) -5 )
END IF

tab_1.tabpage_run.st_sql.Text = ls_sql

tab_1.tabpage_filter.dw_view_where.retrieve( il_view_id)  //Start Code Change ----06.06.2017 #V154 maha - reretrieve filters that may have been discarded for outer joins
//ClipBoard( ls_sql )
//--------------------------- APPEON BEGIN ---------------------------
//$<comment> 10.11.2006 By: LeiWei
//$<reason> Fix a defect.
//tab_1.tabpage_run.st_sql.Visible = True
//---------------------------- APPEON END ----------------------------

Return ls_sql



end function

public subroutine of_modify_dw (datawindow adw_preview);String	ls_dw_Syntax,ls_ObjSyntax,ls_error
String	ls_Objects,ls_ObjName,ls_Syntax
String	ls_type,ls_text,ls_border,ls_OldBand,ls_NewBand
String	ls_x,ls_y,ls_width,ls_height
String	ls_uls,ls_italic,ls_bold,ls_align
String	ls_express,ls_format
String	ls_bgcolor,ls_color,ls_bgmode
String	ls_Modify, ls_new_id, ls_old_id
String	ls_visible,ls_Edit_Style,ls_Mask
String	ls_filter,ls_sort
String 	ls_VScrollBar
String	ls_SlideUp,ls_AutoHeight
String ls_title2_text	//added by long.zhang 06.30.2011
String ls_fontheight //Added by Appeon long.zhang 06.09.2017
datastore	lds_bitmap
long ll_i

DateTime		ldt_Modifydate
Long			ll_SepPos,ll_Pos,ll_RowStart,ll_RowEnd

Constant String ENTERCHAR = "~r~n"

DataStore 	lds_dw


Select Modify_date Into :ldt_Modifydate From ctx_report_syntax Where view_id = :il_view_id;
If ldt_Modifydate <= idt_priordate Then
	of_RefreshDisplaySyntax()
	Return
End If

ls_dw_Syntax = of_GetSyntax(il_view_id)
If IsNull(ls_dw_Syntax) Or Trim(ls_dw_Syntax) = '' Then
	is_Origin_Syntax = adw_Preview.Describe("Datawindow.Syntax")
	of_RefreshDisplaySyntax()
	Return
End If

lds_dw = Create DataStore
lds_dw.Create(ls_dw_Syntax,ls_error)

If ls_error <> '' Then
	//---------Begin Modified by (Appeon)Stephen 05.05.2014 for V142 Schedule IntelliReport--------
	//MessageBox('Create DataStore failed!',ls_error)
	inv_message.of_messagebox("Create DataStore failed!", ls_error , true)
	is_run_error = "Create DataStore failed: "+ ls_error
	ib_run_sucess = false
	//---------End Modfiied ------------------------------------------------------
	Return
End If

//Download bitmap -- jervis 11.24.2009
string ls_path
string ls_filename
blob	lb_file
long ll_pic_id
//Parse path
ls_path = gs_dir_path + gs_DefDirName +"\bitmap\"
gnv_appeondll.of_parsepath(ls_path)

lds_bitmap = create datastore
lds_bitmap.Dataobject = 'd_conv_view_pic'
lds_bitmap.SetTransobject( sqlca)
lds_bitmap.Retrieve(il_view_id,0 )

for ll_i = 1 to lds_bitmap.Rowcount( )
	ls_filename = lds_bitmap.GetItemString( ll_i,"pic_filename")
	ll_pic_id = lds_bitmap.GetItemNumber( ll_i,"pic_id")
	//---------Begin Modified by (Appeon)Toney 06.13.2013 for V141 ISG-CLX--------		
	  /*
	  	ls_filename = ls_path + ls_filename
		if not fileexists(ls_filename) then
			selectblob pic_bitmap into :lb_file from conv_view_pic where pic_id = :ll_pic_id;
			AppeonWriteFile(ls_filename, lb_file,LenA(lb_file))		
		end if
	  */	
	  string ls_picname
	  long  ll_datalen,ll_readcnts,ll_readcycle,ll_start
	  blob  lb_temp
	  ls_picname = lds_bitmap.GetItemString( ll_i,"pic_name")
	  if ls_filename = "!" then continue 
	  ls_filename = ls_path + ls_filename
	  if not fileexists(ls_filename) then
			select datalength(pic_bitmap) into :ll_datalen from conv_view_pic where pic_id = :ll_pic_id;
			if AppeonGetClientType() = 'PB' and gs_dbtype = 'SQL' and ll_datalen > 8000 then
				ll_ReadCnts = Ceiling(ll_datalen/8000)
				
				for ll_ReadCycle = 1 To ll_ReadCnts
					ll_Start = (ll_ReadCycle - 1) * 8000 + 1
					SELECTBLOB SubString(pic_bitmap,:ll_Start,8000) INTO :lb_Temp	from conv_view_pic where pic_id = :ll_pic_id;
					lb_file += lb_Temp
				next
			else
				selectblob pic_bitmap into :lb_file from conv_view_pic where pic_id = :ll_pic_id;
			end if
			AppeonWriteFile(ls_filename, lb_file,len(lb_file))
	end if
	//reset path of picture object -- 12.09.2010
	adw_Preview.Modify(ls_picname + ".filename='" + ls_filename + "'")
	//---------End Modfiied ------------------------------------------------------------------	
next
destroy lds_bitmap



adw_Preview.SetRedraw(False)

ls_Objects = lds_dw.Describe("DataWindow.Objects") + "~t"
ll_SepPos = PosA(ls_Objects,"~t")

Do While ll_SepPos > 0
	ls_ObjName = LeftA(ls_Objects,ll_SepPos - 1)
	ls_Objects = MidA(ls_Objects,ll_SepPos + 1)
	ll_SepPos  = PosA(ls_Objects,"~t")
	
	If adw_Preview.Describe(ls_ObjName + ".Name") <> ls_ObjName Then
		//Ignore removed column - jervis 08.28.2009
		If lds_dw.Describe( ls_ObjName + ".type") = 'column' Then
			Continue
		ElseIf lds_dw.Describe( ls_ObjName + ".type") = 'text' Then
			If lds_dw.Describe( LeftA(ls_ObjName,LenA(ls_ObjName) - 2) + ".type") = 'column' Then Continue
		End If
		
		//Igonre all object when name <> object - jervis 03.09.2010
		if LeftA(ls_ObjName,6) <> 'object' then continue
		
		//ls_Syntax = MidA(ls_dw_Syntax,LastPos(LeftA(ls_dw_Syntax,PosA(ls_dw_Syntax,"band=")),ENTERCHAR) + LenA(ENTERCHAR))		
		ls_Syntax = ENTERCHAR + MidA(ls_dw_Syntax,LastPos(LeftA(ls_dw_Syntax,PosA(ls_dw_Syntax,"band=")),ENTERCHAR) + LenA(ENTERCHAR))//add ~r~n at the begining, by Appeon long.zhang 05.17.2016 (Bug id 5146 - Some Computed fields not saving in PDF document)
		ll_Pos = PosA(ls_Syntax,"name=" + Lower(ls_ObjName) + " ")
		If ll_Pos > 0 Then
			ll_RowStart = LastPos(LeftA(ls_Syntax,ll_Pos),ENTERCHAR) + LenA(ENTERCHAR)
			ll_RowEnd   = PosA(ls_Syntax,ENTERCHAR,ll_RowStart)
			ls_Modify   = 'Create ' + MidA(ls_Syntax,ll_RowStart,ll_RowEnd - ll_RowStart)
			adw_Preview.Modify(ls_Modify)
		End If
	Else
		//BEGIN---Modify by Scofield on 2009-12-30
		ls_OldBand = adw_Preview.Describe(ls_ObjName + ".Band")
		ls_NewBand = lds_dw.Describe(ls_ObjName+".Band")
		if ls_NewBand <> ls_OldBand then
			ls_new_id = adw_Preview.Describe(ls_ObjName + ".id")
			ls_old_id = lds_dw.Describe(ls_ObjName + ".id")
			adw_Preview.Modify("destroy " + ls_ObjName)
			ls_ObjSyntax = gf_GetDWOSyntax(lds_dw.Describe("DataWindow.Syntax"),ls_ObjName)
			if ls_new_id <> ls_old_id then
				ll_Pos = Pos(ls_ObjSyntax, "id=")
				ls_ObjSyntax = Replace(ls_ObjSyntax, ll_Pos, len(ls_old_id) + 3, "id=" + ls_new_id)
			end if
			adw_Preview.Modify("create " + ls_ObjSyntax)
		else
		//END---Modify by Scofield on 2009-12-30
			ls_type    = Lower(lds_dw.Describe(ls_ObjName+".type"))
			ls_text    = lds_dw.Describe(ls_ObjName+".text")
			ls_border  = String(lds_dw.Describe(ls_ObjName+".border"))
			ls_x       = String(lds_dw.Describe(ls_ObjName+".x"))
			ls_y       = String(lds_dw.Describe(ls_ObjName+".y"))
			ls_width   = String(lds_dw.Describe(ls_ObjName+".width"))
			ls_height  = String(lds_dw.Describe(ls_ObjName+".height"))
			ls_uls     = String(lds_dw.Describe(ls_ObjName+".font.underline"))
			ls_italic  = String(lds_dw.Describe(ls_ObjName+".font.italic"))
			ls_bold    = String(lds_dw.Describe(ls_ObjName+".font.weight"))
			
			//Special logic for default title texts, Added by Appeon long.zhang 06.09.2017 (Bug id 5680 - IntelliReport Advanced Screen Design Font Size of Report Header   SaaS Build Date 05272017 and Client Server 15.310 Build date 05252017)
			If ls_ObjName = 'title1_t' or ls_ObjName = 'title2_t'  Then
				ls_fontheight    = String(lds_dw.Describe(ls_ObjName+".font.height")) 
			End If
			
			ls_align   = String(lds_dw.Describe(ls_ObjName+".Alignment"))
			ls_bgmode  = String(lds_dw.Describe(ls_ObjName+".Background.Mode"))
			ls_bgcolor = Trim(String(lds_dw.Describe(ls_ObjName+".Background.Color")))
			If LeftA(ls_bgcolor,1) = '"' And RightA(ls_bgcolor,1) = '"' Then ls_bgcolor = MidA(ls_bgcolor,2,LenA(ls_bgcolor) - 2)
			ls_color   = String(lds_dw.Describe(ls_ObjName+".Color"))
			ls_express = lds_dw.Describe(ls_ObjName+".expression")			
			ls_format  = lds_dw.Describe(ls_ObjName+".format")
			ls_visible = lds_dw.Describe(ls_ObjName+".visible")
			
			//BEGIN---Modify by Scofield on 2010-02-02
			ls_SlideUp    = lds_dw.Describe(ls_ObjName+".SlideUp")
			ls_AutoHeight = lds_dw.Describe(ls_ObjName+".Height.AutoSize")
			
			ls_Modify = ls_ObjName + ".SlideUp = '" + ls_SlideUp + "'"
			adw_Preview.Modify(ls_Modify)
			
			if Lower(ls_AutoHeight) = Lower("Yes") then
				ls_Modify  = "DataWindow.Detail.Height.AutoSize='Yes' "
				ls_Modify += ls_ObjName + ".Height.AutoSize='Yes' "
				adw_Preview.Modify(ls_Modify)
			end if
			//END---Modify by Scofield on 2010-02-02
			
			//BEGIN---Modify by Scofield on 2009-08-24
			ls_Edit_Style = lds_dw.Describe(ls_ObjName+".Edit.Style")
			If ls_Edit_Style = "editmask" Then
				ls_Mask = lds_dw.Describe(ls_ObjName+".editmask.mask")
			End If
			//END---Modify by Scofield on 2009-08-24
			
			//------------------- APPEON BEGIN -------------------			
			//$<modify> Evan 12.03.2010
			//$<reason> Fixed a bug
			/*
			If adw_Preview.Describe(ls_ObjName+".width") > '0' Then
				if IsNumber(ls_visible) then
					ls_Modify = ls_ObjName+".visible='1'"
				else
					ls_Modify = ls_ObjName+".visible='" + ls_visible + "'"
				end if
				
				adw_Preview.Modify(ls_Modify)
			Else
				ls_Modify = ls_ObjName+".visible='0'"
				adw_Preview.Modify(ls_Modify)
			End If
			*/
			ls_Modify = ls_ObjName+".visible='" + ls_visible + "'"
			adw_Preview.Modify(ls_Modify)
			//------------------- APPEON END ---------------------

			ls_Modify = ls_ObjName+".text='"+ls_text+"'"
			adw_Preview.Modify(ls_Modify)
			ls_Modify = ls_ObjName+".border='"+ls_border+"'"
			adw_Preview.Modify(ls_Modify)
			ls_Modify = ls_ObjName+".x='"+ls_x+"'"
			adw_Preview.Modify(ls_Modify)
			ls_Modify = ls_ObjName+".y='"+ls_y+"'"
			adw_Preview.Modify(ls_Modify)
			ls_Modify = ls_ObjName+".width='"+ls_width+"'"
			adw_Preview.Modify(ls_Modify)
			ls_Modify = ls_ObjName+".height='"+ls_height+"'"
			adw_Preview.Modify(ls_Modify)
			ls_Modify = ls_ObjName+".font.underline='"+ls_uls+"'"
			adw_Preview.Modify(ls_Modify)
			ls_Modify = ls_ObjName+".font.italic='"+ls_italic+"'"
			adw_Preview.Modify(ls_Modify)
			ls_Modify = ls_ObjName+".font.weight='"+ls_bold+"'"
			adw_Preview.Modify(ls_Modify)
			
			//Special logic for default title texts, Added by Appeon long.zhang 06.09.2017 (Bug id 5680 - IntelliReport Advanced Screen Design Font Size of Report Header   SaaS Build Date 05272017 and Client Server 15.310 Build date 05252017)
			If ls_ObjName = 'title1_t' or ls_ObjName = 'title2_t'  Then
				ls_Modify = ls_ObjName+".font.height='"+ls_fontheight+"'"
				adw_Preview.Modify(ls_Modify)
			End If
			
			ls_Modify = ls_ObjName+".Alignment='"+ls_align+"'"
			adw_Preview.Modify(ls_Modify)
			ls_Modify = ls_ObjName+".Background.Mode='"+ls_bgmode+"'"
			adw_Preview.Modify(ls_Modify)
			ls_Modify = ls_ObjName+".Background.Color='"+ls_bgcolor+"'"
			adw_Preview.Modify(ls_Modify)
			ls_Modify = ls_ObjName+".Color='"+ls_color+"'"
			adw_Preview.Modify(ls_Modify)
			//---------Begin Added by (Appeon)Stephen 07.02.2014 for Bug 4098 Phone mask for reporting--------
			if ls_format = "(###)###-####" or ls_format = "###-##-####" or ls_format = "#####-####" or ls_format = "####" then
				ls_Edit_Style = "editmask"
				ls_Mask = ls_format
			end if					
			//---------End Added ------------------------------------------------------
			ls_Modify = ls_ObjName+".Format='"+ls_format+"'"
			adw_Preview.Modify(ls_Modify)
			
			//BEGIN---Modify by Scofield on 2009-08-24
			If ls_Edit_Style = "editmask" Then
				ls_Modify = ls_ObjName+".editmask.mask='"+ls_Mask+"'"
				adw_Preview.Modify(ls_Modify)
			elseif ls_Edit_Style = "edit" Then //jervis 05.27.2010
				ls_Modify = ls_ObjName+".edit.Format='"+ls_format+"'"
				adw_Preview.Modify(ls_Modify)
			End If
			//END---Modify by Scofield on 2009-08-24
			
			//Fields vert scroll bar By Jervis 11-18-2009
			If ls_Edit_Style = "edit" Or ls_Edit_Style = "dddw" Or ls_Edit_Style = "ddlb" Then
				ls_VScrollBar = lds_dw.Describe(ls_ObjName + "." + ls_Edit_Style + ".VScrollBar")
				if Lower(ls_VScrollBar) = "yes" then
					ls_Modify = ls_ObjName + "." + ls_Edit_Style + ".VScrollBar=" + ls_VScrollBar + " " + &
									ls_ObjName + "." + ls_Edit_Style + ".AutoHScroll=No"
				else
					ls_Modify = ls_ObjName + "." + ls_Edit_Style + ".VScrollBar=" + ls_VScrollBar + " " +&
									ls_ObjName + "." + ls_Edit_Style + ".AutoHScroll=Yes"
				end if
				adw_Preview.Modify(ls_Modify)
			End If
		end if
	End If
Loop
//Refresh preview
ls_Modify = 'Create text(band=header text="text" border="5"  '&
	+'x="10" y="10" height="20" width="100" '&
	+' name=obj_temp  font.face="Segoe UI" font.height="-8"  )'
adw_Preview.Modify(ls_Modify)
adw_Preview.Modify("destroy obj_temp")
//-------------------Appeon Begin-------------------
//$<add>  long.zhang 06.30.2011
//$<reason> Fixed bug 2494
	ls_title2_text = adw_preview.Describe("title2_t.text")
	IF PosA(ls_title2_text,"Date") > 0 THEN
		IF IsDate(MidA(ls_title2_text,6)) THEN
			adw_preview.Modify("title2_t.text='Date: " + String( Today() ) + "'")
		END IF
	END IF
//-----------------Appeon End-----------------------
adw_Preview.Modify("datawindow.header.height='"+lds_dw.Describe("datawindow.header.height")+"'")
adw_Preview.Modify("datawindow.header.1.height='"+lds_dw.Describe("datawindow.header.1.height")+"'")
adw_Preview.Modify("datawindow.header.2.height='"+lds_dw.Describe("datawindow.header.2.height")+"'")
adw_Preview.Modify("datawindow.header.3.height='"+lds_dw.Describe("datawindow.header.3.height")+"'")
adw_Preview.Modify("datawindow.detail.height='"+lds_dw.Describe("datawindow.detail.height")+"'")
adw_Preview.Modify("datawindow.trailer.1.height='"+lds_dw.Describe("datawindow.trailer.1.height")+"'")
adw_Preview.Modify("datawindow.trailer.2.height='"+lds_dw.Describe("datawindow.trailer.2.height")+"'")
adw_Preview.Modify("datawindow.trailer.3.height='"+lds_dw.Describe("datawindow.trailer.3.height")+"'")
adw_Preview.Modify("datawindow.summary.height='"+lds_dw.Describe("datawindow.summary.height")+"'")
adw_Preview.Modify("datawindow.footer.height='"+lds_dw.Describe("datawindow.footer.height")+"'")

ls_sort = lds_dw.Describe("DataWindow.Table.Sort")
adw_Preview.Modify("DataWindow.Table.Sort='"+ls_sort+"'")
If adw_Preview = tab_1.tabpage_run.dw_run Then adw_Preview.Sort()

ls_filter = lds_dw.Describe("DataWindow.Table.Filter")
If ls_filter <> '?' And ls_filter <> '!' Then
	adw_Preview.Modify("DataWindow.Table.Filter='"+ls_filter+"'")
End If
If adw_Preview = tab_1.tabpage_run.dw_run Then adw_Preview.Filter()
//---------Begin Modified by (Appeon)Toney 06.13.2013 for V141 ISG-CLX--------
  /*
	adw_Preview.SetRedraw(True)
	idt_priordate = ldt_Modifydate
	
	is_Origin_Syntax = adw_Preview.Describe("Datawindow.Syntax")  
  */ 
is_Origin_Syntax = adw_Preview.Describe("Datawindow.Syntax")  
IF il_module = 1 THEN 
	n_cst_update_screen				ln_screen
	ln_screen   = create n_cst_update_screen  //added by gavins 20120618 
	//added by gavins 20120618
	ln_screen.of_arrageobject( is_Origin_Syntax,  ls_dw_Syntax )
	adw_Preview.Create ( is_Origin_Syntax )
	adw_preview.SetTransObject( SQLCA )
	adw_preview.InsertRow( 0 )
	
	If (adw_preview = tab_1.tabpage_run.dw_run And ii_current_wizard_step > ii_total_wizard_steps) Or ii_with_data = 1 Then
		adw_preview.Retrieve()
	End If
	adw_Preview.height = adw_Preview.height - 4 
	adw_Preview.height = adw_Preview.height + 4
	Destroy ln_screen
END IF
 
adw_Preview.SetRedraw(True)
idt_priordate = ldt_Modifydate
//---------End Modfiied ------------------------------------------------------------------


of_RefreshDisplaySyntax()


end subroutine

public subroutine of_refreshdisplaysyntax ();//====================================================================
// Function: of_RefreshDisplaySyntax()
//--------------------------------------------------------------------
// Description:
//--------------------------------------------------------------------
// Arguments:
//--------------------------------------------------------------------
// Returns:  (None)
//--------------------------------------------------------------------
// Author:	Evan		Date: 2010-09-10
//--------------------------------------------------------------------
//	Copyright (c) 1999-2010 IntelliSoft, All rights reserved.
//--------------------------------------------------------------------
// Modify History:
//
//====================================================================

String	ls_Syntax,ls_ColName,ls_Band,ls_Error,ls_Modify,ls_Tag,ls_Weight,ls_Italic,ls_Unline,ls_Align
String	ls_Color,ls_BKMode,ls_BKColor
long		ll_Cycle,ll_ColCnts,ll_XPos,ll_YPos,ll_Width,ll_Height,ll_Visible
string   ls_showorhide

ls_Syntax = Tab_1.tabpage_Preview.dw_Preview.Describe("DataWindow.Syntax")
Tab_1.tabpage_Preview.dw_Display.Create(ls_Syntax,ls_Error)

Tab_1.tabpage_Preview.dw_Preview.ShareDataOff()
Tab_1.tabpage_Preview.dw_Preview.ShareData(Tab_1.tabpage_Preview.dw_Display)

ll_ColCnts = long(Tab_1.tabpage_Preview.dw_Display.Describe("DataWindow.Column.Count"))
for ll_Cycle = 1 to ll_ColCnts
	ls_ColName = Tab_1.tabpage_Preview.dw_Display.Describe("#" + String(ll_Cycle) + ".Name")
	Tab_1.tabpage_Preview.dw_Display.Modify(ls_ColName + ".Border = '2'")
	
	if ii_with_data = 0 then
		ll_Visible = long(Tab_1.tabpage_Preview.dw_Display.Describe(ls_ColName + ".Visible"))
		if ll_Visible = 0 then CONTINUE
		
		ls_Band    = Tab_1.tabpage_Preview.dw_Display.Describe(ls_ColName + ".Band")
		ll_XPos    = long(Tab_1.tabpage_Preview.dw_Display.Describe(ls_ColName + ".X")) + 4
		ll_YPos    = long(Tab_1.tabpage_Preview.dw_Display.Describe(ls_ColName + ".Y")) + 4
		ll_Width   = long(Tab_1.tabpage_Preview.dw_Display.Describe(ls_ColName + ".Width")) - 8
		ll_Height  = long(Tab_1.tabpage_Preview.dw_Display.Describe(ls_ColName + ".Height")) - 8
		ls_Tag     = Tab_1.tabpage_Preview.dw_Display.Describe(ls_ColName + ".Tag")
		ls_Weight  = Tab_1.tabpage_Preview.dw_Display.Describe(ls_ColName + ".Font.Weight")
		ls_Italic  = Tab_1.tabpage_Preview.dw_Display.Describe(ls_ColName + ".Font.Italic")
		ls_Unline  = Tab_1.tabpage_Preview.dw_Display.Describe(ls_ColName + ".Font.Underline")
		ls_Align   = Tab_1.tabpage_Preview.dw_Display.Describe(ls_ColName + ".Alignment")
		ls_Color   = Tab_1.tabpage_Preview.dw_Display.Describe(ls_ColName + ".Color")
		ls_BKMode  = Tab_1.tabpage_Preview.dw_Display.Describe(ls_ColName + ".Background.Mode")
		ls_BKColor = Tab_1.tabpage_Preview.dw_Display.Describe(ls_ColName + ".Background.Color")
		
		ls_Modify  = 'create text(band=' + ls_Band + ' alignment="' + ls_Align + '" text="' + ls_ColName + '" border="0" color="' + ls_Color + '"' &
						 + ' x="' + String(ll_XPos) + '" y="' + String(ll_YPos) + '" height="' + String(ll_Height) &
						 + '" width="' + String(ll_Width) + '" ' + ' name=' + ls_ColName + '_label tag="' + ls_Tag &
						 + '" font.face="Segoe UI" font.height="-8" font.weight="' + ls_Weight &
						 + '" font.family="2" font.pitch="2" font.charset="0" font.italic="' + ls_Italic &
						 + '" font.underline="' + ls_Unline + '" background.mode="' + ls_BKMode &
						 + '" background.color="' + ls_BKColor + '" )'
		
		Tab_1.tabpage_Preview.dw_Display.Modify(ls_Modify)
	else
		ls_Modify = 'Destroy ' + ls_ColName + "_label"
		Tab_1.tabpage_Preview.dw_Display.Modify(ls_Modify)
	end if
next

//------------------- APPEON BEGIN -------------------
//<$>added:long.zhang 12.08.2014
//<$>reason:V14.2 Testing/Bug# 4331 - Hide Ruler not set correct when come back to Design Tab
IF ii_with_ruler = 1 THEN
	ls_showorhide = "Yes"
ELSE
	ls_showorhide = "No"
END IF

Tab_1.tabpage_Preview.dw_Display.Modify("DataWindow.Print.Preview="+ls_showorhide)
Tab_1.tabpage_Preview.dw_Display.Modify("DataWindow.Print.Preview.Rulers="+ls_showorhide)  
//------------------- APPEON END -------------------
end subroutine

public function string of_getsyntax (long al_view_id);//
long	ll_data_length,ll_loops,ll_counter,ll_start
blob	lb_data,lb_all_data
string ls_syntax//Encoding – Nova 11.16.2010

SELECT DataLength(dw_syntax) INTO :ll_data_length
FROM ctx_report_syntax
WHERE view_id = :al_view_id;

If isnull(ll_data_length) Then ll_data_length = 0

If ll_data_length > 8000 Then 
	If Mod(ll_data_length,8000) = 0 Then
		ll_loops = ll_data_length / 8000 
	Else
		ll_loops = (ll_data_length / 8000) + 1
	End If 
ElseIf ll_data_length > 0 Then 
	ll_loops = 1 
End If 

For ll_counter = 1 To ll_loops			
	ll_start = (ll_counter - 1) * 8000 + 1
	SELECTBLOB substring(dw_syntax,:ll_start,8000) INTO :lb_data
	FROM ctx_report_syntax
	WHERE view_id = :al_view_id;
	lb_all_data += lb_data
Next

If isnull(lb_all_data) Then lb_all_data = blob('',EncodingAnsi!) //Encoding – Nova 11.16.2010
ls_syntax=string(lb_all_data,EncodingAnsi!) //Encoding – Nova 11.16.2010
return ls_syntax


end function

public subroutine of_adjust_object_width (long al_step);//====================================================================
// Function: of_Adjust_Object_Width()
//--------------------------------------------------------------------
// Description:
//--------------------------------------------------------------------
// Arguments:
// 	value    long    al_Step
//--------------------------------------------------------------------
// Returns:  (None)
//--------------------------------------------------------------------
// Author:	Evan		Date: 2010-09-10
//--------------------------------------------------------------------
//	Copyright (c) 1999-2010 IntelliSoft, All rights reserved.
//--------------------------------------------------------------------
// Modify History:
// modify by jervis 09.29.2009
//====================================================================

long	ll_width,ll_Cycle,ll_start_col,ll_x,ll_cur_x

if ii_tag = 0 then
	//---------Begin Modified by (Appeon)Stephen 05.05.2014 for V142 Schedule IntelliReport--------
	//MessageBox(gnv_app.iapp_object.DisplayName, "No object selected.")
	inv_message.of_messagebox(gnv_app.iapp_object.DisplayName, "No object selected." , true)
	is_run_error = "No object selected."
	ib_run_sucess = false
	//---------End Modfiied ------------------------------------------------------
	Return
end if

if Tab_1.tabpage_preview.st_obj_name.Text = "None" then Return

ll_width = long(Tab_1.tabpage_preview.dw_preview.Describe(is_CurObject_Name + ".width"))
ll_width = ll_width + al_Step

Tab_1.tabpage_preview.dw_preview.Modify(ls_label_name[ii_tag] + ".width='" + String(ll_width) + "'")
Tab_1.tabpage_preview.dw_preview.Modify(ls_column_name[ii_tag] + ".width='" + String(ll_width) + "'")
Tab_1.tabpage_preview.dw_preview.Modify(ls_column_name[ii_tag] + "_label.width='" + String(ll_width) + "'")

Tab_1.tabpage_preview.dw_Display.Modify(ls_label_name[ii_tag] + ".width='" + String(ll_width) + "'")
Tab_1.tabpage_preview.dw_Display.Modify(ls_column_name[ii_tag] + ".width='" + String(ll_width) + "'")
Tab_1.tabpage_preview.dw_Display.Modify(ls_column_name[ii_tag] + "_label.width='" + String(ll_width) + "'")

//ll_start_col = ii_tag + 1 
ll_cur_x = long(Tab_1.tabpage_preview.dw_preview.Describe(is_CurObject_Name + ".x"))
for ll_Cycle = 1 to ii_col_count		//jervis 09.29.2009
	ll_x = long(Tab_1.tabpage_preview.dw_preview.Describe(ls_label_name[ll_Cycle] + ".x"))
	if ll_x > ll_cur_x then	// + ll_width 
		ll_x = ll_x + al_Step
		
		Tab_1.tabpage_preview.dw_preview.Modify(ls_label_name[ll_Cycle] + ".x='" + String(ll_x) + "'")
		Tab_1.tabpage_preview.dw_preview.Modify(ls_column_name[ll_Cycle] + ".x='" + String(ll_x) + "'")
		Tab_1.tabpage_preview.dw_preview.Modify(ls_column_name[ll_Cycle] + "_label.x='" + String(ll_x) + "'")
		
		Tab_1.tabpage_preview.dw_Display.Modify(ls_label_name[ll_Cycle] + ".x='" + String(ll_x) + "'")
		Tab_1.tabpage_preview.dw_Display.Modify(ls_column_name[ll_Cycle] + ".x='" + String(ll_x) + "'")
		Tab_1.tabpage_preview.dw_Display.Modify(ls_column_name[ll_Cycle] + "_label.x='" + String(ll_x) + "'")
		
		Tab_1.tabpage_columns.dw_view_fields.SetItem(ll_Cycle,"field_x",ll_x)
	end if
Next

Tab_1.tabpage_columns.dw_view_fields.SetItem(ii_tag,"field_display_width", String(ll_width))

end subroutine

public subroutine of_move_object_position (long al_step);//====================================================================
// Function: of_Move_Object_Position()
//--------------------------------------------------------------------
// Description:
//--------------------------------------------------------------------
// Arguments:
// 	value    long    al_Step
//--------------------------------------------------------------------
// Returns:  (None)
//--------------------------------------------------------------------
// Author:	Evan		Date: 2010-09-10
//--------------------------------------------------------------------
//	Copyright (c) 1999-2010 IntelliSoft, All rights reserved.
//--------------------------------------------------------------------
// Modify History:
//
//====================================================================

long ll_x,ll_x_pos,ll_start_x,ll_Cycle

if ii_tag = 0 then
	//---------Begin Modified by (Appeon)Stephen 05.05.2014 for V142 Schedule IntelliReport--------
	//MessageBox(gnv_app.iapp_object.DisplayName, "No object selected.")
	inv_message.of_messagebox(gnv_app.iapp_object.DisplayName, "No object selected." , true)
	is_run_error = "No object selected."
	ib_run_sucess = false
	//---------End Modfiied ------------------------------------------------------
	Return
end if

if Tab_1.tabpage_preview.st_obj_name.Text = "None" then Return

ll_start_x = long(Tab_1.tabpage_preview.dw_preview.Describe(ls_label_name[ii_tag] + ".x"))
if Tab_1.tabpage_preview.cbx_move_all.Checked then
	for ll_Cycle = ii_tag TO ii_col_count
		ll_x_pos = Tab_1.tabpage_columns.dw_view_fields.GetItemNumber(ll_Cycle,"field_x")
		if ll_x_pos >= ll_start_x then
			ll_x = long(Tab_1.tabpage_preview.dw_preview.Describe(ls_label_name[ll_Cycle] + ".x"))
			ll_x = ll_x + al_Step
			Tab_1.tabpage_preview.dw_preview.Modify(ls_label_name[ll_Cycle] + ".x='" + String(ll_x) + "'")
			Tab_1.tabpage_preview.dw_preview.Modify(ls_column_name[ll_Cycle] + ".x='" + String(ll_x) + "'")
			Tab_1.tabpage_preview.dw_preview.Modify(ls_column_name[ll_Cycle] + "_label.x='" + String(ll_x) + "'")
			
			Tab_1.tabpage_preview.dw_Display.Modify(ls_label_name[ll_Cycle] + ".x='" + String(ll_x) + "'")
			Tab_1.tabpage_preview.dw_Display.Modify(ls_column_name[ll_Cycle] + ".x='" + String(ll_x) + "'")
			Tab_1.tabpage_preview.dw_Display.Modify(ls_column_name[ll_Cycle] + "_label.x='" + String(ll_x) + "'")
			
			Tab_1.tabpage_columns.dw_view_fields.SetItem(ll_Cycle, "field_x", ll_x )
		end if
	next
else
	ll_x = long(Tab_1.tabpage_preview.dw_preview.Describe(ls_label_name[ii_tag] + ".x"))
	ll_x = ll_x + al_Step
	
	Tab_1.tabpage_preview.dw_preview.Modify(ls_label_name[ii_tag] + ".x='" + String(ll_x) + "'")
	Tab_1.tabpage_preview.dw_preview.Modify(ls_column_name[ii_tag] + ".x='" + String(ll_x) + "'")
	Tab_1.tabpage_preview.dw_preview.Modify(ls_column_name[ii_tag] + "_label.x='" + String(ll_x) + "'")
	
	Tab_1.tabpage_preview.dw_Display.Modify(ls_label_name[ii_tag] + ".x='" + String(ll_x) + "'")
	Tab_1.tabpage_preview.dw_Display.Modify(ls_column_name[ii_tag] + ".x='" + String(ll_x) + "'")
	Tab_1.tabpage_preview.dw_Display.Modify(ls_column_name[ii_tag] + "_label.x='" + String(ll_x) + "'")
	
	Tab_1.tabpage_columns.dw_view_fields.SetItem(ii_tag, "field_x", ll_x )
end if

end subroutine

public subroutine of_adjust_font_style ();//====================================================================
// Function: of_Adjust_Font_Style()
//--------------------------------------------------------------------
// Description:
//--------------------------------------------------------------------
// Arguments:
//--------------------------------------------------------------------
// Returns:  (None)
//--------------------------------------------------------------------
// Author:	Evan		Date: 2010-09-10
//--------------------------------------------------------------------
//	Copyright (c) 1999-2010 IntelliSoft, All rights reserved.
//--------------------------------------------------------------------
// Modify History:
//
//====================================================================

String ls_Font_Style

if Tab_1.tabpage_preview.st_normal.BorderStyle = StyleLowered! then
	ls_Font_Style = ls_Font_Style + "N"
end if

if Tab_1.tabpage_preview.st_bold.BorderStyle = StyleLowered! then
	ls_Font_Style = ls_Font_Style + "B"
end if

if Tab_1.tabpage_preview.st_italic.BorderStyle = StyleLowered! then
	ls_Font_Style = ls_Font_Style + "I"
end if

if Tab_1.tabpage_preview.st_underline.BorderStyle = StyleLowered! then
	ls_Font_Style = ls_Font_Style + "U"
end if

if is_object_type = "text" then
	Tab_1.tabpage_columns.dw_view_fields.SetItem(ii_tag, "label_font_style", ls_Font_Style)
	tab_1.tabpage_preview.dw_preview.Modify(ls_label_name[ii_tag] + ".font.italic ='0'")
	tab_1.tabpage_preview.dw_preview.Modify(ls_label_name[ii_tag] + ".font.underline ='0'")
	
	tab_1.tabpage_preview.dw_Display.Modify(ls_label_name[ii_tag] + ".font.italic ='0'")
	tab_1.tabpage_preview.dw_Display.Modify(ls_label_name[ii_tag] + ".font.underline ='0'")
elseif is_object_type = "column" then
	Tab_1.tabpage_columns.dw_view_fields.SetItem(ii_tag, "field_font_style", ls_Font_Style)
	//--------------------appeon begin-----------------
	//<$>Modified long.zhang 11.14.2012
	//<$>reason:No _label objects in dw_preview bug 3324
	//	tab_1.tabpage_preview.dw_preview.Modify(ls_column_name[ii_tag] + "_label.font.italic ='0'")
	//	tab_1.tabpage_preview.dw_preview.Modify(ls_column_name[ii_tag] + "_label.font.underline ='0'")
	
	tab_1.tabpage_preview.dw_preview.Modify(ls_column_name[ii_tag] + ".font.italic ='0'")
	tab_1.tabpage_preview.dw_preview.Modify(ls_column_name[ii_tag] + ".font.underline ='0'")
	//------------------appeon end----------------------
	
	tab_1.tabpage_preview.dw_Display.Modify(ls_column_name[ii_tag] + "_label.font.italic ='0'")
	tab_1.tabpage_preview.dw_Display.Modify(ls_column_name[ii_tag] + "_label.font.underline ='0'")
end if

if PosA(ls_Font_Style,"B") > 0 then
	if is_object_type = "text" then
		Tab_1.tabpage_preview.dw_preview.Modify(ls_label_name[ii_tag] + ".font.weight ='700'")
		
		Tab_1.tabpage_preview.dw_Display.Modify(ls_label_name[ii_tag] + ".font.weight ='700'")
	else
		Tab_1.tabpage_preview.dw_preview.Modify(ls_column_name[ii_tag] + ".font.weight ='700'")
		Tab_1.tabpage_preview.dw_preview.Modify(ls_column_name[ii_tag] + "_label.font.weight ='700'")
		
		Tab_1.tabpage_preview.dw_Display.Modify(ls_column_name[ii_tag] + ".font.weight ='700'")
		Tab_1.tabpage_preview.dw_Display.Modify(ls_column_name[ii_tag] + "_label.font.weight ='700'")
	end if
end if

if PosA(ls_Font_Style,"I") > 0 then
	if is_object_type = "text" then
		Tab_1.tabpage_preview.dw_preview.Modify(ls_label_name[ii_tag] + ".font.italic ='1'")
		
		Tab_1.tabpage_preview.dw_Display.Modify(ls_label_name[ii_tag] + ".font.italic ='1'")
	else
		Tab_1.tabpage_preview.dw_preview.Modify(ls_column_name[ii_tag] + ".font.italic ='1'")
		Tab_1.tabpage_preview.dw_preview.Modify(ls_column_name[ii_tag] + "_label.font.italic ='1'")
		
		Tab_1.tabpage_preview.dw_Display.Modify(ls_column_name[ii_tag] + ".font.italic ='1'")
		Tab_1.tabpage_preview.dw_Display.Modify(ls_column_name[ii_tag] + "_label.font.italic ='1'")
	end if
end if

if PosA(ls_Font_Style,"U") > 0 then
	if is_object_type = "text" then
		Tab_1.tabpage_preview.dw_preview.Modify(ls_label_name[ii_tag] + ".font.underline ='1'")
		
		Tab_1.tabpage_preview.dw_Display.Modify(ls_label_name[ii_tag] + ".font.underline ='1'")
	else
		Tab_1.tabpage_preview.dw_preview.Modify(ls_column_name[ii_tag] + ".font.underline ='1'")
		Tab_1.tabpage_preview.dw_preview.Modify(ls_column_name[ii_tag] + "_label.font.underline ='1'")
		
		Tab_1.tabpage_preview.dw_Display.Modify(ls_column_name[ii_tag] + ".font.underline ='1'")
		Tab_1.tabpage_preview.dw_Display.Modify(ls_column_name[ii_tag] + "_label.font.underline ='1'")
	end if
end if

if PosA(ls_Font_Style,"N") > 0 then
	if is_object_type = "text" then
		Tab_1.tabpage_preview.dw_preview.Modify(ls_label_name[ii_tag] + ".font.weight ='400'")
		
		Tab_1.tabpage_preview.dw_Display.Modify(ls_label_name[ii_tag] + ".font.weight ='400'")
	else
		Tab_1.tabpage_preview.dw_preview.Modify(ls_column_name[ii_tag] + ".font.weight ='400'")
		Tab_1.tabpage_preview.dw_preview.Modify(ls_column_name[ii_tag] + "_label.font.weight ='400'")
		
		Tab_1.tabpage_preview.dw_Display.Modify(ls_column_name[ii_tag] + ".font.weight ='400'")
		Tab_1.tabpage_preview.dw_Display.Modify(ls_column_name[ii_tag] + "_label.font.weight ='400'")
	end if
end if

end subroutine

public subroutine of_show_selection ();//show window w_custom_report_selection
//V10.5 SK IntelliReport
//if gb_sk_ver and (il_module=2) then //Start Code Change ----11.15.2010 #V10 maha - modified to be available for all Cred App reports.
//if il_module=2 then
if il_module=2 or il_module=4 then //Bug 4300 - alfee 11.18.2014
	 if not isvalid(w_custom_report_selection) then open(w_custom_report_selection)
	w_custom_report_selection.BringToTop = TRUE
	if isvalid(w_custom_report_selection) then
		tab_1.tabpage_columns.dw_view_fields.sharedata(w_custom_report_selection.uo_1.dw_selected_field)
		If isValid( ids_Screen ) Then  w_custom_report_selection.uo_1.uf_syncscreenitems( ids_Screen )  //Added by (Appeon)Gavin 10.18.2017 for Question #5840 for IntelliReport
	end if
end if

end subroutine

public function integer of_getgroupcolumns (datawindow adw_syntax, integer ai_bandindex, ref string as_column[]);//////////////////////////////////////////////////////////////////////
// $<function> of_getgroupcolumns
// $<arguments>
//			datawindow		adw_syntax
//			integer			ai_bandindex
//			ref	string	as_column[]
// $<returns> integer
// $<description> V10.5-Advanced Report
//////////////////////////////////////////////////////////////////////
// Add by Appeon: Evan 09.21.2010
//////////////////////////////////////////////////////////////////////

string ls_Temp[]
string ls_Syntax
string ls_ColumnDefine
long ll_StartPos
long ll_EndPos
Integer i, j, li_Len
Integer li_ColCount
n_cst_string lnv_string

ls_Syntax = adw_syntax.Describe("datawindow.syntax")
choose case ai_BandIndex
	case 1
		ll_StartPos = Pos(ls_Syntax, "group(level=1")
	case 2
		ll_StartPos = Pos(ls_Syntax, "group(level=2")
	case 3
		ll_StartPos = Pos(ls_Syntax, "group(level=3")
	case else
		Return 0
end choose

ll_StartPos = Pos(ls_Syntax, "by=(", ll_StartPos) + 4
ll_EndPos = Pos(ls_Syntax, ")", ll_StartPos)
ls_ColumnDefine = Mid(ls_Syntax, ll_StartPos, ll_EndPos - ll_StartPos)

lnv_string.of_ParseToArray(ls_ColumnDefine, '"', ls_Temp)
li_ColCount = UpperBound(ls_Temp)
for i = 1 to li_ColCount
	ls_Temp[i] = Trim(ls_Temp[i])
	li_Len = Len(ls_Temp[i])
	if li_Len > 0 then
		j ++
		as_Column[j] = ls_Temp[i]
	end if
next

Return j
end function

public function integer of_preview (datawindow adw_preview, integer as_flag);//////////////////////////////////////////////////////////////////////
// $<function> of_preview
// $<arguments>
//		datawindow	adw_preview
//		integer		as_flag
// $<returns> integer
// $<description> V10.5-Advanced Report
//////////////////////////////////////////////////////////////////////
// Add by Appeon: Evan 09.22.2010
//////////////////////////////////////////////////////////////////////

String ls_font_style,ls_orientation,ls_width,ls_retval,ls_label
String ls_column,ls_label_text,ls_title,ls_x,ls_field_allias,ls_aggregate
String ls_table_field,ls_group_syntax,ls_grey,ls_align,ls_white,ls_syntax
String ls_agg_fld_width[],ls_db_nm,ls_imp_file_nm,ls_data_line,ls_data_all
String ls_presentation_str,ls_dwsyntax_str,ls_sql,Errors,ls_font
String ls_line,ls_first_part,ls_last_part,ls_return
String ls_agg_type[],ls_agg_fld_nm[],ls_agg_fld_num[]
String ls_error
Integer li_agg_cnt[],li_agg_sum[],li_agg_avg[],ls_agg_fld_x[]
Integer li_agg_cnt_1,li_agg_sum_1,li_agg_avg_1
Integer i,li_rc,li_cnt,li_return,res,f,z,li_loops
Integer li_FileNum,li_aggregate_cnt,li_Exists
Integer li_grp_agg,li_sum_agg, li_fontsize
integer li_preview, li_format_date[]  //add by stephen 05.07.2014
Long ll_sum_agg_y,ll_cnt_agg_y,ll_avg_agg_y,ll_width,ll_last_fld_width
Long ll_start_position,ll_longest_width,ll_fld_x,ll_last_fld_x,ll_fld_id
Long ll_total_field_width,ll_fld_width,ll_flen,ll_height,ll_begin_pos,ll_end_pos
long ll_count //maha 06.06.2016
long ll_log //maha 06.06.2016
boolean lb_show_crit = true  //maha 09.25.2017

SetPointer(HourGlass!)
ib_group_report = False
tab_1.tabpage_preview.st_normal.BorderStyle = StyleRaised!
tab_1.tabpage_preview.st_bold.BorderStyle = StyleRaised!
tab_1.tabpage_preview.st_italic.BorderStyle = StyleRaised!
tab_1.tabpage_preview.st_underline.BorderStyle = StyleRaised!
ls_sql = of_build_view_sql(as_flag)
adw_preview.Reset()
adw_preview.DataObject = ''
IF IsNull(ls_sql) Or ls_sql = '' THEN RETURN -1


IF tab_1.tabpage_browse.dw_report_list.GetItemNumber( tab_1.tabpage_browse.dw_report_list.GetRow(), "hide_crit" ) =  1 THEN lb_show_crit = false  //Start Code Change ----09.25.2017 #V154 maha

li_rc = tab_1.tabpage_columns.dw_view_fields.RowCount()
ii_col_count = li_rc
FOR i = 1 To li_rc
	ls_aggregate = tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "aggregate_type" )
	IF Not IsNull( ls_aggregate ) And ls_aggregate <> "None" THEN
		li_aggregate_cnt ++
		ls_agg_fld_nm[ li_aggregate_cnt ] = tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "field_name" )
		ls_agg_fld_x[ li_aggregate_cnt ] = tab_1.tabpage_columns.dw_view_fields.GetItemNumber( i, "field_x" )
		ls_agg_type[li_aggregate_cnt ] = tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "aggregate_type" )
		ls_agg_fld_num[ li_aggregate_cnt ] = String( i )
		IF tab_1.tabpage_columns.dw_view_fields.GetItemNumber( i, "count_fld" ) > 0 THEN
			li_agg_cnt[li_aggregate_cnt] = 1
			li_agg_cnt_1 = 1
		ELSE
			li_agg_cnt[li_aggregate_cnt] = 0
		END IF
		IF tab_1.tabpage_columns.dw_view_fields.GetItemNumber( i, "sum_fld" ) > 0 THEN
			li_agg_sum[li_aggregate_cnt] = 1
			li_agg_sum_1 = 1
		ELSE
			li_agg_sum[li_aggregate_cnt] = 0
		END IF
		IF tab_1.tabpage_columns.dw_view_fields.GetItemNumber( i, "avg_fld" ) > 0 THEN
			li_agg_avg[li_aggregate_cnt] = 1
			li_agg_avg_1 = 1
		ELSE
			li_agg_avg[li_aggregate_cnt] = 0
		END IF
	END IF
NEXT

/////////////////////////////////////////////////////////////////////////////////////
// Build datawindow syntax
ls_grey = String(RGB(192,192,192))
ls_white = String(RGB(255,255,255))
ls_presentation_str = "style( type=Group) Column(Border=0) Datawindow(Color=" + ls_white + " )" + "Text(Border=6 Background.Color=" + ls_grey + ")"
// Before V10.5 logic
Select count(*) into :li_Exists From ctx_report_syntax Where view_id = :il_view_id;
if li_Exists <= 0 or IsNull(li_Exists) then
	ls_group_syntax = "Group("
	FOR i = 1 To li_rc 
		IF tab_1.tabpage_columns.dw_view_fields.GetItemNumber( i, "group_by_field" ) = 1 THEN
			ls_group_syntax = ls_group_syntax + String( i ) + ","
			ib_group_report = True
		END IF
	NEXT
	ls_group_syntax = MidA( ls_group_syntax, 1 ,LenA( ls_group_syntax )-1)
	ls_group_syntax = ls_group_syntax + ")"
	IF ib_group_report THEN
		ls_presentation_str = "style( type=Group ) " + ls_group_syntax + " Column(Border=0) Datawindow(Color=" + ls_white + " )" + "Text(Border=6 Background.Color=" + ls_grey + ")"	
	END IF
end if
ls_dwsyntax_str = SQLCA.SyntaxFromSQL(ls_sql, ls_presentation_str, Errors)
IF Len(Errors) > 0 THEN
	//---------Begin Modified by (Appeon)Stephen 05.05.2014 for V142 Schedule IntelliReport--------
	//MessageBox("Caution", "SyntaxFromSQL caused these errors: " + Errors)
	inv_message.of_messagebox("Caution", "SyntaxFromSQL caused these errors: " + Errors , true)
	is_run_error = "SyntaxFromSQL caused these errors: " + Errors
	ib_run_sucess = false
	//---------End Modfiied ------------------------------------------------------
	RETURN -1
END IF
adw_preview.Create(ls_dwsyntax_str, Errors)
IF Len(Errors) > 0 THEN
	//---------Begin Modified by (Appeon)Stephen 05.05.2014 for V142 Schedule IntelliReport--------
	//MessageBox("Caution", "Create cause these errors: " + Errors)
	inv_message.of_messagebox("Caution", "Create cause these errors: " + Errors , true)
	is_run_error = "Create cause these errors: " + Errors
	ib_run_sucess = false
	//---------End Modfiied ------------------------------------------------------
	RETURN -1
END IF
// V10.5 new feature
if li_Exists > 0 then
	if not of_CreateGroup(adw_preview) then Return -1
end if
adw_preview.SetTransObject(SQLCA)

/////////////////////////////////////////////////////////////////////////////////////
// Set header height
ll_flen = LenA(is_filter)
IF ll_flen > 0 THEN
	ll_height = 52 //Evan 08.10.2011
	IF ll_flen > 80 THEN
		IF Mod(ll_flen, 80) = 0 THEN
			li_loops = ll_flen/80
		ELSE
			li_loops = (ll_flen/80) + 1
		END IF
	ELSE
		li_loops = 1
	END IF
	IF li_loops = 1 THEN
		ll_height = 52
	ELSE
		ll_height = 52*(li_loops)
	END IF
	//-------------------appeon begin----------------
	//<$>Modified:long.zhang 11.01.2012
	//<$>reason:for is_filter contains apostrophe  does not show up Bug id 3314
	//adw_preview.Modify("create text(band=header text='Filter: " + is_filter + "' border='0' color='0' x='10' y='150' height='"+String(ll_height)+"' width='3000'  font.face='Segoe UI' font.height='-8' font.weight='600'  font.family='2' font.pitch='2' font.charset='0' background.mode='1' background.color='553648127'      name=title3_t)" )
		ls_error = adw_preview.Modify("create text(band=header text='' border='0' color='0' x='10' y='150' height='"+String(ll_height)+"' width='3000'  font.face='Segoe UI' font.height='-8' font.weight='600'  font.family='2' font.pitch='2' font.charset='0' background.mode='1' background.color='553648127'      name=title3_t)" )
		
		//Start Code Change ----09.25.2017 #V154 maha - option to hide Criteria added
		IF lb_show_crit then
			if len(ls_error) = 0 then adw_preview.object.title3_t.text = "Filter: " + of_replace(is_filter,"''","'")
		end if
		//End Code Change ----09.25.2017
	//-----------------appeon end-----------------------
END IF
//------------------- APPEON BEGIN -------------------
//$<modify> Evan 08.10.2011
//$<reason> Adjust header height.
/*
if ll_height > 0 then
	adw_preview.Modify("DataWindow.Header.Height='480'")
else
	adw_preview.Modify("DataWindow.Header.Height='" + String(330 + ll_height) + "'")
end if
*/
if ll_Height > 0 then
	adw_preview.Modify("DataWindow.Header.Height='" + String(330 + ll_Height) + "'")
else
	adw_preview.Modify("DataWindow.Header.Height='480'")
end if
ll_Height = Long(adw_preview.Describe("DataWindow.Header.Height"))
//------------------- APPEON END ---------------------

/////////////////////////////////////////////////////////////////////////////////////
// Modify datawindow object's properties
FOR i = 1 To li_rc
	ls_field_allias = tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "field_alias" )
	//---------Begin Added by (Appeon)Stephen 05.08.2014 for IntelliReport Modifications 14.2--------
	li_format_date[i] = tab_1.tabpage_columns.dw_view_fields.GetItemnumber( i, "format_date" )
	if isnull(li_format_date[i]) then li_format_date[i] = 1
	//---------End Added ------------------------------------------------------
	ls_label = ls_field_allias + "_t"
	ls_column = ls_field_allias
		
	ls_column = MidA( ls_column, 1, 40 )
	ls_label = MidA( ls_label, 1, 40 )
	
	//Begin Modify - Evan 08.10.2011
	//ls_return = adw_preview.Modify( ls_label + ".y='310'") //260	
	ls_return = adw_preview.Modify(ls_label + ".y='" + String(ll_Height - 130) + "'")
	//End Modify
	
	ls_label_text = tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "label_text" )
	adw_preview.Modify( ls_label + ".Text='" + ls_label_text + "'")	
	adw_preview.Modify( ls_label + ".height='120'")	
	adw_preview.Modify( ls_label + ".Border='1'")
	
	ls_label_name[i] = adw_preview.Describe( ls_label + ".name")
	ls_column_name[i] = adw_preview.Describe( ls_column + ".name")
	adw_preview.Modify( ls_label + ".tag ='" + String( i ) + "'")
	adw_preview.Modify( ls_column + ".tag ='" + String( i ) + "'")	
	
	IF IsNull( tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "field_display_width" ) ) Or +&
		tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "field_display_width" ) = "" THEN
		ll_width = Long( adw_preview.Describe( ls_column + ".width") )
		if ll_width > 1000 then ll_width = 1000 //Set Default Max Width - jervis 01.28.2010
		tab_1.tabpage_columns.dw_view_fields.SetItem( i, "field_display_width", String( ll_width ) )
	ELSE
		ll_width = Long(tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "field_display_width" ))
	END IF
	
	IF tab_1.tabpage_columns.dw_view_fields.GetItemNumber( i, "field_visible" ) = 0 THEN
		ll_width = 0
	END IF
	adw_preview.Modify( ls_label + ".width ='" + String( ll_width ) + "'")
	adw_preview.Modify( ls_column + ".width ='" + String( ll_width ) + "'")
	
	IF IsNull( tab_1.tabpage_columns.dw_view_fields.GetItemNumber( i, "field_x" ) ) Or +&
		tab_1.tabpage_columns.dw_view_fields.GetItemNumber( i, "field_x" ) = 0  THEN
		IF Not ib_new THEN
			ll_last_fld_x = 0
			FOR z = 1 To li_rc
				ll_fld_x = tab_1.tabpage_columns.dw_view_fields.GetItemNumber( z, "field_x" )
				IF ll_fld_x > ll_last_fld_x THEN
					ll_last_fld_x = ll_fld_x
					ll_last_fld_width = Long( tab_1.tabpage_columns.dw_view_fields.GetItemString( z, "field_display_width" ) )
				END IF
			NEXT
			ls_x = String( ll_last_fld_x + ll_last_fld_width + 20 )
			tab_1.tabpage_columns.dw_view_fields.SetItem( i, "field_x", ll_last_fld_x + ll_last_fld_width + 20 )
			adw_preview.Modify( ls_label + ".x ='"  + ls_x  + "'")
			adw_preview.Modify( ls_column + ".x ='" + ls_x  + "'")
		ELSE
			if i > 1 then //Add by jervis - 01.28.2010
				ls_x = string(long(adw_preview.Describe( "#" +string(i - 1) + ".x")) + long(adw_preview.Describe( "#" +string(i - 1) + ".width")) + 20)
				adw_preview.Modify(ls_column + ".x ='" + ls_x + "'")
				adw_preview.Modify( ls_label + ".x ='"  + ls_x  + "'")
			else
			ls_x = adw_preview.Describe( ls_column + ".x")
			end if
			tab_1.tabpage_columns.dw_view_fields.SetItem( i, "field_x", Long(ls_x)  )
		END IF
	ELSE
		ls_x = String(tab_1.tabpage_columns.dw_view_fields.GetItemNumber( i, "field_x" ))
		adw_preview.Modify( ls_label + ".x ='"  + ls_x  + "'")
		adw_preview.Modify( ls_column + ".x ='" + ls_x  + "'")
		tab_1.tabpage_columns.dw_view_fields.SetItem( i, "field_x", Long(ls_x)  )
	END IF
	
	ls_font_style = tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "label_font_style" )
	
	IF PosA( ls_font_style,"B" ) > 0 THEN
		adw_preview.Modify( ls_label + ".font.weight ='700'")
	END IF
	
	IF PosA( ls_font_style,"I" ) > 0 THEN
		adw_preview.Modify( ls_label + ".font.italic ='1'")
	END IF
	
	IF PosA( ls_font_style,"U" ) > 0 THEN
		adw_preview.Modify( ls_label + ".font.underline ='1'")
	END IF
	
	IF PosA( ls_font_style,"N" ) > 0 THEN
		adw_preview.Modify( ls_label + ".font.weight ='400'")
	END IF
		
	ls_font_style = tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "field_font_style" )	
	IF PosA( ls_font_style,"B" ) > 0 THEN
		adw_preview.Modify( ls_column + ".font.weight ='700'")
		adw_preview.Modify( ls_column + "_label.font.weight ='700'")
	END IF
	
	IF PosA( ls_font_style,"I" ) > 0 THEN
		adw_preview.Modify( ls_column + ".font.italic ='1'")
		adw_preview.Modify( ls_column + "_label.font.italic ='1'")
	END IF
	
	IF PosA( ls_font_style,"U" ) > 0 THEN
		adw_preview.Modify( ls_column + ".font.underline ='1'")
		adw_preview.Modify( ls_column + "_label.font.underline ='1'")
	END IF
	
	IF PosA( ls_font_style,"N" ) > 0 THEN
		adw_preview.Modify( ls_column + ".font.weight ='400'")
		adw_preview.Modify( ls_column + "_label.font.weight ='400'")
	END IF	
NEXT

//Start Code Change ----09.25.2017 #V154 maha
IF lb_show_crit THEN
	tab_1.tabpage_preview.cbx_crit.checked = false
else
	tab_1.tabpage_preview.cbx_crit.checked = true
end if
//End Code Change ----09.25.2017

ls_title = tab_1.tabpage_browse.dw_report_list.GetItemString( tab_1.tabpage_browse.dw_report_list.GetRow(), "view_name" )
IF tab_1.tabpage_browse.dw_report_list.GetItemString( tab_1.tabpage_browse.dw_report_list.GetRow(), "orientation" ) =  "P" THEN
	adw_preview.Modify("DataWindow.Print.Orientation= '2'")
	tab_1.tabpage_preview.rb_p.Checked = True
	tab_1.tabpage_preview.rb_l.Checked = False
ELSE
	adw_preview.Modify("DataWindow.Print.Orientation= '1'")
	tab_1.tabpage_preview.rb_p.Checked = False
	tab_1.tabpage_preview.rb_l.Checked = True
END IF

IF LenA(is_facility_name) > 0 THEN
	is_facility_name = " :  " + is_facility_name
END IF
adw_preview.Modify("create text(band=header text='Report: " + ls_title +"' border='0' color='0' x='10' y='10' height='60' width='2000'  font.face='Segoe UI' font.height='-8' font.weight='600'  font.family='2' font.pitch='2' font.charset='0' background.mode='1' background.color='553648127' name=title1_t)" )
adw_preview.Modify("create text(band=header text='Date: " + String( Today() ) + "' border='0' color='0' x='10' y='80' height='60' width='1400'  font.face='Segoe UI' font.height='-8' font.weight='600'  font.family='2' font.pitch='2' font.charset='0' background.mode='1' background.color='553648127' name=title2_t)" )
ls_syntax = adw_preview.Describe("DataWindow.Syntax")


//***** set up grouping *****************************
IF ib_group_report THEN
	//remove rectangles with no names from group report
	DO While (1 = 1)
		ll_begin_pos = PosA( ls_syntax, "rectangle(" ) -1
		IF ll_begin_pos < 0 THEN EXIT
		
		ls_first_part = MidA( ls_syntax, 1, ll_begin_pos )
		ll_end_pos = PosA( ls_syntax, ")", ll_begin_pos )
		ll_end_pos = ll_end_pos - ll_begin_pos +1
		ls_last_part = MidA( ls_syntax, ll_begin_pos + ll_end_pos ) //, 100000
		ls_syntax = ls_first_part + ls_last_part
	LOOP
	
	//remove default computed columns with no names from group report	
	DO While (1 = 1)
		ll_begin_pos = PosA( ls_syntax, "compute(" ) -1
		IF ll_begin_pos < 0 THEN EXIT
		
		ls_first_part = MidA( ls_syntax, 1, ll_begin_pos )
		ll_end_pos = PosA( ls_syntax, " )", ll_begin_pos )+ 3
		ll_end_pos = ll_end_pos - ll_begin_pos +1
		ls_last_part = MidA( ls_syntax, ll_begin_pos + ll_end_pos ) //, 100000
		ls_syntax = ls_first_part + ls_last_part
	LOOP
END IF

adw_preview.Create(ls_syntax)
adw_preview.SetTransObject(SQLCA)
adw_preview.InsertRow( 0 )

// get the width of all fields together
FOR i = 1 To 100
	ls_width = adw_preview.Describe( "#" + String( i ) + ".width" )
	IF IsNumber( ls_width ) THEN
		ll_total_field_width = ll_total_field_width + Long( ls_width )
	END IF
	FOR f = 1 To li_aggregate_cnt
		IF ls_agg_fld_num[ f ] = String( i ) THEN
			ls_agg_fld_width[ f ] = ls_width
		END IF
	NEXT
NEXT

ll_total_field_width = ll_total_field_width + 100
ls_orientation = tab_1.tabpage_browse.dw_report_list.GetItemString( tab_1.tabpage_browse.dw_report_list.GetRow(), "orientation" )
IF ls_orientation = "P" And ll_total_field_width > 3500 THEN
	ll_total_field_width = 3500
ELSEIF ls_orientation = "L" And ll_total_field_width > 4500 THEN
	ll_total_field_width = 4500
END IF

//debugbreak()
IF li_aggregate_cnt > 0 THEN
	FOR i = 1 To li_aggregate_cnt
		//if there is a count or sum function at the GROUP level then put in space for calc field
		IF ls_agg_type[i] = "GL" Or ls_agg_type[i] = "GLSL" THEN
			li_grp_agg = 1
			CHOOSE CASE li_agg_cnt_1 + li_agg_sum_1 + li_agg_avg_1
				CASE 1
					adw_preview.Modify("DataWindow.trailer.1.Height='100'")
				CASE 2
					adw_preview.Modify("DataWindow.trailer.1.Height='200'")
				CASE 3
					adw_preview.Modify("DataWindow.trailer.1.Height='300'")
			END CHOOSE
		END IF
		//if there is a count or sum function at the SUMMARY level then put in space for calc field
		IF ls_agg_type[i] = "SL" Or ls_agg_type[i] = "GLSL" THEN
			li_sum_agg = 1
			CHOOSE CASE li_agg_cnt_1 + li_agg_sum_1 + li_agg_avg_1
				CASE 1
					adw_preview.Modify("DataWindow.Summary.Height='100'")
				CASE 2
					adw_preview.Modify("DataWindow.Summary.Height='200'")
				CASE 3
					adw_preview.Modify("DataWindow.Summary.Height='300'")
			END CHOOSE
		END IF
	NEXT
	
	IF li_grp_agg = 1 THEN
		IF li_agg_sum_1 = 1 THEN
			li_cnt++
			IF li_cnt = 1 THEN
				ls_retval = adw_preview.Modify('create text(band=trailer.1 alignment="0" text="Sum "border="2" color="0" x="25" y="12" height="83" width="' + String( ll_total_field_width ) + '"  name=group_sum_text  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' ) //computed field						
				ll_sum_agg_y = 22
			ELSEIF li_cnt = 2 THEN
				ls_retval = adw_preview.Modify('create text(band=trailer.1 alignment="0" text="Sum "border="2" color="0" x="25" y="98" height="83" width="' + String( ll_total_field_width ) + '"  name=group_sum_text  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' ) //computed field											
				ll_sum_agg_y = 108
			ELSE
				ls_retval = adw_preview.Modify('create text(band=trailer.1 alignment="0" text="Sum "border="2" color="0" x="25" y="185" height="83" width="' + String( ll_total_field_width ) + '"  name=group_sum_text  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' ) //computed field											
				ll_sum_agg_y = 195
			END IF
		END IF
		
		IF li_agg_cnt_1 = 1 THEN
			li_cnt++
			IF li_cnt = 1 THEN
				ls_retval = adw_preview.Modify('create text(band=trailer.1 alignment="0" text="Count "border="2" color="0" x="25" y="12" height="83" width="' + String( ll_total_field_width ) + '"  name=group_count_text  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' ) //computed field						
				ll_cnt_agg_y = 22
			ELSEIF li_cnt = 2 THEN
				ls_retval = adw_preview.Modify('create text(band=trailer.1 alignment="0" text="Count "border="2" color="0" x="25" y="98" height="83" width="' + String( ll_total_field_width ) + '"  name=group_count_text  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' ) //computed field											
				ll_cnt_agg_y = 108
			ELSE
				ls_retval = adw_preview.Modify('create text(band=trailer.1 alignment="0" text="Count "border="2" color="0" x="25" y="185" height="83" width="' + String( ll_total_field_width ) + '"  name=group_count_text  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' ) //computed field											
				ll_cnt_agg_y = 195
			END IF
		END IF
		
		IF li_agg_avg_1 = 1 THEN
			li_cnt++
			IF li_cnt = 1 THEN
				ls_retval = adw_preview.Modify('create text(band=trailer.1 alignment="0" text="Average "border="2" color="0" x="25" y="12" height="83" width="' + String( ll_total_field_width ) + '"  name=group_avg_text  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' ) //computed field						
				ll_avg_agg_y = 22
			ELSEIF li_cnt = 2 THEN
				ls_retval = adw_preview.Modify('create text(band=trailer.1 alignment="0" text="Average "border="2" color="0" x="25" y="98" height="83" width="' + String( ll_total_field_width ) + '"  name=group_avg_text  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' ) //computed field											
				ll_avg_agg_y = 108
			ELSE
				ls_retval = adw_preview.Modify('create text(band=trailer.1 alignment="0" text="Average "border="2" color="0" x="25" y="185" height="83" width="' + String( ll_total_field_width ) + '"  name=group_avg_text  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' ) //computed field											
				ll_avg_agg_y = 195
			END IF
		END IF
	END IF
	
	li_cnt = 0
	IF li_sum_agg = 1 THEN
		IF li_agg_sum_1 = 1 THEN
			li_cnt++
			IF li_cnt = 1 THEN
				ls_retval = adw_preview.Modify('create text(band=Summary alignment="0" text="Sum "border="2" color="0" x="25" y="12" height="83" width="' + String( ll_total_field_width ) + '"  name=sum_sum_text  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' ) //computed field						
				ll_sum_agg_y = 22
			ELSEIF li_cnt = 2 THEN
				ls_retval = adw_preview.Modify('create text(band=Summary alignment="0" text="Sum "border="2" color="0" x="25" y="98" height="83" width="' + String( ll_total_field_width ) + '"  name=sum_sum_text  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' ) //computed field											
				ll_sum_agg_y = 108
			ELSE
				ls_retval = adw_preview.Modify('create text(band=Summary alignment="0" text="Sum "border="2" color="0" x="25" y="185" height="83" width="' + String( ll_total_field_width ) + '"  name=sum_sum_text  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' ) //computed field											
				ll_sum_agg_y = 195
			END IF
		END IF
		
		IF li_agg_cnt_1 = 1 THEN
			
			li_cnt++
			IF li_cnt = 1 THEN
				ls_retval = adw_preview.Modify('create text(band=Summary alignment="0" text="Count "border="2" color="0" x="25" y="12" height="83" width="' + String( ll_total_field_width ) + '"  name=sum_count_text  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' ) //computed field						
				ll_cnt_agg_y = 22
			ELSEIF li_cnt = 2 THEN
				ls_retval = adw_preview.Modify('create text(band=Summary alignment="0" text="Count "border="2" color="0" x="25" y="98" height="83" width="' + String( ll_total_field_width ) + '"  name=sum_count_text  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' ) //computed field											
				ll_cnt_agg_y = 108
			ELSE
				ls_retval = adw_preview.Modify('create text(band=Summary alignment="0" text="Count "border="2" color="0" x="25" y="185" height="83" width="' + String( ll_total_field_width ) + '"  name=sum_count_text  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' ) //computed field											
				ll_cnt_agg_y = 195
			END IF
		END IF
		
		IF li_agg_avg_1 = 1 THEN
			li_cnt++
			IF li_cnt = 1 THEN
				ls_retval = adw_preview.Modify('create text(band=Summary alignment="0" text="Average "border="2" color="0" x="25" y="12" height="83" width="' + String( ll_total_field_width ) + '"  name=sum_avg_text  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' ) //computed field						
				ll_avg_agg_y = 22
			ELSEIF li_cnt = 2 THEN
				ls_retval = adw_preview.Modify('create text(band=Summary alignment="0" text="Average "border="2" color="0" x="25" y="98" height="83" width="' + String( ll_total_field_width ) + '"  name=sum_avg_text  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' ) //computed field											
				ll_avg_agg_y = 108
			ELSE
				ls_retval = adw_preview.Modify('create text(band=Summary alignment="0" text="Average "border="2" color="0" x="25" y="185" height="83" width="' + String( ll_total_field_width ) + '"  name=sum_avg_text  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' ) //computed field											
				ll_avg_agg_y = 195
			END IF
		END IF
	END IF
	
	FOR i = 1 To li_aggregate_cnt
		IF ls_agg_fld_x[i] < 100 THEN // added ls_agg_fld_x[1] < 400, hope this doesnt screw up things.
			ls_agg_fld_x[i] = ls_agg_fld_x[i] + 400
		END IF

		If (ls_agg_type[i] = "GL" Or ls_agg_type[i] = "GLSL") And li_agg_cnt[i] = 1 THEN
			ls_retval = adw_preview.Modify('create compute(band=trailer.1 alignment="0" expression="count(#' + ls_agg_fld_num[i] + ' for group 1)"border="0" color="0" x="' + String(ls_agg_fld_x[i] ) + '" y="' + String( ll_cnt_agg_y ) + '" height="166" width="' + ls_agg_fld_width[i] + '" format="#,###.00"  name=group_count  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' )
		END IF
		If (ls_agg_type[i] = "SL" Or ls_agg_type[i] = "GLSL") And li_agg_cnt[i] = 1 THEN
			ls_retval = adw_preview.Modify('create compute(band=summary alignment="0" expression="Count(#' + ls_agg_fld_num[i] + ' for all )"border="0" color="0" x="' + String(ls_agg_fld_x[i] ) + '" y="' + String( ll_cnt_agg_y ) + '" height="166" width="' + ls_agg_fld_width[i] + '" format="#,###.00"  name=summary_count  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' )
		END IF
		
		//sum
		If (ls_agg_type[i] = "GL" Or ls_agg_type[i] = "GLSL") And li_agg_sum[i] = 1 THEN
			ls_retval = adw_preview.Modify('create compute(band=trailer.1 alignment="0" expression="sum(#' + ls_agg_fld_num[i] + ' for group 1)"border="0" color="0" x="' + String(ls_agg_fld_x[i] ) + '" y="' + String( ll_sum_agg_y ) + '" height="166" width="' + ls_agg_fld_width[i] + '" format="#,###.00"  name=group_sum  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' )
		END IF
		If (ls_agg_type[i] = "SL" Or ls_agg_type[i] = "GLSL") And li_agg_sum[i] = 1 THEN
			ls_retval = adw_preview.Modify('create compute(band=Summary alignment="0" expression="sum(#' + ls_agg_fld_num[i] + ' for all)"border="0" color="0" x="' + String(ls_agg_fld_x[i] ) + '" y="' + String( ll_sum_agg_y ) + '" height="166" width="' + ls_agg_fld_width[i] + '"  format="#,###.00"  name=summary_sum  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' )
		END IF
		
		//averge
		If (ls_agg_type[i] = "GL" Or ls_agg_type[i] = "GLSL") And li_agg_avg[i] = 1 THEN
			ls_retval = adw_preview.Modify('create compute(band=trailer.1 alignment="0" expression="Avg(#' + ls_agg_fld_num[i] + ' for group 1)"border="0" color="0" x="' + String(ls_agg_fld_x[i] ) + '" y="' + String( ll_avg_agg_y ) + '" height="166" width="' + ls_agg_fld_width[i] + '"  format="#,###.00"  name=group_avg  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' )
		END IF
		If (ls_agg_type[i] = "SL" Or ls_agg_type[i] = "GLSL") And li_agg_avg[i] = 1 THEN
			ls_retval = adw_preview.Modify('create compute(band=Summary alignment="0" expression="Avg(#' + ls_agg_fld_num[i] + ' for all)"border="0" color="0" x="' + String(ls_agg_fld_x[i] ) + '" y="' + String( ll_avg_agg_y ) + '" height="166" width="' + ls_agg_fld_width[i] + '"  format="#,###.00"  name=sumary_avg  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' )
		END IF
	NEXT
END IF

//******************  retrieve data ********************
IF adw_preview = tab_1.tabpage_run.dw_run Or ii_with_data = 1 THEN
	//Start Code Change ----06.06.2016 #V152 maha - added log function
	ll_log = of_log_sys_report("C",gs_ireport_audit_from,"", il_view_id, is_report_name)
	ll_count = adw_preview.Retrieve()
	of_log_sys_report_end( ll_log, ll_count, "")
	//End Code Change ----06.06.2016
END IF
IF ib_group_report THEN
	res = adw_preview.SetSort(is_sort_synt)
	IF res < 1 THEN 		
		//---------Begin Modified by (Appeon)Stephen 05.05.2014 for V142 Schedule IntelliReport--------
		//MessageBox("","Sort Error")
		inv_message.of_messagebox("","Sort Error" , true)
		//---------End Modfiied ------------------------------------------------------
	end if
	adw_preview.Sort()
	adw_preview.GroupCalc()
END IF

tab_1.tabpage_preview.st_left.BorderStyle = StyleRaised!
tab_1.tabpage_preview.st_center.BorderStyle = StyleRaised!
tab_1.tabpage_preview.st_right.BorderStyle = StyleRaised!
tab_1.tabpage_preview.st_f_left.BorderStyle = StyleRaised!
tab_1.tabpage_preview.st_f_center.BorderStyle = StyleRaised!
tab_1.tabpage_preview.st_f_right.BorderStyle = StyleRaised!

IF IsNull( tab_1.tabpage_browse.dw_report_list.GetItemNumber( tab_1.tabpage_browse.dw_report_list.GetRow(), "font_size" ) ) THEN
	ls_font = MidA( adw_preview.Describe( ls_column_name[ 1 ] + ".Font.Height" ),2,100)
	tab_1.tabpage_preview.em_font.Text = ls_font
ELSE
	ls_font = String( tab_1.tabpage_browse.dw_report_list.GetItemNumber( tab_1.tabpage_browse.dw_report_list.GetRow(), "font_size" ))
	tab_1.tabpage_preview.em_font.Text = ls_font
END IF

FOR i = 1 To ii_col_count
	adw_preview.Modify( ls_column_name[ i ] + ".Font.Face='Segoe UI'")
	//---------Begin Modified by (Appeon)Stephen 05.21.2014 for IntelliReport Modifications 14.2--------
	//adw_preview.Modify( ls_column_name[ i ] + ".Font.Height='-" + ls_font + "'")
	//adw_preview.Modify( ls_label_name[ i ] + ".Font.Height='-" + ls_font + "'")	
	li_fontsize = Tab_1.tabpage_columns.dw_view_fields.getitemnumber(i, "field_font_size")
	if isnull(li_fontsize) or li_fontsize = 0 then
		adw_preview.Modify( ls_column_name[ i ] + ".Font.Height='-" + ls_font + "'")
	else
		adw_preview.Modify( ls_column_name[ i ] + ".Font.Height='-" + string(li_fontsize) + "'")
	end if
	li_fontsize = 0
	li_fontsize = Tab_1.tabpage_columns.dw_view_fields.getitemnumber(i, "label_font_size")
	if isnull(li_fontsize) or li_fontsize = 0 then
		adw_preview.Modify( ls_label_name[ i ] + ".Font.Height='-" + ls_font + "'")	
	else
		adw_preview.Modify( ls_label_name[ i ] + ".Font.Height='-" + string(li_fontsize) + "'")	
	end if
	//---------End Modfiied ------------------------------------------------------
    
	 //---------Begin Modified by (Appeon)Stephen 12.10.2014 for V14.2 Testing/Bug# 4338 - iReport the Date Format checkbox that strips time from datetime fields works initially but can’t be changed--------
	 //IF adw_preview.Describe( ls_column_name[ i ] + ".coltype" ) = "datetime" then
	IF lower(adw_preview.Describe( ls_column_name[ i ] + ".coltype" )) = "datetime" or lower(adw_preview.Describe( ls_column_name[ i ] + ".coltype" )) = "date" THEN
	//---------End Modfiied ------------------------------------------------------
		if li_format_date[i] = 1 then //(Appeon)Stephen 05.07.2014 - IntelliReport Modifications 14.2
			adw_preview.SetFormat( ls_column_name[ i ], "mm/dd/yyyy" )
		end if
	END IF
	ls_align = String( tab_1.tabpage_columns.dw_view_fields.GetItemNumber( i, "field_align" )	)
	adw_preview.Modify( ls_column_name[ i ] + ".alignment = '" + ls_align + "'" )
	ls_align = String( tab_1.tabpage_columns.dw_view_fields.GetItemNumber( i, "label_align" )	)
	adw_preview.Modify( ls_label_name[ i ] + ".alignment = '" + ls_align + "'" )
NEXT

IF adw_preview.Title = "" THEN
	adw_preview.Modify("DataWindow.Print.Preview=No")
ELSE
	//---------Begin Modified by (Appeon)Stephen 05.08.2014 for IntelliReport Modifications 14.2--------
	//adw_preview.Modify("DataWindow.Print.Preview=Yes")
	li_preview = tab_1.tabpage_browse.dw_report_list.GetItemnumber( tab_1.tabpage_browse.dw_report_list.GetRow(), "preview_type" )
	if isnull(li_preview) then li_preview = 1
	if  li_preview = 0 then
		adw_preview.Modify("DataWindow.Print.Preview=No")
	else
		adw_preview.Modify("DataWindow.Print.Preview=Yes")
	end if
	//---------End Modfiied ------------------------------------------------------
END IF
adw_preview.Modify("DataWindow.Grid.Lines='1'")

Return 0
end function

public function boolean of_creategroup (datawindow adw_report);//////////////////////////////////////////////////////////////////////
// $<function> of_creategroup
// $<arguments>
//			datawindow	adw_report
// $<returns> boolean
// $<description> V10.5-Advanced Report
//////////////////////////////////////////////////////////////////////
// Add by Appeon: Evan 09.25.2010
//////////////////////////////////////////////////////////////////////

string ls_Error
string ls_Syntax
string ls_db_syntax
string ls_Group
string ls_AllGroup
string ls_Columns
string ls_GoupColumn[]
long ll_GroupCount
long ll_StartPos, ll_EndPos
integer i, li_ColCount
boolean lb_Create = true

// Get all columns
li_ColCount = Integer(adw_report.Describe("datawindow.column.count"))
for i = 1 to li_ColCount
	ls_Columns += adw_report.Describe("#" + String(i) + ".name") + ","
next

// Get all group syntax
ls_db_syntax = of_GetSyntax(il_view_id)
ll_StartPos = Pos(ls_db_syntax, "group(level=1")
if ll_StartPos > 0 then
	li_ColCount = of_GetGroupColumns(ls_db_syntax, 1, ls_GoupColumn)
	for i = 1 to li_ColCount
		if Pos(ls_Columns, ls_GoupColumn[i]) < 1 then
			lb_Create = false
			exit
		end if
	next
	if lb_Create then
		ll_EndPos = Pos(ls_db_syntax, "~r~n", ll_StartPos)
		ls_Group = Mid(ls_db_syntax, ll_StartPos, ll_EndPos - ll_StartPos)
		ls_AllGroup = ls_Group
	end if
end if

lb_Create = true
ll_StartPos = Pos(ls_db_syntax, "group(level=2")
if ll_StartPos > 0 then
	li_ColCount = of_GetGroupColumns(ls_db_syntax, 2, ls_GoupColumn)
	for i = 1 to li_ColCount
		if Pos(ls_Columns, ls_GoupColumn[i]) < 1 then
			lb_Create = false
			exit
		end if
	next
	if lb_Create then
		ll_EndPos = Pos(ls_db_syntax, "~r~n", ll_StartPos)
		ls_Group = Mid(ls_db_syntax, ll_StartPos, ll_EndPos - ll_StartPos)
		if ls_AllGroup <> "" then ls_AllGroup += "~r~n"
		ls_AllGroup += ls_Group
	end if
end if

lb_Create = true
ll_StartPos = Pos(ls_db_syntax, "group(level=3")
if ll_StartPos > 0 then
	li_ColCount = of_GetGroupColumns(ls_db_syntax, 3, ls_GoupColumn)
	for i = 1 to li_ColCount
		if Pos(ls_Columns, ls_GoupColumn[i]) < 1 then
			lb_Create = false
			exit
		end if
	next
	if lb_Create then
		ll_EndPos = Pos(ls_db_syntax, "~r~n", ll_StartPos)
		ls_Group = Mid(ls_db_syntax, ll_StartPos, ll_EndPos - ll_StartPos)
		if ls_AllGroup <> "" then ls_AllGroup += "~r~n"
		ls_AllGroup += ls_Group
	end if
end if

if ls_AllGroup <> "" then
	ls_AllGroup += "~r~n"
else
	Return true
end if

// Insert all group syntax to datawindow syntax
ls_Syntax = adw_report.Describe("datawindow.syntax")
ll_StartPos = Pos(ls_Syntax, "text(name=")
ls_Syntax = Replace(ls_Syntax, ll_StartPos, 0, ls_AllGroup)
adw_report.Create(ls_Syntax, ls_Error)
if Len(ls_Error) > 0 then
	//---------Begin Modified by (Appeon)Stephen 05.05.2014 for V142 Schedule IntelliReport--------
	//MessageBox("Error", "Failed to create group.", StopSign!)
	inv_message.of_messagebox("Error", "Failed to create group.", StopSign! , true)
	is_run_error = "Failed to create group."
	ib_run_sucess = false
	//---------End Modfiied ------------------------------------------------------
	Return false
end if

Return true
end function

public function integer of_getgroupcolumns (string as_syntax, integer ai_bandindex, ref string as_column[]);//////////////////////////////////////////////////////////////////////
// $<function> of_getgroupcolumns
// $<arguments>
//			string			as_syntax
//			integer			ai_bandindex
//			ref	string	as_column[]
// $<returns> integer
// $<description> V10.5-Advanced Report
//////////////////////////////////////////////////////////////////////
// Add by Appeon: Evan 09.25.2010
//////////////////////////////////////////////////////////////////////

string ls_Temp[]
string ls_ColumnDefine
long ll_StartPos
long ll_EndPos
Integer i, j, li_Len
Integer li_ColCount
n_cst_string lnv_string

choose case ai_BandIndex
	case 1
		ll_StartPos = Pos(as_Syntax, "group(level=1")
	case 2
		ll_StartPos = Pos(as_Syntax, "group(level=2")
	case 3
		ll_StartPos = Pos(as_Syntax, "group(level=3")
	case else
		Return 0
end choose

ll_StartPos = Pos(as_Syntax, "by=(", ll_StartPos) + 4
ll_EndPos = Pos(as_Syntax, ")", ll_StartPos)
ls_ColumnDefine = Mid(as_Syntax, ll_StartPos, ll_EndPos - ll_StartPos)

lnv_string.of_ParseToArray(ls_ColumnDefine, '"', ls_Temp)
li_ColCount = UpperBound(ls_Temp)
for i = 1 to li_ColCount
	ls_Temp[i] = Trim(ls_Temp[i])
	li_Len = Len(ls_Temp[i])
	if li_Len > 0 then
		j ++
		as_Column[j] = ls_Temp[i]
	end if
next

Return j
end function

public function integer of_preview_01 (datawindow adw_preview, integer as_flag);//this builds the datawindow calls of_build_view_sql()
//messagebox("of_preview","")
String ls_font_style
String ls_orientation
String ls_width
String ls_retval
String ls_label
String ls_column
String ls_label_text
String ls_title
String ls_x
String ls_field_allias
String ls_table_field
String ls_group_syntax
String ls_grey
String ls_align
String ls_white
String ls_presentation_str
String ls_dwsyntax_str
String ls_sql
String Errors
String ls_font
String ls_agg_type[]
String ls_agg_fld_nm[]
String ls_aggregate
String ls_agg_fld_num[ ]
Integer f
Integer li_agg_cnt[]
Integer li_agg_sum[]
Integer li_agg_avg[]

Integer li_agg_cnt_1
Integer li_agg_sum_1
Integer li_agg_avg_1
Integer res
Integer li_grp_agg
Integer li_sum_agg
Integer ls_agg_fld_x[]
Integer li_rc
Integer z
Integer li_cnt
Integer li_return
Integer i
Integer li_FileNum
Integer li_aggregate_cnt
Long ll_total_field_width
Long ll_sum_agg_y
Long ll_cnt_agg_y
Long ll_avg_agg_y
Long ll_width
Long ll_last_fld_width
Long ll_start_position
Long ll_longest_width
Long ll_fld_x
Long ll_last_fld_x
Long ll_fld_id
Long ll_fld_width
String ls_agg_fld_width[ ]
String ls_db_nm
String ls_imp_file_nm
String ls_data_line
String ls_data_all
String ls_syntax //maha 111502
Integer  li_loops //nova 02.04.2009
Long ll_flen,ll_height //nova 02.04.2009

ib_group_report = False
tab_1.tabpage_preview.st_normal.BorderStyle = StyleRaised!
tab_1.tabpage_preview.st_bold.BorderStyle = StyleRaised!
tab_1.tabpage_preview.st_italic.BorderStyle = StyleRaised!
tab_1.tabpage_preview.st_underline.BorderStyle = StyleRaised!


SetPointer( HourGlass! )
//--------Begin Modified by  Nova 08.18.2010------------------------
//V10.5 SK IntelliReport
//ls_sql = of_build_view_sql()
ls_sql = of_build_view_sql(as_flag)
//--------End Modified --------------------------------------------

//--------Begin Added by Nova 07.08.2009------------------------
//move the code from the below 
adw_preview.Reset()
adw_preview.DataObject = ''
//--------End Added --------------------------------------------
//BugN061001
//$<add> 07.08.2008 by Andy

IF IsNull(ls_sql) Or ls_sql = '' THEN RETURN -1
//end add 07.08.2008
//--------Begin Commented by  Nova 07.08.2009------------------------
//need to reset adw_preview ,move to up these code
//adw_preview.Reset()
//adw_preview.DataObject = ''
//--------End Commented --------------------------------------------


li_rc = tab_1.tabpage_columns.dw_view_fields.RowCount()
ii_col_count = li_rc
// newpage=yes
ls_group_syntax = "Group("
FOR i = 1 To li_rc
	IF tab_1.tabpage_columns.dw_view_fields.GetItemNumber( i, "group_by_field" ) = 1 THEN
		ls_group_syntax = ls_group_syntax + String( i ) + ","
		ib_group_report = True
	END IF
	//--------Begin Added by Nova 08.19.2010------------------------
	//V10.5 SK IntelliReport
	IF tab_1.tabpage_columns.dw_view_fields.GetItemNumber( i, "page_breaker" ) = 1 THEN
		ib_group_break=True
	END IF
	//--------End Modified --------------------------------------------
NEXT
ls_group_syntax = MidA( ls_group_syntax, 1 ,LenA( ls_group_syntax )-1)
//--------Begin Added by Nova 08.19.2010------------------------
//V10.5 SK IntelliReport
IF ib_group_break THEN
	ls_group_syntax=ls_group_syntax+" newpage "
END IF
//--------End Modified --------------------------------------------
ls_group_syntax = ls_group_syntax + ")"

FOR i = 1 To li_rc
	ls_aggregate = tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "aggregate_type" )
	IF Not IsNull( ls_aggregate ) And ls_aggregate <> "None" THEN
		li_aggregate_cnt ++
		ls_agg_fld_nm[ li_aggregate_cnt ] = tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "field_name" )
		ls_agg_fld_x[ li_aggregate_cnt ] = tab_1.tabpage_columns.dw_view_fields.GetItemNumber( i, "field_x" )
		ls_agg_type[li_aggregate_cnt ] = tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "aggregate_type" )
		ls_agg_fld_num[ li_aggregate_cnt ] = String( i )
		IF tab_1.tabpage_columns.dw_view_fields.GetItemNumber( i, "count_fld" ) > 0 THEN
			li_agg_cnt[li_aggregate_cnt] = 1
			li_agg_cnt_1 = 1
		ELSE
			li_agg_cnt[li_aggregate_cnt] = 0
		END IF
		IF tab_1.tabpage_columns.dw_view_fields.GetItemNumber( i, "sum_fld" ) > 0 THEN
			li_agg_sum[li_aggregate_cnt] = 1
			li_agg_sum_1 = 1
		ELSE
			li_agg_sum[li_aggregate_cnt] = 0
		END IF
		IF tab_1.tabpage_columns.dw_view_fields.GetItemNumber( i, "avg_fld" ) > 0 THEN
			li_agg_avg[li_aggregate_cnt] = 1
			li_agg_avg_1 = 1
		ELSE
			li_agg_avg[li_aggregate_cnt] = 0
		END IF
	END IF
NEXT


ls_grey = String(RGB(192,192,192))
ls_white = String(RGB(255,255,255))
IF ib_group_report THEN
	ls_presentation_str = "style( type=Group ) " + ls_group_syntax + " Column(Border=0) Datawindow(Color=" + ls_white + " )" + "Text(Border=6 Background.Color=" + ls_grey + ")"
ELSE
	ls_presentation_str = "style( type=Group) Column(Border=0) Datawindow(Color=" + ls_white + " )" + "Text(Border=6 Background.Color=" + ls_grey + ")"
END IF

ls_dwsyntax_str = SQLCA.SyntaxFromSQL(ls_sql, &
	ls_presentation_str, Errors)

IF LenA(Errors) > 0 THEN	
	//---------Begin Modified by (Appeon)Stephen 05.05.2014 for V142 Schedule IntelliReport--------
	//MessageBox("Caution", "SyntaxFromSQL caused these errors: " + Errors)
	inv_message.of_messagebox("Caution", "SyntaxFromSQL caused these errors: " + Errors , true)
	is_run_error = "SyntaxFromSQL caused these errors: " + Errors
	ib_run_sucess = false
	//---------End Modfiied ------------------------------------------------------
	RETURN -1
END IF

adw_preview.Create( ls_dwsyntax_str, Errors)

IF LenA(Errors) > 0 THEN	
	//---------Begin Modified by (Appeon)Stephen 05.05.2014 for V142 Schedule IntelliReport--------
	//MessageBox("Caution", "Create cause these errors: " + Errors)
	inv_message.of_messagebox("Caution", "Create cause these errors: " + Errors , true)
	is_run_error = "Create cause these errors: " + Errors
	ib_run_sucess = false
	//---------End Modfiied ------------------------------------------------------
	RETURN -1
END IF

adw_preview.SetTransObject( SQLCA )
//--------Begin Added by Nova 02.04.2009------------------------
// 
ll_height = 52
ll_flen = LenA(is_filter)
IF ll_flen > 0 THEN
	IF ll_flen > 80 THEN
		IF Mod(ll_flen, 80) = 0 THEN
			li_loops = ll_flen/80
		ELSE
			li_loops = (ll_flen/80) + 1
		END IF
	ELSE
		li_loops = 1
	END IF
	IF li_loops = 1 THEN
		ll_height = 52
	ELSE
		ll_height = 52*(li_loops)
	END IF
	adw_preview.Modify("create text(band=header text='Filter: " + is_filter + "' border='0' color='0' x='10' y='150' height='"+String(ll_height)+"' width='3000'  font.face='Segoe UI' font.height='-8' font.weight='600'  font.family='2' font.pitch='2' font.charset='0' background.mode='1' background.color='553648127'      name=title3_t)" )
END IF
//--------End Added --------------------------------------------

//------------------- APPEON BEGIN -------------------
//$<modify> Evan 09.03.2010
//$<reason> V10.5-Advanced Report
if ll_height > 0 then
	adw_preview.Modify("DataWindow.Header.Height='480'")
else
	adw_preview.Modify("DataWindow.Header.Height='" + String(330 + ll_height) + "'")
end if
//------------------- APPEON END ---------------------

FOR i = 1 To li_rc
	ls_field_allias = tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "field_alias" )
	ls_label = ls_field_allias + "_t"
	ls_column = ls_field_allias
	
	
	ls_column = MidA( ls_column, 1, 40 )
	ls_label = MidA( ls_label, 1, 40 )
	
	String ls_return
	ls_return = adw_preview.Modify( ls_label + ".y='310'") //260	
	
	ls_label_text = tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "label_text" )
	adw_preview.Modify( ls_label + ".Text='" + ls_label_text + "'")
	
	adw_preview.Modify( ls_label + ".height='120'")
	
	adw_preview.Modify( ls_label + ".Border='1'")
	
	ls_label_name[i] = adw_preview.Describe( ls_label + ".name")
	ls_column_name[i] = adw_preview.Describe( ls_column + ".name")
	adw_preview.Modify( ls_label + ".tag ='" + String( i ) + "'")
	adw_preview.Modify( ls_column + ".tag ='" + String( i ) + "'")
	
	//	IF adw_preview = tab_1.tabpage_preview.dw_preview THEN	
	//		adw_preview.Modify(ls_column + ".Border='2'")
	//	END IF
	
	IF IsNull( tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "field_display_width" ) ) Or +&
		tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "field_display_width" ) = "" THEN
		ll_width = Long( adw_preview.Describe( ls_column + ".width") )
		if ll_width > 1000 then ll_width = 1000 //Set Default Max Width - jervis 01.28.2010
		tab_1.tabpage_columns.dw_view_fields.SetItem( i, "field_display_width", String( ll_width ) )
	ELSE
		ll_width = Long(tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "field_display_width" ))
		//adw_preview.Modify( ls_label + ".width ='" + String( ll_width ) + "'")			
		//adw_preview.Modify( ls_column + ".width ='" + String( ll_width ) + "'")			
	END IF
	
	IF tab_1.tabpage_columns.dw_view_fields.GetItemNumber( i, "field_visible" ) = 0 THEN
		ll_width = 0
	END IF
	adw_preview.Modify( ls_label + ".width ='" + String( ll_width ) + "'")
	adw_preview.Modify( ls_column + ".width ='" + String( ll_width ) + "'")
	
	IF IsNull( tab_1.tabpage_columns.dw_view_fields.GetItemNumber( i, "field_x" ) ) Or +&
		tab_1.tabpage_columns.dw_view_fields.GetItemNumber( i, "field_x" ) = 0  THEN
		//Messagebox("", "field_x = 0")
		IF Not ib_new THEN
			//MessageBox("", "not new" )
			ll_last_fld_x = 0
			FOR z = 1 To li_rc
				ll_fld_x = tab_1.tabpage_columns.dw_view_fields.GetItemNumber( z, "field_x" )
				IF ll_fld_x > ll_last_fld_x THEN
					ll_last_fld_x = ll_fld_x
					ll_last_fld_width = Long( tab_1.tabpage_columns.dw_view_fields.GetItemString( z, "field_display_width" ) )
				END IF
			NEXT
			ls_x = String( ll_last_fld_x + ll_last_fld_width + 20 )
			tab_1.tabpage_columns.dw_view_fields.SetItem( i, "field_x", ll_last_fld_x + ll_last_fld_width + 20 )
			adw_preview.Modify( ls_label + ".x ='"  + ls_x  + "'")
			adw_preview.Modify( ls_column + ".x ='" + ls_x  + "'")
		ELSE
			if i > 1 then //Add by jervis - 01.28.2010
				ls_x = string(long(adw_preview.Describe( "#" +string(i - 1) + ".x")) + long(adw_preview.Describe( "#" +string(i - 1) + ".width")) + 20)
				adw_preview.Modify(ls_column + ".x ='" + ls_x + "'")
				adw_preview.Modify( ls_label + ".x ='"  + ls_x  + "'")
			else
			ls_x = adw_preview.Describe( ls_column + ".x")
			end if
			tab_1.tabpage_columns.dw_view_fields.SetItem( i, "field_x", Long(ls_x)  )
		END IF
	ELSE
		ls_x = String(tab_1.tabpage_columns.dw_view_fields.GetItemNumber( i, "field_x" ))
		adw_preview.Modify( ls_label + ".x ='"  + ls_x  + "'")
		adw_preview.Modify( ls_column + ".x ='" + ls_x  + "'")
		tab_1.tabpage_columns.dw_view_fields.SetItem( i, "field_x", Long(ls_x)  )
	END IF
	//Modified By Alan on 2009-2-5
	//		IF adw_preview = tab_1.tabpage_preview.dw_preview THEN	
	//			IF tab_1.tabpage_columns.dw_view_fields.GetItemNumber( i, "group_by_field" ) = 1 THEN
	//				IF ii_with_data = 0 THEN
	//					ls_retval = adw_preview.Modify('create text(band=Header.1 alignment="0" text="' + ls_column + '" border="0" color="0" x="' + ls_x + '" y="12" height="83" width="' + String( ll_width ) + '"  name=' + ls_column + '_label font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' )//computed field											
	//				END IF
	//			ELSE
	//				IF ii_with_data = 0 THEN
	//					ls_retval = adw_preview.Modify('create text(band=Detail alignment="0" text="' + ls_column + '" border="0" color="0" x="' + ls_x + '" y="12" height="83" width="' + String( ll_width ) + '"  name=' + ls_column + '_label font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' )//computed field								
	//				END IF
	//			END IF
	//			adw_preview.Modify( ls_column + "_label.tag ='" + String( i ) + "'")			
	//		END IF
	
	ls_font_style = tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "label_font_style" )
	
	IF PosA( ls_font_style,"B" ) > 0 THEN
		adw_preview.Modify( ls_label + ".font.weight ='700'")
	END IF
	
	IF PosA( ls_font_style,"I" ) > 0 THEN
		adw_preview.Modify( ls_label + ".font.italic ='1'")
	END IF
	
	IF PosA( ls_font_style,"U" ) > 0 THEN
		adw_preview.Modify( ls_label + ".font.underline ='1'")
	END IF
	
	IF PosA( ls_font_style,"N" ) > 0 THEN
		adw_preview.Modify( ls_label + ".font.weight ='400'")
	END IF
	
	
	ls_font_style = tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "field_font_style" )
	
	IF PosA( ls_font_style,"B" ) > 0 THEN
		adw_preview.Modify( ls_column + ".font.weight ='700'")
		adw_preview.Modify( ls_column + "_label.font.weight ='700'")
	END IF
	
	IF PosA( ls_font_style,"I" ) > 0 THEN
		adw_preview.Modify( ls_column + ".font.italic ='1'")
		adw_preview.Modify( ls_column + "_label.font.italic ='1'")
	END IF
	
	IF PosA( ls_font_style,"U" ) > 0 THEN
		adw_preview.Modify( ls_column + ".font.underline ='1'")
		adw_preview.Modify( ls_column + "_label.font.underline ='1'")
	END IF
	
	IF PosA( ls_font_style,"N" ) > 0 THEN
		adw_preview.Modify( ls_column + ".font.weight ='400'")
		adw_preview.Modify( ls_column + "_label.font.weight ='400'")
	END IF
	
	//		IF adw_preview = tab_1.tabpage_preview.dw_preview AND ii_with_data = 0 THEN			
	//			adw_preview.Modify( ls_column + ".border ='2'")												
	//		ELSEIF adw_preview = tab_1.tabpage_preview.dw_preview AND ii_with_data = 1 THEN						
	//			adw_preview.Modify( ls_column + ".border ='0'")															
	//		END IF
	
	
NEXT

ls_title = tab_1.tabpage_browse.dw_report_list.GetItemString( tab_1.tabpage_browse.dw_report_list.GetRow(), "view_name" )

IF tab_1.tabpage_browse.dw_report_list.GetItemString( tab_1.tabpage_browse.dw_report_list.GetRow(), "orientation" ) =  "P" THEN
	adw_preview.Modify("DataWindow.Print.Orientation= '2'")
	tab_1.tabpage_preview.rb_p.Checked = True
	tab_1.tabpage_preview.rb_l.Checked = False
	//ll_total_field_width	 = 3500
ELSE
	adw_preview.Modify("DataWindow.Print.Orientation= '1'")
	tab_1.tabpage_preview.rb_p.Checked = False
	tab_1.tabpage_preview.rb_l.Checked = True
	//ll_total_field_width	 = 4500	
END IF

IF LenA(is_facility_name) > 0 THEN
	is_facility_name = " :  " + is_facility_name
END IF
//-----Begin Commented by Nova 02.04.2009---------------
//IF ib_group_report THEN
//	adw_preview.Modify("create text(band=header text='Report: " + ls_title + is_facility_name +"' border='0' color='0' x='10' y='80' height='60' width='2000'  font.face='Segoe UI' font.height='-8' font.weight='600'  font.family='2' font.pitch='2' font.charset='0' background.mode='1' background.color='553648127' name=title1_t" )
//	//adw_preview.Modify("create text(band=header text='Date: " + String( Today() ) + "' border='0' color='0' x='10' y='110' height='60' width='1400'  font.face='Segoe UI' font.height='-8' font.weight='600'  font.family='2' font.pitch='2' font.charset='0' background.mode='1' background.color='553648127' name=title2_t" )
//	adw_preview.Modify("create text(band=header text='Filter: " + is_filter + "' border='0' color='0' x='10' y='145' height='60' width='1400'  font.face='Segoe UI' font.height='-8' font.weight='600'  font.family='2' font.pitch='2' font.charset='0' background.mode='1' background.color='553648127' name=title3_t" )
//ELSE
//-----End Commented -----------------------------------
adw_preview.Modify("create text(band=header text='Report: " + ls_title +"' border='0' color='0' x='10' y='10' height='60' width='2000'  font.face='Segoe UI' font.height='-8' font.weight='600'  font.family='2' font.pitch='2' font.charset='0' background.mode='1' background.color='553648127' name=title1_t)" )
adw_preview.Modify("create text(band=header text='Date: " + String( Today() ) + "' border='0' color='0' x='10' y='80' height='60' width='1400'  font.face='Segoe UI' font.height='-8' font.weight='600'  font.family='2' font.pitch='2' font.charset='0' background.mode='1' background.color='553648127' name=title2_t)" )

//-----Begin Commented by Nova 02.04.2009---------------
//		if len(trim(is_filter))>0 then
//			adw_preview.Modify("create text(band=header text='Filter: " + is_filter + "' border='0' color='0' x='10' y='150' height='150' width='3400'  font.face='Segoe UI' font.height='-8' font.weight='600'  font.family='2' font.pitch='2' font.charset='0' background.mode='1' background.color='553648127' name=title3_t)" )
//		end if	
//END IF
//-----End Commented -----------------------------------


ls_syntax = adw_preview.Describe("DataWindow.Syntax")

Long ll_begin_pos
Long ll_end_pos
String ls_line
String ls_first_part
String ls_last_part

//***** set up grouping *****************************
//openwithparm(w_sql_msg,ls_syntax)
IF ib_group_report THEN
	//$<add> 04.29.2008 by Andy 
	//$<Reason> Fixed BugG042903
	//remove rectangles with no names from group report
	DO While (1 = 1)
		ll_begin_pos = PosA( ls_syntax, "rectangle(" ) -1
		IF ll_begin_pos < 0 THEN EXIT
		
		ls_first_part = MidA( ls_syntax, 1, ll_begin_pos )
		ll_end_pos = PosA( ls_syntax, ")", ll_begin_pos )
		ll_end_pos = ll_end_pos - ll_begin_pos +1
		ls_last_part = MidA( ls_syntax, ll_begin_pos + ll_end_pos ) //, 100000
		ls_syntax = ls_first_part + ls_last_part
	LOOP
	
	//remove default computed columns with no names from group report	
	DO While (1 = 1)
		ll_begin_pos = PosA( ls_syntax, "compute(" ) -1
		IF ll_begin_pos < 0 THEN EXIT
		
		ls_first_part = MidA( ls_syntax, 1, ll_begin_pos )
		ll_end_pos = PosA( ls_syntax, " )", ll_begin_pos )+ 3
		ll_end_pos = ll_end_pos - ll_begin_pos +1
		ls_last_part = MidA( ls_syntax, ll_begin_pos + ll_end_pos ) //, 100000
		ls_syntax = ls_first_part + ls_last_part
	LOOP
	//End add 04.29.2008
	
	/*
											//remove rectangles with no names from group report
											ll_begin_pos = Pos( ls_syntax, "rectangle(" ) -1
											ls_first_part = Mid( ls_syntax, 1, ll_begin_pos )
											ll_end_pos = Pos( ls_syntax, ")", ll_begin_pos )
											ll_end_pos = ll_end_pos - ll_begin_pos +1
											ls_last_part = Mid( ls_syntax, ll_begin_pos + ll_end_pos, 100000 )
											ls_syntax = ls_first_part + ls_last_part
											
											ll_begin_pos = Pos( ls_syntax, "rectangle(" ) -1
											ls_first_part = Mid( ls_syntax, 1, ll_begin_pos )
											ll_end_pos = Pos( ls_syntax, ")", ll_begin_pos )
											ll_end_pos = ll_end_pos - ll_begin_pos +1
											ls_last_part = Mid( ls_syntax, ll_begin_pos + ll_end_pos, 100000 )
											ls_syntax = ls_first_part + ls_last_part
											
											//remove default computed columns with no names from group report		
											ll_begin_pos = Pos( ls_syntax, "compute(" ) -1
											ls_first_part = Mid( ls_syntax, 1, ll_begin_pos )
											ll_end_pos = Pos( ls_syntax, " )", ll_begin_pos )+ 3
											ll_end_pos = ll_end_pos - ll_begin_pos +1
											ls_last_part = Mid( ls_syntax, ll_begin_pos + ll_end_pos, 100000 )
											ls_syntax = ls_first_part + ls_last_part
											
											ll_begin_pos = Pos( ls_syntax, "compute(" ) -1
											ls_first_part = Mid( ls_syntax, 1, ll_begin_pos )
											ll_end_pos = Pos( ls_syntax, " )", ll_begin_pos ) + 3
											ll_end_pos = ll_end_pos - ll_begin_pos +1
											ls_last_part = Mid( ls_syntax, ll_begin_pos + ll_end_pos, 100000 )
											ls_syntax = ls_first_part + ls_last_part	
											
											ll_begin_pos = Pos( ls_syntax, "compute(" ) -1
											IF ll_begin_pos > 0 THEN
											ls_first_part = Mid( ls_syntax, 1, ll_begin_pos )
											ll_end_pos = Pos( ls_syntax, " )", ll_begin_pos ) + 3
											ll_end_pos = ll_end_pos - ll_begin_pos +1
											ls_last_part = Mid( ls_syntax, ll_begin_pos + ll_end_pos, 100000 )
											ls_syntax = ls_first_part + ls_last_part		
											END IF
											
											ll_begin_pos = Pos( ls_syntax, "compute(" ) -1
											IF ll_begin_pos > 0 THEN	
											ls_first_part = Mid( ls_syntax, 1, ll_begin_pos )
											ll_end_pos = Pos( ls_syntax, " )", ll_begin_pos ) + 3
											ll_end_pos = ll_end_pos - ll_begin_pos +1
											ls_last_part = Mid( ls_syntax, ll_begin_pos + ll_end_pos, 100000 )
											ls_syntax = ls_first_part + ls_last_part			
											END IF
	*/
END IF

adw_preview.Create(ls_syntax)
adw_preview.SetTransObject(SQLCA)
adw_preview.InsertRow( 0 )

// //get the width of all fields together
FOR i = 1 To 100
	ls_width = adw_preview.Describe( "#" + String( i ) + ".width" )
	IF IsNumber( ls_width ) THEN
		ll_total_field_width = ll_total_field_width + Long( ls_width )
	END IF
	FOR f = 1 To li_aggregate_cnt
		IF ls_agg_fld_num[ f ] = String( i ) THEN
			ls_agg_fld_width[ f ] = ls_width
		END IF
	NEXT
NEXT

ll_total_field_width = ll_total_field_width + 100
ls_orientation = tab_1.tabpage_browse.dw_report_list.GetItemString( tab_1.tabpage_browse.dw_report_list.GetRow(), "orientation" )
IF ls_orientation = "P" And ll_total_field_width > 3500 THEN
	ll_total_field_width = 3500
ELSEIF ls_orientation = "L" And ll_total_field_width > 4500 THEN
	ll_total_field_width = 4500
END IF

//debugbreak()
IF li_aggregate_cnt > 0 THEN
	FOR i = 1 To li_aggregate_cnt
		//if there is a count or sum function at the GROUP level then put in space for calc field
		IF ls_agg_type[i] = "GL" Or ls_agg_type[i] = "GLSL" THEN
			li_grp_agg = 1
			CHOOSE CASE li_agg_cnt_1 + li_agg_sum_1 + li_agg_avg_1
				CASE 1
					adw_preview.Modify("DataWindow.trailer.1.Height='100'")
				CASE 2
					adw_preview.Modify("DataWindow.trailer.1.Height='200'")
				CASE 3
					adw_preview.Modify("DataWindow.trailer.1.Height='300'")
			END CHOOSE
		END IF
		//if there is a count or sum function at the SUMMARY level then put in space for calc field
		IF ls_agg_type[i] = "SL" Or ls_agg_type[i] = "GLSL" THEN
			li_sum_agg = 1
			CHOOSE CASE li_agg_cnt_1 + li_agg_sum_1 + li_agg_avg_1
				CASE 1
					adw_preview.Modify("DataWindow.Summary.Height='100'")
				CASE 2
					adw_preview.Modify("DataWindow.Summary.Height='200'")
				CASE 3
					adw_preview.Modify("DataWindow.Summary.Height='300'")
			END CHOOSE
		END IF
	NEXT
	
	IF li_grp_agg = 1 THEN
		IF li_agg_sum_1 = 1 THEN
			li_cnt++
			IF li_cnt = 1 THEN
				ls_retval = adw_preview.Modify('create text(band=trailer.1 alignment="0" text="Sum "border="2" color="0" x="25" y="12" height="83" width="' + String( ll_total_field_width ) + '"  name=group_sum_text  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' ) //computed field						
				ll_sum_agg_y = 22
			ELSEIF li_cnt = 2 THEN
				ls_retval = adw_preview.Modify('create text(band=trailer.1 alignment="0" text="Sum "border="2" color="0" x="25" y="98" height="83" width="' + String( ll_total_field_width ) + '"  name=group_sum_text  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' ) //computed field											
				ll_sum_agg_y = 108
			ELSE
				ls_retval = adw_preview.Modify('create text(band=trailer.1 alignment="0" text="Sum "border="2" color="0" x="25" y="185" height="83" width="' + String( ll_total_field_width ) + '"  name=group_sum_text  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' ) //computed field											
				ll_sum_agg_y = 195
			END IF
		END IF
		
		IF li_agg_cnt_1 = 1 THEN
			li_cnt++
			IF li_cnt = 1 THEN
				ls_retval = adw_preview.Modify('create text(band=trailer.1 alignment="0" text="Count "border="2" color="0" x="25" y="12" height="83" width="' + String( ll_total_field_width ) + '"  name=group_count_text  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' ) //computed field						
				ll_cnt_agg_y = 22
			ELSEIF li_cnt = 2 THEN
				ls_retval = adw_preview.Modify('create text(band=trailer.1 alignment="0" text="Count "border="2" color="0" x="25" y="98" height="83" width="' + String( ll_total_field_width ) + '"  name=group_count_text  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' ) //computed field											
				ll_cnt_agg_y = 108
			ELSE
				ls_retval = adw_preview.Modify('create text(band=trailer.1 alignment="0" text="Count "border="2" color="0" x="25" y="185" height="83" width="' + String( ll_total_field_width ) + '"  name=group_count_text  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' ) //computed field											
				ll_cnt_agg_y = 195
			END IF
		END IF
		
		IF li_agg_avg_1 = 1 THEN
			li_cnt++
			IF li_cnt = 1 THEN
				ls_retval = adw_preview.Modify('create text(band=trailer.1 alignment="0" text="Average "border="2" color="0" x="25" y="12" height="83" width="' + String( ll_total_field_width ) + '"  name=group_avg_text  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' ) //computed field						
				ll_avg_agg_y = 22
			ELSEIF li_cnt = 2 THEN
				ls_retval = adw_preview.Modify('create text(band=trailer.1 alignment="0" text="Average "border="2" color="0" x="25" y="98" height="83" width="' + String( ll_total_field_width ) + '"  name=group_avg_text  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' ) //computed field											
				ll_avg_agg_y = 108
			ELSE
				ls_retval = adw_preview.Modify('create text(band=trailer.1 alignment="0" text="Average "border="2" color="0" x="25" y="185" height="83" width="' + String( ll_total_field_width ) + '"  name=group_avg_text  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' ) //computed field											
				ll_avg_agg_y = 195
			END IF
		END IF
	END IF
	
	li_cnt = 0
	IF li_sum_agg = 1 THEN
		IF li_agg_sum_1 = 1 THEN
			li_cnt++
			IF li_cnt = 1 THEN
				ls_retval = adw_preview.Modify('create text(band=Summary alignment="0" text="Sum "border="2" color="0" x="25" y="12" height="83" width="' + String( ll_total_field_width ) + '"  name=sum_sum_text  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' ) //computed field						
				ll_sum_agg_y = 22
			ELSEIF li_cnt = 2 THEN
				ls_retval = adw_preview.Modify('create text(band=Summary alignment="0" text="Sum "border="2" color="0" x="25" y="98" height="83" width="' + String( ll_total_field_width ) + '"  name=sum_sum_text  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' ) //computed field											
				ll_sum_agg_y = 108
			ELSE
				ls_retval = adw_preview.Modify('create text(band=Summary alignment="0" text="Sum "border="2" color="0" x="25" y="185" height="83" width="' + String( ll_total_field_width ) + '"  name=sum_sum_text  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' ) //computed field											
				ll_sum_agg_y = 195
			END IF
		END IF
		
		IF li_agg_cnt_1 = 1 THEN
			
			li_cnt++
			IF li_cnt = 1 THEN
				ls_retval = adw_preview.Modify('create text(band=Summary alignment="0" text="Count "border="2" color="0" x="25" y="12" height="83" width="' + String( ll_total_field_width ) + '"  name=sum_count_text  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' ) //computed field						
				ll_cnt_agg_y = 22
			ELSEIF li_cnt = 2 THEN
				ls_retval = adw_preview.Modify('create text(band=Summary alignment="0" text="Count "border="2" color="0" x="25" y="98" height="83" width="' + String( ll_total_field_width ) + '"  name=sum_count_text  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' ) //computed field											
				ll_cnt_agg_y = 108
			ELSE
				ls_retval = adw_preview.Modify('create text(band=Summary alignment="0" text="Count "border="2" color="0" x="25" y="185" height="83" width="' + String( ll_total_field_width ) + '"  name=sum_count_text  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' ) //computed field											
				ll_cnt_agg_y = 195
			END IF
		END IF
		
		IF li_agg_avg_1 = 1 THEN
			li_cnt++
			IF li_cnt = 1 THEN
				ls_retval = adw_preview.Modify('create text(band=Summary alignment="0" text="Average "border="2" color="0" x="25" y="12" height="83" width="' + String( ll_total_field_width ) + '"  name=sum_avg_text  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' ) //computed field						
				ll_avg_agg_y = 22
			ELSEIF li_cnt = 2 THEN
				ls_retval = adw_preview.Modify('create text(band=Summary alignment="0" text="Average "border="2" color="0" x="25" y="98" height="83" width="' + String( ll_total_field_width ) + '"  name=sum_avg_text  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' ) //computed field											
				ll_avg_agg_y = 108
			ELSE
				ls_retval = adw_preview.Modify('create text(band=Summary alignment="0" text="Average "border="2" color="0" x="25" y="185" height="83" width="' + String( ll_total_field_width ) + '"  name=sum_avg_text  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' ) //computed field											
				ll_avg_agg_y = 195
			END IF
		END IF
	END IF
	
	//	messagebox("agg count", li_aggregate_cnt )
	FOR i = 1 To li_aggregate_cnt
		IF ls_agg_fld_x[i] < 100 THEN // added ls_agg_fld_x[1] < 400, hope this doesnt screw up things.
			ls_agg_fld_x[i] = ls_agg_fld_x[i] + 400
		END IF
		//--------Begin Modified by Nova 01.09.2008-----------
		// format="#,##0"--->format="#,###.00"
		//count
		If (ls_agg_type[i] = "GL" Or ls_agg_type[i] = "GLSL") And li_agg_cnt[i] = 1 THEN
			ls_retval = adw_preview.Modify('create compute(band=trailer.1 alignment="0" expression="count(#' + ls_agg_fld_num[i] + ' for group 1)"border="0" color="0" x="' + String(ls_agg_fld_x[i] ) + '" y="' + String( ll_cnt_agg_y ) + '" height="166" width="' + ls_agg_fld_width[i] + '" format="#,###.00"  name=group_count  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' )
		END IF
		If (ls_agg_type[i] = "SL" Or ls_agg_type[i] = "GLSL") And li_agg_cnt[i] = 1 THEN
			ls_retval = adw_preview.Modify('create compute(band=summary alignment="0" expression="Count(#' + ls_agg_fld_num[i] + ' for all )"border="0" color="0" x="' + String(ls_agg_fld_x[i] ) + '" y="' + String( ll_cnt_agg_y ) + '" height="166" width="' + ls_agg_fld_width[i] + '" format="#,###.00"  name=summary_count  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' )
		END IF
		
		//sum
		If (ls_agg_type[i] = "GL" Or ls_agg_type[i] = "GLSL") And li_agg_sum[i] = 1 THEN
			ls_retval = adw_preview.Modify('create compute(band=trailer.1 alignment="0" expression="sum(#' + ls_agg_fld_num[i] + ' for group 1)"border="0" color="0" x="' + String(ls_agg_fld_x[i] ) + '" y="' + String( ll_sum_agg_y ) + '" height="166" width="' + ls_agg_fld_width[i] + '" format="#,###.00"  name=group_sum  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' )
		END IF
		If (ls_agg_type[i] = "SL" Or ls_agg_type[i] = "GLSL") And li_agg_sum[i] = 1 THEN
			ls_retval = adw_preview.Modify('create compute(band=Summary alignment="0" expression="sum(#' + ls_agg_fld_num[i] + ' for all)"border="0" color="0" x="' + String(ls_agg_fld_x[i] ) + '" y="' + String( ll_sum_agg_y ) + '" height="166" width="' + ls_agg_fld_width[i] + '"  format="#,###.00"  name=summary_sum  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' )
		END IF
		
		//averge
		If (ls_agg_type[i] = "GL" Or ls_agg_type[i] = "GLSL") And li_agg_avg[i] = 1 THEN
			ls_retval = adw_preview.Modify('create compute(band=trailer.1 alignment="0" expression="Avg(#' + ls_agg_fld_num[i] + ' for group 1)"border="0" color="0" x="' + String(ls_agg_fld_x[i] ) + '" y="' + String( ll_avg_agg_y ) + '" height="166" width="' + ls_agg_fld_width[i] + '"  format="#,###.00"  name=group_avg  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' )
		END IF
		If (ls_agg_type[i] = "SL" Or ls_agg_type[i] = "GLSL") And li_agg_avg[i] = 1 THEN
			ls_retval = adw_preview.Modify('create compute(band=Summary alignment="0" expression="Avg(#' + ls_agg_fld_num[i] + ' for all)"border="0" color="0" x="' + String(ls_agg_fld_x[i] ) + '" y="' + String( ll_avg_agg_y ) + '" height="166" width="' + ls_agg_fld_width[i] + '"  format="#,###.00"  name=sumary_avg  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912")' )
		END IF
		//--------End Modified -------------------------------
	NEXT
END IF

//ls_grp_fld_nm
//ls_retval = adw_preview.Modify('create text(band=trailer.1 alignment="0" text="Calc 1 "border="0" color="0" x="25" y="30" height="166" width="1302"  name=group_1_header_text  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912"' )//computed field
//ls_retval = adw_preview.Modify('create compute(band=trailer.1 alignment="0" expression="count(#1 for group 1)"border="0" color="0" x="' + ls_agg_fld_width[i] + '"  y="11" height="166" width="' + ls_agg_fld_width[i] + '"  format="#,##0"  name=summary_count_group_1  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912"' )
//ls_retval = adw_preview.Modify('create text(band=trailer.1 alignment="0" text="Calc 2 "border="0" color="0" x="600" y="30" height="166" width="1302"  name=group_1_header_text  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912"' )//computed field
//ls_retval = adw_preview.Modify('create compute(band=trailer.1 alignment="0" expression="count(#2 for group 1 )"border="0" color="0" x="750" y="11" height="166" width="' + ls_agg_fld_width[i] + '"  format="#,##0"  name=summary_count_group_1  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912"' )
//ls_retval = adw_preview.Modify('create compute(band=Summary alignment="0" expression="count(#1 for all)"border="1" color="0" x="500" y="8" height="166" width="' + ls_agg_fld_width[i] + '"  format="#,##0"  name=summary_count_group_1  font.face="Segoe UI" font.height="-8" font.weight="400"  font.family="2" font.pitch="2" font.charset="0" background.mode="1" background.color="536870912"' )

//******************  retrieve data ********************
IF adw_preview = tab_1.tabpage_run.dw_run Or ii_with_data = 1 THEN
	adw_preview.Retrieve()
END IF
IF ib_group_report THEN
	res = adw_preview.SetSort(is_sort_synt)
	IF res < 1 THEN 
		//---------Begin Modified by (Appeon)Stephen 05.05.2014 for V142 Schedule IntelliReport--------
		//MessageBox("","Sort Error")
		inv_message.of_messagebox("","Sort Error" , true)
		//---------End Modfiied ------------------------------------------------------
	end if
	adw_preview.Sort()
	adw_preview.GroupCalc()
END IF

tab_1.tabpage_preview.st_left.BorderStyle = StyleRaised!
tab_1.tabpage_preview.st_center.BorderStyle = StyleRaised!
tab_1.tabpage_preview.st_right.BorderStyle = StyleRaised!
tab_1.tabpage_preview.st_f_left.BorderStyle = StyleRaised!
tab_1.tabpage_preview.st_f_center.BorderStyle = StyleRaised!
tab_1.tabpage_preview.st_f_right.BorderStyle = StyleRaised!

IF IsNull( tab_1.tabpage_browse.dw_report_list.GetItemNumber( tab_1.tabpage_browse.dw_report_list.GetRow(), "font_size" ) ) THEN
	ls_font = MidA( adw_preview.Describe( ls_column_name[ 1 ] + ".Font.Height" ),2,100)
	tab_1.tabpage_preview.em_font.Text = ls_font
ELSE
	ls_font = String( tab_1.tabpage_browse.dw_report_list.GetItemNumber( tab_1.tabpage_browse.dw_report_list.GetRow(), "font_size" ))
	tab_1.tabpage_preview.em_font.Text = ls_font
END IF

FOR i = 1 To ii_col_count
	adw_preview.Modify( ls_column_name[ i ] + ".Font.Face='Segoe UI'")
	adw_preview.Modify( ls_column_name[ i ] + ".Font.Height='-" + ls_font + "'")
	adw_preview.Modify( ls_label_name[ i ] + ".Font.Height='-" + ls_font + "'")
	IF adw_preview.Describe( ls_column_name[ i ] + ".coltype" ) = "datetime" THEN
		adw_preview.SetFormat( ls_column_name[ i ], "mm/dd/yyyy" )
	END IF
	ls_align = String( tab_1.tabpage_columns.dw_view_fields.GetItemNumber( i, "field_align" )	)
	adw_preview.Modify( ls_column_name[ i ] + ".alignment = '" + ls_align + "'" )
	ls_align = String( tab_1.tabpage_columns.dw_view_fields.GetItemNumber( i, "label_align" )	)
	adw_preview.Modify( ls_label_name[ i ] + ".alignment = '" + ls_align + "'" )
NEXT

IF adw_preview.Title = "" THEN
	adw_preview.Modify("DataWindow.Print.Preview=No")
ELSE
	adw_preview.Modify("DataWindow.Print.Preview=Yes")
END IF

//adw_preview.Modify("DataWindow.Print.Preview.Rulers=Yes")

//messagebox("", adw_preview.Describe("DataWindow.Syntax") )

adw_preview.Modify("DataWindow.Grid.Lines='1'" )

IF adw_preview = tab_1.tabpage_preview.dw_preview THEN
	//adw_preview.InsertRow( 0 )
END IF

//This.SetRedraw( True )

//ls_syntax = adw_preview.describe("DataWindow.Syntax")
//clipboard(ls_syntax)

RETURN 0
end function

public function integer of_report_retrieve ();//of_report_retrieve  //Start Code Change ----06.29.2011 #V11 maha  - part of user security
if ib_security = true then
	tab_1.tabpage_browse.dw_report_list.retrieve(gs_user_id)
else
	tab_1.tabpage_browse.dw_report_list.retrieve()
end if

return 1
end function

public function integer of_set_wizardtype (string as_vfieldname, long as_row);//////////////////////////////////////////////////////////////////////
// $<function> of_set_wizardtype
// $<arguments>
//						as_vfieldname string 
//						as_as_row     long
// $<returns> 1
// $<description> set wizard type when selected(especial field)
//////////////////////////////////////////////////////////////////////
// Add by Appeon: 
//        Michael 01.28.2011 V12.1 IntelliReport filtering modification
//////////////////////////////////////////////////////////////////////

Choose case lower(as_vfieldname)
	Case 'primary_office'
		tab_1.tabpage_columns.dw_view_fields.SetItem(as_row, "field_wizard_name", "Address Type")
		tab_1.tabpage_columns.dw_view_fields.SetItem(as_row, "field_wizard_type", "L" )
		tab_1.tabpage_columns.dw_view_fields.SetItem(as_row,'field_options',"D")
	case 'action_type_code'
		tab_1.tabpage_columns.dw_view_fields.SetItem(as_row, "field_wizard_name","Action/Status")
		tab_1.tabpage_columns.dw_view_fields.SetItem(as_row, "field_wizard_type", "N" )
		tab_1.tabpage_columns.dw_view_fields.SetItem(as_row,'field_options',"D")
	case 'prac_id'
		tab_1.tabpage_columns.dw_view_fields.SetItem(as_row,"field_wizard_name",'Practitioner')
		tab_1.tabpage_columns.dw_view_fields.SetItem(as_row, "field_wizard_type", "X" )
		tab_1.tabpage_columns.dw_view_fields.SetItem(as_row,'field_options',"D")
	//case 'facility_name'
	case 'facility_name', 'parent_facility_name', 'verifying_facility_name' //Alpha Test 2967 - alfee 04.06.2012
		tab_1.tabpage_columns.dw_view_fields.SetItem(as_row, "field_wizard_name",'Facility')
		tab_1.tabpage_columns.dw_view_fields.SetItem(as_row, "field_wizard_type", "F" )
		tab_1.tabpage_columns.dw_view_fields.SetItem(as_row,'field_options',"D")
	case 'gp_loc_name'		
		tab_1.tabpage_columns.dw_view_fields.SetItem(as_row,"field_wizard_name",'Practice Locations')
		tab_1.tabpage_columns.dw_view_fields.SetItem(as_row, "field_wizard_type", "Y" )
		tab_1.tabpage_columns.dw_view_fields.SetItem(as_row,'field_options',"D")
	case 'application_name'					
		tab_1.tabpage_columns.dw_view_fields.SetItem(as_row,"field_wizard_name",'Application / Payor')
		tab_1.tabpage_columns.dw_view_fields.SetItem(as_row, "field_wizard_type", "P" )
		tab_1.tabpage_columns.dw_view_fields.SetItem(as_row,'field_options',"D")
	case 'affiliation_status'	//Alpha Test 2967 - alfee 04.06.2012			
		tab_1.tabpage_columns.dw_view_fields.SetItem(as_row,"field_wizard_name",'Affiliation Status')
		tab_1.tabpage_columns.dw_view_fields.SetItem(as_row, "field_wizard_type", "C" )
		tab_1.tabpage_columns.dw_view_fields.SetItem(as_row,'field_options',"C")
end choose


return 1
end function

public subroutine of_get_filter_status ();//////////////////////////////////////////////////////////////////////
// $<function>w_report::of_get_filter_status()
// $<arguments>(None)
// $<description>
// $<description> Get access filter status.
//////////////////////////////////////////////////////////////////////
// $<add> 2009-04-21 by Ken.Guo
//(Appeon)Toney 06.11.2013 - V141 ISG-CLX
//////////////////////////////////////////////////////////////////////

Integer li_except_reports,li_except_current_user

gnv_appeondb.of_startqueue( )
	Select reports_use_access Into :li_except_reports From icred_settings;
	Select count(1) Into :li_except_current_user From 
	(
		Select user_id from reports_except_users where user_id = :gs_user_id
		Union
		Select user_id from reports_except_roles,security_users
		Where reports_except_roles.roles_id = security_users.role_id and security_users.user_id = :gs_user_id
	) users;
gnv_appeondb.of_commitqueue( )

If li_except_reports = 0 or li_except_current_user > 0 Then
	ib_access_filter = False
Else
	ib_access_filter = True
End If

end subroutine

public function boolean wf_check_link_column ();//====================================================================
// Function: wf_check_link_column
//--------------------------------------------------------------------
// Description:
//--------------------------------------------------------------------
// Arguments:
//--------------------------------------------------------------------
// Returns:  boolean
//--------------------------------------------------------------------
// Author:	Mark Lee		Date: 06/04/12
//--------------------------------------------------------------------
//	Copyright (c) 2008-2012 Contract Logix,Inc. All rights reserved.
//--------------------------------------------------------------------
// Modify History:
//(Appeon)Toney 06.11.2013 - V141 ISG-CLX
//====================================================================
long 		ll_rowcount, i 
String 	ls_FtblNm,	ls_TtblNm,	ls_link_from_field,	ls_link_to_field, ls_msg, ls_msg_column
Boolean	lbn_notice = False,	lbn_retrieve = False
Integer	li_cnt

ll_rowcount = tab_1.tabpage_tables.dw_view_links.RowCount()
If ll_rowcount > 0 Then
	FOR i = 1 TO ll_rowcount
		ls_FtblNm = tab_1.tabpage_tables.dw_view_links.GetItemString( i, "link_from_table_nm" )
		ls_TtblNm = tab_1.tabpage_tables.dw_view_links.GetItemString( i, "link_to_table_nm" )
		
		ls_link_from_field = tab_1.tabpage_tables.dw_view_links.GetItemString( i, "link_from_field_nm" )
		ls_link_to_field = tab_1.tabpage_tables.dw_view_links.GetItemString( i, "link_to_field_nm" )
		If lower(ls_FtblNm) = 'v_ctx_multi_header' and lower(ls_TtblNm) = 'v_ctx_multi_detail' then
			If not isnull(ls_link_from_field) and trim(ls_link_from_field) <> '' and lower(ls_link_from_field ) <> 'hdr_id' Then 
				lbn_notice = True
				ls_msg_column = ls_link_from_field
			End If
			IF not isnull(ls_link_to_field) and trim(ls_link_to_field) <> '' and lower(ls_link_to_field ) <> 'hdr_id' Then 
				lbn_notice = True
				ls_msg_column = ls_link_to_field
			End If 
		ElseIf lower(ls_FtblNm) = 'v_ctx_multi_detail' and lower(ls_TtblNm) = 'v_ctx_multi_header' then
			If not isnull(ls_link_from_field) and trim(ls_link_from_field) <> '' and lower(ls_link_from_field ) <> 'hdr_id' Then 
				lbn_notice = True
				ls_msg_column = ls_link_from_field
			End If
			IF not isnull(ls_link_to_field) and trim(ls_link_to_field) <> '' and lower(ls_link_to_field ) <> 'hdr_id' Then 
				lbn_notice = True
				ls_msg_column = ls_link_to_field
			End If 
		End if	
		If lbn_notice = True and  lbn_retrieve = False Then
			ls_msg = "You cannot use column "+ls_msg_column+" to link between table Contract Multi Header and table Contract Multi Detail.~r~nPlease use column Hdr Id instead."
			ls_msg +="~r~n~r~nDo you want to use column Hdr Id to link the two tables?"
			li_cnt = MessageBox("IntelliContract",ls_msg, Question!, YesNo!)			
			If li_cnt = 1 THen 
				tab_1.tabpage_tables.dw_view_links.SetItem( i, "link_from_field_nm",  "hdr_id")
				tab_1.tabpage_tables.dw_view_links.SetItem( i, "link_to_field_nm", "hdr_id")	
				lbn_notice = False
				lbn_retrieve = True
			Else
				Exit
			End If
		ElseIF lbn_notice = True and  lbn_retrieve = True Then
			tab_1.tabpage_tables.dw_view_links.SetItem( i, "link_from_field_nm",  "hdr_id")
			tab_1.tabpage_tables.dw_view_links.SetItem( i, "link_to_field_nm", "hdr_id")	
			lbn_notice = False
		End IF
	Next 
End IF

Return lbn_retrieve
end function

public function string of_build_ctx_access_sql (string as_table_col);//////////////////////////////////////////////////////////////////////
// $<function>w_custom_reportof_build_ctx_access_sql()
// $<arguments>(None)
// $<returns> (none)
// $<description>
// $<description> Build inner SQL to filter CTX data by access.
//////////////////////////////////////////////////////////////////////
// $<add> 02.17.2009 by Ken.Guo
//(Appeon)Toney 06.13.2013 - V141 ISG-CLX
//////////////////////////////////////////////////////////////////////
String ls_ctx_access_inner_sql
ls_ctx_access_inner_sql = &
"~r~nInner Join~r~n" + &
"(~r~n" + &
"	SELECT DISTINCT TOP 100 Percent  ctx_id = ctx_contract_contacts.ctx_id, user_id = ctx_contacts.user_d, access = (CASE ctx_contract_contacts.owner WHEN 'Y' THEN 'F' ELSE ctx_contract_contacts.access END)~r~n" + &
"	FROM ctx_contract_contacts Left Outer Join~r~n" + &
"	(~r~n" + &
"	Select ctx_contract_contacts1.ctx_id,ctx_contacts1.user_d ~r~n" + &
"	From ctx_contract_contacts ctx_contract_contacts1 ,ctx_contacts ctx_contacts1~r~n" + &
"	Where ctx_contract_contacts1.contact_id = ctx_contacts1.contact_id And ctx_contacts1.user_d = '"+gs_user_id+"'~r~n" + &
"	Group By ctx_contract_contacts1.ctx_id,ctx_contacts1.user_d~r~n" + &
"	Having Count(ctx_contract_contacts1.ctx_id) > 1~r~n" + &
"	) ccc~r~n" + &
"	On ctx_contract_contacts.ctx_id = ccc.ctx_id~r~n" + &
"	,ctx_contacts~r~n" + &
"	WHERE ctx_contacts.user_d = '"+gs_user_id+"'~r~n" + &
"		AND (ccc.ctx_id is null or ctx_contract_contacts.access = 'F' )~r~n" + &
"		AND ctx_contract_contacts.contact_id = ctx_contacts.contact_id ~r~n" + &
"		AND ( ctx_contract_contacts.access IN ('F','R') ~r~n" + &
"		OR ctx_contract_contacts.owner = 'Y' )~r~n" + &
"		AND ctx_contract_contacts.ic_area = 'I'~r~n" + &
"	~r~n" + &
"	UNION ~r~n" + &
"	~r~n" + &
"SELECT DISTINCT TOP 100 Percent ctx_id = ctx_group_access.ctx_id,user_id = security_group_users.user_id, access =  ctx_group_access.access~r~n" + &
"FROM ~r~n" + &
"ctx_group_access ,~r~n" + &
"security_group_users,~r~n" + &
"icred_settings~r~n" + &
"WHERE	security_group_users.user_id = '"+gs_user_id+"'~r~n" + &
"	AND ctx_group_access.group_id = security_group_users.group_id~r~n" + &
"	AND ctx_group_access.access = ~r~n" + &
"		(Case When Exists (Select u1.user_id,a1.ctx_id,a1.access ~r~n" + &
"		From ctx_group_access a1,security_group_users u1~r~n" + &
"		Where a1.group_id = u1.group_id ~r~n" + &
"		And a1.ctx_id = ctx_group_access.ctx_id~r~n" + &
"		And u1.user_id = security_group_users.user_id	~r~n" + &
"		And a1.access = 'F') Then 'F' Else 'R' End) ~r~n" + &
"	AND icred_settings.group_access = 1~r~n" + &
"	AND ctx_group_access.access in ('F','R')~r~n" + &
"	AND NOT EXISTS	(SELECT 1 FROM ctx_contract_contacts, ctx_contacts  ~r~n" + &
"			WHERE ( ctx_contacts.contact_id = ctx_contract_contacts.contact_id ) ~r~n" + &
"			AND ( ctx_contacts.user_d = security_group_users.user_id )~r~n" + &
"			AND ( ctx_contract_contacts.ic_area = 'I' )~r~n" + &
"			AND ( ctx_contract_contacts.ctx_id = ctx_group_access.ctx_id )~r~n" + &
"			)~r~n" + &
"	~r~n" + &
"	UNION~r~n" + &
"	~r~n" + &
"	SELECT DISTINCT TOP 100 Percent ctx_id = ctx_basic_info.ctx_id, user_id = security_users.user_id, access = (CASE ctx_acp_contract_management_right.rights WHEN '11' THEN 'F' WHEN '12' THEN 'R' ELSE 'N' END)~r~n" + &
"	FROM ctx_acp_contract_management_right, security_users, ctx_basic_info~r~n" + &
"	WHERE security_users.user_id = '"+gs_user_id+"'~r~n" + &
"		AND ctx_acp_contract_management_right.types = 1~r~n" + &
"		AND ctx_acp_contract_management_right.role_id = security_users.role_id~r~n" + &
"		AND ctx_acp_contract_management_right.category = ctx_basic_info.category~r~n" + &
"		And ctx_basic_info.is_template = 0 ~r~n" + &
"		AND ctx_acp_contract_management_right.rights In ('11','12')~r~n" + &
"		AND NOT EXISTS (SELECT 1 FROM ctx_contract_contacts, ctx_contacts  ~r~n" + &
"				WHERE ( ctx_contacts.contact_id = ctx_contract_contacts.contact_id ) ~r~n" + &
"				AND ( ctx_contacts.user_d = security_users.user_id AND ctx_contract_contacts.ic_area = 'I') ~r~n" + &
"				AND ( ctx_contract_contacts.ctx_id = ctx_basic_info.ctx_id ) ~r~n" + &
"				UNION~r~n" + &
"				SELECT 1 FROM ctx_group_access,security_group_users,icred_settings~r~n" + &
"				WHERE icred_settings.group_access = 1~r~n" + &
"				AND (ctx_group_access.group_id = security_group_users.group_id )~r~n" + &
"				AND ( security_group_users.user_id = security_users.user_id )	~r~n" + &
"				AND ( ctx_group_access.ctx_id = ctx_basic_info.ctx_id )~r~n" + &
"				)~r~n" + &
") t_ctx_access~r~n" + &
"On ( "+as_table_col+" = t_ctx_access.ctx_id ) "

Return ls_ctx_access_inner_sql
end function

public function string of_filter_template_ctx (string as_table_col);//////////////////////////////////////////////////////////////////////
// $<function>w_custom_report::of_filter_template_ctx()
// $<arguments>
//		value	string	as_table_col		
// $<returns> string
// $<description> Filter template data from ctx_basic_info table.
// $<description>
//////////////////////////////////////////////////////////////////////
// $<add> 2009-08-25 by Ken.Guo
//(Appeon)Toney 06.13.2013 - V141 ISG-CLX
//////////////////////////////////////////////////////////////////////

String ls_sql
ls_sql = '~r~nInner Join ctx_basic_info ctx_basic_info_filter_template ' + &
' On '+ as_table_col +' = ctx_basic_info_filter_template.ctx_id and ctx_basic_info_filter_template.is_template = 0'


Return ls_sql
end function

public subroutine of_setobjectenabled (boolean ab_value);//====================================================================
// Function: of_SetObjectEnabled()
//--------------------------------------------------------------------
// Description:
//--------------------------------------------------------------------
// Arguments:
// 	value    boolean    ab_Value
//--------------------------------------------------------------------
// Returns:  (None)
//--------------------------------------------------------------------
// Author:	Scofield		Date: 2009-04-27
//--------------------------------------------------------------------
//	Copyright (c) 1999-2009 Contractlogix, All rights reserved.
//--------------------------------------------------------------------
// Modify History:
//(Appeon)Toney 06.13.2013 - V141 ISG-CLX
//====================================================================

tab_1.tabpage_preview.cb_7.Enabled = ab_Value
//tab_1.tabpage_preview.cb_23.Enabled = ab_Value
tab_1.tabpage_preview.cb_advanced_screen.enabled = ab_Value

end subroutine

public function integer of_checkselectcontent (string as_content, string as_codename, string as_operator);//====================================================================
//$<Function>: of_checkselectcontent
//$<Arguments>:
// 	value    string    as_content
// 	value    string    as_codename
// 	value    string    as_operator
//$<Return>:  integer
//$<Description>: 
//$<Author>: (Appeon) Toney 06.13.2013 (V141 ISG-CLX)
//--------------------------------------------------------------------
//$<Modify History>:
//====================================================================
//check  return select content  if multi  it is in   , one is equal 
//
Integer			li_Pos = 0

If as_codename = 'code' Then
	do while  pos( as_content, ',' ) > 0 
		li_pos ++
		as_content = mid( as_content, Pos( as_content, ',' ) + 1 )
		If li_Pos > 1 Then Exit
	loop 	
Else
	If  pos( as_content, "','" ) > 0 Then
		li_Pos = 2
	Else
		li_Pos ++
	End If
			
End If

If as_operator <> 'in'  and li_Pos > 1 Then
	If MessageBox( 'Tips', 'You have selected multiple values. The Operator will be changed into In List. Do you want to change it? ' , question!, yesno!, 1 ) = 1 Then
		Return 2
	Else
		Return 0
	End If
Else
	Return 1
End If
end function

public function string of_get_lookupdesc_multi (string as_lookup_code);//====================================================================
//$<Function>: of_get_lookupdesc_multi
//$<Arguments>:
// 	value    string    as_lookup_code
//$<Return>:  string
//$<Description>: 
//$<Author>: (Appeon) Toney 06.13.2013 (V141 ISG-CLX)
//--------------------------------------------------------------------
//$<Modify History>:
//====================================================================
Long 		ll_Cycle, ll_cnt
string 	ls_desc, ls_temp, ls_lookupcode[]

n_cst_string lnv_string

IF IsNull(as_lookup_code) OR LEN(TRIM(as_lookup_code)) < 1 THEN RETURN ""

lnv_string.of_parsetoarray(as_lookup_code, ",", ls_lookupcode)

FOR ll_Cycle = 1 to UpperBound(ls_lookupcode)
	ls_temp = gnv_data.of_GetItem("code_lookup","code","lookup_code = " + ls_lookupcode[ll_Cycle])
	IF IsNull(ls_temp) OR Len(Trim(ls_temp)) < 1 THEN CONTINUE
	IF Len(Trim(ls_desc)) < 1 THEN
		ls_desc = "'" + ls_temp + "'"
	ELSE
		ls_desc += ", '" + ls_temp + "'"
	END IF
NEXT

RETURN ls_desc

end function

public function integer of_run_report (long al_report_id, string as_output_file, string as_error);// (Appeon)Harry 01.24.2014 - V142 ISG-CLX Copy from CLX12.0
u_dw ldw_report_list
Long ll_row, ll_cnt, ll_ret
String ls_report_name, ls_file_ext

tab_1.SelectTab(1)
ldw_report_list = tab_1.tabpage_browse.dw_report_list

as_error = ''

//Check exists
ll_row = ldw_report_list.Find('view_id = ' + String(al_report_id), 1, ldw_report_list.RowCount())
If ll_row <= 0 Then
	as_error = 'Auto Report Error -1. The report does not exist. report_id = ' + String(al_report_id) + '.'
	gnv_debug.of_output(True, as_error)
	Return -1
End If
 
ls_report_name = ldw_report_list.GetItemString(ll_row,'view_name')

//Check Filter By column exists
Select Count(1) Into :ll_cnt From conv_view_fields Where view_id = :al_report_id And filter_by_field = 1;
If ll_cnt > 0 Then
	as_error = 'Auto Report Error -2. The report has Filter Wizard fields, and they are not supported.  Report_id: ' + String(al_report_id) + ', report_name: '+ls_report_name+'.'
	gnv_debug.of_output(True, as_error)
	Return -2
End If
 
//Run Report
ldw_report_list.SetRow(ll_row)
ldw_report_list.ScrollToRow(ll_row)
ldw_report_list.event doubleclicked( 0, 0, ll_row,ldw_report_list.object.view_name)

//Output Data
If tab_1.SelectedTab <> 7 Then
	as_error = 'Auto Report Error -3. Failed to run the report, the current selected tabpage is '+String(tab_1.SelectedTab)+'. report_id = ' + String(al_report_id) + ', report_name = '+ls_report_name+'.'
	gnv_debug.of_output(True, as_error)
	Return -3	
End If
ll_ret = tab_1.tabpage_run.dw_run.of_save_as_pdf( as_output_file, as_error)
If ll_ret < 0 Then
	gnv_debug.of_output(True, as_error)
	Return -1
End If

Return 1

end function

public function integer of_sched_savefile (u_dw adw_report, string as_filepath);//====================================================================
//$<Function>: of_sched_savefile
//$<Arguments>:
// 	%ScriptArgs%
//$<Return>:  integer
//$<Description>: 
//$<Author>: (Appeon) Stephen 04.23.2014 (V142 Schedule IntelliReport)
//--------------------------------------------------------------------
//$<Modify History>:
//====================================================================
string ls_Null
string ls_FileName
integer li_ret
appeon_pdfservice lnv_pdf

li_ret = 1
// Save as PDF file
if lower(right(as_filepath, 4)) <> ".pdf" then
	ls_FileName = as_filepath + ".pdf"
end if
if FileExists(ls_FileName) then 
	if not FileDelete(ls_FileName) then return -1
end if

lnv_pdf = Create appeon_pdfservice
lnv_pdf.of_set_schedule(ib_sche)
if lnv_pdf.of_print(tab_1.tabpage_run.dw_run, ls_FileName) = -1 then	
	li_ret = -1
end if
Destroy lnv_pdf

return li_ret
end function

public function integer of_sched_run (long al_report_id, string as_filepath, ref string as_message);//====================================================================
//$<Function>: of_sched_run
//$<Arguments>:
// 	%ScriptArgs%
//$<Return>:  integer
//$<Description>: 
//$<Author>: (Appeon) Stephen 04.22.2014 (V142 Schedule IntelliReport)
//--------------------------------------------------------------------
//$<Modify History>:
//====================================================================
long ll_find

ib_run_sucess = true
ib_sche = true
IF Isvalid(inv_message) THEN
	inv_message.of_set_schedule(ib_sche)		
END IF

ll_find = tab_1.tabpage_browse.dw_report_list.find("view_id = "+string(al_report_id), 1, tab_1.tabpage_browse.dw_report_list.rowcount())
if ll_find < 1 then 
	as_message = "The report(id="+string(al_report_id) +") has not been found. "
	return -1
end if

tab_1.tabpage_browse.cbx_goto.checked = true
tab_1.tabpage_browse.dw_report_list.setrow(ll_find)
tab_1.tabpage_browse.cb_select.TriggerEvent( Clicked! )
as_message = is_run_error	
if ib_run_sucess then
	if of_sched_savefile(tab_1.tabpage_run.dw_run, as_filepath) = -1 then
		as_message = "Failed to save the report(id =" +string(al_report_id) + ")."
		return -1		
	end if
else
	return -1
end if

return 1
end function

public function string of_get_field_type (string as_v_name, string as_c_name);//====================================================================
//$<Function>: of_get_field_type
//$<Arguments>:
// 	%ScriptArgs%
//$<Return>:  string
//$<Description>: 
//$<Author>: (Appeon) Stephen 05.12.2014 (IntelliReport Modifications 14.2)
//--------------------------------------------------------------------
//$<Modify History>:
//====================================================================

string ls_field_type

IF gs_DBType = 'SQL' THEN
	SELECT CASE c.name
				WHEN 'int'      THEN 'N'
				WHEN 'float'    THEN 'N'
				WHEN 'smallint' THEN 'N'
				WHEN 'money'    THEN 'N'
				WHEN 'real'     THEN 'N'
				WHEN 'decimal'  THEN 'N'
				WHEN 'tinyint'  THEN 'N'
				WHEN 'numeric'  THEN 'N'
				WHEN 'bit'      THEN 'N'
				WHEN 'char'     THEN 'C'
				WHEN 'nvarchar' THEN 'C'
				WHEN 'varchar'  THEN 'C'
				WHEN 'text'     THEN 'C'
				WHEN 'datetime' THEN 'D'
			 END INTO :ls_field_type
	FROM sysobjects a 
	INNER JOIN syscolumns b ON (a.id = b.id) 
	INNER JOIN systypes c ON (b.xtype = c.xtype) 
	WHERE a.name = :as_v_name and b.name = :as_c_name;
ELSE
	SELECT CASE b.coltype
				WHEN 'integer'   THEN 'N'
				WHEN 'float'     THEN 'N'
				WHEN 'smallint'  THEN 'N'
				WHEN 'money'     THEN 'N'
				WHEN 'real'      THEN 'N'
				WHEN 'decimal'   THEN 'N'
				WHEN 'tinyint'   THEN 'N'
				WHEN 'numeric'   THEN 'N'
				WHEN 'bit'       THEN 'N'
				WHEN 'char'      THEN 'C'
				WHEN 'nvarchar'  THEN 'C'
				WHEN 'varchar'   THEN 'C'
				WHEN 'long varchar' THEN 'C'
				WHEN 'timestamp' THEN 'D'
				WHEN 'date'      THEN 'D'
				WHEN 'time'      THEN 'D'
			END INTO :ls_field_type 
	FROM sys.syscolumns b
	WHERE b.tname = :as_v_name and b.cname = :as_c_name;	
END IF
if isnull(ls_field_type)	then ls_field_type = ''	
return ls_field_type
end function

public function long of_get_lookup_data (string as_v_name, string as_c_name, ref string as_display, ref string as_lookup_type, ref string as_lookup_name);//====================================================================
// Event: w_custom_report.of_get_lookup_data()
//--------------------------------------------------------------------
// Description:Automatic find Code Lookup Display Field
//             (Only support Code, Adress type)
//--------------------------------------------------------------------
// Arguments:
// 	value    	string	as_v_name 
//    value       string   as_c_name
// 	reference	string	as_Display    	
// 	reference	string	as_lookup_type	
// 	reference	string	as_lookup_name	
//--------------------------------------------------------------------
// Returns:  long    1:Success/0:No Code Lookup
//--------------------------------------------------------------------
// Author:	Andy		Date: Mar 28,2008
//--------------------------------------------------------------------
//	
//--------------------------------------------------------------------
// Modify History:
//
//==================================================================== 
Long    ll_Cnt,ll_i,ll_dsCnt,ll_j,ll_Find
Boolean lb_Flag 
String  ls_DddwName
Long    ll_fCnt
string ls_db_fieldname //add Michael 28.11.2011 

ll_Cnt = UPPERBOUND(istr_ds)
FOR ll_i = 1 to ll_Cnt
	IF istr_ds[ll_i].ls_v_name = as_v_name then
		lb_Flag = true
		exit
	end if
NEXT
if lb_Flag then
	ll_dsCnt = UPPERBOUND(istr_ds[ll_i].lds)
	FOR ll_j = 1 to ll_dsCnt
		ls_DddwName = istr_ds[ll_i].lds[ll_j].describe(as_c_name + ".dddw.Name")
		if Lower(ls_DddwName) = "d_dddw_code_lookup" then
			as_Display = istr_ds[ll_i].lds[ll_j].describe(as_c_name + ".dddw.DisplayColumn")
			as_lookup_type = "C"
			as_lookup_name = istr_ds[ll_i].lds[ll_j].describe(as_c_name + ".tag")
			Exit
		end if					
	NEXT				
	if il_module = 2 and IsNumber(istr_ds[ll_i].ls_screen) then
		inv_data_entry.ids_screen_fields.SetFilter( "view_id = " + String (il_data_view_id) + " AND screen_id = " + istr_ds[ll_i].ls_screen )
		if lower(as_v_name) = 'v_basic' then
			inv_data_entry.ids_screen_fields.SetFilter( "view_id = " + String (il_data_view_id) + " AND screen_id in (1,27)")	//Alpha Test 2967  - alfee 04.09.2011	
		end if				
		inv_data_entry.ids_screen_fields.Filter( )	
		
		//------------------- APPEON BEGIN -------------------
		//$<add> Michael 28.11.2011
		//$<reason> V12.1 IntelliReport filtering modification
		select field_name into :ls_db_fieldname from view_fields_alias 
		where data_view_id = :il_data_view_id and v_name = :as_v_name and c_name = :as_c_name;
		if not isnull(ls_db_fieldname) then as_c_name = ls_db_fieldname
		//------------------- APPEON END ---------------------
		
		ll_fCnt = inv_data_entry.ids_screen_fields.RowCount()
		ll_Find = inv_data_entry.ids_screen_fields.find( "db_field_name='" + as_c_name + "'", 0, ll_fCnt)
		if ll_Find > 0 then
			as_lookup_type = inv_data_entry.ids_screen_fields.getitemstring(ll_Find,"lookup_type")
			if (as_lookup_type = "C" or as_lookup_type = "A") and &
				inv_data_entry.ids_screen_fields.getitemstring(ll_Find,"lookup_field") = "Y" then
				as_Display = inv_data_entry.ids_screen_fields.getitemstring(ll_Find,"lookup_field_name")
				as_lookup_name = inv_data_entry.ids_screen_fields.getitemstring(ll_Find,"lookup_code")
			end if
		end if
	end if
end if

if LenA(as_Display) > 0 then
	RETURN 1
ELSE
	RETURN 0
end if

end function

public function integer of_link_cred_cont (datawindow adw_tables);//====================================================================
//$<Function>: of_link_cred_cont
//$<Arguments>:
// 	%ScriptArgs%
//$<Return>:  integer
//$<Description>: 
//$<Author>: (Appeon) Stephen 05.12.2014 (IntelliReport Modifications 14.2)
//--------------------------------------------------------------------
//$<Modify History>:
//====================================================================
long ll_row, ll_cnt
long ll_module, ll_cred_cnt
long ll_tid, ll_handle
integer li_ans, li_nr
string ls_table_name
boolean lb_v_link, lb_link_cred
treeviewitem ltvi_item

lb_v_link = false
ll_cnt = 0
ll_cred_cnt = 0
for ll_row = 1 to adw_tables.rowcount()
	ls_table_name = adw_tables.GetItemString( ll_row, "table_name" )
	//---------Begin Modified by (Appeon)Stephen 08.05.2014 for BugH071601--------
	/*if Upper( LeftA( ls_table_name, 5 ) ) = "V_CTX" then
		ll_cnt += 1
	end if
	*/
	if of_check_viewid(ls_table_name) = 1 then continue		
	ll_module = of_get_module(ls_table_name)
	if  ll_module = 1 then
		ll_cnt += 1
	elseif ll_module = 2 then
		ll_cred_cnt += 1
	end if
	//---------End Modfiied ------------------------------------------------------		
	if lower(ls_table_name) = 'v_ctx_prac_link' then
		lb_v_link = true
		exit
	end if
next

if ll_cnt > 0 and ll_cred_cnt > 0 and lb_v_link = false then
	li_ans = MessageBox( "Table Selection", "To use both contracts and provider tables you must have the Provider-Contract link selected also. Would you like to add this now?", question!, YesNo!, 1 )
	if li_ans = 1 then
		li_nr = tab_1.tabpage_tables.dw_view_tables.InsertRow( 0 )			
		SELECT id
		INTO :ll_tid
		FROM dbo.sysobjects
		WHERE name = 'v_ctx_prac_link' ;
		tab_1.tabpage_tables.dw_view_tables.SetItem( li_nr, "table_name", "v_ctx_prac_link" )			
		tab_1.tabpage_tables.dw_view_tables.SetItem( li_nr, "conv_view_table_table_name", "v_ctx_prac_link" )			
		tab_1.tabpage_tables.dw_view_tables.SetItem( li_nr, "cust_table_name", ll_tid )
		tab_1.tabpage_tables.dw_view_tables.SetItem( li_nr, "view_id", il_view_id )
		tab_1.tabpage_tables.dw_view_tables.SetItem( li_nr, "project_id", ii_project_id )			
		il_next_table_id = gnv_app.of_get_irep_id("conv_view_table", 1) 
		tab_1.tabpage_tables.dw_view_tables.SetItem( li_nr, "table_id", il_next_table_id )			
		
		ll_handle = tab_1.tabpage_tables.tv_tables.of_finditem(2,'v_ctx_prac_link','')
		if ll_handle > 0 then 			
			if tab_1.tabpage_tables.tv_tables.GetItem(ll_handle,ltvi_item) = 1 then
				ltvi_item.pictureindex = 6
				ltvi_item.SelectedPictureIndex = 6
				tab_1.tabpage_tables.tv_tables.SetItem(ll_handle,ltvi_item)
			end if
		end if
		lb_v_link = true
	else
		return -1
	end if	
end if
if lb_v_link = false then return 1

lb_v_link = false
lb_link_cred = false

for ll_row = 1 to adw_tables.rowcount()
	if lb_v_link = true and lb_link_cred = true then exit
	ls_table_name = adw_tables.GetItemString( ll_row, "table_name" )
	if lower(ls_table_name) = "v_ctx_prac_link" then continue
	ll_module = of_get_module(ls_table_name)  //(Appeon)Stephen 08.05.2014 - bug BugH071502
	if ll_module = 1 then
		//link to contractor
		if lb_v_link = true then continue
		if of_check_viewid(ls_table_name) = 1 then continue
		tab_1.tabpage_tables.cb_view_add_link.TriggerEvent( Clicked! )
		tab_1.tabpage_tables.dw_view_links.SetItem( ii_nr, "link_type", "=" )				
		tab_1.tabpage_tables.dw_view_links.SetItem( ii_nr, "link_from_table_nm", ls_table_name )				
		tab_1.tabpage_tables.dw_view_links.SetItem( ii_nr, "link_from_field_nm", "Ctx_id" )			
		tab_1.tabpage_tables.dw_view_links.SetItem( ii_nr, "link_to_table_nm", "v_ctx_prac_link" )				
		tab_1.tabpage_tables.dw_view_links.SetItem( ii_nr, "link_to_field_nm", "Ctx_id" )	
		lb_v_link = true
	else
		//link to cred
		if lb_link_cred = true then continue		
		if ll_module <> 2 then continue //(Appeon)Stephen 08.05.2014 - bug BugH071502
		
		tab_1.tabpage_tables.cb_view_add_link.TriggerEvent( Clicked! )
		tab_1.tabpage_tables.dw_view_links.SetItem( ii_nr, "link_type", "=" )				
		tab_1.tabpage_tables.dw_view_links.SetItem( ii_nr, "link_from_table_nm", ls_table_name )				
		tab_1.tabpage_tables.dw_view_links.SetItem( ii_nr, "link_from_field_nm", "prac_id" )			
		tab_1.tabpage_tables.dw_view_links.SetItem( ii_nr, "link_to_table_nm", "v_ctx_prac_link" )				
		tab_1.tabpage_tables.dw_view_links.SetItem( ii_nr, "link_to_field_nm", "prac_id" )	
		lb_link_cred = true
	end if
next
	

return 1
end function

public function integer of_drag_order (long al_row);//====================================================================
//$<Function>: of_drag_order
//$<Arguments>:
// 	%ScriptArgs%
//$<Return>:  integer
//$<Description>: 
//$<Author>: (Appeon) Stephen 05.14.2014 (IntelliReport Modifications 14.2)
//--------------------------------------------------------------------
//$<Modify History>:
//====================================================================
integer li_row
if al_row < ii_drag_start then
	tab_1.tabpage_columns.dw_view_fields.setitem(ii_drag_start, "field_order", al_row*10)
	for li_row = al_row to ii_drag_start - 1
		tab_1.tabpage_columns.dw_view_fields.setitem(li_row, "field_order", (li_row +1)*10)
	next
else
	tab_1.tabpage_columns.dw_view_fields.setitem(ii_drag_start, "field_order", al_row*10)
	for li_row = ii_drag_start +1 to al_row 
		tab_1.tabpage_columns.dw_view_fields.setitem(li_row, "field_order", (li_row -1)*10)
	next
end if

tab_1.tabpage_columns.dw_view_fields.setsort("field_order A")
tab_1.tabpage_columns.dw_view_fields.sort()
return 1
end function

public function integer of_export_report (u_dw adw_report);//====================================================================
//$<Function>: of_export_report
//$<Arguments>:
// 	%ScriptArgs%
//$<Return>:  integer
//$<Description>: 
//$<Author>: (Appeon) Stephen 05.15.2014 (IntelliReport Modifications 14.2)
//--------------------------------------------------------------------
//$<Modify History>:
//====================================================================
long ll_row
integer li_autosave,  li_export_format
string ls_export_file
string ls_report_name

ll_row = tab_1.tabpage_browse.dw_report_list.getrow()
if ll_row < 1 then return 1
li_autosave = tab_1.tabpage_browse.dw_report_list.getitemnumber(ll_row, "auto_save")
//---------Begin Modified by (Appeon)Stephen 10.20.2014 for BugA101503--------
//if li_autosave<> 1 or li_preview <> 0 then return 1
//li_preview = tab_1.tabpage_browse.dw_report_list.getitemnumber(ll_row, "preview_type")  
if li_autosave<> 1 then return 1
//---------End Modfiied ------------------------------------------------------

ls_export_file =  tab_1.tabpage_browse.dw_report_list.getitemstring(ll_row, "export_path")
li_export_format = long(tab_1.tabpage_browse.dw_report_list.getitemstring(ll_row, "export_format"))

if right(trim(ls_export_file),1) = '\' then
	ls_report_name = tab_1.tabpage_browse.dw_report_list.getitemstring(ll_row, "view_name")
	ls_export_file = ls_export_file + ls_report_name
end if

gnv_dw.of_SaveAs(adw_report, ls_export_file, li_export_format)
yield()   
ChangeDirectory(gs_current_path) 
return 1
end function

public function boolean of_check_ctxgroup (string as_table_name);//====================================================================
//$<Function>: of_check_ctxgroup
//$<Arguments>:
// 	%ScriptArgs%
//$<Return>:  boolean
//$<Description>: 
//$<Author>: (Appeon) Stephen 05.16.2014 (IntelliReport Modifications 14.2)
//--------------------------------------------------------------------
//$<Modify History>:
//====================================================================
integer li_ans, li_nr
long     ll_tid, ll_handle
string   ls_table_alias
boolean lb_group
treeviewitem ltvi_item

lb_group = false
IF as_table_name = "v_ctx_loc_covering_partners"  or as_table_name = "v_ctx_locations" OR as_table_name = "v_ctx_loc_insurance" OR as_table_name = "v_ctx_loc_language" OR as_table_name = "v_ctx_loc_other_ids" OR +&
	as_table_name = "v_ctx_loc_practice_info" OR as_table_name = "v_ctx_loc_questions"   THEN
	IF tab_1.tabpage_tables.dw_view_tables.Find( "table_name = 'v_ctx_groups'", 1, 1000 ) = 0 THEN
		select v_alias into :ls_table_alias from view_alias where v_name = :as_table_name ; 
		if LenA(ls_table_alias) = 0 then ls_table_alias = as_table_name
		li_ans = MessageBox( "Table Selection", "To use the " + ls_table_alias + " table you must have the Groups table selected also.  Would you like to add this now?", question!, YesNo!, 1 )
		if li_ans = 1 then
			lb_group	= True
			li_nr = tab_1.tabpage_tables.dw_view_tables.InsertRow( 0 )			
			SELECT id
			INTO :ll_tid
			FROM dbo.sysobjects
			WHERE name = 'v_ctx_groups' ;
			tab_1.tabpage_tables.dw_view_tables.SetItem( li_nr, "table_name", "v_ctx_groups" )			
			tab_1.tabpage_tables.dw_view_tables.SetItem( li_nr, "conv_view_table_table_name", "v_ctx_groups" )			
			tab_1.tabpage_tables.dw_view_tables.SetItem( li_nr, "cust_table_name", ll_tid )
			tab_1.tabpage_tables.dw_view_tables.SetItem( li_nr, "view_id", il_view_id )
			tab_1.tabpage_tables.dw_view_tables.SetItem( li_nr, "project_id", ii_project_id )			
			il_next_table_id = gnv_app.of_get_irep_id("conv_view_table", 1) 
			tab_1.tabpage_tables.dw_view_tables.SetItem( li_nr, "table_id", il_next_table_id )			
			
			ll_handle = tab_1.tabpage_tables.tv_tables.of_finditem(2,'v_ctx_groups','')
			if ll_handle > 0 then 			
				if tab_1.tabpage_tables.tv_tables.GetItem(ll_handle,ltvi_item) = 1 then
					ltvi_item.pictureindex = 6
					ltvi_item.SelectedPictureIndex = 6
					tab_1.tabpage_tables.tv_tables.SetItem(ll_handle,ltvi_item)
				end if
			end if
		end if
	else
		lb_group	= True
	end if
end if

return lb_group
end function

public function integer of_set_fontsize (string as_object_name, string as_object_type, integer ai_size);//====================================================================
//$<Function>: of_set_fontsize
//$<Arguments>:
// 	%ScriptArgs%
//$<Return>:  integer
//$<Description>: 
//$<Author>: (Appeon) Stephen 05.21.2014 (IntelliReport Modifications 14.2)
//--------------------------------------------------------------------
//$<Modify History>:
//====================================================================
long ll_find

if as_object_type = "text" then as_object_name = left(trim(as_object_name), len(trim(as_object_name)) - 2)
//---------Begin Modified by (Appeon)Stephen 08.06.2014 for BugH071803--------
//ll_find = Tab_1.tabpage_columns.dw_view_fields.find("table_field = '"+as_object_name+"'", 1, Tab_1.tabpage_columns.dw_view_fields.rowcount())
ll_find = Tab_1.tabpage_columns.dw_view_fields.find("lower(field_alias) = '"+lower(as_object_name)+"'", 1, Tab_1.tabpage_columns.dw_view_fields.rowcount())
//---------End Modfiied ------------------------------------------------------

if ll_find > 0 then
	if as_object_type = "text" then	
		Tab_1.tabpage_columns.dw_view_fields.SetItem(ll_find, "label_font_size", ai_size)
	elseif as_object_type = "column" then
		Tab_1.tabpage_columns.dw_view_fields.SetItem(ll_find, "field_font_size", ai_size)
	end if 
end if
return 1
end function

public function integer of_get_module (string as_view_name);//====================================================================
//$<Function>: of_get_module
//$<Arguments>:
// 	%ScriptArgs%
//$<Return>:  integer
//$<Description>: 
//$<Author>: (Appeon) Stephen 08.05.2014 (Using image OCR to import data into IntelliCred 14.2)
//--------------------------------------------------------------------
//$<Modify History>:
//====================================================================
integer li_module
integer li_find

li_find = ids_view_modle.find("v_name = '" + as_view_name +"'", 1 , ids_view_modle.rowcount())

if li_find > 0 then
	li_module = ids_view_modle.getitemnumber(li_find, "module")
else
	li_module = 3
end if
return li_module


end function

public function integer of_check_viewid (string as_table_name);//====================================================================
//$<Function>: of_check_viewid
//$<Arguments>:
// 	%ScriptArgs%
//$<Return>:  integer
//$<Description>: 
//$<Author>: (Appeon) Stephen 08.05.2014 (Using image OCR to import data into IntelliCred 14.2)
//--------------------------------------------------------------------
//$<Modify History>:
//====================================================================
integer li_ret

IF as_table_name = "v_ctx_loc_covering_partners"  or as_table_name = "v_ctx_locations" OR as_table_name = "v_ctx_loc_insurance" OR as_table_name = "v_ctx_loc_language" OR as_table_name = "v_ctx_loc_other_ids" OR +&
	as_table_name = "v_ctx_loc_practice_info" OR as_table_name = "v_ctx_loc_questions"   THEN
	li_ret = 1
else
	li_ret = 0
end if

return li_ret


end function

public function integer of_filter_report_list (); //Start Code Change ----10.28.2015 #V15 maha
string ls_search
integer li_found
u_dw dw_report

dw_report = tab_1.tabpage_browse.dw_report_list

ls_search = upper(tab_1.tabpage_browse.sle_search.text)


if len(ls_search) = 0 then
	if len(is_my_reports) > 0 then
		ls_search = is_my_reports
	else
		ls_search = ""
	end if
else
	if len(is_my_reports) > 0 then
		ls_search =   is_my_reports +  ' and upper(view_name) like "%' + ls_search + '%"' 
//		ls_search =  "upper(view_name) like '%" + ls_search + "%' AND " + is_my_reports
	else
		ls_search =  'upper(view_name) like "%' + ls_search + '%"'
	end if
end if

if len(ls_search) = 0 then ls_search = "" 

li_found = dw_report.setfilter(ls_search)
if li_found < 0 then
	messagebox("Report Filter","Filter Failed:  " + ls_search)
	clipboard(ls_search)
end if

dw_report.filter()

return 1
end function

public function integer of_revise_filter (string as_operator, ref string as_filter_value);//====================================================================
//$<Function>: of_revise_filter
//$<Arguments>:
// 	value        string    as_operator
// 	reference    string    as_filter_value
//$<Return>:  integer
//$<Description>Replace "'" with "''" when needed.
//						(if there is information with an apostrophe in filter, intellireport creates an error)
//						Scripts are moved from this.of_build_view_sql
//$<Author>: (Appeon) long.zhang 02.14.2016 (For Bug id 4989 - Quotation Mark causing error in Intellireport)
//--------------------------------------------------------------------
//$<Modify History>:
//====================================================================

Long ll_double_pos, ll_sigle_pos, ll_filter_len
Long ll_dot, ll_befor, ll_after
String ls_filter_value, ls_operator

ls_operator = as_operator
ls_filter_value = as_filter_value

ll_filter_len = LenA(ls_filter_value)
IF LeftA(ls_filter_value,1) = "'" And RightA(ls_filter_value,1) = "'"  And LenA(ls_filter_value) > 2 THEN
	ll_double_pos = PosA(ls_filter_value,"''",2)
	ll_sigle_pos = PosA(ls_filter_value,"'",2)
	
	//check if have ',' or ' and '
	////fix bug about adds double qoutes to in-between filter
	IF	ls_operator = "Between" THEN
		ll_dot = PosA(lower(ls_filter_value)," and ",2)
	ELSE
		ll_dot = PosA(ls_filter_value,",",2)
	END IF
	
	//choosing more than one practitioner, the program sees the comma as a text delimiter and adds another apostrophe
	IF ll_dot > 0 And ll_sigle_pos > ll_dot THEN
		ll_befor = LenA(MidA(ls_filter_value,1,ll_dot -1)) -LenA(Trim(MidA(ls_filter_value,1,ll_dot -1)))
		ll_after = LenA(MidA(ls_filter_value,ll_dot +1)) -LenA(Trim(MidA(ls_filter_value,ll_dot +1)))
	ELSE
		ll_befor = LenA(MidA(ls_filter_value,1,ll_sigle_pos -1)) -LenA(Trim(MidA(ls_filter_value,1,ll_sigle_pos -1)))
		ll_after = LenA(MidA(ls_filter_value,ll_sigle_pos +1)) -LenA(Trim(MidA(ls_filter_value,ll_sigle_pos +1)))
	END IF

	DO UNTIL ll_sigle_pos = 0 Or ll_sigle_pos = ll_filter_len
		IF ll_double_pos = 0  Or(ll_double_pos <> ll_sigle_pos) THEN
			IF (ll_dot=0 and ((ll_befor=0) and (ll_after=0))) or(ll_dot>0 and ((ll_befor=0) and (ll_after=0)) and(ll_dot -ll_sigle_pos>1)  )  THEN
				ls_filter_value = ReplaceA(ls_filter_value, ll_sigle_pos, 1, "''")
				ll_filter_len++

				IF ll_dot > 0 THEN ll_dot++
			END IF
		END IF
		IF ll_dot = 0    THEN// if not have ','
			ll_befor = 0
			ll_after = 0
			ll_sigle_pos = PosA(ls_filter_value,"'",ll_sigle_pos +2 )
			IF ll_double_pos = ll_sigle_pos THEN
				ll_double_pos = PosA(ls_filter_value,"''",ll_double_pos +2)
			ELSE
				ll_double_pos = PosA(ls_filter_value,"''",ll_sigle_pos)
			END IF
		ELSEIF ll_dot > 0 THEN//// if  have ','
			ll_sigle_pos = PosA(ls_filter_value,"'",ll_dot+1)
			ll_sigle_pos = PosA(ls_filter_value,"'",ll_sigle_pos+1)
			
			//fix bug about adds double qoutes to in-between filter
			IF	ls_operator = "Between" THEN
				ll_dot = PosA(lower(ls_filter_value)," and ",ll_dot +1)
			Else
				ll_dot = PosA(ls_filter_value,",",ll_dot +1)
			END IF

			IF ll_dot > 0 And ll_sigle_pos > ll_dot THEN
				ll_befor = LenA(MidA(ls_filter_value,1,ll_dot -1)) -LenA(Trim(MidA(ls_filter_value,1,ll_dot -1)))
				ll_after = LenA(MidA(ls_filter_value,ll_dot +1)) -LenA(Trim(MidA(ls_filter_value,ll_dot +1)))
			ELSE
				ll_befor = LenA(MidA(ls_filter_value,1,ll_sigle_pos -1)) -LenA(Trim(MidA(ls_filter_value,1,ll_sigle_pos -1)))
				ll_after = LenA(MidA(ls_filter_value,ll_sigle_pos +1)) -LenA(Trim(MidA(ls_filter_value,ll_sigle_pos +1)))
			END IF
			IF ll_double_pos = ll_sigle_pos THEN
				ll_double_pos = PosA(ls_filter_value,"''",ll_double_pos +2)
			ELSE
				ll_double_pos = PosA(ls_filter_value,"''",ll_sigle_pos)
			END IF
		END IF
	LOOP
END IF

as_filter_value = ls_filter_value

Return 1
end function

public function integer of_link_buttons (string as_from);//Start Code Change ----02.17.2016 #V15 maha
str_link_fields str_link
long ll_table
long ll_field
string ls_table
string ls_field
integer li_row
datawindow dw_view_links

OpenWithParm( w_conv_select_fields, String(il_view_id) + "-" +  as_from )

if message.stringparm = "Cancel" then return 1

dw_view_links = tab_1.tabpage_tables.dw_view_links
li_row = dw_view_links.getrow()

str_link = message.powerobjectparm

//ll_table = str_link.table_id
//ll_field = str_link.field_id
ls_table = str_link.table_name
ls_field = str_link.field_name

IF as_from = "from_field"  THEN
	dw_view_links.SetItem( li_row, "link_from_field_nm", ls_field )
	//dw_view_links.SetItem( li_row, "link_from_field", ll_field )
	dw_view_links.SetItem( li_row, "link_from_table_nm", ls_table )
	//dw_view_links.SetItem( li_row, "link_from_table",  ll_table )
	dw_view_links.SetItem( li_row, "link_from_field_db", ls_table + '.' + ls_field )
	if isnull (dw_view_links.getitemstring(li_row, "link_type")) then dw_view_links.SetItem( li_row, "link_type", "=" )
ELSE
	dw_view_links.SetItem( li_row, "link_to_field_nm", ls_field )
//	dw_view_links.SetItem( li_row, "link_to_field", ll_field )
	dw_view_links.SetItem( li_row, "link_to_table_nm", ls_table )
//	dw_view_links.SetItem( li_row, "link_to_table", ll_table )
	dw_view_links.SetItem( li_row, "link_to_field_db", ls_table + '.' + ls_field )
	if isnull (dw_view_links.getitemstring(li_row, "link_type")) then dw_view_links.SetItem( li_row, "link_type", "=" )
END IF	



return 1


end function

public function integer of_audit_set (string as_data);//Start Code Change ----06.15.2016 #V152 maha - added for audit
//string ls_field
//integer r

of_report_audit_set(as_data, dw_audit, true)

//choose case as_data
//	case 'P'
//		ls_field = "p_mod"
//	case 'T'
//		ls_field = "t_mod"
//	case 'L'
//		ls_field = "l_mod"
//	case 'C'
//		ls_field = "c_mod"
//	case 'F'
//		ls_field = "f_mod"
//	case 'S'
//		ls_field = "s_mod"
//	case 'D'
//		ls_field = "d_mod"
//end choose
//
//dw_audit.setitem(1, ls_field, 1)
//dw_audit.setitem(1, "mod_date", datetime(today(), Now()))
//r = dw_audit.update()
//
//if r < 1 then messagebox("","Report Audit Failed")
//

return 1


end function

public function string of_get_join_filter (string as_table); //Start Code Change ----06.05.2017 #V154 maha - function to move outer join filters to the from part of the query
string ls_return = "Cancel"
string ls_tname
string ls_table
string ls_lookup_type
string  ls_field_type
string ls_filter_value
string ls_filter_value_display
string ls_sql
integer li_rc
integer i
integer cnt = 0
integer li_method = 1
 
li_rc = tab_1.tabpage_filter.dw_view_where.RowCount()
//debugbreak()
IF li_rc > 0 THEN
	FOR i = 1 TO li_rc
		ls_tname = tab_1.tabpage_filter.dw_view_where.GetItemString( i, "table_field_name" )
		ls_table = mid(ls_tname, 1 , pos(ls_tname, ".", 1) - 1)
		li_method = tab_1.tabpage_filter.dw_view_where.GetItemNumber( i, "oj_method" )
		
		if ls_table = as_table and li_method = 1 then
			cnt++
		//	if cnt > 1 then ls_sql = ls_sql + " AND "
			ls_sql = ls_sql + " AND ("
			ls_sql+= ls_tname
			ls_sql = ls_sql + " " + tab_1.tabpage_filter.dw_view_where.GetItemString( i, "operator" ) + " "
			
			ls_filter_value = tab_1.tabpage_filter.dw_view_where.GetItemString( i, "value" )
			This.of_revise_filter(tab_1.tabpage_filter.dw_view_where.GetItemString( i, "operator" ), ls_filter_value)		
	
			IF tab_1.tabpage_filter.dw_view_where.GetItemString( i, "operator" ) = "In" THEN
				ls_sql = ls_sql + "(" + ls_filter_value + ")"
			ELSE
				ls_sql = ls_sql + ls_filter_value
			END IF
			
			ls_lookup_type = tab_1.tabpage_filter.dw_view_where.GetItemString(i,"lookup_type")
			ls_field_type  = tab_1.tabpage_filter.dw_view_where.GetItemString(i,"field_type")
			if (Upper(ls_lookup_type) = 'C' or Upper(ls_lookup_type) = 'A') and ls_field_type = 'C' then

				If  tab_1.tabpage_filter.dw_view_where.GetItemString( i, "operator" ) = '<>' Then //Added By Ken.Guo 06/19/2012
					ls_sql = ls_sql + " AND " + ls_tname + " " + tab_1.tabpage_filter.dw_view_where.GetItemString( i, "operator" ) + " "
				Else
					ls_sql = ls_sql + " OR " + ls_tname + " " + tab_1.tabpage_filter.dw_view_where.GetItemString( i, "operator" ) + " "
				End If

				ls_filter_value_display = tab_1.tabpage_filter.dw_view_where.GetItemString( i, "value_display" )
				This.of_revise_filter(tab_1.tabpage_filter.dw_view_where.GetItemString( i, "operator" ), ls_filter_value_display)

				IF tab_1.tabpage_filter.dw_view_where.GetItemString( i, "operator" ) = "In" THEN
					ls_sql = ls_sql + "(" + ls_filter_value_display + ")"
				else
					ls_sql = ls_sql + ls_filter_value_display
				END IF
			end if
		ls_sql += ")"	
		tab_1.tabpage_filter.dw_view_where.rowsdiscard( i, i, primary!)	
		i = i - 1
		li_rc = li_rc - 1

		else //all other fields
			 CONTINUE
		end if

	END FOR
	//ls_sql+= 	 "~n"		//LeftA( ls_sql, LenA( ls_sql ) - 5 ) + "~n"	
	 ls_return = ls_sql
END IF
 

//messagebox("of_get_join_filter", ls_sql) 

 return ls_return
end function

public function string of_get_first_table (string as_table, datawindow adw_tables);////Start Code Change ----06.05.2017 #V154 maha
string ls_return
//string ls_table
//integer rc
//integer r
//
//ls_return = as_table
//
//rc = adw_tables.rowcount()
//for r = 1 to rc
//	ls_table = adw_tables.GetItemString( r, "table_name" )
//	
//	choose case ls_table
//		case "v_full_name", "v_full_basic", "v_basic"
//			ls_return = Ls_table
//			exit
//	end choose
//next
//
return ls_return
//
////ls_first_table_name = of_get_first_table( ls_first_table_name, dw_view_tables)  //Start Code Change ----06.06.2017 #V154 maha
end function

on w_custom_report.create
int iCurrent
call super::create
this.p_1=create p_1
this.cb_close=create cb_close
this.dw_audit=create dw_audit
this.cb_view_alias=create cb_view_alias
this.tab_1=create tab_1
iCurrent=UpperBound(this.Control)
this.Control[iCurrent+1]=this.p_1
this.Control[iCurrent+2]=this.cb_close
this.Control[iCurrent+3]=this.dw_audit
this.Control[iCurrent+4]=this.cb_view_alias
this.Control[iCurrent+5]=this.tab_1
end on

on w_custom_report.destroy
call super::destroy
destroy(this.p_1)
destroy(this.cb_close)
destroy(this.dw_audit)
destroy(this.cb_view_alias)
destroy(this.tab_1)
end on

event open;call super::open;long ll_view
integer li_set //maha 01202011

This.x = 0
This.y = 0

//--------------------------- APPEON BEGIN ---------------------------
//$<modify> 09.16.2008 By: Ken.Guo
//$<reason> From dashboard
If Isvalid(message.powerobjectparm) Then
	If message.powerobjectparm.classname() = 'str_dashboard' Then
		istr_dashboard=message.powerobjectparm
		ib_auto_locate = True
	End If	
End If
//---------------------------- APPEON END ----------------------------

//---------Begin Added by (Appeon)Stephen 04.23.2014 for V142 Schedule IntelliReport--------
if lower(message.stringparm) = "schedule intellireport" then
	this.hide()
	ib_sche = true
end if
is_message = lower(message.stringparm)
//---------End Added ------------------------------------------------------

if not ib_sche then //Added by (Appeon)Harry 12.13.2017 for  Bug # 5911 - Scheduler report fails --------
	 //---------Begin Added by (Appeon)Stephen 06.01.2017 for V15.4-WebView Reporting Functionality--------
	if w_mdi.of_security_access( 7847 ) = 0 then 
		tab_1.tabpage_run.cb_store.visible = false
	end if
	//---------End Added ------------------------------------------------------
end if

//---------Begin Added by (Appeon)Harry 01.24.2014 for V142 ISG-CLX--------
//Added By Ken.Guo 08/09/2013. for auto export function
If Lower(istr_dashboard.data_name) = 'autoreport' and istr_dashboard.data_id = 0 Then
	This.Hide( )
	tab_1.tabpage_browse.cbx_goto.checked = True
End If
//---------End Added ------------------------------------------------------

//---------Begin Added by (Appeon)Stephen 04.23.2014 for V142 Schedule IntelliReport--------
IF Isvalid(inv_message) THEN
	inv_message.of_set_schedule(ib_sche)		
END IF
//---------End Added ------------------------------------------------------


//--------------------------- APPEON BEGIN ---------------------------
//$<ID> PT-07
//$<modify> 02.08.2006 By: Rodger Wu
//$<reason> Performance tuning
//$<reason> Collect SQL statements and DataWindows for retrieving data and integrate them into 
//$<reason> Appeon Queue Labels to reduce client-server interactions to improve runtime performance.
DataWindowChild dwchild

//Start Code Change ----05.25.2011 #V11 maha 
if of_get_app_setting("set_60","I") = 1 then
	tab_1.tabpage_browse.dw_report_list.dataobject = "d_cust_report_list_for_user"
end if
//End Code Change ----05.25.2011

tab_1.tabpage_browse.dw_report_list.of_SetTransObject(SQLCA)
//comment 12.11.2007 by: Andy
//tab_1.tabpage_tables.dw_select_table.SetTransObject( SQLCA )
tab_1.tabpage_browse.dw_detail.SetTransObject( sqlca )
tab_1.tabpage_browse.dw_detail.GetChild( "mod_user", dwchild )
dwchild.settransobject(sqlca)
gnv_appeonDb.of_StartQueue()

//Start Code Change ----05.25.2011 #V11 maha 
if of_get_app_setting("set_60","I") = 1 then
	ib_security = true
	//tab_1.tabpage_browse.dw_report_list.Retrieve()
end if
of_report_retrieve( ) //Start Code Change ----07.18.2011 #V11 maha - moved outside of if
//End Code Change ----05.25.2011

//comment 12.11.2007 by: Andy
//tab_1.tabpage_tables.dw_select_table.Retrieve()
dwchild.retrieve()
gnv_appeonDb.of_CommitQueue()

//comment 12.11.2007 by: Andy
/*
IF gb_contract_version THEN
	tab_1.tabpage_tables.dw_select_table.SetFilter( "Upper( Left( table_name, 6 )) = 'V_CTX_'" )
	tab_1.tabpage_tables.dw_select_table.Filter()
END IF
*/
IF tab_1.tabpage_browse.dw_report_list.RowCount() > 0 THEN
	tab_1.tabpage_browse.dw_report_list.SetRow( 1 )
	tab_1.tabpage_browse.dw_report_list.SelectRow( 0, False )
	tab_1.tabpage_browse.dw_report_list.SelectRow( 1, True )
END IF

dwchild.insertrow(1)
dwchild.setitem(1,"user_id","All")
//---------------------------- APPEON END ----------------------------

IF tab_1.tabpage_browse.dw_report_list.RowCount() > 0 THEN
	ll_view = tab_1.tabpage_browse.dw_report_list.getitemnumber(1,"view_id")
	of_retrieve_detail(ll_view)//maha111902
END IF
//--------------------------- APPEON BEGIN ---------------------------
//$<ID> PT-08
//$<modify> 02.07.2006 By: Rodger Wu
//$<reason> Performance tuning
//$<modification> Write script to retrieve data from a cache instead of from the database.

/*
//select set_17 into :ii_facil_security from icred_settings;
ii_facil_security = of_get_app_setting("set_17","I")

//department security
//SELECT set_37
//INTO :ii_dept_security_on
//FROM icred_settings;
//IF SQLCA.SQLCODE = -1 THEN
//	MessageBox("SQL Error", SQLCA.SQLERRTEXT )
//	RETURN 1
//END IF
ii_dept_security_on = of_get_app_setting("set_37","I")
*/
ii_facil_security = Integer( gnv_data.of_getitem( "icred_settings", "set_17", False ))
ii_dept_security_on = Integer( gnv_data.of_getitem( "icred_settings", "set_37", False ))
//Start Code Change ----01.04.2008 #V8 maha - Added for Cornell IPA to allow dept security to be on in the system but off in intellireports
//temporary measure; program should be modified to allow multiple options from set 37
if Integer( gnv_data.of_getitem( "icred_settings", "set_2", False )) = 100 then ii_dept_security_on = 0 
//End Code Change---01.04.2008

//Fix a defect of Web application. Rodger Wu on Sept. 6, 2006.
IF Upper( appeongetclienttype()) = "WEB" THEN
	//This.Width = 4050  /*3769*/ //modify by stephen 06-20-2011 --Run report that has multiple pages and there is no scroll bar on web
	This.Width += 10 //Alpha id 3274  - Alfee 09.19.2012
	/*$Comment 02.19.2008 by Andy
	cb_15.x = 2967
	cb_qhelp.x = 3223
	cb_8.x = 3479
	*/
END IF
//---------------------------- APPEON END ----------------------------


//--------------------------- APPEON BEGIN ---------------------------
//$<  Add > 2007-11-06 By: Scofield
//$<Reason> add Resize function

long ll_i

this.of_SetResize(TRUE)
this.inv_resize.of_SetOrigSize (this.WorkSpaceWidth(), this.WorkSpaceHeight())
this.inv_resize.of_SetMinSize (this.WorkSpaceWidth(), this.WorkSpaceHeight())

this.inv_resize.of_register(tab_1,inv_resize.scale)
/*$Comment 02.19.2008 by Andy
this.inv_resize.of_register(cb_15,inv_resize.FIXEDRIGHT)
this.inv_resize.of_register(cb_qhelp,inv_resize.FIXEDRIGHT)
this.inv_resize.of_register(cb_8,inv_resize.FIXEDRIGHT)
*/
//BROWSE
for ll_i =  1 to UpperBound(tab_1.tabpage_browse.Control)
	If tab_1.tabpage_browse.Control[ll_i].ClassName() = 'dw_report_list' or 		tab_1.tabpage_browse.Control[ll_i].ClassName() = 'dw_detail'	then   //Start Code Change ----09.26.2017 #V154 maha
  		this.inv_resize.of_Register (tab_1.tabpage_browse.Control[ll_i],inv_resize.scale)
	end if
next

//TABLES
for ll_i =  1 to UpperBound(tab_1.tabpage_tables.Control)
	choose case tab_1.tabpage_tables.Control[ll_i].ClassName()
		case 'dw_1', 'cb_coll_tables', 'cb_quick_select', 'cb_view_add_link', 'cb_auto_link', 'cb_view_del_link', 'cb_qhelp', 'cb_next_2'
			continue
		case else
		this.inv_resize.of_Register (tab_1.tabpage_tables.Control[ll_i],inv_resize.scale)
	end choose
next

//COLUMNS
for ll_i =  1 to UpperBound(tab_1.tabpage_columns.Control)
	//Start Code Change ----09.26.2017 #V154 maha - rewrote to skip resize of buttons
	choose case tab_1.tabpage_columns.Control[ll_i].ClassName()
		Case 'dw_view_fields_edit'
			Continue
		case 'cb_collapse', 'cb_selection', 'cb_expand', 'cb_add_comp', 'cb_edit_comp', 'cb_next_3'
			Continue
		case else
  			this.inv_resize.of_Register (tab_1.tabpage_columns.Control[ll_i],inv_resize.scale)
	end choose
next

//FILTERS
for ll_i =  1 to UpperBound(tab_1.tabpage_filter.Control)	
	If tab_1.tabpage_filter.Control[ll_i].ClassName() = 'dw_view_where' Then  //Start Code Change ----09.26.2017 #V154 maha
		this.inv_resize.of_Register (tab_1.tabpage_filter.Control[ll_i],inv_resize.scale)
	end if
next

//SORT
for ll_i =  1 to UpperBound(tab_1.tabpage_sort.Control)
	choose case tab_1.tabpage_sort.Control[ll_i].ClassName()  //Start Code Change ----09.26.2017 #V154 maha
		case 'cb_col_all', 'cb_next_5'
			continue
		case else
			this.inv_resize.of_Register (tab_1.tabpage_sort.Control[ll_i],inv_resize.scale)
	end choose
next

//PREVIEW
//Start Code Change ----09.25.2017 #V154 maha - only resize dw
//for ll_i =  1 to UpperBound(tab_1.tabpage_preview.Control)
	// this.inv_resize.of_Register (tab_1.tabpage_preview.DW_display, inv_resize.scale)
	 this.inv_resize.of_Register (tab_1.tabpage_preview.DW_display , 0, 0, 100, 100)
//   this.inv_resize.of_Register (tab_1.tabpage_preview.Control[ll_i],inv_resize.scale)
//next

//RUN
for ll_i =  1 to UpperBound(tab_1.tabpage_run.Control)
	choose case tab_1.tabpage_run.Control[ll_i].ClassName()  //Start Code Change ----09.26.2017 #V154 maha
		case 'dw_run', "dw_wizard", "st_sql"
			this.inv_resize.of_Register (tab_1.tabpage_run.Control[ll_i],inv_resize.scale)
	end choose
next

//---------------------------- APPEON END ----------------------------

//--------------------------- APPEON BEGIN ---------------------------
//$<add> 2007-12-18 By: Andy
ids_tables = Create n_ds 

//------------------- APPEON BEGIN -------------------
//<$>added:long.zhang 12.08.2016
//<$>reason:for Issue id 5351 - SQL Server 2014 and 2016 Partial Contained Databases and High Availability Groups
//ids_tables.dataobject = "d_view_alias_all"
IF gs_dbtype = "SQL" THEN
	ids_tables.dataobject = "d_view_alias_all_sql"
ELSE
	ids_tables.dataobject = "d_view_alias_all_asa"
END IF
//------------------- APPEON END -------------------

ids_tables.settransobject( SQLCA )
ids_tables.retrieve( )

//$<add> 2007-12-20 By: Andy
ids_fields = Create n_ds
IF gs_dbtype = "SQL" THEN
	ids_fields.dataobject = "d_view_fields_alias_sql_all"
ELSE
	ids_fields.dataobject = "d_view_fields_alias_asa_all"
END IF
ids_fields.settransobject( SQLCA )

//$<add> 02.21.2008 by Andy
ids_sort = create n_ds
ids_sort.dataobject = "d_view_fields_alias_sort_all"
ids_sort.settransobject( SQLCA )

//$<add> 02.29.2008 by Andy
inv_data_entry = CREATE pfc_cst_nv_data_entry_functions
inv_data_entry.of_setup_cache()	
app_filler.ids_screen_fields_cache.ShareData( inv_data_entry.ids_screen_fields )
inv_data_entry.of_refresh_cache()	
//---------------------------- APPEON END ----------------------------
//Start Code Change ----03.25.2009 #V92 maha - read only security added
if not(is_message = "schedule intellireport") then //(Appeon)Stephen 07.01.2015 -Bug # 4579 - Scheduler auto shutdown is not working case # 55316
	if w_mdi.of_security_access(1470) = 1 then
		of_readonly_security()
	end if
	//End Code Change---03.25.2009
	
	if of_get_app_setting("set_60","I") = 0 or w_mdi.of_security_access(7195) = 0 then tab_1.tabpage_browse.cb_security.visible = false  //Start Code Change ----06.27.2011 #V11 maha - if not using ireport security, hide button
end if

//Start Code Change ----01.20.2011 #V11 maha
li_set = of_get_app_setting("set_34","I")
if li_set = 1 then ib_show_all_fields_in_select = true
//End Code Change ----01.20.2011

//---------Begin Added by (Appeon)Toney 06.11.2013 for V141 ISG-CLX--------
//Added by Ken.Guo on 2009-04-21
of_get_filter_status()
//---------End Added ------------------------------------------------------------------

//---------Begin Added by (Appeon)Stephen 08.05.2014 for bug BugH071502--------
if not isvalid(ids_view_modle) then
	ids_view_modle = create datastore
	
	//------------------- APPEON BEGIN -------------------
	//<$>added:long.zhang 12.08.2016
	//<$>reason:for Issue id 5351 - SQL Server 2014 and 2016 Partial Contained Databases and High Availability Groups
	//ids_view_modle.dataobject = "d_view_alias_all"
	IF gs_dbtype = "SQL" THEN
		ids_view_modle.dataobject = "d_view_alias_all_sql"
	ELSE
		ids_view_modle.dataobject = "d_view_alias_all_asa"
	END IF
	//------------------- APPEON END -------------------

	ids_view_modle.settransobject(sqlca)
	ids_view_modle.retrieve()
end if
//---------End Added ------------------------------------------------------

end event

event closequery;//nothing

//---------Begin Added by (Appeon)Toney 06.11.2013 for V141 ISG-CLX--------
String	ls_Syntax
long		ll_Rtn

if Tab_1.SelectedTab = 6 then
	ls_Syntax = Tab_1.Tabpage_Preview.dw_Preview.Describe("DataWindow.Syntax")
	if ls_Syntax <> is_Origin_Syntax then
		ll_Rtn = MessageBox(gnv_app.iapp_object.DisplayName,'Do you want to save changes?',Question!,YesNoCancel!)
		if ll_Rtn = 1 then
			Tab_1.Tabpage_Preview.cb_14.TriggerEvent(Clicked!)
		elseif ll_Rtn = 3 then
			Return 1
		end if
	end if
end if
//---------End Added ------------------------------------------------------------------

end event

event close;call super::close;garbagecollect()

//--------------------------- APPEON BEGIN ---------------------------
//$<add> 2007-12-18 By: Andy
if IsValid(ids_tables) then destroy ids_tables
//$<add> 2007-12-20 By: Andy
if IsValid(ids_fields) then destroy ids_fields
//$<add> 02.21.2008 by Andy
if IsValid(ids_sort) then destroy ids_sort

//$<add> 2007-12-19 By: Andy
tab_1.tabpage_columns.dw_view_fields.Sharedataoff( )

//$<add> 02.29.2008 by Andy
if IsValid(inv_data_entry) then 
	inv_data_entry.ids_screen_fields.sharedataoff( )
	destroy inv_data_entry
end if

Long ll_Cnt, ll_i, ll_j, ll_dsCnt
ll_Cnt = UpperBound(istr_ds)
FOR ll_i = 1 to ll_Cnt
	ll_dsCnt = UpperBound(istr_ds[ll_i].lds)
	FOR ll_j = 1 to ll_dsCnt
		if IsValid(istr_ds[ll_i].lds[ll_j]) then
			//destroy datastore
			destroy istr_ds[ll_i].lds[ll_j]
		end if
	NEXT
NEXT
//---------------------------- APPEON END ----------------------------
//--------Begin Added by Nova 08.25.2010------------------------
//V10.5 SK IntelliReport
if IsValid(w_custom_report_selection) then 
	close(w_custom_report_selection)
end if
//--------End Added --------------------------------------------

if isvalid(ids_view_modle) then destroy ids_view_modle  //(Appeon)Stephen 08.05.2014 - for bug BugH071502

end event

event activate;call super::activate;//--------------------------- APPEON BEGIN ---------------------------
//$<  Add > 2007-11-06 By: Scofield
//$<Reason> Change to m_pfe_cst_mdi_menu menu
if not(is_message = "schedule intellireport") then //(Appeon)Stephen 07.01.2015 -Bug # 4579 - Scheduler auto shutdown is not working case # 55316
	If w_mdi.menuname <> "m_pfe_cst_mdi_menu" Then
		w_mdi.ChangeMenu( m_pfe_cst_mdi_menu )
		w_mdi.of_menu_security( w_mdi.MenuName )
	END IF
end if
//---------------------------- APPEON END ----------------------------

end event

event pfc_postopen;call super::pfc_postopen;//Added By Ken.Guo 09-16-2008
If ib_auto_locate Then of_dashboard(istr_dashboard.data_id)
end event

event resize;call super::resize;//Hard code to re-adjust size after resized, Added by Appeon long.zhang 03.09.2016 (BugL030902)
Int li_y_new
Int li_reduce = 20

If AppeonGetClientType() = 'WEB' Then li_reduce = 4
	
//tabpage_tables
tab_1.tabpage_tables.dw_1.width = tab_1.tabpage_tables.tv_tables.width
tab_1.tabpage_tables.dw_1.y  = tab_1.tabpage_tables.dw_view_tables.y
tab_1.tabpage_tables.tv_tables.y = tab_1.tabpage_tables.dw_1.y + tab_1.tabpage_tables.dw_1.height - li_reduce
tab_1.tabpage_tables.tv_tables.height = tab_1.tabpage_tables.dw_view_tables.height - tab_1.tabpage_tables.dw_1.height + li_reduce

//tabpage_columns
//Start Code Change ----09.26.2017 #V154 maha - commented below
//tab_1.tabpage_columns.dw_2.width = tab_1.tabpage_columns.tv_fields.width
//tab_1.tabpage_columns.dw_2.y = tab_1.tabpage_columns.tv_fields.y -  tab_1.tabpage_columns.dw_2.height + li_reduce
//
//tab_1.tabpage_columns.dw_3.width = tab_1.tabpage_columns.dw_view_fields.width
//tab_1.tabpage_columns.dw_view_fields.y = tab_1.tabpage_columns.dw_3.y + tab_1.tabpage_columns.dw_3.height - li_reduce

if tab_1.tabpage_columns.dw_view_fields_edit.visible then
	tab_1.tabpage_columns.dw_view_fields_edit.y = tab_1.tabpage_columns.dw_view_fields.y + tab_1.tabpage_columns.dw_view_fields.height - li_reduce
	tab_1.tabpage_columns.dw_view_fields_edit.x = tab_1.tabpage_columns.dw_view_fields.x
	tab_1.tabpage_columns.dw_view_fields_edit.width = tab_1.tabpage_columns.dw_view_fields.width
//tab_1.tabpage_columns.dw_view_fields_edit.height = tab_1.tabpage_columns.tv_fields.y + tab_1.tabpage_columns.tv_fields.height - tab_1.tabpage_columns.dw_view_fields_edit.y
end if

//tabpage_filter
//tab_1.tabpage_filter.dw_6.width = tab_1.tabpage_filter.dw_view_where.width
//li_y_new = tab_1.tabpage_filter.dw_6.y + tab_1.tabpage_filter.dw_6.height - li_reduce
//tab_1.tabpage_filter.dw_view_where.height -= tab_1.tabpage_filter.dw_view_where.y - li_y_new
//tab_1.tabpage_filter.dw_view_where.y = li_y_new

//tabpage_sort
tab_1.tabpage_sort.dw_4.width = tab_1.tabpage_sort.tv_sort.width
tab_1.tabpage_sort.dw_4.y  = tab_1.tabpage_sort.dw_view_sort.y
tab_1.tabpage_sort.tv_sort.y = tab_1.tabpage_sort.dw_4.y + tab_1.tabpage_sort.dw_4.height - li_reduce
tab_1.tabpage_sort.tv_sort.height = tab_1.tabpage_sort.dw_view_sort.height - tab_1.tabpage_sort.dw_4.height + li_reduce
end event

type p_1 from picture within w_custom_report
boolean visible = false
integer x = 14
integer y = 12
integer width = 82
integer height = 60
boolean originalsize = true
string picturename = "arrowhead.png"
boolean focusrectangle = false
end type

type cb_close from commandbutton within w_custom_report
integer x = 4055
integer width = 343
integer height = 92
integer taborder = 90
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "Close"
end type

event clicked;close(parent)
end event

type dw_audit from u_dw within w_custom_report
boolean visible = false
integer x = 2871
integer width = 709
integer height = 112
integer taborder = 50
boolean bringtotop = true
string dataobject = "d_report_audit_view"
boolean hscrollbar = true
end type

event constructor;call super::constructor;this.of_settransobject( sqlca)
end event

type cb_view_alias from commandbutton within w_custom_report
boolean visible = false
integer x = 2551
integer y = 128
integer width = 681
integer height = 84
integer taborder = 50
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "View Alias Maintenance"
end type

event clicked;//$<add> 02.19.2008 by Andy
Open(w_view_alias_maintenance)
end event

event rbuttondown;
//alfee 10.15.2010

if gs_dbtype = 'SQL' then
	open(w_view_fields_mapping)
end if
end event

type tab_1 from tab within w_custom_report
event create ( )
event destroy ( )
integer width = 4434
integer height = 2120
integer taborder = 10
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long backcolor = 33551856
boolean fixedwidth = true
boolean raggedright = true
alignment alignment = center!
integer selectedtab = 1
tabpage_browse tabpage_browse
tabpage_tables tabpage_tables
tabpage_columns tabpage_columns
tabpage_filter tabpage_filter
tabpage_sort tabpage_sort
tabpage_preview tabpage_preview
tabpage_run tabpage_run
end type

on tab_1.create
this.tabpage_browse=create tabpage_browse
this.tabpage_tables=create tabpage_tables
this.tabpage_columns=create tabpage_columns
this.tabpage_filter=create tabpage_filter
this.tabpage_sort=create tabpage_sort
this.tabpage_preview=create tabpage_preview
this.tabpage_run=create tabpage_run
this.Control[]={this.tabpage_browse,&
this.tabpage_tables,&
this.tabpage_columns,&
this.tabpage_filter,&
this.tabpage_sort,&
this.tabpage_preview,&
this.tabpage_run}
end on

on tab_1.destroy
destroy(this.tabpage_browse)
destroy(this.tabpage_tables)
destroy(this.tabpage_columns)
destroy(this.tabpage_filter)
destroy(this.tabpage_sort)
destroy(this.tabpage_preview)
destroy(this.tabpage_run)
end on

event selectionchanging;int i,li_rc,li_cnt

IF oldindex = 2 THEN
	//$<add> 07.08.2008 by Andy
	if of_tabchanging(oldindex,newindex) = 1 then return 1	
	of_save_tables()
	
//$<add> 03.04.2008 by Andy 	
ELSEIF oldindex = 3 THEN
	//$<modify> 07.08.2008 by Andy
	if of_tabchanging(oldindex,newindex) = 1 then return 1
	//$<add> 04.15.2008 by Andy Reason:Optimize speed.
	//of_save( )
	tab_1.tabpage_columns.dw_view_fields.Update()
	//end 04.15.2008
	
//$<add> 04.15.2008 by Andy Reason:Optimize speed.
ELSEIF oldindex = 4 THEN
	if of_check_filter() = 1 then
		tab_1.tabpage_filter.dw_view_where.update( )
	else //add Michael 05.21.2012 Cannot insert the value NULL into column 'view_id'
		return 1
	end if
ELSEIF oldindex = 5 THEN
	tab_1.tabpage_sort.dw_view_sort.update( )
ELSEIF oldindex = 6 THEN
	tab_1.tabpage_preview.dw_label.setfocus( )
	tab_1.tabpage_browse.dw_detail.update( )
	tab_1.tabpage_columns.dw_view_fields.update( )
END IF



IF newindex = 1 THEN
	//st_help_1.Visible = True
	//st_help_2.Visible = True	
	of_help( "browse", "" )
//$<add> 04.24.2008 by Andy
//$<Reason> fixed a issue from John
ELSEIF newindex = 4 then
	DataWindowChild dwchild

	tab_1.tabpage_filter.dw_view_where.GetChild( "table_field_name", dwchild )
	dwchild.SetTransObject( SQLCA )
	//---------Begin Modified by (Appeon)Stephen 06.26.2014 for IntelliReport Modifications 14.2--------
     //if dwchild.Retrieve( il_view_id, il_module, il_data_view_id ) < 1 then dwchild.insertrow(0)
	  if dwchild.Retrieve( il_view_id, il_module, il_data_view_id, il_data_view_id_cont) < 1 then dwchild.insertrow(0)
	//---------End Modfiied ------------------------------------------------------
	
//end add 04.24.2008	
ELSEIF newindex = 6 THEN
	is_filter = ""
	is_sql_where = ""
	SetNull(idt_priordate)
	
	//--------Begin Added by Nova 08.19.2010---------
	//V10.5 SK IntelliReport
	//of_preview( tab_1.tabpage_preview.dw_preview)
	//---------Begin Modified by (Appeon)Toney 06.13.2013 for V141 ISG-CLX--------
	  /*
		of_preview( tab_1.tabpage_preview.dw_preview, 0)		
	  */
	long ll_rtn
	ll_Rtn = of_preview( tab_1.tabpage_preview.dw_preview, 0)
	if ll_Rtn < 0 then
		of_SetObjectEnabled(false)
	else
		of_SetObjectEnabled(true)
	end if
	//---------End Modfiied ------------------------------------------------------------------
	
	//--------End Modified --------------------------
	
	//------------------- APPEON BEGIN -------------------
	//$<add> Evan 08.31.2010
	//$<reason> V10.5-Advanced Report	
	of_modify_dw(tab_1.Tabpage_Preview.dw_preview)
	//------------------- APPEON END ---------------------	
ELSEIF newindex = 5 THEN     //maha changed from newindex = 5 092402
//--------------------------- APPEON BEGIN ---------------------------
//$<ID> PT-09
//$<modify> 02.10.2006 By: Rodger Wu
//$<reason> Performance tuning
//$<modification> Add a condition to avoid redundant function call in order to
//$<modification> reduce client-server interactions to improve runtime performance.
/*	of_save() */

//$<Comment> 04.15.2008 by Andy
//	If Not ( oldindex = 4 and tab_1.tabpage_filter.dw_view_where.Modifiedcount() = 0 ) Then
//		of_save()
//	End If
//end comment 04.15.2008	
//---------------------------- APPEON END ----------------------------

	//tab_1.tabpage_sort.dw_fields_list_sort.Retrieve( il_view_id )
ELSEIF newindex = 7 THEN
	//------------------- APPEON BEGIN -------------------
	//$<add> Evan 09.02.2010
	//$<reason> V10.5-Advanced Report	
	setnull(idt_priordate)
//Start Code Change ----05.26.2011 #V11 maha - commented out pending further review
//	IF tab_1.tabpage_run.dw_run.rowcount() = 0 THEN
//		li_rc = tab_1.tabpage_columns.dw_view_fields.RowCount()
//		FOR i = 1 TO li_rc
//			IF LenA( tab_1.tabpage_columns.dw_view_fields.GetItemString( i, "field_wizard_name" ) ) > 0 THEN
//				li_cnt++
//			END IF
//		NEXT
//		IF li_cnt > 0 then
//			is_facility_name = ""
//			ii_total_wizard_steps = li_cnt
//			ii_current_wizard_step = 0
//			ii_total_where_values = 0
//			is_sql_where = ""
//			is_address_types = ""
//			is_net_dev_types = ""
//			//
//			of_preview( tab_1.tabpage_run.dw_run, 0 )	
//			of_modify_dw( tab_1.tabpage_run.dw_run )	
//			setnull(idt_priordate)
//			tab_1.tabpage_run.dw_run.reset()
//		END IF
//	END IF
	//------------------- APPEON END ---------------------	
//End Code Change ----05.26.2011
	//$<add> 04.21.2008 by Andy 
	is_filter = ""
	//$<add> 04.25.2008 by Andy
	is_sql_where = ""	
	
	//st_help_1.Visible = False
	//st_help_2.Visible = False
	tab_1.tabpage_run.st_sql.Text = ""
	tab_1.tabpage_run.st_sql.Visible = False	
	tab_1.tabpage_run.cb_next_run.Enabled = True
	of_wizard_setup()
	tab_1.tabpage_run.dw_run.GroupCalc()
	
	//--------------------------- APPEON BEGIN ---------------------------
	//$<add> 10.11.2006 By: LeiWei
	//$<reason> Fix a defect.
	tab_1.tabpage_run.cb_showsql.text = ""
	tab_1.tabpage_run.cb_showsql.event clicked( )
	//---------------------------- APPEON END ----------------------------

END IF

//Start Code Change ----06.14.2017 #V154 maha
choose case newindex
	case 2,3
		if w_mdi.of_security_access(1340) = 0 then
			cb_view_alias.visible = false
		else
			cb_view_alias.visible = true
		end if
	case else
		cb_view_alias.visible = false
end choose


	
end event

event selectionchanged;
//--------------------------- APPEON BEGIN ---------------------------
//$<add> 2007-12-06 By: Andy
Long   ll_Root,ll_Cnt,ll_N
u_tvs_rpt ltv
String ls_viewList[]
Long   ll_FistRoot

CHOOSE CASE newindex
	CASE 2
		ltv = tabpage_tables.tv_tables		
		//--------Begin Added by Nova 09.02.2010------------------------
		//V10.5 SK IntelliReport
		//if gb_sk_ver and (il_module=2) then
		//if il_module=2 then  //Start Code Change ----11.15.2010 #V10 maha - changed to show for all cred app
		if il_module=2 or il_module=4 then //Bug 4300 - alfee 11.18.2014
			tab_1.tabpage_tables.cb_quick_select.visible=true
		end if
		//--------End Added --------------------------------------------
	CASE 3,5
		ll_Cnt = tab_1.tabpage_tables.dw_view_tables.Rowcount( )
		FOR ll_N = 1 to ll_Cnt
			ls_viewList[ll_N] = tab_1.tabpage_tables.dw_view_tables.GetItemString(ll_N,"conv_view_table_table_name")
		NEXT
		if newindex = 3 then
			//---------Begin Modified by (Appeon)Stephen 06.26.2014 for IntelliReport Modifications 14.2--------
			//ids_fields.Retrieve( ls_viewList, il_data_view_id )
			ids_fields.Retrieve( ls_viewList,il_data_view_id,  il_data_view_id_cont)
			//---------End Modfiied ------------------------------------------------------	
			
			ltv = tabpage_columns.tv_fields
			//--------Begin Added by Nova 09.02.2010------------------------
			//V10.5 SK IntelliReport
			//if gb_sk_ver and (il_module=2) then
			//if il_module=2 then  //Start Code Change ----11.15.2010 #V10 maha - changed to show for all cred app
			if il_module=2 or il_module=4 then //Bug 4300 - alfee 11.18.2014
				tab_1.tabpage_columns.cb_selection.visible=true
			end if
			//--------End Added --------------------------------------------
		else
			ids_sort.Retrieve( ls_viewList,il_data_view_id, il_view_id)
			ltv = tabpage_sort.tv_sort
		end if
	CASE 7 //Add by Evan 11.15.2010
		if tab_1.tabpage_run.dw_wizard.Visible and tab_1.tabpage_run.dw_wizard.RowCount() < 1 then
			tab_1.tabpage_run.dw_wizard.Event RetrieveEnd(0)
		end if
		Return
	CASE ELSE
		//--------Begin Added by Nova 09.02.2010------------------------
		//V10.5 SK IntelliReport
//		if isvalid(w_custom_report_selection) then
//			close(w_custom_report_selection)
//		end if
		//--------End Added --------------------------------------------
		//DO NOTHING
		return
		
END CHOOSE

ltv.of_reset()
ltv.event pfc_populate( 0)

//Expand All
ll_Root = ltv.FindItem(RootTreeItem!, 0)
ll_FistRoot = ll_Root
DO WHILE (1=1)
	IF ll_Root < 1 THEN  EXIT	
	ltv.ExpandAll(ll_Root)//expandItem
	ll_Root = ltv.FindItem(NextTreeItem!, ll_Root)	
LOOP

if ll_FistRoot > 0 then 
	ltv.selectitem( ll_FistRoot )
END IF
//--------Begin modified by Nova 09.02.2010------------------------
//V10.5 SK IntelliReport
//ltv.setfocus( )
//if not isvalid(w_custom_report_selection) then
//	ltv.setfocus( )
//end if	
//--------End modified --------------------------------------------		
//---------------------------- APPEON END ----------------------------

end event

type tabpage_browse from userobject within tab_1
event create ( )
event destroy ( )
integer x = 18
integer y = 100
integer width = 4398
integer height = 2004
long backcolor = 33551856
string text = "Browse"
long tabtextcolor = 33554432
long tabbackcolor = 79741120
long picturemaskcolor = 12632256
cb_23 cb_23
cb_security cb_security
cb_find cb_find
cb_select cb_select
dw_report_list dw_report_list
cb_next_1 cb_next_1
cb_delete cb_delete
cb_new cb_new
cb_copy cb_copy
cbx_goto cbx_goto
cb_1 cb_1
cb_properties cb_properties
cb_25 cb_25
cb_27 cb_27
cb_26 cb_26
sle_search sle_search
cb_clear cb_clear
dw_detail dw_detail
gb_3 gb_3
end type

on tabpage_browse.create
this.cb_23=create cb_23
this.cb_security=create cb_security
this.cb_find=create cb_find
this.cb_select=create cb_select
this.dw_report_list=create dw_report_list
this.cb_next_1=create cb_next_1
this.cb_delete=create cb_delete
this.cb_new=create cb_new
this.cb_copy=create cb_copy
this.cbx_goto=create cbx_goto
this.cb_1=create cb_1
this.cb_properties=create cb_properties
this.cb_25=create cb_25
this.cb_27=create cb_27
this.cb_26=create cb_26
this.sle_search=create sle_search
this.cb_clear=create cb_clear
this.dw_detail=create dw_detail
this.gb_3=create gb_3
this.Control[]={this.cb_23,&
this.cb_security,&
this.cb_find,&
this.cb_select,&
this.dw_report_list,&
this.cb_next_1,&
this.cb_delete,&
this.cb_new,&
this.cb_copy,&
this.cbx_goto,&
this.cb_1,&
this.cb_properties,&
this.cb_25,&
this.cb_27,&
this.cb_26,&
this.sle_search,&
this.cb_clear,&
this.dw_detail,&
this.gb_3}
end on

on tabpage_browse.destroy
destroy(this.cb_23)
destroy(this.cb_security)
destroy(this.cb_find)
destroy(this.cb_select)
destroy(this.dw_report_list)
destroy(this.cb_next_1)
destroy(this.cb_delete)
destroy(this.cb_new)
destroy(this.cb_copy)
destroy(this.cbx_goto)
destroy(this.cb_1)
destroy(this.cb_properties)
destroy(this.cb_25)
destroy(this.cb_27)
destroy(this.cb_26)
destroy(this.sle_search)
destroy(this.cb_clear)
destroy(this.dw_detail)
destroy(this.gb_3)
end on

type cb_23 from commandbutton within tabpage_browse
integer x = 9
integer y = 48
integer width = 270
integer height = 84
integer taborder = 60
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "&Save"
end type

event clicked;//Start Code Change ----10.07.2014 #V14.2 maha - button added
dw_detail.update()
//---------Begin Added by (Appeon)Stephen 10.20.2014 for BugA101501--------
long ll_find, ll_view_id
long ll_row

ll_row = dw_report_list.getrow()
if ll_row < 1 then return
ll_view_id = dw_report_list.getitemnumber(ll_row, "view_id")
dw_report_list.setredraw(false)
//dw_report_list.retrieve()
of_report_retrieve( )   //Start Code Change ----07.25.2015 #V15 maha - corrected for security
ll_find = dw_report_list.find("view_id = "+string(ll_view_id), 1, dw_report_list.rowcount())
if ll_find > 0 then
	dw_report_list.scrolltorow(ll_find)
	dw_report_list.selectrow(0, false)
	dw_report_list.selectrow(ll_find, true)
end if
dw_report_list.setredraw(true)
//---------End Added ------------------------------------------------------
end event

type cb_security from commandbutton within tabpage_browse
integer x = 2139
integer y = 52
integer width = 288
integer height = 84
integer taborder = 80
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "Security"
end type

event clicked;string ls_parm
//report*I@ALL

ls_parm = string(il_view_id ) + "*I@ALL"
openwithparm(w_ireport_user_access,ls_parm)
end event

type cb_find from commandbutton within tabpage_browse
integer x = 841
integer y = 48
integer width = 270
integer height = 84
integer taborder = 50
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "&Find"
end type

event clicked;long ll_id
integer f

open(w_reportname_search)

ll_id = message.doubleparm

if ll_id = 0 then return

f = dw_report_list.find("view_id = " + string(ll_id),1,dw_report_list.rowcount())

if f > 0 then
	dw_report_list.scrolltorow(f)
	dw_report_list.setrow(f)
	dw_report_list.selectrow(0,false)
	dw_report_list.selectrow(f,true)
	
	of_retrieve_detail( ll_id)
end if
end event

type cb_select from commandbutton within tabpage_browse
integer x = 1399
integer y = 48
integer width = 270
integer height = 84
integer taborder = 30
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
boolean enabled = false
string text = "S&elect"
end type

event clicked;//dw_report_list.TriggerEvent( doubleClicked! )
Integer li_rc
Integer i
Integer li_found
Integer li_add_rec_fld
Integer li_distinct_sql
String ls_field
String ls_table_ids[]

ib_new = False

if upper(is_mod_user) = upper(gs_user_id) then //maha 111902
	tab_1.tabpage_columns.Enabled = True
	tab_1.tabpage_filter.Enabled = True
	tab_1.tabpage_preview.Enabled = True
	tab_1.tabpage_sort.Enabled = True
	tab_1.tabpage_tables.Enabled = True
else
	tab_1.tabpage_columns.Enabled = false
	tab_1.tabpage_filter.Enabled = false
	tab_1.tabpage_preview.Enabled = false
	tab_1.tabpage_sort.Enabled = false
	tab_1.tabpage_tables.Enabled = false	
end if

tab_1.tabpage_run.Enabled = True

IF dw_report_list.rowcount() > 0 THEN
	//$<add> 03.27.2008 by Andy
	ib_advanced = tab_1.tabpage_tables.cbx_advanced.checked
	//End add 03.27.2008
	il_view_id = dw_report_list.GetItemNumber( dw_report_list.getrow(), "view_id" )
	
	of_retrieve_report(il_view_id) //code moved 112202 maha
	
	//Start Code Change ----06.15.2016 #V152 maha
	dw_audit.reset()
	dw_audit.insertrow(1)
	dw_audit.setitem(1, "report_id", il_view_id)
	is_report_name = tab_1.tabpage_browse.dw_detail.getitemstring(1,"view_name")
	dw_audit.setitem(1, "report_name", is_report_name)
	dw_audit.setitem(1, "mod_user", gs_user_id)
	dw_audit.setitem(1, "add_edit", "E")
	dw_audit.setitem(1, "report_type", "C")
	//End Code Change ----06.15.2016
	
//--------------------------- APPEON BEGIN ---------------------------
//$<ID> PT-10
//$<modify> 02.09.2006 By: Rodger Wu
//$<reason> Performance tuning
//$<reason> of_save() has been called within tab_1.selectionchanging and 
//$<reason> it is unnecessary to call it repeatedly after running tab_1.SelectTab(7).
/*
	if cbx_goto.checked = true then
		tab_1.SelectTab( 7 )
	else
		tab_1.SelectTab( 2 )
	end if
	of_save() */
	
	//$<add> 02.29.2008 by Andy
	of_init_dynamic_dw()
	//end of add 02.29.2008
	
	//$<add> 04.16.2008 by Andy
	of_save()
	//end 04.16.2008
	
	tab_1.tabpage_run.dw_run.Reset() //Start Code Change ----05.25.2011 #V11 maha - moved from report double-clicked
	
	if cbx_goto.checked = true then	
		//$<modify> 07.08.2008 by Andy
		//tab_1.SelectTab( 7 )
		of_selecttab(7)
	else
		tab_1.SelectTab( 2 )
		//$<comment> 04.15.2008 by Andy
		//of_save()
	end if
//---------------------------- APPEON END ----------------------------
		
END IF
//---------Begin Added by (Appeon)Toney 11.22.2013 for V141 ISG-CLX--------
//$Reason:Fix history BugT071801
//tab_1.tabpage_tables.cb_show_selecttion.visible =(il_module = 2)
//tab_1.tabpage_columns.cb_selecttion.visible =(il_module = 2)
tab_1.tabpage_tables.cb_quick_select.visible =(il_module = 2 or il_module = 4) //Bug 4300 - alfee 11.18.2014
tab_1.tabpage_columns.cb_selection.visible =(il_module = 2 or il_module = 4) //Bug 4300 - alfee 11.18.2014
//---------End Added ------------------------------------------------------------------


end event

type dw_report_list from u_dw within tabpage_browse
integer y = 164
integer width = 3026
integer height = 1840
integer taborder = 20
boolean bringtotop = true
boolean titlebar = true
string title = "Select Report"
string dataobject = "d_cust_report_list_w_cat"
boolean hscrollbar = true
end type

event constructor;call super::constructor;//--------------------------- APPEON BEGIN ---------------------------
//$<ID> PT-11
//$<comment> 02.07.2006 By: Rodger Wu
//$<reason> Performance tuning
//$<modification> Move the following script into the Open event of w_custom_report 
//$<modification> due to the usage of CreateOnDemand.

//This.of_SetTransObject(SQLCA)
//This.Retrieve()
//
//IF dw_report_list.RowCount() > 0 THEN
//	dw_report_list.SetRow( 1 )
//	dw_report_list.SelectRow( 0, False )
//	dw_report_list.SelectRow( 1, True )
//
//END IF
//---------------------------- APPEON END ----------------------------

//--------------------------- APPEON BEGIN ---------------------------
//$<add> 2007-12-05 By: Andy
this.of_setrowselect( true)

this.of_setbase( true )
this.of_setresize( true )
this.inv_resize.of_setorigsize( this.width,this.height)
this.inv_resize.of_setminsize( this.width,this.height)
this.inv_resize.of_register(this.inv_resize.scale)
//$<add> 04.23.2008 by Andy
this.inv_resize.of_setheaderheight(true)
//end add 04.23.2008
//this.inv_resize.of_SetDetailHeight(true)
//---------------------------- APPEON END ----------------------------
end event

event clicked;call super::clicked;long ll_vid

IF row > 0 THEN
	This.SetRow( row )
	This.SelectRow( 0 , False )
	This.SelectRow( row, True )
	This.ScrollToRow( row )
	ll_vid = this.getitemnumber(row,"view_id")
	
	of_retrieve_detail(ll_vid)
//	dw_detail.settransobject(sqlca)
//	dw_detail.retrieve(ll_vid)
//	il_view_id = ll_vid
	
END IF
end event

event doubleclicked;call super::doubleclicked;

Integer li_rc
Integer i
Integer li_found
Integer li_add_rec_fld
Integer li_distinct_sql
String ls_field
String ls_table_ids[]

//$<add> 01.08.2008 by: Andy
//$Reason:if row < 1, then ignore.(bug:BugN122803,BugN122806)
if row < 1 then return
//end of add 01.08.2008

ib_new = False

//if upper(is_mod_user) = upper(gs_user_id) then //maha 111902
//	tab_1.tabpage_columns.Enabled = True
//	tab_1.tabpage_filter.Enabled = True
//	tab_1.tabpage_preview.Enabled = True
//	tab_1.tabpage_sort.Enabled = True
//	tab_1.tabpage_tables.Enabled = True
//else
//	tab_1.tabpage_columns.Enabled = false
//	tab_1.tabpage_filter.Enabled = false
//	tab_1.tabpage_preview.Enabled = false
//	tab_1.tabpage_sort.Enabled = false
//	tab_1.tabpage_tables.Enabled = false	
//end if

tab_1.tabpage_run.Enabled = True
//tab_1.tabpage_run.dw_run.Reset() //Start Code Change ----05.25.2011 #V11 maha - moved to cd_select.clicked

IF row > 0 THEN
	cb_select.TriggerEvent( Clicked! )
//	il_view_id = This.GetItemNumber( row, "view_id" )
//	
//	of_retrieve_report(il_view_id) //code moved 112202 maha
//	
//	tab_1.SelectTab( 7 )
//	
//	of_save()
//	
END IF




end event

event retrieveend;call super::retrieveend;//IF rowcount > 0 THEN
//	cb_select.Enabled = True
//	cb_delete.Enabled = True
//END IF


end event

event rowfocuschanged;call super::rowfocuschanged;//--------------------------- APPEON BEGIN ---------------------------
//$<Modify> 2007-12-06 By: Andy

string ls_name// Added by  Nova 07.08.2009------------------------
window lw_win// Added by  Nova 07.08.2009------------------------
long ll_view_id
integer li_save_count  //maha 12.12.2017

if currentrow < 1 or currentrow > this.Rowcount( ) then return
//--------Begin Added by Nova 07.08.2009------------------------
//setting the window's title is report's name(Corrected BugN061003)
ls_name = this.getitemstring(currentrow,"view_name")
lw_win=tab_1.getparent()
lw_win.title = "IntelliReport ( " + ls_name + " )" 
//--------End Added --------------------------------------------

il_module       = this.getitemnumber( currentrow, "module")
il_data_view_id = this.getitemnumber( currentrow, "data_view_id")
//---------Begin Added by (Appeon)Stephen 05.12.2014 for IntelliReport Modifications 14.2--------
if il_module = 4 then
	il_data_view_id_cont = this.getitemnumber( currentrow, "data_view_id_cont")
else
	il_data_view_id_cont = il_data_view_id
end if
//---------End Added ------------------------------------------------------

//Start Code Change ----04.22.2014 #V14.2 maha
ll_view_id = this.GetItemNumber(currentrow,"view_id")
dw_detail.retrieve(ll_view_id)
//End Code Change ----04.22.2014

//$<modify> 05.26.2008 by Andy
datawindowChild ldwc_1,ldwc_2,ldwc_3,ldwc_4
if tab_1.tabpage_tables.dw_view_links.GetChild( "link_from_field_db" , ldwc_1) = 1 then
	ldwc_1.settransobject( SQLCA )
	ldwc_1.retrieve( il_module, il_data_view_id )
	
	if tab_1.tabpage_tables.dw_view_links.GetChild( "link_to_field_db" , ldwc_2) = 1 then
		ldwc_2.settransobject( SQLCA )
		//ldwc_2.retrieve( il_module, il_data_view_id )
		ldwc_1.sharedata( ldwc_2 )
	end if
	
	if tab_1.tabpage_sort.dw_view_sort.GetChild( "dbname" , ldwc_3) = 1 then
		ldwc_3.settransobject( SQLCA )
		//ldwc_3.retrieve( il_module, il_data_view_id )
		ldwc_1.sharedata( ldwc_3 )
	end if	
	
	if tab_1.tabpage_columns.dw_all_fields.getchild('dbname',ldwc_4) = 1 then
		ldwc_4.settransobject( SQLCA )
		//ldwc_4.retrieve( il_module, il_data_view_id )
		ldwc_1.sharedata( ldwc_4 )
	end if

end if

//---------------------------- APPEON END ----------------------------

//Start Code Change ----12.12.2017 #V16 maha - Store button visibility
select count(srs_id) into :li_save_count from sys_report_storage where report_id = :ll_view_id and report_type = 'C';
if li_save_count > 0 then
	tab_1.tabpage_run.cb_store.visible = true
else
	tab_1.tabpage_run.cb_store.visible = false
end if
end event

event other;call super::other;//$<add> 04.17.2008 by Andy
if Message.WordParm = 61458 then 
	Message.Processed = true
	Message.ReturnValue = 0 
end if
end event

event resize;call super::resize;this.scrolltorow(il_resize_number)//For restore the rowsfocuse before resizing( Corrected BugN061005)  Added by  Nova 07.10.2009------------------------

//Start Code Change ----04.22.2014 #V14.2 maha
//long n
//long w
//
//n = this.x + this.width + 10
//dw_detail.x = n 
//w = tab_1.width
//dw_detail.width =  w - n - 25

end event

event rowfocuschanging;call super::rowfocuschanging;il_resize_number=currentrow//For save the currentrow( Corrected BugN061005)  Added by  Nova 07.10.2009------------------------
end event

type cb_next_1 from commandbutton within tabpage_browse
integer x = 4037
integer y = 48
integer width = 334
integer height = 84
integer taborder = 40
boolean bringtotop = true
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "Ne&xt ->"
end type

event clicked;integer r
string f


//$<add> 01.07.2008 by: Andy
//Reason: if GetRow() < 1,then the system will crash.
if dw_detail.GetRow() < 1 then return
//end of add

dw_detail.AcceptText()
IF IsNull( dw_detail.GetItemString( 1, "view_name" )) THEN
	//---------Begin Modified by (Appeon)Stephen 05.05.2014 for V142 Schedule IntelliReport--------
	//MessageBox("Missing Data", "The name of the report must be filled in." )
	inv_message.of_messagebox("Missing Data", "The name of the report must be filled in." , true)
	ib_run_sucess = false
	//---------End Modfiied ------------------------------------------------------
	dw_detail.SetFocus()
	Return 
END IF

gnv_appeonDb.of_StartQueue()

dw_detail.Update()

of_report_retrieve( )  //Start Code Change ----06.29.2011 #V11 maha

//comment 12.11.2007 by: Andy
//IF ib_new THEN
//	tab_1.tabpage_tables.dw_select_table.Retrieve()
//END IF

gnv_appeonDb.of_CommitQueue()
//---------------------------- APPEON END ----------------------------



f = "view_id = " + string(il_view_id)

r = dw_report_list.find(f,1,dw_report_list.rowcount())
dw_report_list.ScrollToRow( r )
dw_report_list.SetRow( r )
//--------Begin Added by Nova 07.28.2008------------------------
dw_report_list.event rowfocuschanged( r )
//--------End Added --------------------------------------------
dw_report_list.SelectRow( 0, False )
dw_report_list.SelectRow( r, TRue )


tab_1.tabpage_tables.Enabled = True
//$<add> 04.16.2008 by Andy
if Not ib_new then of_save()
//end 04.16.2008
tab_1.SelectTab( 2 )
end event

type cb_delete from commandbutton within tabpage_browse
integer x = 567
integer y = 48
integer width = 270
integer height = 84
integer taborder = 30
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
boolean enabled = false
string text = "&Delete"
end type

event clicked;Integer li_view_id
integer res

res = messagebox("Delete Report","Are you sure you want to delete this report?",question!,yesno!,2)
if res = 2 then 	return

//Start Code Change ----08.19.2014 #V14.2 maha - added second message
res = messagebox("Delete Report","Are you positive you want to delete this report?  It will not be recoverable.",question!,yesno!,2)
if res = 2 then 	return
//End Code Change ----08.19.2014

IF dw_report_list.RowCount() = 0 THEN
	Return
END IF

li_view_id = dw_detail.GetItemNumber( 1, "view_id" )
//--------------------------- APPEON BEGIN ---------------------------
//$<ID> PT-13
//$<modify> 02.08.2006 By: Rodger Wu
//$<reason> Performance tuning
//$<modification> Add Appeon Queue labels to reduce client-server interactions to improve runtime performance.

/*
Delete 
From conv_view_where
Where view_id = :li_view_id;
IF SQLCA.SQLCODE = -1 THEN
	MessageBox( "Error", SQLCA.SQLERRTEXT )
	Return -1
END IF

Delete 
From conv_view_table
Where view_id = :li_view_id;
IF SQLCA.SQLCODE = -1 THEN
	MessageBox( "Error", SQLCA.SQLERRTEXT )
	Return -1
END IF

Delete 
From conv_view_fields
Where view_id = :li_view_id;
IF SQLCA.SQLCODE = -1 THEN
	MessageBox( "Error", SQLCA.SQLERRTEXT )
	Return -1
END IF

Delete 
From conv_view_links
Where view_id = :li_view_id;
IF SQLCA.SQLCODE = -1 THEN
	MessageBox( "Error", SQLCA.SQLERRTEXT )
	Return -1
END IF

Delete 
From conv_view_sort //maha 042202
Where view_id = :li_view_id;
IF SQLCA.SQLCODE = -1 THEN
	MessageBox( "Error", SQLCA.SQLERRTEXT )
	Return -1
END IF

Delete 
From conv_view
Where view_id = :li_view_id;
IF SQLCA.SQLCODE = -1 THEN
	MessageBox( "Error", SQLCA.SQLERRTEXT )
	Return -1
END IF

dw_report_list.Retrieve()
*/

gnv_appeondb.of_StartQueue()
Delete 
From conv_view_where
Where view_id = :li_view_id;
IF SQLCA.SQLCODE = -1 THEN
	//---------Begin Modified by (Appeon)Stephen 05.05.2014 for V142 Schedule IntelliReport--------
	//MessageBox( "Error", SQLCA.SQLERRTEXT )
	inv_message.of_messagebox("Error", SQLCA.SQLERRTEXT , true)
	ib_run_sucess = false
	//---------End Modfiied ------------------------------------------------------
	gnv_appeondb.of_CommitQueue()
	Return -1
END IF

Delete 
From conv_view_table
Where view_id = :li_view_id;
IF SQLCA.SQLCODE = -1 THEN
	//---------Begin Modified by (Appeon)Stephen 05.05.2014 for V142 Schedule IntelliReport--------
	//MessageBox( "Error", SQLCA.SQLERRTEXT )
	inv_message.of_messagebox("Error", SQLCA.SQLERRTEXT , true)
	ib_run_sucess = false
	//---------End Modfiied ------------------------------------------------------
	gnv_appeondb.of_CommitQueue()
	Return -1
END IF

Delete 
From conv_view_fields
Where view_id = :li_view_id;
IF SQLCA.SQLCODE = -1 THEN
	//---------Begin Modified by (Appeon)Stephen 05.05.2014 for V142 Schedule IntelliReport--------
	//MessageBox( "Error", SQLCA.SQLERRTEXT )
	inv_message.of_messagebox("Error", SQLCA.SQLERRTEXT , true)
	ib_run_sucess = false
	//---------End Modfiied ------------------------------------------------------
	gnv_appeondb.of_CommitQueue()
	Return -1
END IF

Delete 
From conv_view_links
Where view_id = :li_view_id;
IF SQLCA.SQLCODE = -1 THEN
	//---------Begin Modified by (Appeon)Stephen 05.05.2014 for V142 Schedule IntelliReport--------
	//MessageBox( "Error", SQLCA.SQLERRTEXT )
	inv_message.of_messagebox("Error", SQLCA.SQLERRTEXT , true)
	ib_run_sucess = false
	//---------End Modfiied ------------------------------------------------------
	gnv_appeondb.of_CommitQueue()
	Return -1
END IF

Delete 
From conv_view_sort //maha 042202
Where view_id = :li_view_id;
IF SQLCA.SQLCODE = -1 THEN
	//---------Begin Modified by (Appeon)Stephen 05.05.2014 for V142 Schedule IntelliReport--------
	//MessageBox( "Error", SQLCA.SQLERRTEXT )
	inv_message.of_messagebox("Error", SQLCA.SQLERRTEXT , true)
	ib_run_sucess = false
	//---------End Modfiied ------------------------------------------------------
	gnv_appeondb.of_CommitQueue()
	Return -1
END IF

Delete 
From conv_view
Where view_id = :li_view_id;
IF SQLCA.SQLCODE = -1 THEN
	//---------Begin Modified by (Appeon)Stephen 05.05.2014 for V142 Schedule IntelliReport--------
	//MessageBox( "Error", SQLCA.SQLERRTEXT )
	inv_message.of_messagebox("Error", SQLCA.SQLERRTEXT , true)
	ib_run_sucess = false
	//---------End Modfiied ------------------------------------------------------
	gnv_appeondb.of_CommitQueue()
	Return -1
END IF
Delete From ctx_report_syntax Where view_id = :li_view_id; //Evan 09.03.2010 (V10.5-Advanced Report)

//Start Code Change ----06.29.2011 #V11 maha 
Delete From security_user_ireport Where report_id = :li_view_id;
IF SQLCA.SQLCODE = -1 THEN
	//---------Begin Modified by (Appeon)Stephen 05.05.2014 for V142 Schedule IntelliReport--------
	//MessageBox( "Error", SQLCA.SQLERRTEXT )
	inv_message.of_messagebox("Error", SQLCA.SQLERRTEXT , true)
	ib_run_sucess = false
	//---------End Modfiied ------------------------------------------------------
	gnv_appeondb.of_CommitQueue()
	Return -1
END IF
//End Code Change ----06.29.2011

//Start Code Change ----07.25.2016 #V152 maha
//dw_audit.update()  //(Appeon) Modified by harry 07.26.2016 
dw_audit.reset()
dw_audit.insertrow(1)
dw_audit.setitem(1, "report_id", il_view_id)
//is_report_name = tab_1.tabpage_browse.dw_report_list.getitemstring(1,"view_name")  //(Appeon) Modified by harry 07.26.2016 BugH070401
is_report_name = tab_1.tabpage_browse.dw_detail.getitemstring(1,"view_name")  //(Appeon) Added by harry 07.26.2016 BugH070401
dw_audit.setitem(1, "report_name", is_report_name)
dw_audit.setitem(1, "mod_user", gs_user_id)
dw_audit.setitem(1, "report_type", "C")
dw_audit.setitem(1, "add_edit", "D")
dw_audit.setitem(1, "mod_date", datetime(today(),now()))
dw_audit.update()
//End Code Change ----07.25.2016

of_report_retrieve( )  //Start Code Change ----06.29.2011 #V11 maha
gnv_appeondb.of_CommitQueue()

//---------------------------- APPEON END ----------------------------

IF dw_report_list.RowCount() > 0 THEN
	dw_report_list.SetRow( 1 )
	dw_report_list.SelectRow( 0, False )
	dw_report_list.SelectRow( 1, True )
	li_view_id = dw_report_list.GetItemNumber( 1, "view_id" )
	
	of_retrieve_detail(li_view_id)
//$<add> 01.07.2008 by: Andy
else
	//$<add> 04.28.2008 by Andy
	//$<Reason> Fixed BugN042801
	of_clean_up()
	tab_1.tabpage_columns.Enabled = false
	tab_1.tabpage_filter.Enabled = false
	tab_1.tabpage_preview.Enabled = false
	tab_1.tabpage_sort.Enabled = false
	tab_1.tabpage_tables.Enabled = false
	tab_1.tabpage_run.Enabled = false
	tab_1.tabpage_browse.cb_next_1.enabled = false
	//end add 04.28.2008
	
	dw_detail.Reset()
//end of add 01.07.2008
END IF

if IsValid(w_DashBoard) then w_DashBoard.Of_Refres_All_Tabs()		//Added by Scofield on 2009-08-07//(Appeon)Toney 07.24.2013 - V141 ISG-CLX

end event

type cb_new from commandbutton within tabpage_browse
integer x = 288
integer y = 48
integer width = 270
integer height = 84
integer taborder = 50
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "&New"
end type

event clicked;//--------------------------- APPEON BEGIN ---------------------------
//$<Modify> 2007-12-05 By: Andy

Integer li_nr
Long ll_next_view_id
integer i
string ls_parm //maha 06.29.2011

If dw_detail.Modifiedcount() > 0 or dw_detail.DeletedCount() > 0 Then
	if dw_detail.update() <> 1 then
		return
	end if
	commit using sqlca;
End If

ib_new = True

gnv_appeondb.of_StartQueue()
//li_nr = dw_detail.InsertRow( 1 )

//cb_select.Enabled = false
//cb_copy.Enabled = false
cb_next_1.Enabled = True

SELECT Max( table_id )  
INTO :il_next_table_id  
FROM conv_view_table;
//---------Begin Commented by (Appeon)Toney 05.31.2013 for V141 ISG-CLX--------
//$Reason:can't get the value in queue
  /*
    IF IsNull( il_next_table_id ) THEN
		il_next_table_id = 1
	END IF 
  */
//---------End Commented ------------------------------------------------------


SELECT Max( link_id )  
INTO :il_next_link_id  
FROM conv_view_links;
//---------Begin Commented by (Appeon)Toney 05.31.2013 for V141 ISG-CLX--------
//$Reason:can't get the value in queue
  /*
	IF IsNull( il_next_link_id ) THEN
		il_next_link_id = 1
	END IF     
  */
//---------End Commented ------------------------------------------------------

SELECT Max( sort_id )  
INTO :il_next_sort_id  
FROM conv_view_sort;
//---------Begin Commented by (Appeon)Toney 05.31.2013 for V141 ISG-CLX--------
//$Reason:can't get the value in queue
  /*
	IF IsNull( il_next_sort_id ) THEN
		il_next_sort_id = 1
	END IF     
  */
//---------End Commented ------------------------------------------------------

SELECT Max( field_id )  
INTO :il_next_field_id  
FROM conv_view_fields;
//---------Begin Commented by (Appeon)Toney 05.31.2013 for V141 ISG-CLX--------
//$Reason:can't get the value in queue
  /*
	IF IsNull( il_next_field_id ) THEN
		il_next_field_id = 1
	END IF     
  */
//---------End Commented ------------------------------------------------------

SELECT Max( where_id )  
INTO :il_next_where_id  
FROM conv_view_where;
//---------Begin Commented by (Appeon)Toney 05.31.2013 for V141 ISG-CLX--------
//$Reason:can't get the value in queue
  /*
	IF IsNull( il_next_where_id ) THEN
		il_next_where_id = 1
	END IF     
  */
//---------End Commented ------------------------------------------------------


//Start Code Change ----04.18.2012 #V12 maha - moved view id set to properties window
//SELECT Max( view_id )  
//INTO :ll_next_view_id  
//FROM conv_view  ;
gnv_appeondb.of_CommitQueue()
//---------Begin Added by (Appeon)Toney 06.13.2013 for V141 ISG-CLX--------
//$Reason:can't get the value in queue
IF IsNull( il_next_table_id ) THEN
	il_next_table_id = 1
END IF

IF IsNull( il_next_link_id ) THEN
	il_next_link_id = 1
END IF

IF IsNull( il_next_sort_id ) THEN
	il_next_sort_id = 1
END IF

IF IsNull( il_next_field_id ) THEN
	il_next_field_id = 1
END IF

IF IsNull( il_next_where_id ) THEN
	il_next_where_id = 1
END IF
//---------End Added ------------------------------------------------------------------

//IF IsNull( ll_next_view_id ) THEN
//	ll_next_view_id = 1
//ELSE
//	ll_next_view_id ++
//END IF

//il_view_id = ll_next_view_id
il_view_id = 0
//End Code Change ----04.18.2012 #V12

//dw_detail.SetItem( li_nr, "view_id", ll_next_view_id  )
//dw_detail.SetItem( li_nr, "project_id", ii_project_id )
//dw_detail.SetItem( li_nr, "create_date", datetime(today(),now()) )
//dw_detail.SetItem( li_nr, "created_by", gs_user_id )
//dw_detail.SetItem( li_nr, "mod_user", "All" )

str_parm  lstr_parm

lstr_parm.s_type = "new"
lstr_parm.l_wf_id = il_view_id
lstr_parm.u_dw = dw_report_list

openwithparm(w_custom_report_properties,lstr_parm)

lstr_parm = Message.Powerobjectparm
if Not isValid(lstr_parm) or isNull(lstr_parm) then return

if lstr_parm.s_type = "ok" then
	of_clean_up()

	tab_1.tabpage_run.Enabled = False
	tab_1.tabpage_preview.Enabled = False
	tab_1.tabpage_filter.Enabled = False
	tab_1.tabpage_sort.Enabled = False
	tab_1.tabpage_columns.Enabled = False
	tab_1.tabpage_tables.Enabled = False
	//tab_1.tabpage_browse.dw_detail.enabled = true
	//dw_detail.object.category.background.color = rgb(255,255,255) //white
	//dw_detail.object.view_name.background.color = rgb(255,255,255)
	//dw_detail.object.mod_user.background.color = rgb(255,255,255)
	
	tab_1.tabpage_columns.dw_view_fields.Retrieve( il_view_id )

	tab_1.tabpage_tables.cbx_distinct.Checked = True
	//$<add> 03.27.2008 by Andy
	ib_advanced = tab_1.tabpage_tables.cbx_advanced.checked
	tab_1.tabpage_tables.cbx_advanced.Checked = False
	tab_1.tabpage_tables.cbx_advanced.event clicked( )

	//dw_detail.SetFocus( )
	//dw_detail.SetColumn( "view_name" )
	//dw_detail.SetRow( li_nr )
	
	//$<modify> 03.21.2008 by Andy
	//dw_detail.retrieve(il_view_id)
	//Start Code Change ----04.18.2012 #V12 maha - set report id from return value
	il_view_id = lstr_parm.l_wf_id  
	of_retrieve_detail(il_view_id)
	//Start Code Change ----04.18.2012
	
	//Start Code Change ----06.15.2016 #V152 maha
	dw_audit.reset()
	dw_audit.insertrow(1)
	dw_audit.setitem(1, "report_id", il_view_id)
	dw_audit.setitem(1, "report_name",tab_1.tabpage_browse.dw_detail.getitemstring(1,"view_name"))
	dw_audit.setitem(1, "mod_user", gs_user_id)
	dw_audit.setitem(1, "add_edit", "A")
	dw_audit.setitem(1, "report_type", "C") //(Appeon)Stephen 09.18.2016 - V15.2 Testing Bug #5337: Report audit trail does not record Report Type when creating an iReport
	//End Code Change ----06.15.2016

	//Start Code Change ----06.29.2011 #V11 maha 
	if of_get_app_setting("set_60","I") =  1 then
		if w_mdi.of_security_access(7195) = 1 then
			ls_parm = string(il_view_id ) + "*I@ALL"
			openwithparm(w_ireport_user_access,ls_parm)
		else  //Start Code Change ----07.18.2011 #V11 maha 
			string s_rpt
			s_rpt = string(il_view_id)
			insert into security_user_ireport (user_id,report_id,report_type,access_rights) values(:gs_user_id, :s_rpt, 'I',1 );
			commit using sqlca;
		end if
	else
		
	end if
	//End Code Change ----06.29.2011
	
	//$<add> 02.14.2008 by Andy
	cb_next_1.event clicked()
	//--------Begin Added by Nova 08.24.2010------------------------
	//V10.5 SK IntelliReport
	if gb_sk_ver and (il_module=2) then
		open(w_custom_report_selection)
		w_custom_report_selection.BringToTop = TRUE
		if isvalid(w_custom_report_selection) then
			tab_1.tabpage_columns.dw_view_fields.sharedata(w_custom_report_selection.uo_1.dw_selected_field)
		end if
   end if
	//--------End Added --------------------------------------------


end if
//---------------------------- APPEON END ----------------------------
end event

type cb_copy from commandbutton within tabpage_browse
integer x = 1120
integer y = 48
integer width = 270
integer height = 84
integer taborder = 40
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "&Copy"
end type

event clicked;integer res
n_ds lds_view
n_ds lds_table
n_ds lds_link
n_ds lds_field
n_ds lds_filter
n_ds lds_sort
long ll_next_view_id
long ll_null
string ls_null
string ls_name
string ls_parm //maha 08.30.2011
integer i
integer ic, li_row
integer ck = 0 

res = messagebox("Copy report","Are you sure you wish to copy this report?",question!,yesno!,1)

if res = 2 then 
	return
end if

IF dw_report_list.rowcount() > 0 THEN	
	ls_name = dw_detail.getitemstring(1,"view_name")
	ls_name = "Copy of " + ls_name
	//$<modify> 05.14.2008 by Andy
	ls_name = MidA(ls_name,1,100)//30
	
	setnull(ll_null)
	setnull(ls_null)
	SELECT Max( view_id )  
	INTO :ll_next_view_id  
	FROM conv_view  ;
	
	of_retrieve_report(il_view_id)

	IF IsNull( ll_next_view_id ) THEN
		ll_next_view_id = 1
	ELSE
		ll_next_view_id ++
	END IF
	
	il_view_id = ll_next_view_id
	
	
 

	lds_view = CREATE n_ds
	lds_view.DataObject = "d_cust_report_detail"
	lds_view.of_SetTransObject( SQLCA )
	
	lds_table = CREATE n_ds
	
	//------------------- APPEON BEGIN -------------------
	//<$>added:long.zhang 12.08.2016
	//<$>reason:for Issue id 5351 - SQL Server 2014 and 2016 Partial Contained Databases and High Availability Groups
	//lds_table.DataObject = "d_conv_view_tables_report"
	If gs_dbtype = 'SQL' THEN
		lds_table.DataObject = "d_conv_view_tables_report_sql"
	Else
		lds_table.DataObject = "d_conv_view_tables_report_asa"
	End If
	//------------------- APPEON END -------------------
	
	lds_table.of_SetTransObject( SQLCA )
	
	lds_link = CREATE n_ds
	lds_link.DataObject = "d_conv_view_links"
	lds_link.of_SetTransObject( SQLCA )
	
	lds_field = CREATE n_ds
	lds_field.DataObject = "d_view_selected_fields"
	lds_field.of_SetTransObject( SQLCA )
	
	lds_filter = CREATE n_ds
	lds_filter.DataObject = "d_view_where"
	lds_filter.of_SetTransObject( SQLCA )
	
	lds_sort = CREATE n_ds
	lds_sort.DataObject = "d_cust_report_sort"
	lds_sort.of_SetTransObject( SQLCA )
	
	//copy view	
	tab_1.tabpage_browse.dw_detail.RowsCopy (1, 1, primary!, lds_view, 500, primary! )
	for i = 1 to lds_view.rowcount()
		lds_view.setitem(i,"view_id",il_view_id)
		lds_view.setitem(i,"view_name",ls_name)
		//lds_view.setitem(i,"category",ls_null)
		lds_view.setitem(i,"mod_user",gs_user_id)
		lds_view.setitem(i,"created_by",gs_user_id)
		lds_view.setitem(i,"create_date",datetime(today(),now())) 
	next
	
	//copy tables
	tab_1.tabpage_tables.dw_view_tables.RowsCopy (1, tab_1.tabpage_tables.dw_view_tables.rowcount(), primary!, lds_table, 500, primary! )
	//ic = tab_1.tabpage_tables.dw_view_tables.rowcount()
	//messagebox("table",ic)
	//return
	
	li_row = lds_table.rowcount()
	il_next_table_id = gnv_app.of_get_irep_id("conv_view_table", li_row)  //add by stephen 03.27.2013 -IntelliReport primary key issues
	for i = 1 to lds_table.rowcount()
		//il_next_table_id++  //delete by stephen 03.27.2013 -IntelliReport primary key issues
		lds_table.setitem(i,"view_id",il_view_id)
		lds_table.setitem(i,"table_id",il_next_table_id - li_row + i)
	next
	
	//copy links
	tab_1.tabpage_tables.dw_view_links.RowsCopy (1, tab_1.tabpage_tables.dw_view_links.rowcount(), primary!, lds_link, 500, primary! )
	li_row = lds_link.rowcount()
	il_next_link_id = gnv_app.of_get_irep_id("conv_view_links", li_row)  //add by stephen 03.27.2013 -IntelliReport primary key issues
	for i = 1 to lds_link.rowcount()
		//il_next_link_id++  //delete by stephen 03.27.2013 -IntelliReport primary key issues
		lds_link.setitem(i,"view_id",il_view_id)
		lds_link.setitem(i,"link_id",il_next_link_id - li_row +i)
	next
	
	//copy fields
	tab_1.tabpage_columns.dw_view_fields.RowsCopy (1, tab_1.tabpage_columns.dw_view_fields.rowcount(), primary!, lds_field, 500, primary! )
	li_row = lds_field.rowcount()
	il_next_field_id = gnv_app.of_get_irep_id("conv_view_fields", li_row)  //add by stephen 03.27.2013 -IntelliReport primary key issues
	for i = 1 to lds_field.rowcount()
		//il_next_field_id++  //delete by stephen 03.27.2013 -IntelliReport primary key issues
		lds_field.setitem(i,"view_id",il_view_id)
		lds_field.setitem(i,"field_id",il_next_field_id - li_row +i)
	next
	
	//copy filter
	tab_1.tabpage_filter.dw_view_where.RowsCopy (1, tab_1.tabpage_filter.dw_view_where.rowcount(), primary!, lds_filter, 500, primary! )
	li_row = lds_filter.rowcount()
	il_next_where_id = gnv_app.of_get_irep_id("conv_view_where", li_row)  //add by stephen 03.27.2013 -IntelliReport primary key issues
	for i = 1 to lds_filter.rowcount()
		//il_next_where_id++  //delete by stephen 03.27.2013 -IntelliReport primary key issues
		lds_filter.setitem(i,"view_id",il_view_id)
		lds_filter.setitem(i,"where_id",il_next_where_id - li_row +i)
	next

		//copy sort
	tab_1.tabpage_sort.dw_view_sort.RowsCopy (1, tab_1.tabpage_sort.dw_view_sort.rowcount(), primary!, lds_sort, 500, primary! )
	li_row = lds_sort.rowcount()
	il_next_sort_id = gnv_app.of_get_irep_id("conv_view_sort", li_row)  //add by stephen 03.27.2013 -IntelliReport primary key issues
	for i = 1 to lds_sort.rowcount()
		//il_next_sort_id++ //delete by stephen 03.27.2013 -IntelliReport primary key issues
		lds_sort.setitem(i,"view_id",il_view_id)
		lds_sort.setitem(i,"sort_id",il_next_sort_id - li_row +i)
	next

//--------------------------- APPEON BEGIN ---------------------------
//$<ID> PT-17
//$<modify> 02.09.2006 By: Rodger Wu
//$<reason> Performance tuning
//$<modification> Add Appeon Update label to reduce client-server interactions to improve runtime performance.

/*
	if lds_table.update() = 1 then
		if	lds_link.update() = 1 then
			if lds_field.update() = 1 then
				if lds_filter.update() = 1 then
					if lds_sort.update() = 1 then
						if lds_view.update() = 1 then
							commit using sqlca;
							ck = 1
						else
							messagebox("Save error", "Error Saving VIEW.  Copy not saved.")
						end if
					else
						messagebox("Save error", "Error Saving SORT.  Copy not saved.")
					end if
				else
					messagebox("Save error", "Error Saving FILTER.  Copy not saved.")
				end if
			else
				messagebox("Save error", "Error Saving FIELDS.  Copy not saved.")
			end if
		else
			messagebox("Save error", "Error Saving LINKS.  Copy not saved.")
		end if
	else
		messagebox("Save error", "Error Saving TABLE.  Copy not saved.")
	end if
					
	if ck = 1 then
		of_retrieve_detail(il_view_id)
		of_retrieve_report(il_view_id)
		dw_report_list.retrieve()
*/
	Integer li_return

	li_return = gnv_appeonDb.of_Update( lds_table, lds_link, lds_field )
	If li_return = -101 Then
		messagebox("Save error", "Error Saving TABLE.  Copy not saved.")
	Elseif li_return = -102 Then
		messagebox("Save error", "Error Saving LINKS.  Copy not saved.")
	Elseif li_return = -103 Then
		messagebox("Save error", "Error Saving FIELDS.  Copy not saved.")
	Else
		li_return = gnv_appeonDb.of_Update( lds_filter, lds_sort, lds_view )
		If li_return = -101 Then
			messagebox("Save error", "Error Saving FILTER.  Copy not saved.")
		Elseif li_return = -102 Then
			messagebox("Save error", "Error Saving SORT.  Copy not saved.")
		Elseif li_return = -103 Then
			messagebox("Save error", "Error Saving VIEW.  Copy not saved.")
		Else
			ck = 1
		End If
	End If
	
	if ck = 1 then
		//Start Code Change ----08.29.2011 #V11 maha 
		if of_get_app_setting("set_60","I") =  1 then
			if w_mdi.of_security_access(7195) = 1 then
				ls_parm = string(il_view_id ) + "*I@ALL"
				openwithparm(w_ireport_user_access,ls_parm)
			else  //Start Code Change ----08..2011 #V11 maha 
				string s_rpt
				s_rpt = string(il_view_id)
				insert into security_user_ireport (user_id,report_id,report_type,access_rights) values(:gs_user_id, :s_rpt, 'I',1 );
				commit using sqlca;
			end if
		else
			//no security
		end if
		//End Code Change ----08.29.2011
		gnv_appeondb.of_StartQueue()
		of_report_retrieve( )  //Start Code Change ----06.29.2011 #V11 maha - replaced dw_report_list.retrieve
		of_retrieve_detail(il_view_id)
		gnv_appeondb.of_CommitQueue()
		
		of_retrieve_report(il_view_id)
//---------------------------- APPEON END ----------------------------		
		ic = dw_report_list.find("view_id = " + string(il_view_id),1 ,dw_report_list.rowcount())
		if ic > 0 then
			dw_report_list.scrolltorow(ic)
			dw_report_list.setrow(ic)
			dw_report_list.selectrow(0,false)
			dw_report_list.selectrow(ic,true)
		elseif ic = 0 then //Start Code Change ----08.30.2011 #V11 maha 
			messagebox("Unable to find Copied report","If Report security is turned on access Report security for this report.")
		else
			messagebox("Find error","")
		end if
	end if
END IF
//messagebox("","This function not complete")
end event

type cbx_goto from checkbox within tabpage_browse
integer x = 1682
integer y = 48
integer width = 462
integer height = 84
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long textcolor = 33554432
long backcolor = 33551856
string text = "Preview Report"
boolean checked = true
end type

type cb_1 from commandbutton within tabpage_browse
boolean visible = false
integer x = 4105
integer y = 72
integer width = 247
integer height = 92
integer taborder = 20
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
boolean enabled = false
string text = "&New"
end type

event clicked;ib_new = True

of_get_next_ids()

cb_next_1.Enabled = True

Integer li_nr
Long ll_next_view_id  

li_nr = dw_report_list.InsertRow( 0 )

dw_report_list.ScrollToRow( li_nr )
dw_report_list.SetRow( li_nr )
dw_report_list.SetFocus()
dw_report_list.SelectRow( 0, False )
dw_report_list.SelectRow( li_nr, TRue )

cb_next_1.Enabled = True

SELECT Max( view_id )  
INTO :ll_next_view_id  
FROM conv_view  ;

IF IsNull( ll_next_view_id ) THEN
	ll_next_view_id = 1
ELSE
	ll_next_view_id ++
END IF

il_view_id = ll_next_view_id

dw_report_list.SetItem( li_nr, "view_id", ll_next_view_id  )
dw_report_list.SetItem( li_nr, "project_id", ii_project_id )

of_clean_up()

tab_1.tabpage_run.Enabled = False
tab_1.tabpage_preview.Enabled = False
tab_1.tabpage_filter.Enabled = False
tab_1.tabpage_sort.Enabled = False
tab_1.tabpage_columns.Enabled = False
tab_1.tabpage_tables.Enabled = False

tab_1.tabpage_columns.dw_view_fields.Retrieve( il_view_id )

tab_1.tabpage_tables.cbx_distinct.Checked = True
end event

type cb_properties from commandbutton within tabpage_browse
boolean visible = false
integer x = 3566
integer y = 80
integer width = 288
integer height = 84
integer taborder = 80
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
boolean enabled = false
string text = "&Properties"
end type

event clicked;//--------------------------- APPEON BEGIN ---------------------------
//$<add> 2007-12-05 By: Andy
Long ll_view_id
str_parm  lstr_parm
if dw_detail.rowcount() < 1 then return //(Appeon)stephen 06.05.2013- Invalid DataWindow row/column
//---------Begin Modified by (Appeon)Toney 06.13.2013 for V141 ISG-CLX--------
//$Reason:
  /*
   ll_view_id = dw_detail.GetItemNumber( 1, "view_id" )   
  */
if dw_report_list.rowcount() < 1 then return
ll_view_id = dw_report_list.GetItemNumber(dw_report_list.GetRow(),"view_id")
//---------End Modfiied ------------------------------------------------------------------
lstr_parm.l_wf_id = ll_view_id
lstr_parm.s_type = "properties"
lstr_parm.u_dw = dw_report_list

openwithparm(w_custom_report_properties,lstr_parm)
//---------------------------- APPEON END ----------------------------
end event

type cb_25 from commandbutton within tabpage_browse
boolean visible = false
integer x = 3717
integer y = 76
integer width = 306
integer height = 84
integer taborder = 60
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
boolean enabled = false
string text = "Auto Report"
end type

event clicked;Open(w_auto_report)  //(Appeon)Harry 01.24.2014 - V142 ISG-CLX
end event

type cb_27 from commandbutton within tabpage_browse
integer x = 3502
integer y = 48
integer width = 293
integer height = 84
integer taborder = 70
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "My Reports"
end type

event clicked; //Start Code Change ----10.28.2015 #V15 maha
 is_my_reports = 'upper(mod_user) = "' + upper(gs_user_id) + '"'
//  is_my_reports = "upper(mod_user) = '" + upper(gs_user_id) + "'"

 of_filter_report_list( )

end event

type cb_26 from commandbutton within tabpage_browse
integer x = 3200
integer y = 48
integer width = 288
integer height = 84
integer taborder = 90
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "Filter"
end type

event clicked; //Start Code Change ----10.28.2015 #V15 maha
of_filter_report_list()
end event

type sle_search from singlelineedit within tabpage_browse
integer x = 2478
integer y = 52
integer width = 704
integer height = 80
integer taborder = 60
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long textcolor = 33554432
borderstyle borderstyle = stylelowered!
end type

type cb_clear from commandbutton within tabpage_browse
integer x = 3803
integer y = 48
integer width = 192
integer height = 84
integer taborder = 60
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "Clear"
end type

event clicked; //Start Code Change ----10.28.2015 #V15 maha
 is_my_reports = ""
 tab_1.tabpage_browse.sle_search.text = ""
 
 of_filter_report_list( )
end event

type dw_detail from u_dw within tabpage_browse
integer x = 3031
integer y = 164
integer width = 1358
integer height = 1840
integer taborder = 90
boolean bringtotop = true
boolean titlebar = true
string title = "Report Properties"
string dataobject = "d_cust_report_detail"
end type

event buttonclicked;call super::buttonclicked;//====================================================================
//$<Event>: buttonclicked
//$<Arguments>:
// 	%ScriptArgs%
//$<Return>:  long
//$<Description>: 
//$<Author>: (Appeon) Stephen 05.15.2014 (IntelliReport Modifications 14.2)
//--------------------------------------------------------------------
//$<Modify History>:
//====================================================================
string ls_path, ls_filename
integer li_ret
string ls_notes

if dwo.name="b_1" then  ///Modified by (Appeon)Gavin 12.07.2017 for V16.1  Export and excel   "Excel (*.xlsx),*.xlsx," &
	li_ret = GetFileSaveName("Save As File",&
				+ ls_path, ls_filename, "DOC", &
				+ "Excel (*.xlsx),*.xlsx," &
				+ "Excel 97-2003 (*.xls),*.xls," &
				+ "Text (*.txt),*.txt," &
				+ "CSV (*.csv),*.csv," &
				+ "HTMLTable (*.html),*.html," &
				+ "XML (*.xml),*.xml," &
				+ "PDF (*.pdf),*.pdf,"  &
	             + "ALL Files(*.*),*.*")
	
	if li_ret = 1 then
		ls_path = mid(ls_path, 1, pos(ls_path, ".") - 1)
		this.setitem(row, "export_path", ls_path)
	end if

elseif dwo.name = "b_pre_help" then   //Start Code Change ----07.11.2017 #V153 maha
	messagebox("Preview Type", "Page Preview: Will display the data as pages for printing.  Use for reports that will be printed.~r~rNo Pages: Will display all columns across with no page break.  Use for reports that will be exported.")
//Start Code Change ----09.25.2017 #V154 maha
elseif dwo.name = "b_expand" then  
	ls_notes = this.getitemstring(row, "report_notes")

	if isnull(ls_notes) then ls_notes = ""
	OpenWithParm( w_ai_notes_new,  "V#" + ls_notes)

	IF Message.StringParm = "Cancel" THEN
		Return -1
	ELSE
		ls_notes = Message.StringParm
		This.SetItem( row, "report_notes", ls_notes )	
	END IF
//End Code Change ----09.25.2017
end if

end event

event constructor;call super::constructor;//--------------------------- APPEON BEGIN ---------------------------
//$<ID> PT-14
//$<comment> 02.07.2006 By: Rodger Wu
//$<reason> Performance tuning
//$<modification> Move the following script into the Open event of w_custom_report 
//$<modification> due to the usage of CreateOnDemand.
//DataWindowChild dwchild

This.SetTransObject( sqlca )

//dwchild.retrieve()
//dwchild.insertrow(1)
//dwchild.setitem(1,"user_id","All")
//---------------------------- APPEON END ----------------------------
//---------Begin Added by (Appeon)Stephen 05.08.2014 for IntelliReport Modifications 14.2--------
DataWindowChild dwchild
Integer li_Ret
Long ll_Set9,ll_set_cont,ll_Row

li_Ret = this.GetChild( "mod_user", dwchild ) 
if li_Ret = 1 then
	dwchild.settransobject(sqlca)
	dwchild.retrieve()
end if

li_Ret = this.GetChild( "module", dwchild ) 
if li_Ret = 1 then
	dwchild.settransobject(sqlca)
	
	SELECT TOP 1 Set_9, set_cont INTO :ll_Set9,:ll_set_cont FROM icred_settings;	
	if ll_Set9 = 4 then
		ll_Row = dwchild.insertrow( 0 )
		dwchild.setitem(ll_Row,"module",1)
		dwchild.setitem(ll_Row,"name","IntelliContract")
	else
		ll_Row = dwchild.insertrow( 0 )
		dwchild.setitem(ll_Row,"module",2)
		dwchild.setitem(ll_Row,"name","IntelliCred/App")
		if ll_set_cont = 1 then
			ll_Row = dwchild.insertrow( 0 )
			dwchild.setitem(ll_Row,"module",1)
			dwchild.setitem(ll_Row,"name","IntelliContract")
			ll_Row = dwchild.insertrow( 0 )
			dwchild.setitem(ll_Row,"module",4)
			dwchild.setitem(ll_Row,"name","Cred/App/Cont")
		end if	
	end if
end if
//---------End Added ------------------------------------------------------
end event

event retrieveend;call super::retrieveend;//====================================================================
//$<Event>: retrieveend
//$<Arguments>:
// 	%ScriptArgs%
//$<Return>:  long
//$<Description>: 
//$<Author>: (Appeon) Stephen 05.08.2014 (IntelliReport Modifications 14.2)
//--------------------------------------------------------------------
//$<Modify History>:
//====================================================================
integer li_preview

if this.getrow() < 1 then return
li_preview = this.getitemnumber(this.getrow(), "preview_type")

if isnull(li_preview) then this.setitem(this.getrow(), "preview_type", 1)
end event

event resize;call super::resize;////------------------- APPEON BEGIN -------------------
////<$>added:long.zhang 11.04.2014
////<$>reason:populate dw_detail to dw_detail_background to warkaround a bug of powerbuilder.
////				for V14.2 Testing - Bug 4277 / Issue Editing iReport Nam
//dw_detail.SetRedraw(False)
//dw_detail.y = dw_detail_bg.y + 104
//dw_detail.height = dw_detail_bg.height - 104 - 5
//dw_detail.x = dw_detail_bg.x + 10
//dw_detail.width = dw_detail_bg.width - 20
//dw_detail.SetRedraw(True)
////------------------- APPEON END -------------------
end event

type gb_3 from groupbox within tabpage_browse
integer x = 2441
integer width = 1577
integer height = 148
integer taborder = 10
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long textcolor = 128
long backcolor = 33551856
string text = "Filters"
end type

type tabpage_tables from userobject within tab_1
event create ( )
event destroy ( )
integer x = 18
integer y = 100
integer width = 4398
integer height = 2004
boolean enabled = false
long backcolor = 33551856
string text = "Tables"
long tabtextcolor = 33554432
long tabbackcolor = 79741120
long picturemaskcolor = 12632256
cb_quick_select cb_quick_select
cb_15 cb_15
cb_11 cb_11
cb_10 cb_10
cb_8 cb_8
cbx_advanced cbx_advanced
dw_5 dw_5
dw_1 dw_1
cb_coll_tables cb_coll_tables
st_auto_link st_auto_link
cb_view_add_tbl cb_view_add_tbl
cb_view_del_tbl cb_view_del_tbl
cb_next_2 cb_next_2
cb_view_del_link cb_view_del_link
cb_auto_link cb_auto_link
cb_qhelp cb_qhelp
cbx_distinct cbx_distinct
dw_view_tables dw_view_tables
dw_view_links dw_view_links
cb_view_add_link cb_view_add_link
tv_tables tv_tables
end type

on tabpage_tables.create
this.cb_quick_select=create cb_quick_select
this.cb_15=create cb_15
this.cb_11=create cb_11
this.cb_10=create cb_10
this.cb_8=create cb_8
this.cbx_advanced=create cbx_advanced
this.dw_5=create dw_5
this.dw_1=create dw_1
this.cb_coll_tables=create cb_coll_tables
this.st_auto_link=create st_auto_link
this.cb_view_add_tbl=create cb_view_add_tbl
this.cb_view_del_tbl=create cb_view_del_tbl
this.cb_next_2=create cb_next_2
this.cb_view_del_link=create cb_view_del_link
this.cb_auto_link=create cb_auto_link
this.cb_qhelp=create cb_qhelp
this.cbx_distinct=create cbx_distinct
this.dw_view_tables=create dw_view_tables
this.dw_view_links=create dw_view_links
this.cb_view_add_link=create cb_view_add_link
this.tv_tables=create tv_tables
this.Control[]={this.cb_quick_select,&
this.cb_15,&
this.cb_11,&
this.cb_10,&
this.cb_8,&
this.cbx_advanced,&
this.dw_5,&
this.dw_1,&
this.cb_coll_tables,&
this.st_auto_link,&
this.cb_view_add_tbl,&
this.cb_view_del_tbl,&
this.cb_next_2,&
this.cb_view_del_link,&
this.cb_auto_link,&
this.cb_qhelp,&
this.cbx_distinct,&
this.dw_view_tables,&
this.dw_view_links,&
this.cb_view_add_link,&
this.tv_tables}
end on

on tabpage_tables.destroy
destroy(this.cb_quick_select)
destroy(this.cb_15)
destroy(this.cb_11)
destroy(this.cb_10)
destroy(this.cb_8)
destroy(this.cbx_advanced)
destroy(this.dw_5)
destroy(this.dw_1)
destroy(this.cb_coll_tables)
destroy(this.st_auto_link)
destroy(this.cb_view_add_tbl)
destroy(this.cb_view_del_tbl)
destroy(this.cb_next_2)
destroy(this.cb_view_del_link)
destroy(this.cb_auto_link)
destroy(this.cb_qhelp)
destroy(this.cbx_distinct)
destroy(this.dw_view_tables)
destroy(this.dw_view_links)
destroy(this.cb_view_add_link)
destroy(this.tv_tables)
end on

type cb_quick_select from commandbutton within tabpage_tables
integer x = 430
integer y = 28
integer width = 384
integer height = 84
integer taborder = 50
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "Quick Select"
end type

event clicked;//V10.5 SK IntelliReport
of_show_selection()
end event

type cb_15 from commandbutton within tabpage_tables
integer x = 1079
integer y = 520
integer width = 146
integer height = 92
integer taborder = 60
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "&Dn"
end type

event clicked;//$<add> 04.01.2008 by Andy

long ll_row,ll_cnt
long ll_table_id
string ls_table_name,ls_sys_table

ll_row = dw_view_tables.getrow()
ll_cnt = dw_view_tables.rowcount()

if ll_row < ll_cnt then	
	ls_table_name = dw_view_tables.GetItemString( ll_row, "conv_view_table_table_name" )
	ll_table_id   = dw_view_tables.GetItemNumber( ll_row, "cust_table_name" )		
	ls_sys_table  = dw_view_tables.GetItemString( ll_row, "table_name" )
	
	dw_view_tables.SetItem(ll_row,"conv_view_table_table_name",dw_view_tables.GetItemString( ll_row + 1, "conv_view_table_table_name" ))
	dw_view_tables.SetItem(ll_row,"cust_table_name",dw_view_tables.GetItemNumber( ll_row + 1, "cust_table_name" ))	
	dw_view_tables.SetItem(ll_row,"table_name",dw_view_tables.GetItemString( ll_row + 1, "table_name" ))
	
	dw_view_tables.SetItem(ll_row + 1,"conv_view_table_table_name",ls_table_name)
	dw_view_tables.SetItem(ll_row + 1,"cust_table_name",ll_table_id)
 	dw_view_tables.SetItem(ll_row + 1,"table_name",ls_sys_table)
 
	dw_view_tables.setrow(ll_row + 1)
	dw_view_tables.scrolltorow(ll_row + 1)
	
	//$<add> 04.15.2008 by Andy
	dw_view_tables.Update()
	//end 04.15.2008
end if

end event

type cb_11 from commandbutton within tabpage_tables
integer x = 1079
integer y = 428
integer width = 146
integer height = 92
integer taborder = 50
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "&Up"
end type

event clicked;//$<add> 04.01.2008 by Andy

long ll_row
long ll_table_id
string ls_table_name,ls_sys_table

ll_row = dw_view_tables.getrow()

if ll_row > 1 then	
	ls_table_name = dw_view_tables.GetItemString( ll_row, "conv_view_table_table_name" )
	ll_table_id   = dw_view_tables.GetItemNumber( ll_row, "cust_table_name" )		
	ls_sys_table  = dw_view_tables.GetItemString( ll_row, "table_name" )
	
	dw_view_tables.SetItem(ll_row,"conv_view_table_table_name",dw_view_tables.GetItemString( ll_row - 1, "conv_view_table_table_name" ))
	dw_view_tables.SetItem(ll_row,"cust_table_name",dw_view_tables.GetItemNumber( ll_row - 1, "cust_table_name" ))	
	dw_view_tables.SetItem(ll_row,"table_name",dw_view_tables.GetItemString( ll_row - 1, "table_name" ))
	
	dw_view_tables.SetItem(ll_row - 1,"conv_view_table_table_name",ls_table_name)
	dw_view_tables.SetItem(ll_row - 1,"cust_table_name",ll_table_id)
 	dw_view_tables.SetItem(ll_row - 1,"table_name",ls_sys_table)
	 
	dw_view_tables.setrow(ll_row - 1)
	dw_view_tables.scrolltorow(ll_row - 1)
	
	//$<add> 04.15.2008 by Andy
	dw_view_tables.Update()
	//end 04.15.2008
end if
end event

type cb_10 from commandbutton within tabpage_tables
integer x = 1079
integer y = 292
integer width = 146
integer height = 92
integer taborder = 60
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "<<"
end type

event clicked;//--------------------------- APPEON BEGIN ---------------------------
//$<add> 04.01.2008 by Andy
Long ll_Row 

ll_Row = dw_view_tables.GetRow()
if ll_Row > 0 then 
	dw_view_tables.event DoubleClicked(0,0,ll_Row,dw_view_tables.object.conv_view_table_table_name)
end if
//---------------------------- APPEON END ----------------------------

end event

type cb_8 from commandbutton within tabpage_tables
integer x = 1079
integer y = 196
integer width = 146
integer height = 92
integer taborder = 30
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = ">>"
end type

event clicked;//--------------------------- APPEON BEGIN ---------------------------
//$<add> 04.01.2008 by Andy
Long ll_Handle
ll_Handle = tv_tables.FindItem(CurrentTreeItem!, 0)
if ll_Handle > 0 then 
	tv_tables.event DoubleClicked(ll_Handle)	
	of_audit_set("T")//Start Code Change ----06.15.2016 #V152 maha
end if
//---------------------------- APPEON END ----------------------------

end event

type cbx_advanced from checkbox within tabpage_tables
integer x = 2482
integer y = 308
integer width = 846
integer height = 64
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long textcolor = 33554432
long backcolor = 33551856
string text = "Advanced Table Linking"
boolean checked = true
end type

event clicked;//$<add> 03.27.2008 by Andy

IF This.Checked THEN
	UPDATE conv_view
	SET advanced_linking = 1
	WHERE conv_view.view_id = :il_view_id ;
ELSE
	UPDATE conv_view
	SET advanced_linking = 0
	WHERE conv_view.view_id = :il_view_id ;	
END IF
IF SQLCA.SQLCODE = -1 THEN
	//---------Begin Modified by (Appeon)Stephen 05.05.2014 for V142 Schedule IntelliReport--------
	//MessageBox("DB Error", SQLCA.SQLERRTEXT )
	inv_message.of_messagebox("DB Error", SQLCA.SQLERRTEXT , true)
	is_run_error = "DB Error: " + SQLCA.SQLERRTEXT
	ib_run_sucess = false
	//---------End Modfiied ------------------------------------------------------
END IF

IF This.Checked THEN
	IF ib_advanced THEN RETURN
	
	tv_tables.Height      -= dw_view_links.Height + 28
	dw_view_tables.Height -= dw_view_links.Height + 28
	dw_view_links.visible = True
	cb_auto_link  .visible = True
	cb_view_add_link.visible = True
	cb_view_del_link.visible = True
	cb_qhelp.visible = True
	//st_auto_link.visible = True
	
	ib_advanced = True
ELSE
	IF NOT ib_advanced THEN RETURN 
	
	tv_tables.Height      += dw_view_links.Height + 28
	dw_view_tables.Height += dw_view_links.Height + 28
	dw_view_links.visible = False
	cb_auto_link.visible = False
	cb_view_add_link.visible = False
	cb_view_del_link.visible = False
	cb_qhelp.visible = False
	st_auto_link.visible = False
	
	ib_advanced = False
END IF

end event

type dw_5 from datawindow within tabpage_tables
integer x = 2482
integer y = 440
integer width = 983
integer height = 384
integer taborder = 110
string title = "none"
string dataobject = "d_view_screen_picture"
boolean border = false
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event constructor;//--------------------------- APPEON BEGIN ---------------------------
//$<add> 2007-12-18 By: Andy
InsertRow(0)
//---------------------------- APPEON END ----------------------------
end event

event doubleclicked;//--------------------------- APPEON BEGIN ---------------------------
//$<add> 2007-12-18 By: Andy
blob			lblb_data
ulong			lul_ret
string		ls_FileName,ls_path,ls_p_name,ls_Parm,ls_command
n_cst_FileSrvwin32	luo_FileSrv
String      ls_temp,ls_v_name,ls_screen,ls_v_alias
Long        ll_dataLength,ll_ScreenCnt,ll_i
str_intellireport lstr_parm
n_cst_string lnvo_string
String      ls_ScreenArray[],ls_screenID
boolean     lb_Flag = false

if row < 1 then return
if this.describe( "t_2.visible" ) = '0' then return//p_1
if lower(dwo.name) = "p_1" or lower(dwo.name) = "t_1" or lower(dwo.name) = "t_3" then
	ls_v_name     = this.GetItemString(row,"v_name")
	ll_dataLength = this.GetItemNumber(row,"dataleng")
	ls_p_name     = this.describe( "t_1.text" )
	if isNull(ls_p_name) then ls_p_name = ''
	ls_screen     = this.GetItemString(row,"screen")
	ls_v_alias    = this.GetItemString(row,"v_alias")
	
	if of_get_image(ls_v_name,ll_dataLength,lblb_data) = 1 then 
		luo_FileSrv	= create n_cst_FileSrvwin32			
		ls_path = gs_temp_path + "temp"
		//check path
		IF Not luo_FileSrv.of_directoryexists( ls_path) Then
			luo_FileSrv.of_createdirectory(ls_path)
		End IF
			
		IF Fileexists(ls_path + '\' + ls_p_name) Then 
			Filedelete(ls_path + '\' + ls_p_name)
		end if	
		ls_FileName = ls_path + '\' + ls_p_name
		
		if luo_FileSrv.of_Filewrite( ls_FileName, lblb_data)=-1 then
			destroy luo_FileSrv
			return
		end if
		//$<add> 01.23.2008 by Andy 
		ls_temp = ls_Screen + ','
		lnvo_string.of_parsetoarray( ls_temp, ',', ls_ScreenArray )
		ll_ScreenCnt = UpperBound(ls_ScreenArray)
		
		FOR ll_i = 1 to ll_ScreenCnt			
			ls_screenID = ls_ScreenArray[ll_i]
			if IsNumber(ls_screenID) then
				lb_Flag = true
				exit
			end if
		NEXT
		//create dynamic dw show screen print
		if lb_Flag then 
			//$<add> 01.22.2008 by Andy
			lstr_parm.ll_module = il_module
			lstr_parm.ll_data_view_id = il_data_view_id
			lstr_parm.ls_v_name = ls_v_name
			lstr_parm.ls_filename = ls_FileName
			lstr_parm.ls_screen = ls_screen
			lstr_parm.ls_v_alias = ls_v_alias
			
			OpenWithParm(w_show_screen_print,lstr_parm)
		else
			//use API show screen print
			ls_command = 'open'
			ls_Parm    = "Document"
			ls_temp    = ""
			lul_ret = ShellExecuteA(Handle(this),ls_command,ls_filename,ls_Parm,ls_temp,1)
			/*Comment 02.19.2008 by Andy
			IF lul_ret < 32 Then		
				Messagebox(gnv_app.iapp_object.DisplayName, 'Cannot open this file ,file damaged or Windows has no relevant open mode.')
			End IF
			*/
		end if
//	Else
//		MessageBox(gnv_app.iapp_object.DisplayName, 'Documents not exist or damaged, cannot open!')
	End IF
	
	destroy luo_FileSrv
end if
//---------------------------- APPEON END ----------------------------

end event

event clicked;//$<add> 02.18.2008 by Andy
this.event doubleclicked( xpos, ypos, row, dwo )
end event

type dw_1 from datawindow within tabpage_tables
integer x = 5
integer y = 148
integer width = 1033
integer height = 120
integer taborder = 110
boolean enabled = false
boolean titlebar = true
string title = "Select Tables To Use In Report"
string dataobject = "d_conv_view_tables_report_sql"
boolean border = false
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

type cb_coll_tables from commandbutton within tabpage_tables
integer x = 23
integer y = 28
integer width = 384
integer height = 84
integer taborder = 60
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "&Collapse All"
end type

event clicked;//--------------------------- APPEON BEGIN ---------------------------
//$<add> 2007-12-11 By: Andy
of_expandcollapseall(this,tv_tables)
//---------------------------- APPEON END ----------------------------
end event

type st_auto_link from statictext within tabpage_tables
boolean visible = false
integer x = 2482
integer y = 1036
integer width = 969
integer height = 284
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long textcolor = 16711680
long backcolor = 33551856
string text = "The Auto Link function will be about 90% correct in linking your tables, but you should always check your links before proceding.  It cannot always know exactly what you are trying to do."
boolean focusrectangle = false
end type

type cb_view_add_tbl from commandbutton within tabpage_tables
boolean visible = false
integer x = 3954
integer y = 1548
integer width = 384
integer height = 92
integer taborder = 40
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "Add Table"
end type

event clicked;Integer li_nr

li_nr = dw_view_tables.InsertRow( 0 )
dw_view_tables.SetRow( li_nr )
dw_view_tables.ScrollToRow( li_nr )

il_next_table_id++

dw_view_tables.SetItem( li_nr, "table_id", il_next_table_id )
dw_view_tables.SetItem( li_nr, "view_id", il_view_id )
dw_view_tables.SetItem( li_nr, "project_id", ii_project_id )

dw_view_tables.SetFocus( )


end event

type cb_view_del_tbl from commandbutton within tabpage_tables
boolean visible = false
integer x = 3950
integer y = 1440
integer width = 384
integer height = 92
integer taborder = 50
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "Delete Table"
end type

event clicked;Long ll_table_id

ll_table_id = dw_view_tables.GetItemNumber( dw_view_tables.GetRow(), "cust_table_name" ) 

dw_view_tables.DeleteRow( 0 )

DELETE FROM conv_view_links  
WHERE ( conv_view_links.link_from_table = :ll_table_id  OR  
       conv_view_links.link_to_table = :ll_table_id ) AND  
      ( conv_view_links.view_id = :il_view_id )   ;
	 
	 
of_save()



end event

type cb_next_2 from commandbutton within tabpage_tables
integer x = 4041
integer y = 28
integer width = 338
integer height = 84
integer taborder = 40
boolean bringtotop = true
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "Ne&xt ->"
end type

event clicked;//$<comment> 07.08.2008 by Andy
//$<reason>  Move to of_check_tables()
/*
integer i
string ls_def
integer p
integer a = 0
long t
string ls_tname


IF dw_view_tables.RowCount() = 0 THEN
	MessageBox( "Tables", "You must select at least one table to report on." )
	Return 
END IF

//$<add> 03.27.2008 by Andy
IF Not cbx_advanced.checked THEN
	IF dw_view_tables.RowCount() > 1 AND dw_view_links.RowCount() = 0  THEN
		cb_9.event clicked()
		IF  dw_view_links.RowCount() = 0 OR dw_view_tables.RowCount() - 1   > dw_view_links.RowCount() THEN
			MessageBox( "Linking Error", "IntelliReport is having trouble figuring out the appropriate Report Table links and needs your help.")
			cbx_advanced.checked = True
			cbx_advanced.Event clicked()
			RETURN
		END IF
	END IF
	
	//$<add> 04.22.2008 by Andy
	IF dw_view_tables.RowCount() - 1   > dw_view_links.RowCount()  THEN
		cb_9.event clicked()
		IF  dw_view_links.RowCount() = 0 OR dw_view_tables.RowCount() - 1   > dw_view_links.RowCount() THEN
			MessageBox( "Linking Error", "IntelliReport is having trouble figuring out the appropriate Report Table links and needs your help.")
			cbx_advanced.checked = True
			cbx_advanced.Event clicked()
			RETURN
		END IF 
	END IF
END IF
//end add 03.27.2008

IF dw_view_tables.RowCount() > 1 AND dw_view_links.RowCount() = 0  THEN
	//$<modify> 02.29.2008 by Andy
	//MessageBox( "Links", "You have more than 1 table selected but no links.  Please link the tables in the Create View Table Links Box." )
	MessageBox( "Links", "You have more than 1 table selected but no links. Please click Auto Link to have system link tables for you or click Add Link to link tables in the Create View Table Links box." )
	Return 
END IF

IF dw_view_tables.RowCount() - 1   > dw_view_links.RowCount()  THEN //maha 111902
	MessageBox( "Linking Error", "You do not have enough links for the number of tables selected.  Please verify all tables are linked." )
	//$<add> 03.27.2008 by Andy
	IF Not cbx_advanced.checked THEN
		cbx_advanced.checked = True
		cbx_advanced.Event clicked()
	END IF
	//end add 03.27.2008
	Return 
END IF

//$<comment> 04.15.2008
//IF of_save() = -1 THEN
//	Return -1
//END IF
//end comment 04.15.2008

//if (ii_facil_security = 1) and (Not gb_contract_version) then			//Modified by Scofield on 2007-08-23: Add "and (Not gb_contract_version)"
if (ii_facil_security = 1) and (il_module=2) then //04.03.2008 by Andy Fixed BugG040302
	for i = 1 to dw_view_tables.RowCount()
		ls_tname = dw_view_tables.getitemstring(i,"table_name")
		
//Start Code Change ---- 10.05.2007 #V7 maha  changed test logic because the original way a pd_affil_stat view not named v_affil_stat would not be trapped
		
//		//--------------------------- APPEON BEGIN ---------------------------
//		//$<modify> 2005-11-11 By: owen chen
//		//$<reason> add database option for sql excution
//		choose case gs_dbtype
//			case 'ASA'
//				select view_def into :ls_def from systable where table_name = :ls_tname;		
//			case 'SQL'
//				select view_def into :ls_def from v_systable where table_name = :ls_tname;
//		end choose
//		//---------------------------- APPEON END ----------------------------
//				
//		if  pos(ls_def,"pd_affil_stat",1) > 0 then
		if  lower(ls_tname) = "v_affil_stat" then //Start Code Change ---- 10.05.2007 #V7 maha 
			a = 1
		end if
	next
//End Code Change---10.05.2007
	if a = 0 then
		//$<modify> 04.03.2008 by Andy
		//messagebox("Table Select error","Facility Security is turned on so the v_affil_stat must be used in all reports.")
		messagebox("Table Select error","Facility Security is turned on so the Appointment Status must be used in all reports.")
		//end modify 04.03.2008
		return -1
	end if
end if

a=0

//if department security is turned on then do this.
//if ii_dept_security_on = 1 and (Not gb_contract_version) then			//Modified by Scofield on 2007-08-23: Add "and (Not gb_contract_version)"
if ii_dept_security_on = 1 and (il_module=2) then //04.03.2008 by Andy Fixed BugG040302
	for i = 1 to dw_view_tables.RowCount()
		ls_tname = dw_view_tables.getitemstring(i,"table_name")
		//Start Code Change ---- 10.05.2007 #V7 maha  changed test logic because the original way a department view not named v_affil_stat would not be trapped

//		//--------------------------- APPEON BEGIN ---------------------------
//		//$<modify> 2005-11-11 By: owen chen
//		//$<reason> add database option for sql excution
//		choose case gs_dbtype
//			case 'ASA'
//				select view_def into :ls_def from systable where table_name = :ls_tname;
//			case 'SQL'
//				select view_def into :ls_def from v_systable where table_name = :ls_tname;
//		end choose
//		//---------------------------- APPEON END ----------------------------
//		
//		if  pos(ls_def,"pd_affil_dept",1) > 0 then
		if  lower(ls_tname) = "v_affil_dept" then //Start Code Change ---- 10.05.2007 #V7 maha 
			a = 1
		end if
	next	
	if a = 0 then
		//$<modify> 04.03.2008 by Andy
		//messagebox("Table Select error","Department Security is turned on so the v_affil_dept must be used in all reports.  If you do not have this view contact intellisoft support.")
		messagebox("Table Select error","Department Security is turned on so the Affil Department must be used in all reports.  If you do not have this view contact intellisoft support.")
		//end modify 04.03.2008
		return -1
	end if
end if


//dw_view_tables.Update()
//dw_view_links.Update()
*/

tab_1.tabpage_columns.Enabled = True


//$<modify> 07.08.2008 by Andy
//tab_1.SelectTab( 3 )
of_selecttab(3)

end event

type cb_view_del_link from commandbutton within tabpage_tables
integer x = 1646
integer y = 28
integer width = 384
integer height = 84
integer taborder = 60
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "Dele&te Link"
end type

event clicked;dw_view_links.DeleteRow( 0 )
of_audit_set("L")//Start Code Change ----06.15.2016 #V152 maha
end event

type cb_auto_link from commandbutton within tabpage_tables
integer x = 850
integer y = 28
integer width = 384
integer height = 84
integer taborder = 70
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "Aut&o Link"
end type

event clicked;Integer li_nr
Integer li_ans
Integer li_rc
Integer i
Integer li_link_row
Integer li_cnt
Integer li_prac_link_cnt = 0
Long ll_tid
Integer li_table_id
String ls_table_name
String ls_first_table_name
string ls_view 
Boolean lb_affil_stat_allready_linked = False
Boolean lb_affil_stat
Boolean lb_dept
Boolean lb_staff_cat
Boolean lb_basic
Boolean lb_address
Boolean lb_address_link
Boolean lb_specialty_facility_link  //add by stephen 04.22.2013
Boolean lb_hosp_link  //add by stephen 04.25.2013
boolean lb_ctx_group //add by stephen 05.16.2014
//$<add> 04.03.2008 by Andy
String  ls_table_alias 
string  ls_first_table_name_group
TreeViewItem ltvi_item
Long    ll_handle
//end add 04.03.2008

//Added by Nova on 08.20.2008
String ls_tmp_table_name
String ls_tmp_first_table_name
//end add 08.20.2008
//---------Begin Added by (Appeon)Stephen 06.30.2014 for IntelliReport Modifications 14.2--------
String  ls_first_table[]
integer li_i, li_table_num[]
integer li_module, li_cred_module
//---------End Added ------------------------------------------------------

dw_view_tables.AcceptText()
dw_view_tables.Update()
li_rc = dw_view_tables.Retrieve( il_view_id )
//Start Code Change ---- 04.12.2006 #389 maha 5207
if li_rc < 1 then 
	messagebox("Auto Link","You must select more than one table before using Auto Link.")
	return
end if
//End Code Change---04.12.2006

of_audit_set("L")//Start Code Change ----06.15.2016 #V152 maha

li_rc = dw_view_links.RowCount()
IF li_rc > 0 THEN
	li_ans = MessageBox("Links", "This option will delete any links that currently exist.  Continue?", Question!, YesNo!, 1 )
	IF li_ans = 2 THEN
		Return
	END IF
	FOR i = 1 TO li_rc
		dw_view_links.DeleteRow( 0 )
	END FOR
	dw_view_links.Update( )
END IF

li_rc = dw_view_tables.RowCount()
IF li_rc = 1 THEN
	MessageBox( "Link Failure", "You need to select at least 2 tables to use the Auto Link Function." )
	Return
END IF

//---------Begin modified by (Appeon)Stephen 05.13.2014 for IntelliReport Modifications 14.2--------
//ls_first_table_name = dw_view_tables.GetItemString( 1, "table_name" )
for i = 1 to li_rc
	ls_first_table_name = dw_view_tables.GetItemString( i, "table_name" )
	
	if lower(ls_first_table_name) = "v_ctx_prac_link" or of_check_viewid(ls_first_table_name) = 1 or of_get_module(ls_first_table_name) = 3 then 
		continue
	end if
	ls_first_table[1] = ls_first_table_name
	li_table_num[1] = i
	exit
next

//---------Begin Added by (Appeon)Stephen 08.20.2014 for BugH081401--------
//move by stephen 08.22.2014
if upperbound(ls_first_table) < 1 then return  
lb_ctx_group = false 
for i = 1 to li_rc
	ls_table_name = dw_view_tables.GetItemString( i, "table_name" )
	lb_ctx_group = of_check_ctxgroup(ls_table_name) 
	if lb_ctx_group = true then exit
next
//---------End Added ------------------------------------------------------

if il_module = 4 then
	if of_link_cred_cont(dw_view_tables) = -1 then		
		return
	end if
	ls_first_table_name = ls_first_table[1]
	//---------Begin Added by (Appeon)Stephen 08.05.2014 for BugH071601--------
	//if Upper( LeftA( ls_first_table_name, 5 ) ) = "V_CTX" then
	li_module = of_get_module(ls_first_table_name)	
	if li_module = 1 then   //CTX VIEW
	//---------End Added ------------------------------------------------------
		for i = li_table_num[1] to dw_view_tables.rowcount()
			ls_first_table_name = dw_view_tables.GetItemString( i, "table_name" )
			if of_get_module(ls_first_table_name) = 2 then
				ls_first_table[2] = ls_first_table_name
				li_table_num[2] = i
				exit
			end if
		next
	else
		for i = li_table_num[1] to dw_view_tables.rowcount()
			ls_first_table_name = dw_view_tables.GetItemString( i, "table_name" )
			if of_get_module(ls_first_table_name) = 1 then 
				ls_first_table[2] = ls_first_table_name
				li_table_num[2] = i
				exit
			end if
		next
	end if
end if
//---------End Added ------------------------------------------------------

//analyze the tables that are selected
FOR i = 1 TO li_rc //if an affil_stat child add the affil_stat_view
	ls_table_name = dw_view_tables.GetItemString( i, "table_name" )
//Start Code Change ---- 10.05.2007 #V7 maha added v_affil_dept to list
	IF ls_table_name = "v_dept" OR ls_table_name = "v_affil_dept" OR ls_table_name = "v_staff_cat" OR ls_table_name = "v_staff_leave"  OR ls_table_name = "v_committee_review" OR +&
		ls_table_name = "v_net_dev_actions" OR ls_table_name = "v_net_dev_ids" OR ls_table_name = "v_net_dev_notes"  OR ls_table_name = "v_action_items" THEN
		IF dw_view_tables.Find( "table_name = 'v_affil_stat'", 1, 1000 ) = 0 THEN
			//$<modify> 04.03.2008 by Andy
			select v_alias into :ls_table_alias from view_alias where v_name = :ls_table_name ; 
			if LenA(ls_table_alias) = 0 then ls_table_alias = ls_table_name
			
			IF ls_table_name = "v_action_items" THEN
				//li_ans = MessageBox( "Table Selection", "Will you be using the v_action_items table to report on data for a specific facility? If so you must have the v_affil_stat table selected also so you can link to the parent OR verifying facility field.  Would you like to add this now?", StopSign!, YesNo!, 1 )				
				li_ans = MessageBox( "Table Selection", "Will you be using the " + ls_table_alias + " table to report on data for a specific facility? If so you must have the Appointment Status table selected also so you can link to the parent OR verifying facility field.  Would you like to add this now?", question!, YesNo!, 1 )				
			ELSE
				//li_ans = MessageBox( "Table Selection", "To use the " + Upper( ls_table_name ) + " table you must have the v_affil_stat table selected also.  Would you like to add this now?", StopSign!, YesNo!, 1 )
				li_ans = MessageBox( "Table Selection", "To use the " + ls_table_alias + " table you must have the Appointment Status table selected also.  Would you like to add this now?", question!, YesNo!, 1 )
			END IF
			//end modify 04.03.2008
			IF li_ans = 1 THEN
				lb_affil_stat	= True
				li_nr = dw_view_tables.InsertRow( 0 )			
				SELECT id
				INTO :ll_tid
				FROM dbo.sysobjects
				WHERE name = 'v_affil_stat' ;
				dw_view_tables.SetItem( li_nr, "table_name", "v_affil_stat" )
				//<add> 08/02/2007 by: Andy
				dw_view_tables.SetItem( li_nr, "conv_view_table_table_name", "v_affil_stat" )
				//end of add
				dw_view_tables.SetItem( li_nr, "cust_table_name", ll_tid )
				dw_view_tables.SetItem( li_nr, "view_id", il_view_id )
				dw_view_tables.SetItem( li_nr, "project_id", ii_project_id )
				//il_next_table_id++	
				il_next_table_id = gnv_app.of_get_irep_id("conv_view_table", 1)  //add by stephen 03.07.2013 -IntelliReport primary key issues
				dw_view_tables.SetItem( li_nr, "table_id", il_next_table_id )
				
				//$<add> 04.03.2008 by Andy
				ll_handle = tab_1.tabpage_tables.tv_tables.of_finditem(2,'v_affil_stat','')
				if ll_handle > 0 then 			
					if tab_1.tabpage_tables.tv_tables.GetItem(ll_handle,ltvi_item) = 1 then
						ltvi_item.pictureindex = 6
						ltvi_item.SelectedPictureIndex = 6
						tab_1.tabpage_tables.tv_tables.SetItem(ll_handle,ltvi_item)
					end if
				end if
				//end add 04.03.2008
			ELSE
				Return
			END IF
		ELSE
			lb_affil_stat	= True
		END IF
		CONTINUE
	END IF	
	
	
	//------------------- APPEON BEGIN -------------------
	//$<add> Stephen 04.22.2013
	//                         04.25.2013
	//$<reason> Auto Link is not creating links for Specialty Facility link correctly
	//                 Auto Link is not creating links for Hosp Facility Link correctly
	IF ls_table_name = "v_board_specialty"  then
		if dw_view_tables.Find( "table_name = 'v_specialty_facility_link'", 1, 1000 ) = 0 THEN
			lb_specialty_facility_link = false
		else
			lb_specialty_facility_link = true
		end if 
	end if
	
	IF ls_table_name = "v_hosp_affil"  then
		if dw_view_tables.Find( "table_name = 'v_hospital_facility_link'", 1, 1000 ) = 0 THEN
			lb_hosp_link = false
		else
			lb_hosp_link = true
		end if 
	end if
	//------------------- APPEON END -------------------
	
	//if address ask about address link 
	IF ls_table_name = "v_address" OR ls_table_name = "v_mailing_address" THEN
		IF dw_view_tables.Find( "table_name = 'v_address_link'", 1, 1000 ) = 0 THEN
			//$<modify> 04.03.2008 by Andy
			select v_alias into :ls_table_alias from view_alias where v_name = :ls_table_name ; 
			if LenA(ls_table_alias) = 0 then ls_table_alias = ls_table_name
			//li_ans = MessageBox( "Table Selection", "You have selected the " + ls_table_name + " table.  If you want to query addresses by ADDRESS TYPE (Primary, Additional, Billing etc.) then you should include the v_address_link table.  Would you like to add this table now?", StopSign!, YesNo!, 1 )
			li_ans = MessageBox( "Table Selection", "You have selected the " + ls_table_alias + " table.  If you want to query addresses by ADDRESS TYPE (Primary, Additional, Billing etc.) then you should include the Address Link table.  Would you like to add this table now?", question!, YesNo!, 1 )
			//end modify 04.03.2008
			IF li_ans = 1 THEN
				lb_address_link = True
				li_nr = dw_view_tables.InsertRow( 0 )			
				SELECT id
				INTO :ll_tid
				FROM dbo.sysobjects
				WHERE name = 'v_address_link' ;
				dw_view_tables.SetItem( li_nr, "table_name", "v_address_link" )
				//<add> 08/02/2007 by: Andy
				dw_view_tables.SetItem( li_nr, "conv_view_table_table_name", "v_address_link" )
				//end of add
				dw_view_tables.SetItem( li_nr, "cust_table_name", ll_tid )
				dw_view_tables.SetItem( li_nr, "view_id", il_view_id )
				dw_view_tables.SetItem( li_nr, "project_id", ii_project_id )
				//il_next_table_id++	
				il_next_table_id = gnv_app.of_get_irep_id("conv_view_table", 1)  //add by stephen 03.07.2013 -IntelliReport primary key issues
				dw_view_tables.SetItem( li_nr, "table_id", il_next_table_id )
				
				//$<add> 04.03.2008 by Andy
				ll_handle = tab_1.tabpage_tables.tv_tables.of_finditem(2,'v_address_link','')
				if ll_handle > 0 then 			
					if tab_1.tabpage_tables.tv_tables.GetItem(ll_handle,ltvi_item) = 1 then
						ltvi_item.pictureindex = 6
						ltvi_item.SelectedPictureIndex = 6
						tab_1.tabpage_tables.tv_tables.SetItem(ll_handle,ltvi_item)
					end if
				end if
				//end add 04.03.2008
			END IF
		ELSE
				lb_address_link = True
		END IF
		
		CONTINUE
	END IF
END FOR

//---------Begin Added by (Appeon)Stephen 06.30.2014 for IntelliReport Modifications 14.2--------
for li_i = 1 to upperbound(ls_first_table) 
	ls_first_table_name = ls_first_table[li_i]
	li_prac_link_cnt = 0
	li_module = of_get_module(ls_first_table_name)	
//---------End Added ------------------------------------------------------
	li_rc = dw_view_tables.RowCount()
	
	FOR i = li_table_num[li_i] +1 TO li_rc
		ls_table_name = dw_view_tables.GetItemString( i, "table_name" )
	//Start Code Change ---- 10.05.2007 #V7 maha added v_affil_dept to list
	//modify by stephen 04.22.2013 --add OR ls_table_name = "v_specialty_facility_link"
	//modify by stephen 04.25.2013 --add  ls_table_name = "v_hospital_facility_link"
		IF ls_table_name = "v_dept" OR ls_table_name = "v_affil_dept" OR ls_table_name = "v_staff_cat" OR ls_table_name = "v_staff_leave"  OR ls_table_name = "v_committee_review" OR +&
		lower(ls_table_name) = "v_ctx_prac_link" or ls_table_name = "v_affil_stat" OR ls_table_name = "v_net_dev_actions" OR ls_table_name = "v_net_dev_ids" OR ls_table_name = "v_net_dev_notes" OR +&
			 ls_table_name = "v_action_items" OR ls_table_name = "v_address_link" OR ls_table_name = "v_specialty_facility_link" or( ls_table_name = "v_board_specialty" and lb_specialty_facility_link =true) OR+&
			 ls_table_name = "v_hospital_facility_link" or( ls_table_name = "v_hosp_affil" and lb_hosp_link =true) OR +&
			 ( (ls_table_name = "v_address" OR ls_table_name = "v_mailing_address") and lb_address_link = True) THEN
			CONTINUE
		END IF
	
		//--------------------------- APPEON BEGIN ---------------------------
		//$<add> 2006-08-30 By: Rodger Wu (Contract)
		//$<reason> Modification for IntelliContract.
	    //---------Begin Added by (Appeon)Stephen 08.05.2014 for BugH071601--------
		/*IF Upper( LeftA( ls_first_table_name, 5 ) ) = "V_CTX" AND &
			Upper( LeftA( ls_table_name, 5 ) ) = "V_CTX" THEN
			*/
		 li_cred_module = of_get_module(ls_table_name)
		 IF li_module	= 1 AND li_cred_module = 1 THEN
		//---------End Added ------------------------------------------------------

			if lower(ls_table_name) = "v_ctx_prac_link" then continue //(Appeon)Stephen 05.13.2014 - IntelliReport Modifications 14.2
			
			//<add> 06/19/2007 by: Andy fixed a defect
			String ls_link_from_field
			String ls_link_to_field
			
			//---------Begin Added by (Appeon)Stephen 05.16.2014 for IntelliReport Modifications 14.2--------
			if lb_ctx_group = true then
				if ( ls_table_name = "v_ctx_loc_covering_partners" OR ls_table_name = "v_ctx_loc_insurance" or ls_table_name = "v_ctx_locations" OR ls_table_name = "v_ctx_loc_language" OR ls_table_name = "v_ctx_loc_other_ids" OR +&
					ls_table_name = "v_ctx_loc_practice_info" OR ls_table_name = "v_ctx_loc_questions"  ) or   ls_first_table_name = "v_ctx_loc_covering_partners" OR ls_first_table_name = "v_ctx_loc_insurance" OR ls_first_table_name = "v_ctx_loc_language" OR ls_first_table_name = "v_ctx_loc_other_ids" OR +&
					ls_first_table_name = "v_ctx_loc_practice_info"  or ls_first_table_name = "v_ctx_locations" OR ls_first_table_name = "v_ctx_loc_questions"  then	
					
					continue
				end if
			end if
			//---------End Added ------------------------------------------------------	
			
			ls_link_from_field = "ctx_id"
			ls_link_to_field   = "ctx_id"
			if lower(ls_first_table_name) = 'v_ctx_basic_info' and lower(ls_table_name) = 'v_ctx_basic_info_master_link' then
				ls_link_from_field = 'master_ctx_id'
			end if
			if lower(ls_first_table_name) = 'v_ctx_basic_info_master_link' and lower(ls_table_name) = 'v_ctx_basic_info' then
				ls_link_to_field   = 'master_ctx_id'
			end if	
			//end of add
			//---------Begin Added by (Appeon)Toney 06.13.2013 for V141 ISG-CLX--------
			IF il_module = 1 THEN
				//Begin - Added By Mark Lee 06/04/12 email subject 'RE: possible bug FW: Incorrect reporting for Multi header'
				If lower(ls_first_table_name) = 'v_ctx_multi_header' and lower(ls_table_name) = 'v_ctx_multi_detail' then
					ls_link_from_field = 'hdr_id'
					ls_link_to_field   = 'hdr_id'
				ElseIf lower(ls_first_table_name) = 'v_ctx_multi_detail' and lower(ls_table_name) = 'v_ctx_multi_header' then
					ls_link_from_field = 'hdr_id'
					ls_link_to_field   = 'hdr_id'
				End if	
				//End - Added By Mark Lee 06/04/12
			END IF		
			//---------End Added ------------------------------------------------------------------	
			
			cb_view_add_link.TriggerEvent( Clicked! )		
			dw_view_links.SetItem( ii_nr, "link_type", "=" )		
			dw_view_links.SetItem( ii_nr, "link_from_table_nm", ls_first_table_name )						
			//<Modify> 06/19/2007 by: Andy fixed a defect 
			//dw_view_links.SetItem( ii_nr, "link_from_field_nm", "ctx_id" )	
			dw_view_links.SetItem( ii_nr, "link_from_field_nm", ls_link_from_field)
			dw_view_links.SetItem( ii_nr, "link_to_table_nm", ls_table_name )				
			//dw_view_links.SetItem( ii_nr, "link_to_field_nm", "ctx_id" )
			dw_view_links.SetItem( ii_nr, "link_to_field_nm", ls_link_to_field )
			//end of Modify
			li_prac_link_cnt++
			CONTINUE;			
		END IF
		//---------------------------- APPEON END ----------------------------
		//---------Begin Added by (Appeon)Stephen 08.05.2014 for BugH071601--------
		//if Upper( LeftA( ls_first_table_name, 5 ) ) = "V_CTX" or Upper( LeftA( ls_table_name, 5 ) ) = "V_CTX" THEN continue //(Appeon)Stephen 05.13.2014 - IntelliReport Modifications 14.2
		 IF li_module	= 1 or li_cred_module = 1 THEN continue
		//---------End Added ------------------------------------------------------

		//debugbreak()
		cb_view_add_link.TriggerEvent( Clicked! )
		dw_view_links.SetItem( ii_nr, "link_type", "=" )				
		dw_view_links.SetItem( ii_nr, "link_from_table_nm", ls_first_table_name )				
		dw_view_links.SetItem( ii_nr, "link_from_field_nm", "prac_id" )			
		dw_view_links.SetItem( ii_nr, "link_to_table_nm", ls_table_name )				
		dw_view_links.SetItem( ii_nr, "link_to_field_nm", "prac_id" )				
		li_prac_link_cnt++
		//  Added by Nova 08.20.2008
		if ls_first_table_name='v_affil_stat' then  lb_affil_stat_allready_linked=true
		
	END FOR
	
	IF li_module	= 1 THEN continue //(Appeon)Stephen 08.05.2014 - BugH071603
	IF li_prac_link_cnt = 0 THEN
		IF lb_affil_stat THEN
			cb_view_add_link.TriggerEvent( Clicked! )		
			li_rc = dw_view_links.RowCount( )
			dw_view_links.SetItem( li_rc, "link_type", "=" )				
			dw_view_links.SetItem( li_rc, "link_from_table_nm", ls_first_table_name )				
			dw_view_links.SetItem( li_rc, "link_from_field_nm", "prac_id" )			
			dw_view_links.SetItem( li_rc, "link_to_table_nm", "v_affil_stat" )				
			dw_view_links.SetItem( li_rc, "link_to_field_nm", "prac_id" )		
			lb_affil_stat_allready_linked = True
			//messagebox("2", "clicked")	
		ELSEIF lb_address_link THEN
			//modify 07/19/2007 by: Andy	
			if lower(ls_first_table_name) <> "v_address" then
				cb_view_add_link.TriggerEvent( Clicked! )		
				li_rc = dw_view_links.RowCount( )
				dw_view_links.SetItem( li_rc, "link_type", "=" )				
				dw_view_links.SetItem( li_rc, "link_from_table_nm", ls_first_table_name )				
				dw_view_links.SetItem( li_rc, "link_from_field_nm", "prac_id" )			
				dw_view_links.SetItem( li_rc, "link_to_table_nm", "v_address" )				
				dw_view_links.SetItem( li_rc, "link_to_field_nm", "prac_id" )	
				//--------Begin Added by Nova 08.20.2008------------------------
				ls_tmp_table_name='v_address'
				ls_tmp_first_table_name=ls_first_table_name
				//--------End Added --------------------------------------------
	
				
				//messagebox("3", "clicked")
			end if
		//end of modify
		END IF
		//------------------- APPEON BEGIN -------------------
		//$<add> Stephen 04.22.2013
		//                         04.25.2013
		//$<reason> Auto Link is not creating links for Specialty Facility link correctly
		//                 Auto Link is not creating links for Hosp Facility Link correctly
		if lb_specialty_facility_link then
			if lower(ls_first_table_name) <> "v_board_specialty" then
				cb_view_add_link.TriggerEvent( Clicked! )		
				li_rc = dw_view_links.RowCount( )
				dw_view_links.SetItem( li_rc, "link_type", "=" )				
				dw_view_links.SetItem( li_rc, "link_from_table_nm", ls_first_table_name )				
				dw_view_links.SetItem( li_rc, "link_from_field_nm", "prac_id" )			
				dw_view_links.SetItem( li_rc, "link_to_table_nm", "v_board_specialty" )				
				dw_view_links.SetItem( li_rc, "link_to_field_nm", "prac_id" )
				ls_tmp_table_name='v_board_specialty'
				ls_tmp_first_table_name=ls_first_table_name
			end if
		end if
		
		if lb_hosp_link then
			if lower(ls_first_table_name) <> "v_hosp_affil" then
				cb_view_add_link.TriggerEvent( Clicked! )		
				li_rc = dw_view_links.RowCount( )
				dw_view_links.SetItem( li_rc, "link_type", "=" )				
				dw_view_links.SetItem( li_rc, "link_from_table_nm", ls_first_table_name )				
				dw_view_links.SetItem( li_rc, "link_from_field_nm", "prac_id" )			
				dw_view_links.SetItem( li_rc, "link_to_table_nm", "v_hosp_affil" )				
				dw_view_links.SetItem( li_rc, "link_to_field_nm", "prac_id" )
				ls_tmp_table_name='v_hosp_affil'
				ls_tmp_first_table_name=ls_first_table_name
			end if
		end if
		//------------------- APPEON END ------------------
	END IF
NEXT
li_rc = dw_view_tables.RowCount()

//Modify 07/19/2007 by: Andy
//FOR i = 1 TO li_rc
FOR i = 1 TO li_rc//uncommented by Nova on 08.20.2008
//end of modify
	ls_table_name = dw_view_tables.GetItemString( i, "table_name" )	
	CHOOSE CASE ls_table_name
		CASE "v_ctx_groups"  //(Appeon)Stephen 05.16.2014 - IntelliReport Modifications 14.2
			if lb_ctx_group then
				for li_cnt = 1 to li_rc
					ls_first_table_name = dw_view_tables.GetItemString( li_cnt, "table_name" )
					if ls_first_table_name = "v_ctx_loc_covering_partners"  or ls_first_table_name = "v_ctx_locations" OR ls_first_table_name = "v_ctx_loc_insurance" OR ls_first_table_name = "v_ctx_loc_language" OR ls_first_table_name = "v_ctx_loc_other_ids" OR +&
				     	ls_first_table_name = "v_ctx_loc_practice_info" OR ls_first_table_name = "v_ctx_loc_questions" then
						cb_view_add_link.TriggerEvent( Clicked! )
						li_link_row = dw_view_links.RowCount( )
						dw_view_links.SetItem( li_link_row, "link_type", "=" )				
						dw_view_links.SetItem( li_link_row, "link_from_table_nm", "v_ctx_groups" )				
						dw_view_links.SetItem( li_link_row, "link_from_field_nm", "rec_id" )			
						dw_view_links.SetItem( li_link_row, "link_to_table_nm", ls_first_table_name )				
						dw_view_links.SetItem( li_link_row, "link_to_field_nm", "gp_id" )							
				     end if					
				next
			end if
		CASE "v_affil_stat"
			IF NOT lb_affil_stat_allready_linked THEN
				cb_view_add_link.TriggerEvent( Clicked! )
				li_link_row = dw_view_links.RowCount( )
				dw_view_links.SetItem( li_link_row, "link_type", "=" )			
				IF dw_view_tables.Find( "table_name = 'v_basic'", 1, 1000 ) > 0 THEN				
					dw_view_links.SetItem( li_link_row, "link_from_table_nm", "v_basic" )				
				ELSEIF dw_view_tables.Find( "table_name = 'v_basic_info'", 1, 1000 ) > 0 THEN			
					dw_view_links.SetItem( li_link_row, "link_from_table_nm", "v_basic_info" )								
				ELSEIF dw_view_tables.Find( "table_name = 'v_full_name'", 1, 1000 ) > 0 THEN			
					dw_view_links.SetItem( li_link_row, "link_from_table_nm", "v_full_name" )	
				ELSE
					dw_view_links.DeleteRow( li_link_row )
				END IF			
				dw_view_links.SetItem( li_link_row, "link_from_field_nm", "prac_id" )			
				dw_view_links.SetItem( li_link_row, "link_to_table_nm", "v_affil_stat" )				
				dw_view_links.SetItem( li_link_row, "link_to_field_nm", "prac_id" )		
				lb_affil_stat_allready_linked = True
				//messagebox("", "clicked")				
			END IF
		CASE "v_dept"
			cb_view_add_link.TriggerEvent( Clicked! )
			li_link_row = dw_view_links.RowCount( )
			dw_view_links.SetItem( li_link_row, "link_type", "=" )				
			dw_view_links.SetItem( li_link_row, "link_from_table_nm", "v_affil_stat" )				
			dw_view_links.SetItem( li_link_row, "link_from_field_nm", "rec_id" )			
			dw_view_links.SetItem( li_link_row, "link_to_table_nm", "v_dept" )				
			dw_view_links.SetItem( li_link_row, "link_to_field_nm", "rec_id" )	
			
		CASE "v_affil_dept" //Start Code Change ---- 10.05.2007 #V7 maha added
			cb_view_add_link.TriggerEvent( Clicked! )
			li_link_row = dw_view_links.RowCount( )
			dw_view_links.SetItem( li_link_row, "link_type", "=" )				
			dw_view_links.SetItem( li_link_row, "link_from_table_nm", "v_affil_stat" )				
			dw_view_links.SetItem( li_link_row, "link_from_field_nm", "rec_id" )			
			dw_view_links.SetItem( li_link_row, "link_to_table_nm", "v_affil_dept" )				
			dw_view_links.SetItem( li_link_row, "link_to_field_nm", "rec_id" )	

		CASE "v_staff_cat"
			cb_view_add_link.TriggerEvent( Clicked! )
			li_link_row = dw_view_links.RowCount( )
			dw_view_links.SetItem( li_link_row, "link_type", "=" )				
			dw_view_links.SetItem( li_link_row, "link_from_table_nm", "v_affil_stat" )				
			dw_view_links.SetItem( li_link_row, "link_from_field_nm", "rec_id" )			
			dw_view_links.SetItem( li_link_row, "link_to_table_nm", "v_staff_cat" )				
			dw_view_links.SetItem( li_link_row, "link_to_field_nm", "rec_id" )					

		CASE "v_committee_review"
			cb_view_add_link.TriggerEvent( Clicked! )
			li_link_row = dw_view_links.RowCount( )
			dw_view_links.SetItem( li_link_row, "link_type", "=" )				
			dw_view_links.SetItem( li_link_row, "link_from_table_nm", "v_affil_stat" )				
			dw_view_links.SetItem( li_link_row, "link_from_field_nm", "rec_id" )			
			dw_view_links.SetItem( li_link_row, "link_to_table_nm", "v_committee_review" )				
			dw_view_links.SetItem( li_link_row, "link_to_field_nm", "rec_id" )					

		CASE "v_staff_leave"
			cb_view_add_link.TriggerEvent( Clicked! )
			li_link_row = dw_view_links.RowCount( )
			dw_view_links.SetItem( li_link_row, "link_type", "=" )				
			dw_view_links.SetItem( li_link_row, "link_from_table_nm", "v_affil_stat" )				
			dw_view_links.SetItem( li_link_row, "link_from_field_nm", "rec_id" )			
			//--------Begin Modified by  Nova 07.22.2009------------------------
			//dw_view_links.SetItem( li_link_row, "link_to_table_nm", "v_committee_review" )				
			dw_view_links.SetItem( li_link_row, "link_to_table_nm", "v_staff_leave" )
			//--------End Modified --------------------------------------------					
			dw_view_links.SetItem( li_link_row, "link_to_field_nm", "rec_id" )			
			
		//------------------- APPEON BEGIN -------------------
		//$<add> Stephen 04.22.2013
		//                         04.25.2013
		//$<reason> Auto Link is not creating links for Specialty Facility link correctly
		//                 Auto Link is not creating links for Hosp Facility Link correctly
		case "v_board_specialty"
			IF lb_specialty_facility_link THEN
				cb_view_add_link.TriggerEvent( Clicked! )
				li_link_row = dw_view_links.RowCount( )
				dw_view_links.SetItem( li_link_row, "link_type", "=" )				
				dw_view_links.SetItem( li_link_row, "link_from_table_nm", ls_table_name )				
				dw_view_links.SetItem( li_link_row, "link_from_field_nm", "rec_id" )			
				dw_view_links.SetItem( li_link_row, "link_to_table_nm", "v_specialty_facility_link" )				
				dw_view_links.SetItem( li_link_row, "link_to_field_nm", "specialty_id" )
				if (lower(ls_tmp_table_name)<>lower(ls_table_name))  and  (lower(ls_tmp_first_table_name)<>lower(ls_tmp_first_table_name)) then//Added by Nova on 08.20.2008
					if lower(ls_first_table_name) <> lower(ls_table_name) then
						cb_view_add_link.TriggerEvent( Clicked! ) //naha 101104
						li_link_row = dw_view_links.RowCount( )
						dw_view_links.SetItem( li_link_row, "link_type", "=" )				
						dw_view_links.SetItem( li_link_row, "link_from_table_nm", ls_first_table_name )				
						dw_view_links.SetItem( li_link_row, "link_from_field_nm", "prac_id" )			
						dw_view_links.SetItem( li_link_row, "link_to_table_nm", ls_table_name )				
						dw_view_links.SetItem( li_link_row, "link_to_field_nm", "prac_id" )
					end if
				end if
			END IF
			
			IF dw_view_tables.Find( "table_name = 'v_affil_stat'", 1, 1000 ) > 0 and lb_specialty_facility_link  then
				cb_view_add_link.TriggerEvent( Clicked! )
				li_link_row = dw_view_links.RowCount( )
				dw_view_links.SetItem( li_link_row, "link_type", "=" )				
				dw_view_links.SetItem( li_link_row, "link_from_table_nm", "v_specialty_facility_link" )				
				dw_view_links.SetItem( li_link_row, "link_from_field_nm", "prac_id" )			
				dw_view_links.SetItem( li_link_row, "link_to_table_nm", "v_affil_stat" )				
				dw_view_links.SetItem( li_link_row, "link_to_field_nm", "prac_id" )					
				//lb_affil_stat_allready_linked = True
			
				cb_view_add_link.TriggerEvent( Clicked! )
				li_link_row = dw_view_links.RowCount( )
				dw_view_links.SetItem( li_link_row, "link_type", "=" )				
				dw_view_links.SetItem( li_link_row, "link_from_table_nm", "v_specialty_facility_link" )				
				dw_view_links.SetItem( li_link_row, "link_from_field_nm", "facility_id" )			
				dw_view_links.SetItem( li_link_row, "link_to_table_nm", "v_affil_stat" )				
				dw_view_links.SetItem( li_link_row, "link_to_field_nm", "parent_facility_id" )	
			END IF
		
		case "v_hosp_affil"
			IF lb_hosp_link THEN
				cb_view_add_link.TriggerEvent( Clicked! )
				li_link_row = dw_view_links.RowCount( )
				dw_view_links.SetItem( li_link_row, "link_type", "=" )				
				dw_view_links.SetItem( li_link_row, "link_from_table_nm", ls_table_name )				
				dw_view_links.SetItem( li_link_row, "link_from_field_nm", "rec_id" )			
				dw_view_links.SetItem( li_link_row, "link_to_table_nm", "v_hospital_facility_link" )				
				dw_view_links.SetItem( li_link_row, "link_to_field_nm", "rec_id" )
				if (lower(ls_tmp_table_name)<>lower(ls_table_name))  and  (lower(ls_tmp_first_table_name)<>lower(ls_tmp_first_table_name)) then//Added by Nova on 08.20.2008
					if lower(ls_first_table_name) <> lower(ls_table_name) then
						cb_view_add_link.TriggerEvent( Clicked! ) //naha 101104
						li_link_row = dw_view_links.RowCount( )
						dw_view_links.SetItem( li_link_row, "link_type", "=" )				
						dw_view_links.SetItem( li_link_row, "link_from_table_nm", ls_first_table_name )				
						dw_view_links.SetItem( li_link_row, "link_from_field_nm", "prac_id" )			
						dw_view_links.SetItem( li_link_row, "link_to_table_nm", ls_table_name )				
						dw_view_links.SetItem( li_link_row, "link_to_field_nm", "prac_id" )
					end if
				end if
			END IF
			
			IF dw_view_tables.Find( "table_name = 'v_affil_stat'", 1, 1000 ) > 0 and lb_hosp_link  then
				cb_view_add_link.TriggerEvent( Clicked! )
				li_link_row = dw_view_links.RowCount( )
				dw_view_links.SetItem( li_link_row, "link_type", "=" )				
				dw_view_links.SetItem( li_link_row, "link_from_table_nm", "v_hospital_facility_link" )				
				dw_view_links.SetItem( li_link_row, "link_from_field_nm", "prac_id" )			
				dw_view_links.SetItem( li_link_row, "link_to_table_nm", "v_affil_stat" )				
				dw_view_links.SetItem( li_link_row, "link_to_field_nm", "prac_id" )					
				//lb_affil_stat_allready_linked = True
			
				cb_view_add_link.TriggerEvent( Clicked! )
				li_link_row = dw_view_links.RowCount( )
				dw_view_links.SetItem( li_link_row, "link_type", "=" )				
				dw_view_links.SetItem( li_link_row, "link_from_table_nm", "v_hospital_facility_link" )				
				dw_view_links.SetItem( li_link_row, "link_from_field_nm", "facility_id" )			
				dw_view_links.SetItem( li_link_row, "link_to_table_nm", "v_affil_stat" )				
				dw_view_links.SetItem( li_link_row, "link_to_field_nm", "parent_facility_id" )	
			END IF
		//------------------- APPEON END -------------------

		CASE "v_net_dev_actions","v_net_dev_ids"
			cb_view_add_link.TriggerEvent( Clicked! )
			li_link_row = dw_view_links.RowCount( )
			dw_view_links.SetItem( li_link_row, "link_type", "=" )				
			dw_view_links.SetItem( li_link_row, "link_from_table_nm", "v_affil_stat" )				
			dw_view_links.SetItem( li_link_row, "link_from_field_nm", "prac_id" )			
			dw_view_links.SetItem( li_link_row, "link_to_table_nm", ls_table_name )				
			dw_view_links.SetItem( li_link_row, "link_to_field_nm", "prac_id" )					

			cb_view_add_link.TriggerEvent( Clicked! )
			li_link_row = dw_view_links.RowCount( )
			dw_view_links.SetItem( li_link_row, "link_type", "=" )				
			dw_view_links.SetItem( li_link_row, "link_from_table_nm", "v_affil_stat" )				
			dw_view_links.SetItem( li_link_row, "link_from_field_nm", "parent_facility_id" )			
			dw_view_links.SetItem( li_link_row, "link_to_table_nm", ls_table_name )				
			dw_view_links.SetItem( li_link_row, "link_to_field_nm", "facility_id" )					

		CASE "v_address", "v_mailing_address"
			IF lb_address_link THEN
				cb_view_add_link.TriggerEvent( Clicked! )
				li_link_row = dw_view_links.RowCount( )
				dw_view_links.SetItem( li_link_row, "link_type", "=" )				
				dw_view_links.SetItem( li_link_row, "link_from_table_nm", ls_table_name )				
				dw_view_links.SetItem( li_link_row, "link_from_field_nm", "rec_id" )			
				dw_view_links.SetItem( li_link_row, "link_to_table_nm", "v_address_link" )				
				dw_view_links.SetItem( li_link_row, "link_to_field_nm", "address_id" )
//				ls_tmp_table_name=v_address
//				ls_tmp_first_table_name=ls_first_table_name
			if (lower(ls_tmp_table_name)<>lower(ls_table_name))  and  (lower(ls_tmp_first_table_name)<>lower(ls_tmp_first_table_name)) then//Added by Nova on 08.20.2008
				//modify 07/19/2007 by: Andy
				if lower(ls_first_table_name) <> lower(ls_table_name) then
					cb_view_add_link.TriggerEvent( Clicked! ) //naha 101104
					li_link_row = dw_view_links.RowCount( )
					dw_view_links.SetItem( li_link_row, "link_type", "=" )				
					dw_view_links.SetItem( li_link_row, "link_from_table_nm", ls_first_table_name )				
					dw_view_links.SetItem( li_link_row, "link_from_field_nm", "prac_id" )			
					dw_view_links.SetItem( li_link_row, "link_to_table_nm", ls_table_name )				
					dw_view_links.SetItem( li_link_row, "link_to_field_nm", "prac_id" )
				end if
			end if
				//end of Modify
			END IF
			
			//if the affil_stat table is in the list then link to address_link
			IF dw_view_tables.Find( "table_name = 'v_affil_stat'", 1, 1000 ) > 0 THEN
				//IF NOT lb_affil_stat_allready_linked THEN	//Commented by Nova on 08.20.2008		
					cb_view_add_link.TriggerEvent( Clicked! )
					li_link_row = dw_view_links.RowCount( )
					dw_view_links.SetItem( li_link_row, "link_type", "=" )				
					dw_view_links.SetItem( li_link_row, "link_from_table_nm", "v_address_link" )				
					dw_view_links.SetItem( li_link_row, "link_from_field_nm", "prac_id" )			
					dw_view_links.SetItem( li_link_row, "link_to_table_nm", "v_affil_stat" )				
					dw_view_links.SetItem( li_link_row, "link_to_field_nm", "prac_id" )					
					lb_affil_stat_allready_linked = True
				//END IF
				
				//IF NOT lb_affil_stat_allready_linked THEN
					cb_view_add_link.TriggerEvent( Clicked! )
					li_link_row = dw_view_links.RowCount( )
					dw_view_links.SetItem( li_link_row, "link_type", "=" )				
					dw_view_links.SetItem( li_link_row, "link_from_table_nm", "v_address_link" )				
					dw_view_links.SetItem( li_link_row, "link_from_field_nm", "facility_id" )			
					dw_view_links.SetItem( li_link_row, "link_to_table_nm", "v_affil_stat" )				
					dw_view_links.SetItem( li_link_row, "link_to_field_nm", "parent_facility_id" )						
				//END IF
			END IF
		CASE "v_action_items","v_net_dev_actions"			
			IF dw_view_tables.Find( "table_name = 'v_affil_stat'", 1, 1000 ) > 0 THEN
				cb_view_add_link.TriggerEvent( Clicked! )
				li_link_row = dw_view_links.RowCount( )
				dw_view_links.SetItem( li_link_row, "link_type", "=" )
				dw_view_links.SetItem( li_link_row, "link_from_table_nm", ls_table_name )				
				dw_view_links.SetItem( li_link_row, "link_from_field_nm", "prac_id" )			
				dw_view_links.SetItem( li_link_row, "link_to_table_nm", "v_affil_stat" )				
				dw_view_links.SetItem( li_link_row, "link_to_field_nm", "prac_id" )					
				lb_affil_stat_allready_linked = True
			END IF			
			Open( w_link_question )
			cb_view_add_link.TriggerEvent( Clicked! )
			li_link_row = dw_view_links.RowCount( )
			dw_view_links.SetItem( li_link_row, "link_type", "=" )				
			dw_view_links.SetItem( li_link_row, "link_from_table_nm", "v_action_items" )				
			dw_view_links.SetItem( li_link_row, "link_from_field_nm", "facility_id" )			
			dw_view_links.SetItem( li_link_row, "link_to_table_nm", "v_affil_stat" )				
			IF Message.StringParm = "Parent" THEN			
				dw_view_links.SetItem( li_link_row, "link_to_field_nm", "parent_facility_id" )					
			ELSE
				dw_view_links.SetItem( li_link_row, "link_to_field_nm", "verifying_facility" )					
			END IF
			lb_affil_stat_allready_linked = True			
	END CHOOSE
END FOR
//\/ link the net dev app ids  maha 101104
IF dw_view_tables.Find( "table_name = 'v_net_dev_actions'", 1, 1000 ) > 0  and dw_view_tables.Find( "table_name = 'v_net_dev_ids'", 1, 1000 ) > 0 THEN
	cb_view_add_link.TriggerEvent( Clicked! )
	li_link_row = dw_view_links.RowCount( )
	dw_view_links.SetItem( li_link_row, "link_type", "=" )
	dw_view_links.SetItem( li_link_row, "link_from_table_nm", "v_net_dev_actions" )				
	dw_view_links.SetItem( li_link_row, "link_from_field_nm", "app_id" )			
	dw_view_links.SetItem( li_link_row, "link_to_table_nm", "v_net_dev_ids" )				
	dw_view_links.SetItem( li_link_row, "link_to_field_nm", "app_id" )	
end if

dw_view_links.Update()
dw_view_links.Retrieve( il_view_id )

//maha 012704 replaced below with above from ver 3 which works better
//Integer li_nr
//Integer li_ans
//Integer li_rc
//Integer i
//Integer li_link_row
//Integer li_prac_link_cnt = 0
//Long ll_tid
//Integer li_table_id
//String ls_table_name
//String ls_first_table_name
//Boolean lb_affil_stat_allready_linked = False
//Boolean lb_affil_stat
//Boolean lb_dept
//Boolean lb_staff_cat
//Boolean lb_basic
//Boolean lb_address
//Boolean lb_address_link
//
//dw_view_tables.AcceptText()
//dw_view_tables.Update()
//dw_view_tables.Retrieve( il_view_id )
//
//li_rc = dw_view_links.RowCount()
//IF li_rc > 0 THEN
//	li_ans = MessageBox("Links", "This option will delete any links that currently exist.  Continue?", Question!, YesNo!, 1 )
//	IF li_ans = 2 THEN
//		Return
//	END IF
//	FOR i = 1 TO li_rc
//		dw_view_links.DeleteRow( 0 )
//	END FOR
//	dw_view_links.Update( )
//END IF
//
//li_rc = dw_view_tables.RowCount()
//IF li_rc < 2 THEN
//	MessageBox( "Link Failure", "You need to select at least 2 tables to use the Auto Link Function." )
//	Return
//END IF
//
//ls_first_table_name = dw_view_tables.GetItemString( 1, "table_name" )
//
//
////analyze the tables that are selected
//FOR i = 1 TO li_rc
//	ls_table_name = dw_view_tables.GetItemString( i, "table_name" )
//	IF ls_table_name = "v_dept" OR ls_table_name = "v_staff_cat" OR ls_table_name = "v_staff_leave"  OR ls_table_name = "v_committee_review" OR +&
//		ls_table_name = "v_net_dev_actions" OR ls_table_name = "v_net_dev_ids" OR ls_table_name = "v_net_dev_notes"  OR ls_table_name = "v_action_items" THEN
//		IF dw_view_tables.Find( "table_name = 'v_affil_stat'", 1, 1000 ) = 0 THEN
//			IF ls_table_name = "v_action_items" THEN
//				li_ans = MessageBox( "Table Selection", "Will you be using the v_action_items table to report on data for a specific facility? If so you must have the v_affil_stat table selected also so you can link to the parent OR verifying facility field.  Would you like to add this now?", StopSign!, YesNo!, 1 )				
//			ELSE
//				li_ans = MessageBox( "Table Selection", "To use the " + Upper( ls_table_name ) + " table you must have the v_affil_stat table selected also.  Would you like to add this now?", StopSign!, YesNo!, 1 )
//			END IF
//			IF li_ans = 1 THEN
//				lb_affil_stat	= True
//				li_nr = dw_view_tables.InsertRow( 0 )			
//				SELECT id
//				INTO :ll_tid
//				FROM dbo.sysobjects
//				WHERE name = 'v_affil_stat' ;
//				dw_view_tables.SetItem( li_nr, "table_name", "v_affil_stat" )				
//				dw_view_tables.SetItem( li_nr, "cust_table_name", ll_tid )
//				dw_view_tables.SetItem( li_nr, "view_id", il_view_id )
//				dw_view_tables.SetItem( li_nr, "project_id", ii_project_id )
//				il_next_table_id++				
//				dw_view_tables.SetItem( li_nr, "table_id", il_next_table_id )				
//			ELSE
//				Return
//			END IF
//		ELSE
//			lb_affil_stat	= True
//		END IF
//		CONTINUE
//	END IF
//	IF ls_table_name = "v_address" OR ls_table_name = "v_mailing_address" THEN
//		IF dw_view_tables.Find( "table_name = 'v_address_link'", 1, 1000 ) = 0 THEN		
//			li_ans = MessageBox( "Table Selection", "You have selected the " + ls_table_name + " table.  If you want to query addresses by ADDRESS TYPE (Primary, Additional, Billing etc.) then you should include the v_address_link table.  Would you like to add this table now?", StopSign!, YesNo!, 1 )
//			IF li_ans = 1 THEN
//				lb_address_link = True
//				li_nr = dw_view_tables.InsertRow( 0 )			
//				SELECT id
//				INTO :ll_tid
//				FROM dbo.sysobjects
//				WHERE name = 'v_address_link' ;
//				dw_view_tables.SetItem( li_nr, "table_name", "v_address_link" )				
//				dw_view_tables.SetItem( li_nr, "cust_table_name", ll_tid )
//				dw_view_tables.SetItem( li_nr, "view_id", il_view_id )
//				dw_view_tables.SetItem( li_nr, "project_id", ii_project_id )
//				il_next_table_id++				
//				dw_view_tables.SetItem( li_nr, "table_id", il_next_table_id )				
//			END IF
//		ELSE
//				lb_address_link = True
//		END IF
//		
//		CONTINUE
//	END IF
//END FOR
//
//li_rc = dw_view_tables.RowCount()
//
//FOR i = 2 TO li_rc
//	ls_table_name = dw_view_tables.GetItemString( i, "table_name" )
//	IF ls_table_name = "v_dept" OR ls_table_name = "v_staff_cat" OR ls_table_name = "v_staff_leave"  OR ls_table_name = "v_committee_review" OR +&
//		 ls_table_name = "v_affil_stat" OR ls_table_name = "v_net_dev_actions" OR ls_table_name = "v_net_dev_ids" OR ls_table_name = "v_net_dev_notes" OR +&
//		 ls_table_name = "v_action_items" OR ls_table_name = "v_address_link" OR ( (ls_table_name = "v_address" OR ls_table_name = "v_mailing_address") and lb_address_link = True) THEN
//		CONTINUE
//	END IF
//	//debugbreak()
//	cb_view_add_link.TriggerEvent( Clicked! )
//	dw_view_links.SetItem( ii_nr, "link_type", "=" )				
//	dw_view_links.SetItem( ii_nr, "link_from_table_nm", ls_first_table_name )				
//	dw_view_links.SetItem( ii_nr, "link_from_field_nm", "prac_id" )			
//	dw_view_links.SetItem( ii_nr, "link_to_table_nm", ls_table_name )				
//	dw_view_links.SetItem( ii_nr, "link_to_field_nm", "prac_id" )				
//	li_prac_link_cnt++
//	//messagebox("1", "clicked")
//END FOR
//
//IF li_prac_link_cnt = 0 THEN
//	IF lb_affil_stat THEN
//		cb_view_add_link.TriggerEvent( Clicked! )		
//		li_rc = dw_view_links.RowCount( )
//		dw_view_links.SetItem( li_rc, "link_type", "=" )				
//		dw_view_links.SetItem( li_rc, "link_from_table_nm", ls_first_table_name )				
//		dw_view_links.SetItem( li_rc, "link_from_field_nm", "prac_id" )			
//		dw_view_links.SetItem( li_rc, "link_to_table_nm", "v_affil_stat" )				
//		dw_view_links.SetItem( li_rc, "link_to_field_nm", "prac_id" )		
//		lb_affil_stat_allready_linked = True
//		//messagebox("2", "clicked")		
//	ELSEIF lb_address_link THEN
//		cb_view_add_link.TriggerEvent( Clicked! )		
//		li_rc = dw_view_links.RowCount( )
//		dw_view_links.SetItem( li_rc, "link_type", "=" )				
//		dw_view_links.SetItem( li_rc, "link_from_table_nm", ls_first_table_name )				
//		dw_view_links.SetItem( li_rc, "link_from_field_nm", "prac_id" )			
//		dw_view_links.SetItem( li_rc, "link_to_table_nm", "v_address" )				
//		dw_view_links.SetItem( li_rc, "link_to_field_nm", "prac_id" )		
//		//messagebox("3", "clicked")		
//	END IF
//END IF
//
//li_rc = dw_view_tables.RowCount()
//
//FOR i = 2 TO li_rc
//	ls_table_name = dw_view_tables.GetItemString( i, "table_name" )	
//	CHOOSE CASE ls_table_name
//		CASE "v_affil_stat"
//			IF NOT lb_affil_stat_allready_linked THEN
//				cb_view_add_link.TriggerEvent( Clicked! )
//				li_link_row = dw_view_links.RowCount( )
//				dw_view_links.SetItem( li_link_row, "link_type", "=" )			
//				IF dw_view_tables.Find( "table_name = 'v_basic'", 1, 1000 ) > 0 THEN				
//					dw_view_links.SetItem( li_link_row, "link_from_table_nm", "v_basic" )				
//				ELSEIF dw_view_tables.Find( "table_name = 'v_basic_info'", 1, 1000 ) > 0 THEN			
//					dw_view_links.SetItem( li_link_row, "link_from_table_nm", "v_basic_info" )								
//				ELSEIF dw_view_tables.Find( "table_name = 'v_full_name'", 1, 1000 ) > 0 THEN			
//					dw_view_links.SetItem( li_link_row, "link_from_table_nm", "v_full_name" )	
//				ELSE
//					dw_view_links.DeleteRow( li_link_row )
//				END IF			
//				dw_view_links.SetItem( li_link_row, "link_from_field_nm", "prac_id" )			
//				dw_view_links.SetItem( li_link_row, "link_to_table_nm", "v_affil_stat" )				
//				dw_view_links.SetItem( li_link_row, "link_to_field_nm", "prac_id" )		
//				lb_affil_stat_allready_linked = True
//				//messagebox("", "clicked")				
//			END IF
//		CASE "v_dept"
//			cb_view_add_link.TriggerEvent( Clicked! )
//			li_link_row = dw_view_links.RowCount( )
//			dw_view_links.SetItem( li_link_row, "link_type", "=" )				
//			dw_view_links.SetItem( li_link_row, "link_from_table_nm", "v_affil_stat" )				
//			dw_view_links.SetItem( li_link_row, "link_from_field_nm", "rec_id" )			
//			dw_view_links.SetItem( li_link_row, "link_to_table_nm", "v_dept" )				
//			dw_view_links.SetItem( li_link_row, "link_to_field_nm", "rec_id" )					
//
//		CASE "v_staff_cat"
//			cb_view_add_link.TriggerEvent( Clicked! )
//			li_link_row = dw_view_links.RowCount( )
//			dw_view_links.SetItem( li_link_row, "link_type", "=" )				
//			dw_view_links.SetItem( li_link_row, "link_from_table_nm", "v_affil_stat" )				
//			dw_view_links.SetItem( li_link_row, "link_from_field_nm", "rec_id" )			
//			dw_view_links.SetItem( li_link_row, "link_to_table_nm", "v_staff_cat" )				
//			dw_view_links.SetItem( li_link_row, "link_to_field_nm", "rec_id" )					
//
//		CASE "v_committee_review"
//			cb_view_add_link.TriggerEvent( Clicked! )
//			li_link_row = dw_view_links.RowCount( )
//			dw_view_links.SetItem( li_link_row, "link_type", "=" )				
//			dw_view_links.SetItem( li_link_row, "link_from_table_nm", "v_affil_stat" )				
//			dw_view_links.SetItem( li_link_row, "link_from_field_nm", "rec_id" )			
//			dw_view_links.SetItem( li_link_row, "link_to_table_nm", "v_committee_review" )				
//			dw_view_links.SetItem( li_link_row, "link_to_field_nm", "rec_id" )					
//
//		CASE "v_staff_leave"
//			cb_view_add_link.TriggerEvent( Clicked! )
//			li_link_row = dw_view_links.RowCount( )
//			dw_view_links.SetItem( li_link_row, "link_type", "=" )				
//			dw_view_links.SetItem( li_link_row, "link_from_table_nm", "v_affil_stat" )				
//			dw_view_links.SetItem( li_link_row, "link_from_field_nm", "rec_id" )			
//			dw_view_links.SetItem( li_link_row, "link_to_table_nm", "v_committee_review" )				
//			dw_view_links.SetItem( li_link_row, "link_to_field_nm", "rec_id" )					
//
//		CASE "v_net_dev_actions"
//			cb_view_add_link.TriggerEvent( Clicked! )
//			li_link_row = dw_view_links.RowCount( )
//			dw_view_links.SetItem( li_link_row, "link_type", "=" )				
//			dw_view_links.SetItem( li_link_row, "link_from_table_nm", "v_affil_stat" )				
//			dw_view_links.SetItem( li_link_row, "link_from_field_nm", "prac_id" )			
//			dw_view_links.SetItem( li_link_row, "link_to_table_nm", "v_net_dev_actions" )				
//			dw_view_links.SetItem( li_link_row, "link_to_field_nm", "prac_id" )					
//
//			cb_view_add_link.TriggerEvent( Clicked! )
//			li_link_row = dw_view_links.RowCount( )
//			dw_view_links.SetItem( li_link_row, "link_type", "=" )				
//			dw_view_links.SetItem( li_link_row, "link_from_table_nm", "v_affil_stat" )				
//			dw_view_links.SetItem( li_link_row, "link_from_field_nm", "parent_facility_id" )			
//			dw_view_links.SetItem( li_link_row, "link_to_table_nm", "v_net_dev_actions" )				
//			dw_view_links.SetItem( li_link_row, "link_to_field_nm", "facility_id" )					
//
//		CASE "v_address", "v_mailing_address"
//			IF lb_address_link THEN
//				cb_view_add_link.TriggerEvent( Clicked! )
//				li_link_row = dw_view_links.RowCount( )
//				dw_view_links.SetItem( li_link_row, "link_type", "=" )				
//				dw_view_links.SetItem( li_link_row, "link_from_table_nm", ls_table_name )				
//				dw_view_links.SetItem( li_link_row, "link_from_field_nm", "rec_id" )			
//				dw_view_links.SetItem( li_link_row, "link_to_table_nm", "v_address_link" )				
//				dw_view_links.SetItem( li_link_row, "link_to_field_nm", "address_id" )					
//			END IF
//			
//			//if the affil_stat table is in the list then link to address_link
//			IF dw_view_tables.Find( "table_name = 'v_affil_stat'", 1, 1000 ) > 0 THEN
//				IF NOT lb_affil_stat_allready_linked THEN				
//					cb_view_add_link.TriggerEvent( Clicked! )
//					li_link_row = dw_view_links.RowCount( )
//					dw_view_links.SetItem( li_link_row, "link_type", "=" )				
//					dw_view_links.SetItem( li_link_row, "link_from_table_nm", "v_address_link" )				
//					dw_view_links.SetItem( li_link_row, "link_from_field_nm", "prac_id" )			
//					dw_view_links.SetItem( li_link_row, "link_to_table_nm", "v_affil_stat" )				
//					dw_view_links.SetItem( li_link_row, "link_to_field_nm", "prac_id" )					
//					lb_affil_stat_allready_linked = True
//				END IF
//				
//				//IF NOT lb_affil_stat_allready_linked THEN
//					cb_view_add_link.TriggerEvent( Clicked! )
//					li_link_row = dw_view_links.RowCount( )
//					dw_view_links.SetItem( li_link_row, "link_type", "=" )				
//					dw_view_links.SetItem( li_link_row, "link_from_table_nm", "v_address_link" )				
//					dw_view_links.SetItem( li_link_row, "link_from_field_nm", "facility_id" )			
//					dw_view_links.SetItem( li_link_row, "link_to_table_nm", "v_affil_stat" )				
//					dw_view_links.SetItem( li_link_row, "link_to_field_nm", "parent_facility_id" )						
//				//END IF
//			END IF
//		CASE "v_action_items"			
//			IF dw_view_tables.Find( "table_name = 'v_affil_stat'", 1, 1000 ) > 0 THEN
//				cb_view_add_link.TriggerEvent( Clicked! )
//				li_link_row = dw_view_links.RowCount( )
//				dw_view_links.SetItem( li_link_row, "link_type", "=" )				
//				dw_view_links.SetItem( li_link_row, "link_from_table_nm", "v_action_items" )				
//				dw_view_links.SetItem( li_link_row, "link_from_field_nm", "prac_id" )			
//				dw_view_links.SetItem( li_link_row, "link_to_table_nm", "v_affil_stat" )				
//				dw_view_links.SetItem( li_link_row, "link_to_field_nm", "prac_id" )					
//				lb_affil_stat_allready_linked = True
//			END IF			
//			Open( w_link_question )
//			cb_view_add_link.TriggerEvent( Clicked! )
//			li_link_row = dw_view_links.RowCount( )
//			dw_view_links.SetItem( li_link_row, "link_type", "=" )				
//			dw_view_links.SetItem( li_link_row, "link_from_table_nm", "v_action_items" )				
//			dw_view_links.SetItem( li_link_row, "link_from_field_nm", "facility_id" )			
//			dw_view_links.SetItem( li_link_row, "link_to_table_nm", "v_affil_stat" )				
//			IF Message.StringParm = "Parent" THEN			
//				dw_view_links.SetItem( li_link_row, "link_to_field_nm", "parent_facility_id" )					
//			ELSE
//				dw_view_links.SetItem( li_link_row, "link_to_field_nm", "verifying_facility" )					
//			END IF
//			lb_affil_stat_allready_linked = True			
//	END CHOOSE
//END FOR
//
//
//dw_view_links.Update()
//dw_view_links.Retrieve( il_view_id )
end event

type cb_qhelp from commandbutton within tabpage_tables
integer x = 2048
integer y = 28
integer width = 384
integer height = 84
integer taborder = 60
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "&Query Help"
end type

event clicked;Open( w_query_hints )
end event

type cbx_distinct from checkbox within tabpage_tables
integer x = 2482
integer y = 212
integer width = 846
integer height = 64
boolean bringtotop = true
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long textcolor = 33554432
long backcolor = 33551856
string text = "Select Distinct Values Only"
boolean checked = true
end type

event clicked;
IF This.Checked THEN
	UPDATE conv_view
	SET distinct_sql = 1
	WHERE conv_view.view_id = :il_view_id ;
ELSE
	UPDATE conv_view
	SET distinct_sql = 0
	WHERE conv_view.view_id = :il_view_id ;	
END IF
IF SQLCA.SQLCODE = -1 THEN
	MessageBox("DB Error", SQLCA.SQLERRTEXT )
END IF
end event

type dw_view_tables from datawindow within tabpage_tables
integer x = 1262
integer y = 148
integer width = 1170
integer height = 1192
integer taborder = 60
string dragicon = "droparrow.ico"
boolean titlebar = true
string title = "Selected Tables"
string dataobject = "d_conv_view_tables_report_sql"
boolean vscrollbar = true
boolean livescroll = true
end type

event constructor;//Added by Appeon long.zhang 12.08.2016 (Issue id 5351 - SQL Server 2014 and 2016 Partial Contained Databases and High Availability Groups)
If gs_dbtype = 'SQL' THEN
	This.dataobject = 'd_conv_view_tables_report_sql' 
Else
	This.dataobject = 'd_conv_view_tables_report_asa' 
End If

This.SetTransObject( SQLCA )
//$<add> 03.31.2008 by Andy
this.setrowfocusindicator( p_1)  //Start Code Change ----12.04.2009 #V92 maha - changed indicator
end event

event dragdrop;//$<add> 02.20.2008 by Andy
of_tv_doubleclicked(tv_tables.il_DragSource)
of_audit_set("T")//Start Code Change ----06.15.2016 #V152 maha


end event

event clicked;IF row > 0 THEN
	//$<modify> 02.14.2008 by Andy
	/*Reason:Move to rowfocuschanged
	This.SelectRow( 0, False )
	This.SelectRow( row, True )
	This.SetRow( row )
	*/
	if this.RowCount( ) > 0 then this.event rowfocuschanged( 1 )
	//end of modify 02.14.2008
	is_drag_object = "deselect table"	
	This.Drag(Begin! )	
END IF
end event

event doubleclicked;//$<add> 02.20.2008 by Andy
//---------Begin Modified by (Appeon)Toney 06.13.2013 for V141 ISG-CLX--------
  /*
  of_delete_row()    
  */
//Add by Jervis 02.02.2010
//If a user double clicks in the selected Selected columns area(area on right),  
//before the system removes the field from the report prompt the user
string ls_name
if row > 0 then
	ls_name = this.GetItemString(row,'conv_view_table_table_name')
	if MessageBox("Remove","Are you sure you want to remove the " + ls_name + " from the report?",Question!,YesNo!) = 1  then
		//$<add> 02.20.2008 by Andy
		of_delete_row()
		of_audit_set("T")//Start Code Change ----06.15.2016 #V152 maha
	end if
end if  
//---------End Modfiied ------------------------------------------------------------------

//String ls_v_name
//Long   ll_Find,ll_module,ll_handle
//TreeViewItem ltri_Item
//
//if row > 0 then	
//	
//	This.DeleteRow( row )
//	of_save()	
//end if
end event

event rowfocuschanged;//--------------------------- APPEON BEGIN ---------------------------
//$<add> 02.14.2008 by Andy
String ls_v_name,ls_p_name,ls_screen
Long   ll_Find,ll_dataLength
String ls_Modify,ls_v_alias

if currentrow < 1 then return

ls_v_name = this.GetItemString(currentrow,"conv_view_table_table_name")
ll_Find = ids_tables.Find("v_name='" + ls_v_name + "'",0,ids_tables.RowCount())
if ll_Find > 0 then
	ll_dataLength = ids_tables.GetItemNumber( ll_Find, "datalength" )
	ls_p_name     = ids_tables.GetItemString( ll_Find, "p_name" )
	if Isnull(ls_p_name) then ls_p_name = ''
	ls_screen = ids_tables.GetItemString( ll_Find, "screen" )
	ls_v_alias= ids_tables.GetItemString( ll_Find, "v_alias" )
	
	//Show picture name.
	if ll_dataLength > 0 then
		ls_Modify = "t_2.visible='1' t_3.visible='1' t_3.text='" + ls_v_alias + " Screen Shot' t_1.text='" + ls_p_name + "'"//p_1.visible='1' t_1.visible='1'
		dw_5.setItem(1,"v_name",ls_v_name)
		dw_5.setItem(1,"dataleng",ll_dataLength)
		dw_5.setItem(1,"screen",ls_screen)
		dw_5.setItem(1,"v_alias",ls_v_alias)
	else
		ls_Modify = "t_2.visible='0' t_3.visible='0' t_3.text='' t_1.text=''"//p_1.visible='0' t_1.visible='0'
	end if
	dw_5.Modify(ls_Modify)
end if

//This.SelectRow( 0, False )
//This.SelectRow( currentrow, True )
This.SetRow( currentrow )
//---------------------------- APPEON END ----------------------------
end event

event other;//$<add> 04.17.2008 by Andy
if Message.WordParm = 61458 then 
	Message.Processed = true
	Message.ReturnValue = 0 
end if
end event

event retrieveend;//Start Code Change ----06.06.2017 #V154 maha
integer i
string ls_v_name

for i = 1 to this.rowcount()
	ls_v_name = this.getitemstring(i, "table_name")
	choose case ls_v_name
		case "v_full_name", "v_full_basic", "v_basic"
			this.SetItem( i, "set_sort", 0)
		case "v_affil_stat"
			this.SetItem( i, "set_sort", 1)	
		case else
			this.SetItem( i, "set_sort", 2)	
	end choose
next

this.sort()

end event

type dw_view_links from datawindow within tabpage_tables
integer x = 5
integer y = 1356
integer width = 3872
integer height = 636
integer taborder = 40
boolean titlebar = true
string title = "Create View Table Links"
string dataobject = "d_conv_view_links"
boolean vscrollbar = true
boolean livescroll = true
end type

event buttonclicked;String ls_name
String ls_table_name
String ls_obj_nm
Long ll_obj_id

ls_name = dwo.name

//Start Code Change ----02.23.2016 #V15 maha
of_link_buttons( ls_name)
return 

//IF ls_name = "from_table" OR ls_name = "to_table" THEN
//	OpenWithParm( w_conv_select_table, il_view_id)
//	IF Message.StringParm = "Cancel" THEN
//		Return
//	END IF
//	ls_obj_nm = MidA( Message.StringParm, PosA( Message.StringParm, "-" ) +1, 1000 )
//	ll_obj_id = Long( MidA( Message.StringParm, 1, PosA( Message.StringParm, "-" ) -1 ) )
//	if isnull(ll_obj_id) or ll_obj_id = 0 then return //trap maha 061703
//	IF ls_name = "from_table"  THEN
//		dw_view_links.SetItem( row, "link_from_table_nm", ls_obj_nm )
//		dw_view_links.SetItem( row, "link_from_table", ll_obj_id )	
//	ELSE
//		dw_view_links.SetItem( row, "link_to_table_nm", ls_obj_nm )
//		dw_view_links.SetItem( row, "link_to_table", ll_obj_id )			
//	END IF
//ELSEIF ls_name = "from_field" OR ls_name = "to_field" THEN
//	IF ls_name = "from_field"  THEN
//		ls_table_name = This.GetItemString( row, "link_from_table_nm" )
//		//ll_obj_id = This.GetItemNumber( row, "link_from_table" )
//	ELSE
//		ls_table_name = This.GetItemString( row, "link_to_table_nm" )		
//		//ll_obj_id = This.GetItemNumber( row, "link_to_table" )		
//	END IF
//	//<Modify> 12.14.2007 by: Andy
//	//OpenWithParm( w_conv_select_fields, ls_table_name )
//	//---------Begin Modified by (Appeon)Stephen 06.26.2014 for IntelliReport Modifications 14.2--------
//	//OpenWithParm( w_conv_select_fields, String(il_view_id) + "-" + String(il_data_view_id) + "@@" + ls_table_name )
//	OpenWithParm( w_conv_select_fields, String(il_view_id) + "-" + String(il_data_view_id)+"-"+ string(il_data_view_id_cont) + "@@" + ls_name )
//	//---------End Modfiied ------------------------------------------------------
//	
//	//end of modify
//	IF Message.StringParm = "Cancel" THEN
//		Return
//	END IF
//	ls_obj_nm = MidA( Message.StringParm, PosA( Message.StringParm, "-" ) +1, 1000 )
//	ll_obj_id = Long( MidA( Message.StringParm, 1, PosA( Message.StringParm, "-" ) -1 ) )
//	if isnull(ll_obj_id) or ll_obj_id = 0 then return //trap maha 061703
//	IF ls_name = "from_field"  THEN
//		dw_view_links.SetItem( row, "link_from_field_nm", ls_obj_nm )
//		dw_view_links.SetItem( row, "link_from_field", ll_obj_id )
//		//$<add> 02.22.2008 by Andy
//		dw_view_links.SetItem( row, "link_from_field_db", ls_table_name + '.' + ls_obj_nm )
//	ELSE
//		dw_view_links.SetItem( row, "link_to_field_nm", ls_obj_nm )
//		dw_view_links.SetItem( row, "link_to_field", ll_obj_id )
//		//$<add> 02.22.2008 by Andy
//		dw_view_links.SetItem( row, "link_to_field_db", ls_table_name + '.' + ls_obj_nm )
//	END IF	
//END IF
//End Code Change ----02.23.2016
end event

event constructor;This.SetTransObject( SQLCA )
end event

event getfocus;DatawindowChild dwchild

//IF This.GetColumnName() = "link_from_table" OR This.GetColumnName() = "link_to_table" THEN
	This.GetChild( "link_from_table", dwchild )
	dwchild.SetTransObject( SQLCA )
	dwchild.Retrieve( il_view_id )

	This.GetChild( "link_to_table", dwchild )
	dwchild.SetTransObject( SQLCA )
	dwchild.Retrieve( il_view_id )	
//END IF
end event

event itemfocuschanged;//DatawindowChild dwchild
//Long li_table_id
//
//debugbreak()
//
////IF This.GetColumnName() = "link_from_field" OR This.GetColumnName() = "link_to_field" THEN
////	li_table_id = This.GetItemNumber( row, "link_from_table" )
////	This.GetChild( "link_from_field", dwchild )
////	dwchild.SetTransObject( SQLCA )
////	//dwchild.Retrieve( li_table_id )
////	IF Not IsNull( li_table_id ) THEN	
//		dwchild.SetFilter( "id = " + String( li_table_id ) )
//		dwchild.Filter( )
//	END IF
//
//	li_table_id = This.GetItemNumber( row, "link_to_table" )
//	This.GetChild( "link_to_field", dwchild )
//	dwchild.SetTransObject( SQLCA )
//	//dwchild.Retrieve( li_table_id )
//	IF Not IsNull( li_table_id ) THEN
//		dwchild.SetFilter( "id = " + String( li_table_id ) )
//		dwchild.Filter( )
//	END IF
//END IF
end event

event clicked;integer i

i = this.getclickedrow()

if i > 0 then
	this.setrow(i)
end if
end event

event other;//$<add> 04.17.2008 by Andy
if Message.WordParm = 61458 then 
	Message.Processed = true
	Message.ReturnValue = 0 
end if
end event

type cb_view_add_link from commandbutton within tabpage_tables
integer x = 1248
integer y = 28
integer width = 384
integer height = 84
integer taborder = 70
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "&Add Link"
end type

event clicked;Integer li_nr

dw_view_tables.Update()
dw_view_tables.sort()  //Start Code Change ----06.06.2017 #V154 maha

li_nr = dw_view_links.InsertRow( 0 )
dw_view_links.SetRow( li_nr )
dw_view_links.ScrollToRow( li_nr )

//il_next_link_id++  --delete by stephen 03.07.2013 -IntelliReport primary key issues
il_next_link_id = gnv_app.of_get_irep_id("conv_view_links", 1)  //add by stephen 03.07.2013 -IntelliReport primary key issues

dw_view_links.SetItem( li_nr, "link_id", il_next_link_id )
dw_view_links.SetItem( li_nr, "view_id", il_view_id )
dw_view_links.SetItem( li_nr, "project_id", ii_project_id )

ii_nr = li_nr

of_audit_set("L")//Start Code Change ----06.15.2016 #V152 maha

//$<Modify> 03.27.2008 by Andy add:if statement
IF cbx_advanced.checked THEN st_auto_link.visible = true

dw_view_links.SetFocus( )


end event

type tv_tables from u_tvs_rpt within tabpage_tables
integer x = 5
integer y = 248
integer width = 1033
integer height = 1092
integer taborder = 100
boolean bringtotop = true
long backcolor = 16777215
borderstyle borderstyle = stylebox!
string picturename[] = {"Custom039!","EditDataGrid!","PlaceColumn5!","Custom050!","Custom038!","sectiongreen.png"}
end type

event constructor;call super::constructor;String ls_dataobject1, ls_dataobject2

//--------------------------- APPEON BEGIN ---------------------------
//$<add> 2007-12-10 By: Andy

//------------------- APPEON BEGIN -------------------
//<$>added:long.zhang 12.08.2016
//<$>reason:for Issue id 5351 - SQL Server 2014 and 2016 Partial Contained Databases and High Availability Groups
//this.of_register( 1, "module", "name", ":al_module", "d_view_module", SQLCA, "")
//this.of_register( 2, "v_name", "v_alias", ":al_module,:al_view_id", "d_view_names", SQLCA, "flag")
if gs_DbType = 'SQL' THEN
	ls_dataobject1 = 'd_view_module_sql'
	ls_dataobject2 = 'd_view_names_sql'
Else
	ls_dataobject1 = 'd_view_module_asa'
	ls_dataobject2 = 'd_view_names_asa'
End If
this.of_register( 1, "module", "name", ":al_module", ls_dataobject1, SQLCA, "")
this.of_register( 2, "v_name", "v_alias", ":al_module,:al_view_id", ls_dataobject2, SQLCA, "flag")
//------------------- APPEON END -------------------
ids_Screen = Create DataStore
//---------------------------- APPEON END ----------------------------
end event

event selectionchanged;call super::selectionchanged;//--------------------------- APPEON BEGIN ---------------------------
//$<Modify> 2007-12-18 By: Andy

String       ls_v_name,ls_p_name,ls_Modify
Integer      li_level
Long         ll_Cnt,ll_Find,ll_dataLength
TreeViewItem ltvi
String       ls_screen,ls_v_alias

if this.getItem(newhandle,ltvi) = 1 then
	li_level  = ltvi.level
	if li_level = 2 then
		ls_v_name = String(ltvi.data)
		ls_v_alias= ltvi.label
		
		ll_Cnt = UPPERBOUND(this.inv_attrib)
		if ll_Cnt >= li_level then
			ll_Find = ids_tables.Find("v_name='" + ls_v_name + "'",0,ids_tables.RowCount())
			if ll_Find > 0 then
				ll_dataLength = ids_tables.GetItemNumber( ll_Find, "datalength" )
				ls_p_name     = ids_tables.GetItemString( ll_Find, "p_name" )
				if Isnull(ls_p_name) then ls_p_name = ''
				ls_screen = ids_tables.GetItemString( ll_Find, "screen" )
				
				//Show picture name.
				if ll_dataLength > 0 then
					ls_Modify = "t_2.visible='1' t_3.visible='1' t_3.text='" + ls_v_alias + " Screen Shot' t_1.text='" + ls_p_name + "'"//p_1.visible='1' t_1.visible='1'
					dw_5.setItem(1,"v_name",ls_v_name)
					dw_5.setItem(1,"dataleng",ll_dataLength)
					//$<add> 01.22.2008 by Andy
					dw_5.setItem(1,"screen",ls_screen)
					dw_5.setItem(1,"v_alias",ls_v_alias)
				else
					ls_Modify = "t_2.visible='0' t_3.visible='0' t_3.text='' t_1.text=''"//p_1.visible='0' t_1.visible='0'
				end if
				dw_5.Modify(ls_Modify)
			end if
		end if
	else
		ls_Modify = "t_2.visible='0' t_3.visible='0' t_3.text='' t_1.text=''"//p_1.visible='0' t_1.visible='0'
		dw_5.Modify(ls_Modify)
	end if
end if
//---------------------------- APPEON END ----------------------------

end event

event getfocus;call super::getfocus;//--------------------------- APPEON BEGIN ---------------------------
//$<add> 02.14.2008 by Andy
Long ll_handle
ll_handle = this.FindItem ( CurrentTreeItem!, 0 )

if ll_handle > 0 then 
	this.event selectionchanged( ll_handle, ll_handle)
end if
//---------------------------- APPEON END ----------------------------
end event

event pfc_retrieve;call super::pfc_retrieve;//$<add>  02.27.2008 by Andy
//$Reason:Delete the view that it isn't exists in the selected data view.
//        fixed BugJ022601
TreeViewItem ltvi
Integer li_Level, li_NextLevel
datastore lds_screen
String ls_Filter,ls_Screen,ls_Find
Long   ll_module,ll_Cnt = 1,ll_SCnt,ll_i
Long   ll_Find

if this.GetItem( al_parent, ltvi ) = 1 then
	li_Level = ltvi.Level
	ll_module= Long(ltvi.data)
	li_NextLevel = this.of_getnextlevel( al_parent )
	ll_Cnt = this.inv_attrib[li_NextLevel].ids_obj.RowCount()
	
	if ll_module = 1 OR ll_module = 2 then
		lds_screen = create datastore
		lds_screen.dataobject = 'd_screen_all'
		lds_screen.settransobject(SQLCA)
		lds_screen.retrieve( )
		//---------Begin Modified by (Appeon)Stephen 06.26.2014 for Using image OCR to import data into IntelliCred 14.2--------
		//ls_Filter = "module=" + String(ll_module) + " And data_view_id=" + String(il_data_view_id)
		if il_module = 4 and ll_module = 1 then
			ls_Filter = "module=" + String(ll_module) + " And data_view_id=" + String(il_data_view_id_cont)
		else
			ls_Filter = "module=" + String(ll_module) + " And data_view_id=" + String(il_data_view_id)
		end if
		//---------End Modfiied ------------------------------------------------------
		
		lds_screen.setfilter( ls_Filter  )
		lds_screen.filter( )
		ll_SCnt = lds_screen.RowCount( )
		ids_Screen.DataObject  = lds_Screen.DataObject  //Added by (Appeon)Gavin 10.18.2017 for Question #5840 for IntelliReport
		lds_Screen.RowsCopy( 1, lds_Screen.RowCount( ), Primary!, ids_Screen, 1, Primary! )
		
		For ll_i = ll_Cnt to 1 step -1
			ls_Screen = this.inv_attrib[li_NextLevel].ids_obj.getitemString(ll_i,"screen")
			ls_Screen = ls_Screen + ','
			//Only need check one time,Not check all screen 
			ls_Screen = LeftA(ls_Screen,PosA(ls_Screen,',') - 1)
			if Not IsNumber(ls_Screen) then Continue
				
			ls_Find = "screen_id=" + ls_Screen
			ll_Find = lds_screen.Find( ls_Find, 0, ll_Scnt)
			if ll_Find < 1 then 
				this.inv_attrib[li_NextLevel].ids_obj.deleteRow(ll_i)
			end if			
		next
		
		ll_Cnt = this.inv_attrib[li_NextLevel].ids_obj.RowCount()
		destroy lds_screen
	end if
end if

return ll_Cnt	



end event

event doubleclicked;call super::doubleclicked;of_audit_set("T")//Start Code Change ----07.18.2016 #V152 maha
end event

type tabpage_columns from userobject within tab_1
event create ( )
event destroy ( )
integer x = 18
integer y = 100
integer width = 4398
integer height = 2004
boolean enabled = false
long backcolor = 33551856
string text = "Columns"
long tabtextcolor = 33554432
long tabbackcolor = 79741120
long picturemaskcolor = 12632256
cb_expand cb_expand
cb_selection cb_selection
cb_move_left cb_move_left
cb_move_right cb_move_right
cb_collapse cb_collapse
cb_next_3 cb_next_3
cb_move_up cb_move_up
cb_move_down cb_move_down
cb_add_comp cb_add_comp
cb_edit_comp cb_edit_comp
dw_all_fields dw_all_fields
dw_view_fields_edit dw_view_fields_edit
dw_view_fields dw_view_fields
dw_2 dw_2
tv_fields tv_fields
end type

on tabpage_columns.create
this.cb_expand=create cb_expand
this.cb_selection=create cb_selection
this.cb_move_left=create cb_move_left
this.cb_move_right=create cb_move_right
this.cb_collapse=create cb_collapse
this.cb_next_3=create cb_next_3
this.cb_move_up=create cb_move_up
this.cb_move_down=create cb_move_down
this.cb_add_comp=create cb_add_comp
this.cb_edit_comp=create cb_edit_comp
this.dw_all_fields=create dw_all_fields
this.dw_view_fields_edit=create dw_view_fields_edit
this.dw_view_fields=create dw_view_fields
this.dw_2=create dw_2
this.tv_fields=create tv_fields
this.Control[]={this.cb_expand,&
this.cb_selection,&
this.cb_move_left,&
this.cb_move_right,&
this.cb_collapse,&
this.cb_next_3,&
this.cb_move_up,&
this.cb_move_down,&
this.cb_add_comp,&
this.cb_edit_comp,&
this.dw_all_fields,&
this.dw_view_fields_edit,&
this.dw_view_fields,&
this.dw_2,&
this.tv_fields}
end on

on tabpage_columns.destroy
destroy(this.cb_expand)
destroy(this.cb_selection)
destroy(this.cb_move_left)
destroy(this.cb_move_right)
destroy(this.cb_collapse)
destroy(this.cb_next_3)
destroy(this.cb_move_up)
destroy(this.cb_move_down)
destroy(this.cb_add_comp)
destroy(this.cb_edit_comp)
destroy(this.dw_all_fields)
destroy(this.dw_view_fields_edit)
destroy(this.dw_view_fields)
destroy(this.dw_2)
destroy(this.tv_fields)
end on

type cb_expand from commandbutton within tabpage_columns
integer x = 1294
integer y = 28
integer width = 320
integer height = 84
integer taborder = 20
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "Expand"
end type

event clicked;//====================================================================
//$<Event>: clicked
//$<Arguments>:
// 	%ScriptArgs%
//$<Return>:  long
//$<Description>: 
//$<Author>: (Appeon) Stephen 05.14.2014 (IntelliReport Modifications 14.2)
//--------------------------------------------------------------------
//$<Modify History>:
//====================================================================

if this.text = "Expand" then
	dw_view_fields_edit.visible = false
	dw_view_fields.height = dw_2.height
	this.text = "Collapse"
else
	dw_view_fields_edit.visible = true
	//dw_view_fields.height = tv_fields.height - dw_7.height - dw_view_fields_edit.height - 10
	dw_view_fields.height = dw_2.height - dw_view_fields_edit.height - 10
	this.text = "Expand"
end if
end event

type cb_selection from commandbutton within tabpage_columns
boolean visible = false
integer x = 416
integer y = 28
integer width = 375
integer height = 84
integer taborder = 60
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "Quick Select"
end type

event clicked;//V10.5 SK IntelliReport
of_show_selection()
end event

type cb_move_left from commandbutton within tabpage_columns
integer x = 1093
integer y = 260
integer width = 146
integer height = 92
integer taborder = 50
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "<<"
end type

event clicked;//--------------------------- APPEON BEGIN ---------------------------
//$<add> 02.14.2008 by Andy
Long ll_Row 

ll_Row = dw_view_fields.GetRow()
if ll_Row > 0 then 
	dw_view_fields.event DoubleClicked(0,0,ll_Row,dw_view_fields.object.field_visible)
end if
//---------------------------- APPEON END ----------------------------

end event

type cb_move_right from commandbutton within tabpage_columns
integer x = 1093
integer y = 164
integer width = 146
integer height = 92
integer taborder = 50
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = ">>"
end type

event clicked;//--------------------------- APPEON BEGIN ---------------------------
//$<add> 02.14.2008 by Andy
Long ll_Handle
ll_Handle = tv_fields.FindItem(CurrentTreeItem!, 0)
if ll_Handle > 0 then 
	tv_fields.event DoubleClicked(ll_Handle)	
end if
//---------------------------- APPEON END ----------------------------

end event

type cb_collapse from commandbutton within tabpage_columns
integer x = 27
integer y = 28
integer width = 375
integer height = 84
integer taborder = 50
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "&Collapse All"
end type

event clicked;//--------------------------- APPEON BEGIN ---------------------------
//$<add> 2007-12-12 By: Andy
of_expandcollapseall(this,tv_fields)
//---------------------------- APPEON END ----------------------------
end event

type cb_next_3 from commandbutton within tabpage_columns
integer x = 4041
integer y = 28
integer width = 338
integer height = 84
integer taborder = 50
boolean bringtotop = true
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "Ne&xt ->"
end type

event clicked;//$<comment> 03.04.2008 by Andy
//Reason: Move to of_check_fields()
//Integer li_rc
//Integer i
//integer c
//Integer li_total_agg
//string ls_alias
//
//IF dw_view_fields.RowCount() = 0 THEN
//	MessageBox( "Fields", "You must select at least one field to report on." )
//	Return 
//END IF
//
//li_rc = dw_view_fields.RowCount()
//
//dw_view_fields.AcceptText()
//
//FOR i = 1 TO li_rc
//	IF Not IsNull( dw_view_fields.GetItemString( i, "field_wizard_name" ) ) THEN
//		IF IsNull( dw_view_fields.GetItemString( i, "field_options" ) ) OR Trim(dw_view_fields.GetItemString( i, "field_options" ))  = '' THEN
//			MessageBox("", "You need to fill in the Compare To column." )
//			dw_view_fields.SetRow( i )
//			dw_view_fields.ScrollToRow( i )
//			dw_view_fields.SetColumn( "field_options" )
//			Return
//		END IF
//		
//		IF IsNull( dw_view_fields.GetItemString( i, "field_alias" ) ) OR dw_view_fields.GetItemString( i, "field_alias" )  = '' THEN
//			MessageBox("", "You need to fill in the Field Alias column." )
//			dw_view_fields.SetRow( i )
//			dw_view_fields.ScrollToRow( i )
//			dw_view_fields.SetColumn( "field_alias" )
//			Return
//		END IF		
//	END IF
//	
//	//MESSAGEBOX("", "I" + dw_view_fields.GetItemString( i, "aggregate_type" ) +"I" )
//	
//	IF IsNull(dw_view_fields.GetItemString( i, "aggregate_type" ) ) OR +&
//				 dw_view_fields.GetItemString( i, "aggregate_type" ) = "" OR +&
//				 dw_view_fields.GetItemString( i, "aggregate_type" ) = " " THEN
//		li_total_agg = dw_view_fields.GetItemNumber( i, "count_fld" ) + dw_view_fields.GetItemNumber( i, "sum_fld" ) + dw_view_fields.GetItemNumber( i, "avg_fld" ) 
//		IF li_total_agg > 0 THEN
//			//MessageBox( "Aggregate Field Setup Error", "You have selected an aggregate calculation but not an aggregate type.  Please correct." )
// 			MessageBox( "Aggregate Field Setup Error", "You have selected an aggregate calculation but no aggregate type.  Please correct." )
//			dw_view_fields.SetRow( i )
//			dw_view_fields.ScrollToRow( i )
//			dw_view_fields.SetColumn( "aggregate_type" )
//			Return			
//		END IF
//	END IF
//	
//	IF Len( dw_view_fields.GetItemString( i, "aggregate_type" ) ) > 1 THEN
//		li_total_agg = dw_view_fields.GetItemNumber( i, "count_fld" ) + dw_view_fields.GetItemNumber( i, "sum_fld" ) + dw_view_fields.GetItemNumber( i, "avg_fld" ) 
//		IF li_total_agg = 0 THEN
//			MessageBox( "Aggregate Field Setup Error", "You have selected an aggregate type but no aggregate function ( ex. Sum, Count, Average).  Please correct." )
//			dw_view_fields.SetRow( i )
//			dw_view_fields.ScrollToRow( i )
//			dw_view_fields.SetColumn( "aggregate_type" )
//			Return			
//		END IF
//	END IF
//END FOR
//
//FOR i = 1 TO li_rc - 1 //duplicate alias check maha 020304
//	ls_alias = dw_view_fields.GetItemString( i, "field_alias" )
//	for c = i + 1 TO li_rc 
//		if ls_alias = dw_view_fields.GetItemString( c, "field_alias" )then 
//			//messagebox("Duplicate Fields", ls_alias + " on row " + string(c) + " has a duplicate field alias ( to row " + string(i) + ").  Modify one to continue.")
// 			messagebox("Duplicate Fields", ls_alias + " on row " + string(c) + " has a duplicate field alias ( with row " + string(i) + ").  Modify one to continue.")
//			return
//		end if
//	next
//next

//of_save( )

tab_1.tabpage_filter.Enabled = True

//$<modify> 07.08.2008 by Andy
//tab_1.SelectTab( 4 )
of_selecttab(4)

end event

type cb_move_up from commandbutton within tabpage_columns
integer x = 1093
integer y = 396
integer width = 146
integer height = 92
integer taborder = 40
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "&Up"
end type

event clicked;Integer li_order
Integer i
Integer li_cr
Integer li_rc

li_cr = dw_view_fields.GetRow( )

IF li_cr = 1 THEN
	Return
END IF


//
//li_order = dw_view_fields.GetItemNumber( dw_view_fields.GetRow(), "field_order" )
//
//dw_view_fields.SetItem( dw_view_fields.GetRow(), "field_order", li_order -11 )
//
//dw_view_fields.SetSort( "field_order a" )
//dw_view_fields.Sort()
dw_view_fields.RowsMove(li_cr, li_cr, primary!, dw_view_fields, li_cr - 1, Primary!)

li_cr --

li_rc = dw_view_fields.RowCount()

FOR i = 1 TO li_rc
	dw_view_fields.SetItem( i, "field_order", i * 10 )
END FOR

dw_view_fields.SetSort( "field_order a" )
dw_view_fields.Sort()

//$<add> 04.15.2008 by Andy
dw_view_fields.Update()
//end 04.15.2008

dw_view_fields.SetFocus()

dw_view_fields.SelectRow( 0, False )
dw_view_fields.SelectRow( li_cr, True )
//$<add> 04.17.2008 by Andy
dw_view_fields.scrolltorow( li_cr )
//end add 04.17.2008
dw_view_fields.SetRow( li_cr )
//$<add> 04.03.2008 by Andy
//$Reason:fixed BugG040301
if li_cr = 1 then dw_view_fields.event rowfocuschanged(1)

end event

type cb_move_down from commandbutton within tabpage_columns
integer x = 1093
integer y = 488
integer width = 146
integer height = 92
integer taborder = 50
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "&Dn"
end type

event clicked;Integer li_order
Integer i
Integer li_rc
Integer li_cr

li_cr = dw_view_fields.GetRow( )

IF li_cr = dw_view_fields.RowCount( ) THEN
	Return
END IF

li_cr ++

li_order = dw_view_fields.GetItemNumber( dw_view_fields.GetRow(), "field_order" )

dw_view_fields.SetItem( dw_view_fields.GetRow(), "field_order", li_order +11 )

dw_view_fields.SetSort( "field_order a" )
dw_view_fields.Sort()

li_rc = dw_view_fields.RowCount()

FOR i = 1 TO li_rc
	dw_view_fields.SetItem( i, "field_order", i * 10 )
END FOR

dw_view_fields.SetSort( "field_order a" )
dw_view_fields.Sort()

//$<add> 04.15.2008 by Andy
dw_view_fields.Update()
//end 04.15.2008

dw_view_fields.SetFocus()

dw_view_fields.SelectRow( 0, False )
dw_view_fields.SelectRow( li_cr, True )
//$<add> 04.17.2008 by Andy
dw_view_fields.scrolltorow( li_cr )
//end add 04.17.2008
dw_view_fields.SetRow( li_cr )
end event

type cb_add_comp from commandbutton within tabpage_columns
integer x = 1627
integer y = 28
integer width = 393
integer height = 84
integer taborder = 60
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "&Add Computed"
end type

event clicked;Integer li_nr
String ls_formula
String ls_field

OpenWithParm( w_calc_field_report, "New" )

IF Message.StringParm = "Cancel" THEN
	Return
END IF

of_audit_set("C")//Start Code Change ----06.15.2016 #V152 maha

ls_field = MidA( Message.StringParm, 1, PosA( Message.StringParm, "-" )-1 )
ls_formula = MidA( Message.StringParm, PosA( Message.StringParm, "-" )+1, 1000 )

li_nr = dw_view_fields.InsertRow( 0 )

//il_next_field_id++  --delete by stephen 03.07.2013 -IntelliReport primary key issues
il_next_field_id = gnv_app.of_get_irep_id("conv_view_fields", 1)  //add by stephen 03.07.2013 -IntelliReport primary key issues
			
dw_view_fields.SetItem( li_nr, "field_id", il_next_field_id )
dw_view_fields.SetItem( li_nr, "project_id", ii_project_id )
dw_view_fields.SetItem( li_nr, "view_id", il_view_id )
dw_view_fields.SetItem( li_nr, "field_alias", ls_field )

dw_view_fields.SetItem( li_nr, "sel_field_id", 0 )
dw_view_fields.SetItem( li_nr, "sel_table_id", 0 )

dw_view_fields.SetItem( li_nr, "field_name", ls_formula )
dw_view_fields.SetItem( li_nr, "table_name", ls_field )

dw_view_fields.SetItem( li_nr, "field_order",li_nr * 10 )

dw_view_fields.SetItem( li_nr, "label_text", MidA(ls_field,1, 38) )

//This.DeleteRow( row )

dw_view_fields.Update( )

//$<add> 05.27.2008 by Andy
dw_view_fields.scrolltorow(li_nr)
dw_view_fields.setrow(li_nr)
dw_view_fields.selectrow(0,false)
dw_view_fields.selectrow(li_nr,true)

end event

type cb_edit_comp from commandbutton within tabpage_columns
integer x = 2039
integer y = 28
integer width = 411
integer height = 84
integer taborder = 70
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "Edit Co&mputed"
end type

event clicked;Integer li_nr
String ls_formula
String ls_field

li_nr = dw_view_fields.GetRow()
//$<add> 01.07.2008 By: Andy
if li_nr < 1 then return
//end of add
ls_formula = dw_view_fields.GetItemString( li_nr , "field_name" )
ls_field = dw_view_fields.GetItemString( li_nr, "table_name" )
//$<add> 01.07.2008 By: Andy
//if isn't a compute field,then ignore.
Long ll_sel_table_id
ll_sel_table_id = dw_view_fields.GetItemNumber( li_nr, "sel_table_id" )
if ll_sel_table_id > 0 then return
//end of add
OpenWithParm( w_calc_field_report, ls_field + "-" + ls_formula )

IF Message.StringParm = "Cancel" THEN
	Return
END IF

of_audit_set("C")//Start Code Change ----06.15.2016 #V152 maha

ls_field = MidA( Message.StringParm, 1, PosA( Message.StringParm, "-" )-1 )
ls_formula = MidA( Message.StringParm, PosA( Message.StringParm, "-" )+1, 1000 )

//li_nr = dw_view_fields.InsertRow( 0 )

//il_next_field_id++
//dw_view_fields.SetItem( li_nr, "field_id", il_next_field_id )
dw_view_fields.SetItem( li_nr, "project_id", ii_project_id )
dw_view_fields.SetItem( li_nr, "view_id", il_view_id )

dw_view_fields.SetItem( li_nr, "sel_field_id", 0 )
dw_view_fields.SetItem( li_nr, "sel_table_id", 0 )

dw_view_fields.SetItem( li_nr, "field_name", ls_formula )
dw_view_fields.SetItem( li_nr, "table_name", ls_field )

dw_view_fields.SetItem( li_nr, "field_order",li_nr * 10 )
//--------------------------- APPEON BEGIN ---------------------------
//$<add> 2007.08.13 By: Frank.Gui
//$<reason> 
dw_view_fields.SetItem( li_nr, "field_alias", ls_field )
//---------------------------- APPEON END ----------------------------

//This.DeleteRow( row )

dw_view_fields.Update( )

end event

type dw_all_fields from datawindow within tabpage_columns
boolean visible = false
integer x = 379
integer y = 1216
integer width = 603
integer height = 352
integer taborder = 110
boolean titlebar = true
string title = "4. Select Fields To Use In View"
string dataobject = "d_conv_view_fields2"
boolean vscrollbar = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event constructor;This.SetTransObject( sqlca )
//--------------------------- APPEON BEGIN ---------------------------
//$<modify> 2005-11-11 By: owen chen
//$<reason> add database option for sql excution

string ls_sqlsyntax
//$<modify> 05.15.2008 by Andy
//$<reason> add column: dbname
choose case gs_dbtype
	case 'ASA'
		ls_sqlsyntax =   "  SELECT distinct systable.table_name, "+&  
									"systable.table_id, "+&
									"sys.syscolumns.cname, "+&  
									"sys.syscolumns.colno, "+&  
									"sys.syscolumns.coltype, "+&  
									"sys.syscolumns.length, "+& 
									"systable.table_name + '.' + sys.syscolumns.cname dbname "+& 
								 "FROM sys.syscolumns, "+&  
										"systable "+& 
									"WHERE ( sys.syscolumns.tname = systable.table_name ) and "+&  
										  " ( ( sys.syscolumns.tname in ( :table_name ) ) ) "  
	case 'SQL'
		ls_sqlsyntax =  "  SELECT distinct v_systable.table_name, "+&  
										"v_systable.table_id, "+&
										"v_syscolumns.cname, "+&  
										"v_syscolumns.colno, "+&  
										"v_syscolumns.coltype, "+&  
										"v_syscolumns.length, "+&
										"v_systable.table_name + '.' + v_syscolumns.cname dbname "+&
								 "FROM v_syscolumns, "+&  
										"v_systable "+& 
								"WHERE ( v_syscolumns.tname = v_systable.table_name ) and "+&  
									  " ( ( v_syscolumns.tname in ( :table_name ) ) ) " 
end choose
//this.modify("DataWindow.Table.Select='"+ls_sqlsyntax+"'")
this.modify("DataWindow.Table.Select=~""+ls_sqlsyntax+"~"")
//end 05.15.2008
//---------------------------- APPEON END ----------------------------

end event

type dw_view_fields_edit from u_dw within tabpage_columns
integer x = 1275
integer y = 1144
integer width = 3118
integer height = 860
integer taborder = 50
boolean bringtotop = true
boolean titlebar = true
string title = "Selected Columns Edit"
string dataobject = "d_view_selected_fields_edit"
boolean vscrollbar = false
boolean livescroll = false
end type

event itemchanged;//$<modify> 03.28.2008 by Andy
//---------Begin Modified by (Appeon)Toney 06.13.2013 for V141 ISG-CLX--------
  /*
   dw_view_fields.event itemchanged(row,dwo,data)   
  */
 return dw_view_fields.event itemchanged(row,dwo,data)
 of_audit_set("C")//Start Code Change ----06.15.2016 #V152 maha
//---------End Modfiied ------------------------------------------------------------------


end event

event constructor;//--------------------------- APPEON BEGIN ---------------------------
//$<add> 02.22.2008 by Andy
this.of_setupdateable( false )
this.of_setbase( true )
this.of_setresize( true )
this.inv_resize.of_setorigsize( this.width,this.height)
this.inv_resize.of_setminsize( this.width,this.height)
this.inv_resize.of_register(this.inv_resize.scale)
this.inv_resize.of_SetDetailHeight(true)
//end of add

//$<add> 2007-12-19 By: Andy
//Copy from dw_view_fields::retrieveend()
DataWindowChild dwchild
Integer i

if This.GetChild( "field_wizard_name", dwchild ) = 1 then 
	dwchild.settransobject( SQLCA )
	dwchild.retrieve( )
	
	dwchild.InsertRow( 1 )
	dwchild.SetItem( 1, "lookup_name", "Single Date Comparison" )
	dwchild.SetItem( 1, "type", "D" )
	
	dwchild.InsertRow( 1 )
	dwchild.SetItem( 1, "lookup_name", "Date Range Comparison" )
	dwchild.SetItem( 1, "type", "R" )
	
	
	dwchild.InsertRow( 1 )
	dwchild.SetItem( 1, "lookup_name", "Facility" )
	dwchild.SetItem( 1, "type", "F" )
	
	//i = dwchild.find("lookup_name")
	dwchild.InsertRow( 1 )
	dwchild.SetItem( 1, "lookup_name", "Address Type" )
	dwchild.SetItem( 1, "type", "L" )
	
	dwchild.InsertRow( 1 ) //maha 071404
	dwchild.SetItem( 1, "lookup_name", "Action/Status" )
	dwchild.SetItem( 1, "type", "N" )
	
	dwchild.InsertRow( 1 ) //maha 071404
	dwchild.SetItem( 1, "lookup_name", "Application / Payor" )
	dwchild.SetItem( 1, "type", "P" )
	//--------Begin Added by Nova 08.19.2010------------------------
	//V10.5 SK IntelliReport	
	dwchild.InsertRow( 1 ) //08.19
	dwchild.SetItem( 1, "lookup_name", "Practitioner" )
	dwchild.SetItem( 1, "type", "X" )
	
	dwchild.InsertRow( 1 ) //08.19
	dwchild.SetItem( 1, "lookup_name", "Practice Locations" )
	dwchild.SetItem( 1, "type", "Y" )
	//--------End Added --------------------------------------------
	
	dwchild.InsertRow( 1 ) //Start Code Change ----11.03.2014 #V14.2 maha
	dwchild.SetItem( 1, "lookup_name", "Active Status (Appt)" )
	dwchild.SetItem( 1, "type", "S" )
	
	dwchild.InsertRow( 1 ) //Start Code Change ----11.03.2014 #V14.2 maha
	dwchild.SetItem( 1, "lookup_name", "Active Status (Data)" )
	dwchild.SetItem( 1, "type", "T" )	
	
	dwchild.InsertRow( 1 ) //blankrow to clear wizard
end if
//---------------------------- APPEON END ----------------------------

end event

event resize;call super::resize;//$<add> 04.02.2008 by Andy
//$Reason:fixed BugN030604
//        When the window is resized,it will trigger RowFocusChanged event and the row will move to 1.
Long ll_Row

ll_Row = dw_view_fields.GetSelectedRow(0)
if ll_Row > 0 then 
	this.scrolltorow( ll_Row )
	this.setrow( ll_Row )
end if

end event

event buttonclicked;call super::buttonclicked;//Start Code Change ----08.10.2012 #V12 maha
this.setitem(row, "field_display_width", "25")

messagebox("Reset field width","To make the the field reappear, go to the Design tab and clear the Advaced design.  You will have to rebuild the design of ther report.")
end event

type dw_view_fields from u_dw within tabpage_columns
integer x = 1275
integer y = 128
integer width = 3118
integer height = 1008
integer taborder = 11
boolean bringtotop = true
boolean titlebar = true
string title = "Selected Columns"
string dataobject = "d_view_selected_fields"
end type

event clicked;call super::clicked;IF row > 0 THEN
	This.SelectRow( 0, False )
	This.SelectRow( row, True )
	This.SetRow( row )
	//---------Begin Modified by (Appeon)Stephen 05.14.2014 for IntelliReport Modifications 14.2--------
    /*
	 IF This.GetClickedColumn() = 0 THEN //Commented by (Appeon)Stephen 05.14.2014 - IntelliReport Modifications 14.2
		is_drag_object = "deselect field"	
		This.Drag(Begin! )	
		
	END IF
	 */
	is_drag_object = "deselect field"	
	This.Drag(Begin! )	
	ib_leave = false
	ii_drag_start = row
	//---------End Modfiied ------------------------------------------------------		
END IF
end event

event constructor;call super::constructor;This.SetTransObject( SQLCA )
This.Modify("DataWindow.HorizontalScrollSplit=930")
This.Modify("DataWindow.HorizontalScrollPosition2=933")

//$<add> 04.17.2008 by Andy 
//Copy from retrieveend event.
DataWindowChild dwchild

This.GetChild( "field_wizard_name", dwchild )
dwchild.settransobject( SQLCA )
dwchild.retrieve( )

dwchild.InsertRow( 1 )
dwchild.SetItem( 1, "lookup_name", "Single Date Comparison" )
dwchild.SetItem( 1, "type", "D" )

dwchild.InsertRow( 1 )
dwchild.SetItem( 1, "lookup_name", "Date Range Comparison" )
dwchild.SetItem( 1, "type", "R" )


dwchild.InsertRow( 1 )
dwchild.SetItem( 1, "lookup_name", "Facility" )
dwchild.SetItem( 1, "type", "F" )

//i = dwchild.find("lookup_name")
dwchild.InsertRow( 1 )
dwchild.SetItem( 1, "lookup_name", "Address Type" )
dwchild.SetItem( 1, "type", "L" )

dwchild.InsertRow( 1 ) //maha 071404
dwchild.SetItem( 1, "lookup_name", "Action/Status" )
dwchild.SetItem( 1, "type", "N" )

dwchild.InsertRow( 1 ) //maha 071404
dwchild.SetItem( 1, "lookup_name", "Application / Payor" )
dwchild.SetItem( 1, "type", "P" )
//--------Begin Added by Nova 08.19.2010------------------------
//V10.5 SK IntelliReport	
dwchild.InsertRow( 1 ) //08.19
dwchild.SetItem( 1, "lookup_name", "Practitioner" )
dwchild.SetItem( 1, "type", "X" )

dwchild.InsertRow( 1 ) //08.19
dwchild.SetItem( 1, "lookup_name", "Practice Locations" )
dwchild.SetItem( 1, "type", "Y" )
//--------End Added --------------------------------------------

dwchild.InsertRow( 1 ) //Start Code Change ----11.03.2014 #V14.2 maha
dwchild.SetItem( 1, "lookup_name", "Active Status (Appt)" )
dwchild.SetItem( 1, "type", "S" )

dwchild.InsertRow( 1 ) //Start Code Change ----11.03.2014 #V14.2 maha
dwchild.SetItem( 1, "lookup_name", "Active Status (Data)" )
dwchild.SetItem( 1, "type", "T" )	

dwchild.InsertRow( 1 ) //blankrow to clear wizard

//$<add> 2007-12-19 By: Andy
this.Sharedata( dw_view_fields_edit )




end event

event doubleclicked;call super::doubleclicked;//$<add> 02.20.2008 by Andy
//---------Begin Modified by (Appeon)Toney 06.13.2013 for V141 ISG-CLX--------
  /*
    of_delete_row()  
  */
//Add by Jervis 02.02.2010
//If a user double clicks in the selected Selected columns area(area on right),  
//before the system removes the field from the report prompt the user
string ls_name
if row > 0 then
	ls_name = this.GetItemString(row,'label_text')
	if MessageBox("Remove","Are you sure you want to remove the " + ls_name + " from the report?",Question!,YesNo!) = 1  then
		//$<add> 02.20.2008 by Andy
		of_delete_row()
		of_audit_set("C")//Start Code Change ----06.15.2016 #V152 maha
	end if
end if  
//---------End Modfiied ------------------------------------------------------------------

end event

event dragdrop;call super::dragdrop;//$<add> 02.20.2008 by Andy
//---------Begin Modified by (Appeon)Stephen 05.14.2014 for IntelliReport Modifications 14.2--------
//of_tv_doubleclicked(tv_fields.il_DragSource)
if ib_leave=true then
	of_tv_doubleclicked(tv_fields.il_DragSource)
else
	if row > 0 and ii_drag_start > 0 and row <> ii_drag_start  then
		of_drag_order(row)
	end if
	ii_drag_start = 0
end if
//---------End Modfiied ------------------------------------------------------



end event

event dragleave;call super::dragleave;ib_leave = true
end event

event itemchanged;call super::itemchanged;//$<modify> 03.28.2008 by Andy

DataWindowChild dwchild
Integer li_found
String  ls_null
String ls_v_name,ls_c_name,ls_Display 
String ls_lookup_type,ls_lookup_name
Long   ll_Find
String ls_ColType, ls_alias
string ls_field_type
integer li_page_break,i,li_cnt

CHOOSE CASE String(dwo.name)
	CASE "field_wizard_name"
		This.GetChild( "field_wizard_name", dwchild )
		li_found = dwchild.Find( "lookup_name = '" + data + "'", 1, dwchild.RowCount() )//GetRow()
		IF li_found > 0 THEN
			//sss = dwchild.GetItemString( li_found, "type" )
			This.SetItem( row, "field_wizard_type", dwchild.GetItemString( li_found, "type" ) )
		END IF
		//messagebox("data",data)
		if data = "" or isnull(data) then 
			this.setitem(this.getrow(),"field_options"," ") //maha 012704  clear this field
			This.SetItem( row, "field_wizard_type", "")
		end if
		//--------Begin Modified by  Nova 08.19.2010-----------------------
		//V10.5 SK IntelliReport
		//if data = "Facility" or data = "Application / Payor" or data = "Action Status" or data = "Address Type" then
		if data = "Facility" or data = "Application / Payor" or data = "Action Status" or data = "Address Type" or data = "Practitioner" or data = "Practice Locations" then
		//--------End Modified --------------------------------------------
			this.setitem(this.getrow(),"field_options","D") //maha 071604  set this field
		elseif data = "Active Status (Appt)" or data = "Active Status (Data)" then  //Start Code Change ----11.03.2014 #V14.2 maha
			this.setitem(this.getrow(),"field_options","D") 
		end if		
	CASE "field_visible"
		IF data = "0" THEN
			//---------Begin Added by (Appeon)Toney 12.04.2013 for V141 ISG-CLX--------
			//$Reason:Fix history BugT111202,sort field(s) string can't contain invisible field
			//hiding field will delete it from sort fields list automatically
			string ls_tablename,ls_fieldname
			IF Not ib_show_all_fields_in_select THEN
				ls_tablename = THIS.GetItemString(row,"table_name")
				ls_fieldname = THIS.GetItemString(row,"field_name")
				ll_find = tab_1.tabpage_sort.dw_view_sort.find("table_name='"+ls_tablename+"' AND field_name='"+ls_fieldname+"'",1,tab_1.tabpage_sort.dw_view_sort.rowcount())
				IF ll_find > 0 THEN
					IF MessageBox("Hide the field","The field will be auto deleted from the sorted list if hidden.~r~nContinue or not?",Question!,YesNo!,2) = 2 THEN Return 2
					tab_1.tabpage_sort.dw_view_sort.DeleteRow(ll_find)
					tab_1.tabpage_sort.dw_view_sort.Update( )
				END IF
			END IF
			//---------End Added ------------------------------------------------------------------
			This.SetItem( row, "field_x", -1 )
		ELSE
			This.SetItem( row, "field_x", 0 )		
		END IF
	//$<add> 03.04.2008 by Andy
	CASE "aggregate_type"
		IF TRIM(data) = "" then 
			This.SetItem( row, "count_fld", 0)
			This.SetItem( row, "sum_fld"  , 0)
			This.SetItem( row, "avg_fld"  , 0)
		end if
//$<comment> 05.09.2008 by Andy
//	CASE "group_by_field"
//		IF data = "0" THEN
//			This.SetItem( row, "aggregate_type", " ")
//			This.SetItem( row, "count_fld", 0)
//			This.SetItem( row, "sum_fld"  , 0)
//			This.SetItem( row, "avg_fld"  , 0)
//		END IF
	//$<ADD> 03.28.2008 by Andy
	CASE "filter_by_field"
		IF data = "0" THEN
			Setnull(ls_null)
			This.SetItem( row, "field_wizard_name", ls_null)
			This.SetItem( row, "field_options", '')
		ELSE
			//Automatic set Code Lookup Display Field		
			ls_v_name = GetItemString(row,"table_name")
			ls_c_name = GetItemString(row,"field_name")
			IF of_get_lookup_data(ls_v_name,ls_c_name,ls_Display,ls_lookup_type,ls_lookup_name) = 1 THEN
				tab_1.tabpage_columns.dw_view_fields.SetItem( row, "field_wizard_name", ls_lookup_name )
				//Only support display description or code field
				IF lower(ls_Display) = 'code' then ls_Display = 'C' else ls_Display = 'D'
				tab_1.tabpage_columns.dw_view_fields.SetItem( row, "field_options", ls_Display )
				tab_1.tabpage_columns.dw_view_fields.SetItem( row, "field_wizard_type", ls_lookup_type )			
			END IF
			//---------Begin Added by (Appeon)Stephen 05.07.2014 for IntelliReport Modifications 14.2--------
			ls_field_type = of_get_field_type(ls_v_name,ls_c_name)
			if len(ls_field_type) > 0 then
				tab_1.tabpage_columns.dw_view_fields.SetItem( row, "field_type", ls_field_type )
			end if
			//---------End Added ------------------------------------------------------
			//$<add> 04.24.2008 by Andy
			//$<Reason> fixed a issue from John.			
			ll_Find = ids_fields.Find("c_name='" + ls_c_name + "' and table_name='" + ls_v_name + "'",0,ids_fields.RowCount())
			if ll_Find > 0 then
				ls_ColType = ids_fields.GetItemString(ll_Find,"coltype")
				//61:datetime for MSSQL
				if ls_ColType = '61' or ls_ColType = 'timestamp' then
					tab_1.tabpage_columns.dw_view_fields.SetItem( row, "field_wizard_name", "Date Range Comparison" )
					tab_1.tabpage_columns.dw_view_fields.SetItem( row, "field_wizard_type", "R" )
				end if
			end if			
			of_set_wizardtype(ls_c_name,row) //add Michael 28.11.2011 V12.1 IntelliReport filtering modification
		END IF
	CASE "label_text"
		//$<add> 03.31.2008 by Andy
		//dw_7.Title = data + " Column Properties"
		dw_view_fields_edit.Title = data + " Column Properties"  //Start Code Change ----09.26.2017 #V154 maha
		
	//$<add> 05.16.2008 by Andy
	CASE "lu_field_name"
		if isNull(data) or trim(data) = "" then return
		ls_v_name = GetItemString(row,"table_name")
		ls_c_name = GetItemString(row,"field_name")
		ll_Find   = tab_1.tabpage_filter.dw_view_where.Find( "table_field_name='" + ls_v_name + "." + ls_c_name + "'", 1, tab_1.tabpage_filter.dw_view_where.RowCount())
		if ll_Find > 0 then 
			tab_1.tabpage_filter.dw_view_where.setitem(ll_Find,"lu_field_name",data)
		end if
	//--------Begin Added by Nova 08.19.2010------------------------
	//V10.5 SK IntelliReport
	CASE "group_by_field"
		IF data = "0" THEN
			This.SetItem( row, "page_breaker"  , 0)
		END IF
	CASE "page_breaker"
		li_cnt=tab_1.tabpage_columns.dw_view_fields.rowcount( )
		IF data = "0" THEN
			li_page_break=0
			ib_group_break=False
		ELSE
			li_page_break=1
			ib_group_break=TRUE
		END IF
		FOR i=1 to li_cnt
			IF GetItemNumber(i,"group_by_field")=1 then
				This.SetItem( i, "page_breaker"  ,li_page_break)
			END IF
		NEXT
//--------End Added --------------------------------------------
     CASE "field_alias" //(Appeon)Stephen 05.06.2014 - IntelliReport Modifications 14.2
		if of_strip_char ("",data,"@DBFIELD@") = "FAILS" or pos(data, ' ') > 0 then  //(Appeon)Stephen 08.06.2014 - add 'pos(data, ' ') > 0'  --BugH071801
			inv_message.of_messagebox("Prompt", "Field ( " + data + " )  is an invalid field Alias.  It must contain only letters, numbers or underscores, and cannot start with a number.", true)
			return 2
		end if		
		ll_find = tab_1.tabpage_columns.dw_view_fields.find(" lower(field_alias)='"+lower(data)+"'",1,tab_1.tabpage_columns.dw_view_fields.rowcount())
		IF ll_find > 0 THEN
			inv_message.of_messagebox( "Duplicate Fields", data + " on row " + string(row) + " has a duplicate field alias ( with row " + string(ll_find) + ").  Modify one to continue.", true)
			return 2
		end if
     CASE ELSE
		RETURN
		
END CHOOSE

end event

event retrieveend;call super::retrieveend;//$<comment> 04.17.2008 by Andy
//Reason:Have moved it to constructor event.

//DataWindowChild dwchild
Integer i

//This.GetChild( "field_wizard_name", dwchild )
//dwchild.InsertRow( 1 )
//dwchild.SetItem( 1, "lookup_name", "Single Date Comparison" )
//dwchild.SetItem( 1, "type", "D" )
//
//dwchild.InsertRow( 1 )
//dwchild.SetItem( 1, "lookup_name", "Date Range Comparison" )
//dwchild.SetItem( 1, "type", "R" )
//
//
//dwchild.InsertRow( 1 )
//dwchild.SetItem( 1, "lookup_name", "Facility" )
//dwchild.SetItem( 1, "type", "F" )
//
////i = dwchild.find("lookup_name")
//dwchild.InsertRow( 1 )
//dwchild.SetItem( 1, "lookup_name", "Address Type" )
//dwchild.SetItem( 1, "type", "L" )
//
//dwchild.InsertRow( 1 ) //maha 071404
//dwchild.SetItem( 1, "lookup_name", "Action/Status" )
//dwchild.SetItem( 1, "type", "N" )
//
//dwchild.InsertRow( 1 ) //maha 071404
//dwchild.SetItem( 1, "lookup_name", "Application / Payor" )
//dwchild.SetItem( 1, "type", "P" )
//
//
//dwchild.InsertRow( 1 ) //blankrow to clear wizard
//end comment 04.17.2008

FOR i = 1 TO rowcount
	IF Long( This.GetItemNumber( i, "field_x" ) ) > 0 THEN
		This.SetItem( i, "field_visible", 1 )
	ELSE
		This.SetItem( i, "field_visible", 0 )
	END IF
END FOR

//--------------------------- APPEON BEGIN ---------------------------
//$<Modify> 2007-12-19 By: Andy
if RowCount > 0 then
	this.setrow(1)
	dw_view_fields.selectrow(1,true)
end if
//---------------------------- APPEON END ----------------------------

//Integer i
//Integer li_found
//String ls_tbl_nm
//String ls_fld_nm
//
//FOR i = 1 TO rowcount
//	ls_tbl_nm = This.GetItemString( i, "table_name" )
//	ls_fld_nm = This.GetItemString( i, "field_name" )
//	li_found = dw_fields_list.Find( "table_name = '" + ls_tbl_nm + "' AND field_name ='" + ls_fld_nm + "'" , 1, 1000 )
//	IF li_found > 0 THEN
//		dw_fields_list.DeleteRow( li_found )
//	END IF
//END FOR
end event

event rowfocuschanged;call super::rowfocuschanged;//$<add> 03.04.2008 by Andy
if CurrentRow < 1 then return

String ls_label_text

This.SelectRow( 0, False )
This.SelectRow( CurrentRow, True )

//$<add> 2007-12-19 By: Andy
dw_view_fields_edit.scrolltoRow(CurrentRow)

//$<add> 03.31.2008 by Andy
ls_label_text = GetItemString(CurrentRow,"label_text")
if isNull(ls_label_text) then ls_label_text = ''
dw_view_fields_edit.Title = ls_label_text + " Column Properties"
//---------Begin Added by (Appeon)Toney 06.13.2013 for V141 ISG-CLX--------
long ll_TableID
ll_TableID = dw_view_fields.GetItemNumber(CurrentRow,"sel_table_id")
if IsNull(ll_TableID) or ll_TableID <= 0 then
	cb_edit_comp.Enabled = true
else
	cb_edit_comp.Enabled = false
end if
//---------End Added ------------------------------------------------------------------

end event

type dw_2 from datawindow within tabpage_columns
integer y = 128
integer width = 1033
integer height = 1876
integer taborder = 30
boolean enabled = false
boolean titlebar = true
string title = "Select Columns To Use In Report"
string dataobject = "d_conv_view_tables_report_sql"
boolean border = false
boolean livescroll = true
end type

type tv_fields from u_tvs_rpt within tabpage_columns
integer y = 224
integer width = 1033
integer height = 1780
integer taborder = 30
boolean bringtotop = true
long backcolor = 16777215
borderstyle borderstyle = stylebox!
string picturename[] = {"Custom039!","EditDataGrid!","PlaceColumn5!","Custom050!","Custom038!","sectiongreen.png"}
end type

event constructor;call super::constructor;//--------------------------- APPEON BEGIN ---------------------------
//$<add> 2007-12-10 By: Andy
this.of_register( 1, "module", "name", ":al_view_id", "d_view_module_fields", SQLCA, "")
this.of_register( 2, "v_name", "v_alias", ":al_view_id,:al_module", "d_view_names_fields", SQLCA, "")
if gs_DbType = 'SQL' THEN
	this.of_register( 3, "c_name", "c_alias", ":as_table,:al_data_view_id,:al_view_id,:al_onlyvisible, :al_data_view_id_cont", "d_view_fields_alias_sql", SQLCA, "flag")
ELSE
	this.of_register( 3, "c_name", "c_alias", ":as_table,:al_data_view_id,:al_view_id,:al_onlyvisible, :al_data_view_id_cont", "d_view_fields_alias_asa", SQLCA, "flag")
END IF
//---------------------------- APPEON END ----------------------------
end event

event dragleave;call super::dragleave;ib_leave = true //(Appeon)Stephen 08.05.2014 - BugH071604
end event

event doubleclicked;call super::doubleclicked;of_audit_set("C")//Start Code Change ----06.15.2016 #V152 maha
end event

type tabpage_filter from userobject within tab_1
integer x = 18
integer y = 100
integer width = 4398
integer height = 2004
boolean enabled = false
long backcolor = 33551856
string text = "Filter"
long tabtextcolor = 33554432
long tabbackcolor = 79741120
long picturemaskcolor = 12632256
dw_view_where dw_view_where
cb_24 cb_24
sle_2 sle_2
sle_1 sle_1
cb_3 cb_3
cb_16 cb_16
cb_12 cb_12
cb_next_4 cb_next_4
end type

on tabpage_filter.create
this.dw_view_where=create dw_view_where
this.cb_24=create cb_24
this.sle_2=create sle_2
this.sle_1=create sle_1
this.cb_3=create cb_3
this.cb_16=create cb_16
this.cb_12=create cb_12
this.cb_next_4=create cb_next_4
this.Control[]={this.dw_view_where,&
this.cb_24,&
this.sle_2,&
this.sle_1,&
this.cb_3,&
this.cb_16,&
this.cb_12,&
this.cb_next_4}
end on

on tabpage_filter.destroy
destroy(this.dw_view_where)
destroy(this.cb_24)
destroy(this.sle_2)
destroy(this.sle_1)
destroy(this.cb_3)
destroy(this.cb_16)
destroy(this.cb_12)
destroy(this.cb_next_4)
end on

type dw_view_where from u_dw within tabpage_filter
integer y = 128
integer width = 4411
integer height = 1876
integer taborder = 11
boolean titlebar = true
string title = "Filters"
string dataobject = "d_view_where"
end type

event buttonclicked;call super::buttonclicked;//$<add> 05.16.208 by Andy
Long   ll_Pos
String ls_lookup_name,ls_desc,ls_lookup_type
String ls_field_type,ls_table_field
String ls_v_name,ls_c_name,ls_Display
String ls_Null,ls_Val,ls_lu_field_name
//---------Begin Added by (Appeon)Toney 06.13.2013 for V141 ISG-CLX--------
String ls_facilityname,ls_return,ls_temp,ls_value,ls_operator,ls_rqmnt
string ls_type
long   ll_return

str_pass	lstr_Param

if dwo.Name = "b_getcontract" then
	ib_Select = false
	ib_AutoRetrieve = false
	Open(w_rpt_contract_search)
	ib_AutoRetrieve = true
	
	if Not ib_Select then Return
	
	ls_Return = Message.StringParm
	
	Do
		ls_Temp = f_get_token(ls_Return,"|")
		ll_Pos = Pos(ls_Temp, "~t")
		ls_Value += Left(ls_Temp,ll_Pos - 1) + ","
	Loop While ls_Return <> ''
	
	ls_operator = this.GetItemString(row, "operator")
	
	ll_Return = of_checkselectcontent( ls_Value, 'code', lower( ls_operator) ) //add by gavins 20120209
	If ll_Return = 1 Then
		//
	ElseIf ll_Return = 2 Then
		this.SetItem( Row, 'operator', 'In' )
		ls_operator = 'in'
	ElseIf ll_Return = 0 Then
		Return
	End If	
	
	if Lower(ls_operator) <> "in" then
		ls_Value = Left(ls_Value,Pos(ls_Value,",") - 1)
	else
		ls_Value = Left(ls_Value,Len(ls_Value) - 1)
	end if
	
	This.SetItem(row,"value", ls_value)
	This.SetItem(row,"value_display",ls_value)
elseif dwo.Name = "b_getcontact" then
	lstr_Param.s_string = 'Select_Contact'
	OpenWithParm(w_contract_contact,lstr_Param)
	
	ls_Value = Message.StringParm
	if IsNull(ls_Value) or Trim(ls_Value) = "" then Return
	
	ls_operator = this.GetItemString(row, "operator")
	
	ll_Return = of_checkselectcontent( ls_Value, 'code', lower( ls_operator) ) //add by gavins 20120209
	If ll_Return = 1 Then
		//
	ElseIf ll_Return = 2 Then
		this.SetItem( Row, 'operator', 'In' )
		ls_operator = 'in'
	ElseIf ll_Return = 0 Then
		Return
	End If	
	
	
	if Lower(ls_operator) <> "in" then
		ls_Value = Left(ls_Value,Pos(ls_Value,",") - 1)
	else
		ls_Value = Left(ls_Value,Len(ls_Value) - 1)
	end if
	
	This.SetItem(row,"value", ls_value)
	This.SetItem(row,"value_display",ls_value)
elseif dwo.Name = "cb_getrqmnt" then
	ls_rqmnt = This.GetItemString(row,"value")
	OpenWithParm(w_req_profile_select,ls_rqmnt)
	
	ls_Value = Message.StringParm
	if IsNull(ls_Value) or Trim(ls_Value) = "" then Return
	
	ls_operator = this.GetItemString(row, "operator")
	
	ll_Return = of_checkselectcontent( ls_Value, 'name', lower( ls_operator) ) //add by gavins 20120209
	If ll_Return = 1 Then
		//
	ElseIf ll_Return = 2 Then
		this.SetItem( Row, 'operator', 'In' )
		ls_operator = 'in'
	ElseIf ll_Return = 0 Then
		Return
	End If	
	
//	if Lower(ls_operator) <> "in" then
//		ls_Value = Left(ls_Value,Pos(ls_Value,",") - 1)
//	else
		ls_Value = Left(ls_Value,Len(ls_Value) - 1)
//	end if
	
	This.SetItem(row,"value", ls_value)
	This.SetItem(row,"value_display",ls_value)
elseif dwo.Name = "cb_getfacilityname" then
	ls_facilityname = This.GetItemString(row,"value")
	if isnull(ls_facilityname) then ls_facilityname = ''  //APB NULL Value Bug - jerivs 11.01.2010
	OpenWithParm(w_facility_name_select,"name&"+ls_facilityname)
	
	ls_Value = Message.StringParm
	if IsNull(ls_Value) or Trim(ls_Value) = "" then Return
	
	ls_operator = this.GetItemString(row, "operator")
	
	ll_Return = of_checkselectcontent( ls_Value, 'name', lower( ls_operator) ) //add by gavins 20120209
	If ll_Return = 1 Then
		//
	ElseIf ll_Return = 2 Then
		this.SetItem( Row, 'operator', 'In' )
		ls_operator = 'in'
	ElseIf ll_Return = 0 Then
		Return
	End If	
	
//	if Lower(ls_operator) <> "in" then
//		ls_Value = Left(ls_Value,Pos(ls_Value,",") - 1)
//	else
		ls_Value = Left(ls_Value,Len(ls_Value) - 1)
//	end if
	
	This.SetItem(row,"value", ls_value)
	This.SetItem(row,"value_display",ls_value)


//---------End Added ------------------------------------------------------------------

ELSEIF dwo.Name = "b_dropdown" THEN
	ls_lookup_name   = This.GetItemString(row,"lookup_name")
	ls_lookup_type   = This.GetItemString(row,"lookup_type")
	ls_lu_field_name = This.GetItemString(row,"lu_field_name")
	ls_field_type    = This.GetItemString(row,"field_type")
	//---------Begin Added by (Appeon)Toney 06.13.2013 for V141 ISG-CLX--------
	n_cst_string  ln_string//(Appeon)Toney 12.05.2013 - V141 ISG-CLX,Fix history BugT072302
	IF ls_lookup_type = "C"/*il_module = 1 */THEN//(Appeon)Toney 12.05.2013 - V141 ISG-CLX,Fix history BugT072302,change the condition
		//BEGIN---Modify by Scofield on 2009-05-19
		ls_operator = this.GetItemString(row, "operator")
		IF Lower(ls_operator) = "in" THEN
			ls_value = this.GetItemString(row, "value")
			if IsNull(ls_value) then ls_value = ""
			//(Appeon)Toney 12.05.2013 - V141 ISG-CLX,Fix history BugT072302,Replace the single quotes with empty string 
			IF Upper(ls_field_type) = 'C' Or Upper(ls_field_type) = 'D' THEN ls_value = ln_string.of_globalreplace(ls_value,"'","")
			
			OpenWithParm( w_lookup_search_dddw,'M' + "@" + ls_lookup_name + "@@" + ls_value)
		
			if Message.StringParm <> "Cancel" then
				ls_value = Message.StringParm
				ls_desc = of_get_lookupdesc_multi(ls_value)
				//---------Begin Added by (Appeon)Toney 12.05.2013 for V141 ISG-CLX--------
				//$Reason:Fix history BugT072302,append single quotes into  char type field
				IF Upper(ls_field_type) = 'C' Or Upper(ls_field_type) = 'D' THEN	
					
					//------------------- APPEON BEGIN -------------------
					//<$>added:long.zhang 04.02.2015
					//<$>reason:IntelliReport in v14.2 build 03/23/2015 in list filter bug
					//ls_value = ln_string.of_globalreplace(ls_value,",","','")
					ls_value = ln_string.of_globalreplace(ls_value,", ","', '") 
					//------------------- APPEON END -------------------
					
					ls_value = "'"+ls_value+"'"
				END IF				
				//---------End Added ------------------------------------------------------------------				
				this.SetItem(row,"value", ls_value)					
				this.SetItem(row,"value_display",ls_desc)
			end if				
			RETURN
		END IF
		//END---Modify by Scofield on 2009-05-19
	END IF	
	//---------End Added ------------------------------------------------------------------

	
	w_custom_report.tab_1.tabpage_filter.sle_1.Text = ls_lu_field_name//Added by Nova on 08.12.2008
	
	IF IsNull(ls_lookup_name) THEN ls_lookup_name = ""
	IF IsNull(ls_lookup_type) THEN ls_lookup_type = ""
	IF IsNull(ls_field_type) THEN ls_field_type = ""
	
	IF Upper(ls_lookup_type) = 'C' Or Upper(ls_lookup_type) = 'A' THEN
		//get lookup name if lookup name is null
		IF ls_lookup_name = "" THEN
			ls_table_field = This.GetItemString(row,"table_field_name")
			ll_Pos = PosA(ls_table_field,'.')
			ls_v_name = LeftA(ls_table_field,ll_Pos - 1)
			ls_c_name = MidA(ls_table_field ,ll_Pos + 1)
			IF of_get_lookup_data(ls_v_name,ls_c_name,ls_Display,ls_lookup_type,ls_lookup_name) = 1 THEN
				IF IsNull(ls_lu_field_name) Or ls_lu_field_name = "" THEN
					IF Lower(ls_Display) = 'code' THEN ls_Display = 'Code' ELSE ls_Display = 'Description'
						This.SetItem( row, "lu_field_name", ls_Display )
						ls_lu_field_name = ls_Display
					END IF
					This.SetItem( row, "lookup_type"  , ls_lookup_type )
					This.SetItem( row, "lookup_name"  , ls_lookup_name )
				ELSE
					SetNull(ls_Null)
					This.SetItem( row, "lu_field_name", ls_Null )
					This.SetItem( row, "lookup_type"  , ls_Null )
					This.SetItem( row, "lookup_name"  , ls_Null )
					RETURN
				END IF
			END IF
			
			//Open a window
			OpenWithParm( w_lookup_search_dddw,ls_lookup_type + "@" + ls_lookup_name)
			IF Message.StringParm <> "Cancel" THEN
				ls_Val = String(Message.DoubleParm)
				IF Upper(ls_field_type) = 'C' Or Upper(ls_field_type) = 'D' THEN
					ls_Val = "'" + ls_Val + "'"
				END IF
				This.SetItem(row,"value",ls_Val)
				//$<modify> 05.19.2008 by Andy
				IF Upper(ls_lookup_type) = 'C' THEN
					//--------Begin Modified by Nova 08.12.2008-----------
					//ls_desc = gnv_data.of_GetItem("code_lookup",ls_lu_field_name,"lookup_code = " + string(message.DoubleParm))
					IF  w_custom_report.tab_1.tabpage_filter.sle_2.Text = 'Description' THEN
						SELECT Description Into :ls_desc From code_lookup Where lookup_code = :Message.DoubleParm;
					ELSE
						SELECT code Into :ls_desc From code_lookup Where lookup_code = :Message.DoubleParm;
					END IF
				ELSE
					IF Lower(ls_lu_field_name) = 'description' THEN
						SELECT entity_name Into :ls_desc From address_lookup Where lookup_code = :Message.DoubleParm;
					ELSE
						SELECT code Into :ls_desc From address_lookup Where lookup_code = :Message.DoubleParm;
					END IF
				END IF
				ls_desc = "'" + ls_desc + "'"
				//--------End Modified -------------------------------
				This.SetItem(row,"value_display",ls_desc)
			END IF
		END IF
	END IF
	

end event

event itemchanged;call super::itemchanged;//$<add> 05.16.2008 by Andy
Long   ll_Pos,ll_Find
String ls_v_name,ls_c_name
String ls_Display,ls_lookup_type,ls_lookup_name
datawindowchild ldwc
String ls_lu_field_name,ls_field_type
string  ls_type

CHOOSE CASE lower(dwo.name)
	CASE 'table_field_name'
		if isnull(data) or data = "" then return
		//---------Begin Added by (Appeon)Toney 06.13.2013 for V141 ISG-CLX--------
		this.SetItem( row, "value"  , '' )	
		this.SetItem( row, "value_display"  , '' )				
		//---------End Added ------------------------------------------------------------------
		//Get display name
		if this.getchild('table_field_name',ldwc) = 1 then
			ll_Find = ldwc.find( "dbname='" + data + "'", 1, ldwc.rowcount())
			if ll_Find > 0 then
				ls_lu_field_name = ldwc.getitemstring(ll_Find,"lu_field_name")
				//ls_lookup_type   = ldwc.getitemstring(ll_Find,"lookup_type")
				this.SetItem( row, "lu_field_name", ls_lu_field_name )
				//---------Begin Added by (Appeon)Toney 06.13.2013 for V141 ISG-CLX--------
				//Added By Alan on 2009-1-5 BugA063001
				this.SetItem( row, "lookup_type"  , '' )				
				//---------End Added ------------------------------------------------------------------
			end if
		end if
		
		//Get lookup type and name
		ll_Pos = PosA(data,'.')		
		ls_v_name = LeftA(data,ll_Pos - 1)
		ls_c_name = MidA(data ,ll_Pos + 1)
		IF of_get_lookup_data(ls_v_name,ls_c_name,ls_Display,ls_lookup_type,ls_lookup_name) = 1 THEN
			if isNull(ls_lu_field_name) or ls_lu_field_name = "" then
				IF lower(ls_Display) = 'code' then ls_Display = 'Code' else ls_Display = 'Description'
				this.SetItem( row, "lu_field_name", ls_Display )
			end if
//--------Begin Modified by  Nova 08.12.2010------------------------
//fixed bug.
//			this.SetItem( row, "lookup_type"  , ls_lookup_type )
//			this.SetItem( row, "lookup_name"  , ls_lookup_name )
		end if
		this.SetItem( row, "lookup_type"  , ls_lookup_type )
	   this.SetItem( row, "lookup_name"  , ls_lookup_name )
//--------End Modified --------------------------------------------		
		//Get field data type
		IF gs_DBType = 'SQL' THEN
			SELECT CASE c.name
						WHEN 'int'      THEN 'N'
						WHEN 'float'    THEN 'N'
						WHEN 'smallint' THEN 'N'
						WHEN 'money'    THEN 'N'
						WHEN 'real'     THEN 'N'
						WHEN 'decimal'  THEN 'N'
						WHEN 'tinyint'  THEN 'N'
						WHEN 'numeric'  THEN 'N'
						WHEN 'bit'      THEN 'N'
						WHEN 'char'     THEN 'C'
						WHEN 'nvarchar' THEN 'C'
						WHEN 'varchar'  THEN 'C'
						WHEN 'text'     THEN 'C'
						WHEN 'datetime' THEN 'D'
					 END INTO :ls_field_type
			FROM sysobjects a 
			INNER JOIN syscolumns b ON (a.id = b.id) 
			INNER JOIN systypes c ON (b.xtype = c.xtype) 
			WHERE a.name = :ls_v_name and b.name = :ls_c_name;
		ELSE
			SELECT CASE b.coltype
						WHEN 'integer'   THEN 'N'
						WHEN 'float'     THEN 'N'
						WHEN 'smallint'  THEN 'N'
						WHEN 'money'     THEN 'N'
						WHEN 'real'      THEN 'N'
						WHEN 'decimal'   THEN 'N'
						WHEN 'tinyint'   THEN 'N'
						WHEN 'numeric'   THEN 'N'
						WHEN 'bit'       THEN 'N'
						WHEN 'char'      THEN 'C'
						WHEN 'nvarchar'  THEN 'C'
						WHEN 'varchar'   THEN 'C'
						WHEN 'long varchar' THEN 'C'
						WHEN 'timestamp' THEN 'D'
						WHEN 'date'      THEN 'D'
						WHEN 'time'      THEN 'D'
					END INTO :ls_field_type 
			FROM sys.syscolumns b
			WHERE b.tname = :ls_v_name and b.cname = :ls_c_name;	
		END IF
		this.SetItem( row, "field_type", ls_field_type)
		
	CASE 'value_display'	
		this.SetItem(row,"value",data)
	//--------Begin Added by Nova 08.12.2010------------------------
	//V10.5 SK IntelliReport
	CASE 'operator' 
		ll_Pos = PosA(this.object.table_field_name[row],'.')		
		ls_v_name = LeftA(this.object.table_field_name[row],ll_Pos - 1)
		ls_c_name = MidA(this.object.table_field_name[row] ,ll_Pos + 1)
		IF of_get_lookup_data(ls_v_name,ls_c_name,ls_Display,ls_lookup_type,ls_lookup_name) = 1 THEN
			if isNull(ls_lu_field_name) or ls_lu_field_name = "" then
				IF lower(ls_Display) = 'code' then ls_Display = 'Code' else ls_Display = 'Description'
				this.SetItem( row, "lu_field_name", ls_Display )
			end if
		end if
		this.SetItem( row, "lookup_type"  , ls_lookup_type )
	   this.SetItem( row, "lookup_name"  , ls_lookup_name )
		if data='Is Not' or data='Is' then
			this.SetItem(row,"value",'Null')
			this.SetItem(row,"value_display",'Null')
		else
			this.SetItem(row,"value",'')
			this.SetItem(row,"value_display",'')
		end if
//--------End Added --------------------------------------------		
	CASE ELSE
		//DO NOTHING
			
END CHOOSE
	
end event

event constructor;call super::constructor;this.settransobject(sqlca)
end event

type cb_24 from commandbutton within tabpage_filter
integer x = 1248
integer y = 24
integer width = 384
integer height = 84
integer taborder = 20
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "Filter Help"
end type

event clicked;open(w_filter_hints_ir)
end event

type sle_2 from singlelineedit within tabpage_filter
boolean visible = false
integer x = 3589
integer y = 1800
integer width = 343
integer height = 92
integer taborder = 50
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long textcolor = 33554432
borderstyle borderstyle = stylelowered!
end type

type sle_1 from singlelineedit within tabpage_filter
boolean visible = false
integer x = 3968
integer y = 1796
integer width = 343
integer height = 92
integer taborder = 40
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long textcolor = 33554432
borderstyle borderstyle = stylelowered!
end type

type cb_3 from commandbutton within tabpage_filter
integer x = 832
integer y = 24
integer width = 384
integer height = 84
integer taborder = 70
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "&Preview SQL"
end type

event clicked;//--------Begin Modified by  Nova 08.18.2010------------------------
//V10.5 SK IntelliReport
//openwithparm(w_sql_msg,of_build_view_sql() )
openwithparm(w_sql_msg,of_build_view_sql(1) )
//--------End Modified --------------------------------------------


end event

type cb_16 from commandbutton within tabpage_filter
integer x = 434
integer y = 24
integer width = 384
integer height = 84
integer taborder = 60
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "&Delete Filter"
end type

event clicked;Long ll_table_id

if dw_view_where.getrow() = 0 then return //Start Code Change ----07.18.2016 #V152 maha

dw_view_where.DeleteRow( 0 )
of_audit_set("F")//Start Code Change ----06.15.2016 #V152 maha

//$<Modify> 04.15.2008 by Andy Reason: Optimize speed.
//of_save()
dw_view_where.update()
dw_audit.update()  //Start Code Change ----06.15.2016 #V152 maha





end event

type cb_12 from commandbutton within tabpage_filter
integer x = 27
integer y = 24
integer width = 384
integer height = 84
integer taborder = 50
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "&Add Filter"
end type

event clicked;Integer li_nr
//$<comment> 04.24.2008 by Andy
//$<Reason> Move to tab_1.selectchanging event
//DataWindowChild dwchild
//
//dw_view_where.GetChild( "table_field_name", dwchild )
//dwchild.SetTransObject( SQLCA )
//dwchild.Retrieve( il_view_id )

li_nr = dw_view_where.InsertRow( 0 )
dw_view_where.SetRow( li_nr )
dw_view_where.ScrollToRow( li_nr )

//il_next_where_id++  --delete by stephen 03.07.2013 -IntelliReport primary key issues
il_next_where_id = gnv_app.of_get_irep_id("conv_view_where", 1)  //add by stephen 03.07.2013 -IntelliReport primary key issues

dw_view_where.SetItem( li_nr, "where_id", il_next_where_id )
dw_view_where.SetItem( li_nr, "view_id", il_view_id )
dw_view_where.SetItem( li_nr, "project_id", ii_project_id )
dw_view_where.SetItem( li_nr, "operator", "=" )//Added by  Nova 08.12.2010---V10.5 SK IntelliReport
dw_view_where.SetItem( li_nr, "oj_method", 1 )  //Start Code Change ----06.07.2017 #V154 maha

dw_view_where.SetFocus( )

of_audit_set("F")//Start Code Change ----06.15.2016 #V152 maha - corrected 07.18.2016


end event

type cb_next_4 from commandbutton within tabpage_filter
integer x = 4041
integer y = 28
integer width = 334
integer height = 84
integer taborder = 50
boolean bringtotop = true
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "Ne&xt ->"
end type

event clicked;IF dw_view_where.AcceptText() = -1 THEN
	Return -1
END IF

//$<Comment> 04.15.2008 by Andy
//IF of_save( ) = -1 THEN
//	Return
//END IF
//end Comment 04.15.2008

//of_preview( tab_1.tabpage_preview.dw_preview )

tab_1.tabpage_sort.Enabled = True

tab_1.SelectTab( 5 )

end event

type tabpage_sort from userobject within tab_1
integer x = 18
integer y = 100
integer width = 4398
integer height = 2004
boolean enabled = false
long backcolor = 33551856
string text = "Sort"
long tabtextcolor = 33554432
long tabbackcolor = 79741120
long picturemaskcolor = 12632256
cb_22 cb_22
cb_21 cb_21
cb_20 cb_20
cb_19 cb_19
dw_4 dw_4
dw_view_sort dw_view_sort
cb_next_5 cb_next_5
cb_col_all cb_col_all
tv_sort tv_sort
end type

on tabpage_sort.create
this.cb_22=create cb_22
this.cb_21=create cb_21
this.cb_20=create cb_20
this.cb_19=create cb_19
this.dw_4=create dw_4
this.dw_view_sort=create dw_view_sort
this.cb_next_5=create cb_next_5
this.cb_col_all=create cb_col_all
this.tv_sort=create tv_sort
this.Control[]={this.cb_22,&
this.cb_21,&
this.cb_20,&
this.cb_19,&
this.dw_4,&
this.dw_view_sort,&
this.cb_next_5,&
this.cb_col_all,&
this.tv_sort}
end on

on tabpage_sort.destroy
destroy(this.cb_22)
destroy(this.cb_21)
destroy(this.cb_20)
destroy(this.cb_19)
destroy(this.dw_4)
destroy(this.dw_view_sort)
destroy(this.cb_next_5)
destroy(this.cb_col_all)
destroy(this.tv_sort)
end on

type cb_22 from commandbutton within tabpage_sort
integer x = 1225
integer y = 576
integer width = 146
integer height = 84
integer taborder = 70
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "&Dn"
end type

event clicked;//$<add> 04.01.2008 by Andy
long ll_row,ll_Cnt
string ls_v_name,ls_c_name,ls_dbname,ls_sort_dir

ll_row = dw_view_sort.getrow()
ll_Cnt = dw_view_sort.RowCount()

if ll_row < ll_Cnt then
	ls_v_name  = dw_view_sort.GetItemString( ll_row, "table_name" )
	ls_c_name  = dw_view_sort.GetItemString( ll_row, "field_name" )
	ls_dbname  = dw_view_sort.GetItemString( ll_row, "dbname" )
	ls_sort_dir= dw_view_sort.GetItemString( ll_row, "sort_dir" )
	
	dw_view_sort.SetItem(ll_row, "table_name",dw_view_sort.GetItemString( ll_row + 1, "table_name" ))
	dw_view_sort.SetItem(ll_row, "field_name",dw_view_sort.GetItemString( ll_row + 1, "field_name" ))
	dw_view_sort.SetItem(ll_row, "dbname"    ,dw_view_sort.GetItemString( ll_row + 1, "dbname" ))
	dw_view_sort.SetItem(ll_row, "sort_dir"  ,dw_view_sort.GetItemString( ll_row + 1, "sort_dir" ))
	
	dw_view_sort.SetItem(ll_row + 1, "table_name",ls_v_name)
	dw_view_sort.SetItem(ll_row + 1, "field_name",ls_c_name)
	dw_view_sort.SetItem(ll_row + 1, "dbname"    ,ls_dbname)
	dw_view_sort.SetItem(ll_row + 1, "sort_dir"  ,ls_sort_dir)

	dw_view_sort.setrow(ll_row + 1)
	dw_view_sort.scrolltorow(ll_row + 1)
	
	//$<add> 04.15.2008 by Andy
	dw_view_sort.Update()
	//end 04.15.2008
end if

end event

type cb_21 from commandbutton within tabpage_sort
integer x = 1225
integer y = 480
integer width = 146
integer height = 84
integer taborder = 60
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "&Up"
end type

event clicked;//$<add> 04.01.2008 by Andy
long ll_row
string ls_v_name,ls_c_name,ls_dbname,ls_sort_dir

ll_row = dw_view_sort.getrow()

if ll_row > 1 then
	ls_v_name  = dw_view_sort.GetItemString( ll_row, "table_name" )
	ls_c_name  = dw_view_sort.GetItemString( ll_row, "field_name" )
	ls_dbname  = dw_view_sort.GetItemString( ll_row, "dbname" )
	ls_sort_dir= dw_view_sort.GetItemString( ll_row, "sort_dir" )
	
	dw_view_sort.SetItem(ll_row, "table_name",dw_view_sort.GetItemString( ll_row - 1, "table_name" ))
	dw_view_sort.SetItem(ll_row, "field_name",dw_view_sort.GetItemString( ll_row - 1, "field_name" ))
	dw_view_sort.SetItem(ll_row, "dbname"    ,dw_view_sort.GetItemString( ll_row - 1, "dbname" ))
	dw_view_sort.SetItem(ll_row, "sort_dir"  ,dw_view_sort.GetItemString( ll_row - 1, "sort_dir" ))
	
	dw_view_sort.SetItem(ll_row - 1, "table_name",ls_v_name)
	dw_view_sort.SetItem(ll_row - 1, "field_name",ls_c_name)
	dw_view_sort.SetItem(ll_row - 1, "dbname"    ,ls_dbname)
	dw_view_sort.SetItem(ll_row - 1, "sort_dir"  ,ls_sort_dir)
 
	dw_view_sort.setrow(ll_row - 1)
	dw_view_sort.scrolltorow(ll_row - 1)
	
	//$<add> 04.15.2008 by Andy
	dw_view_sort.Update()
	//end 04.15.2008
end if

end event

type cb_20 from commandbutton within tabpage_sort
integer x = 1225
integer y = 360
integer width = 146
integer height = 84
integer taborder = 70
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "<<"
end type

event clicked;//--------------------------- APPEON BEGIN ---------------------------
//$<add> 04.01.2008 by Andy
Long ll_Row 

ll_Row = dw_view_sort.GetRow()
if ll_Row > 0 then 
	dw_view_sort.event DoubleClicked(0,0,ll_Row,dw_view_sort.object.sort_dir)
end if
//---------------------------- APPEON END ----------------------------

end event

type cb_19 from commandbutton within tabpage_sort
integer x = 1225
integer y = 276
integer width = 146
integer height = 84
integer taborder = 21
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = ">>"
end type

event clicked;//--------------------------- APPEON BEGIN ---------------------------
//$<add> 04.01.2008 by Andy
Long ll_Handle
ll_Handle = tv_sort.FindItem(CurrentTreeItem!, 0)
if ll_Handle > 0 then 
	tv_sort.event DoubleClicked(ll_Handle)	
end if
//---------------------------- APPEON END ----------------------------

end event

type dw_4 from datawindow within tabpage_sort
integer y = 156
integer width = 1143
integer height = 120
integer taborder = 30
boolean enabled = false
boolean titlebar = true
string title = "Select Columns To Sort By"
string dataobject = "d_conv_view_tables_report_sql"
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

type dw_view_sort from u_dw within tabpage_sort
integer x = 1435
integer y = 156
integer width = 2194
integer height = 1848
integer taborder = 11
string dragicon = "droparrow.ico"
boolean bringtotop = true
boolean titlebar = true
string title = "Selected Sort Columns"
string dataobject = "d_cust_report_sort"
end type

event constructor;call super::constructor;This.SetTransObject( SQLCA )
//$<add> 04.01.2008 by Andy
this.setrowfocusindicator( p_1)  //Start Code Change ----12.04.2009 #V92 maha - changed indicator
end event

event doubleclicked;call super::doubleclicked;//$<add> 02.20.2008 by Andy
of_delete_row()
of_audit_set("S")//Start Code Change ----06.15.2016 #V152 maha

//if row > 0 then
//
//	This.DeleteRow( row )
//
//	of_save()
//
//end if
end event

event clicked;call super::clicked;IF row > 0 THEN
	/*
	This.SelectRow( 0, False )
	This.SelectRow( row, True )
	*/
	This.SetRow( row )
	IF This.GetClickedColumn() = 0 THEN
		is_drag_object = "deselect sort"	
		This.Drag(Begin! )			
	END IF
END IF
end event

event dragdrop;call super::dragdrop;//$<add> 02.20.2008 by Andy
of_tv_doubleclicked(tv_sort.il_DragSource)

end event

event other;call super::other;//$<add> 04.17.2008 by Andy
if Message.WordParm = 61458 then 
	Message.Processed = true
	Message.ReturnValue = 0 
end if
end event

type cb_next_5 from commandbutton within tabpage_sort
integer x = 4037
integer y = 28
integer width = 343
integer height = 84
integer taborder = 50
boolean bringtotop = true
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "Ne&xt ->"
end type

event clicked;//--------------------------- APPEON BEGIN ---------------------------
//$<ID> PT-20
//$<comment> 02.10.2006 By: Rodger Wu
//$<reason> Performance tuning
//$<reason> Function of_save() will be called in subsequent function within tab_1.selectionchanging and 
//$<reason> it is unnecessary to call it before running tab_1.SelectTab( 6 ).

/*of_save( )*/
//---------------------------- APPEON END ----------------------------

//of_preview( tab_1.tabpage_preview.dw_preview )
//ib_new = False

tab_1.tabpage_preview.Enabled = True
tab_1.tabpage_run.Enabled = True

//$<modify> 07.08.2008 by Andy
//tab_1.SelectTab( 6 )
of_selecttab(6)

end event

type cb_col_all from commandbutton within tabpage_sort
integer x = 41
integer y = 28
integer width = 334
integer height = 84
integer taborder = 60
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "&Collapse All"
end type

event clicked;//--------------------------- APPEON BEGIN ---------------------------
//$<add> 2007-12-12 By: Andy
of_expandcollapseall(this,tv_sort)
//---------------------------- APPEON END ----------------------------
end event

type tv_sort from u_tvs_rpt within tabpage_sort
integer y = 256
integer width = 1143
integer height = 1748
integer taborder = 110
boolean bringtotop = true
long backcolor = 16777215
borderstyle borderstyle = stylebox!
string picturename[] = {"Custom039!","EditDataGrid!","PlaceColumn5!","Custom050!","Custom038!","sectiongreen.png"}
end type

event constructor;call super::constructor;//--------------------------- APPEON BEGIN ---------------------------
//$<add> 2007-12-17 By: Andy
this.of_register( 1, "module", "name", ":al_view_id", "d_view_module_fields", SQLCA, "")
this.of_register( 2, "v_name", "v_alias", ":al_view_id,:al_module", "d_view_names_fields", SQLCA, "")
this.of_register( 3, "c_name", "c_alias", ":as_table,:al_data_view_id,:al_view_id, :al_data_view_id_cont", "d_view_fields_alias_sort", SQLCA, "flag")
//---------------------------- APPEON END ----------------------------

end event

event pfc_retrieve;call super::pfc_retrieve;//---------Begin Added by (Appeon)Toney 12.04.2013 for V141 ISG-CLX--------
//$Reason:Fix history BugT111202,sort field(s) string can't contain invisible field
//the invisible field will be filtered before appends to tree view
string  ls_filter,ls_tablename,ls_fieldname
long    ll_row,ll_visible,ll_level
ll_level = THIS.of_getnextlevel(al_parent)
IF (ll_level = 3) AND (Not ib_show_all_fields_in_select) THEN
	FOR ll_row = 1 TO tab_1.tabpage_columns.dw_view_fields.rowcount( )
		ll_visible = tab_1.tabpage_columns.dw_view_fields.GetItemNumber(ll_row,"field_visible")
		IF ll_visible = 0 THEN
			ls_tablename = tab_1.tabpage_columns.dw_view_fields.GetItemString(ll_row,"table_name")
			ls_fieldname = tab_1.tabpage_columns.dw_view_fields.GetItemString(ll_row,"field_name")
			IF LenA(ls_filter) > 0 THEN ls_filter = ls_filter+" OR "
			ls_filter =ls_filter + " (table_name = '"+ls_tablename+"' AND c_name = '"+ls_fieldname+"')"
		END IF
	NEXT
	IF LenA(ls_filter) > 0 THEN ls_filter = "Not ("+ls_filter+")"
	THIS.inv_attrib[ll_level].ids_obj.SetFilter(ls_filter)
	THIS.inv_attrib[ll_level].ids_obj.Filter()
END IF

Return ancestorreturnvalue
//---------End Added ------------------------------------------------------------------


end event

event doubleclicked;call super::doubleclicked;of_audit_set("S")//Start Code Change ----06.15.2016 #V152 maha
end event

type tabpage_preview from userobject within tab_1
integer x = 18
integer y = 100
integer width = 4398
integer height = 2004
boolean enabled = false
long backcolor = 33551856
string text = "Design"
long tabtextcolor = 33554432
long tabbackcolor = 79741120
long picturemaskcolor = 12632256
gb_1 gb_1
st_left st_left
st_5 st_5
st_center st_center
st_right st_right
st_f_right st_f_right
st_f_center st_f_center
st_f_left st_f_left
st_6 st_6
dw_label dw_label
st_4 st_4
hsb_2 hsb_2
st_3 st_3
st_1 st_1
hsb_1 hsb_1
cbx_move_all cbx_move_all
dw_preview dw_preview
st_7 st_7
st_bold st_bold
st_italic st_italic
st_underline st_underline
st_normal st_normal
cb_14 cb_14
cb_7 cb_7
cb_advanced_screen cb_advanced_screen
cb_clear_design cb_clear_design
cb_clear_help cb_clear_help
dw_display dw_display
rb_p rb_p
rb_l rb_l
cbx_crit cbx_crit
gb_2 gb_2
st_font st_font
em_font em_font
cb_ruler cb_ruler
st_obj_name st_obj_name
end type

on tabpage_preview.create
this.gb_1=create gb_1
this.st_left=create st_left
this.st_5=create st_5
this.st_center=create st_center
this.st_right=create st_right
this.st_f_right=create st_f_right
this.st_f_center=create st_f_center
this.st_f_left=create st_f_left
this.st_6=create st_6
this.dw_label=create dw_label
this.st_4=create st_4
this.hsb_2=create hsb_2
this.st_3=create st_3
this.st_1=create st_1
this.hsb_1=create hsb_1
this.cbx_move_all=create cbx_move_all
this.dw_preview=create dw_preview
this.st_7=create st_7
this.st_bold=create st_bold
this.st_italic=create st_italic
this.st_underline=create st_underline
this.st_normal=create st_normal
this.cb_14=create cb_14
this.cb_7=create cb_7
this.cb_advanced_screen=create cb_advanced_screen
this.cb_clear_design=create cb_clear_design
this.cb_clear_help=create cb_clear_help
this.dw_display=create dw_display
this.rb_p=create rb_p
this.rb_l=create rb_l
this.cbx_crit=create cbx_crit
this.gb_2=create gb_2
this.st_font=create st_font
this.em_font=create em_font
this.cb_ruler=create cb_ruler
this.st_obj_name=create st_obj_name
this.Control[]={this.gb_1,&
this.st_left,&
this.st_5,&
this.st_center,&
this.st_right,&
this.st_f_right,&
this.st_f_center,&
this.st_f_left,&
this.st_6,&
this.dw_label,&
this.st_4,&
this.hsb_2,&
this.st_3,&
this.st_1,&
this.hsb_1,&
this.cbx_move_all,&
this.dw_preview,&
this.st_7,&
this.st_bold,&
this.st_italic,&
this.st_underline,&
this.st_normal,&
this.cb_14,&
this.cb_7,&
this.cb_advanced_screen,&
this.cb_clear_design,&
this.cb_clear_help,&
this.dw_display,&
this.rb_p,&
this.rb_l,&
this.cbx_crit,&
this.gb_2,&
this.st_font,&
this.em_font,&
this.cb_ruler,&
this.st_obj_name}
end on

on tabpage_preview.destroy
destroy(this.gb_1)
destroy(this.st_left)
destroy(this.st_5)
destroy(this.st_center)
destroy(this.st_right)
destroy(this.st_f_right)
destroy(this.st_f_center)
destroy(this.st_f_left)
destroy(this.st_6)
destroy(this.dw_label)
destroy(this.st_4)
destroy(this.hsb_2)
destroy(this.st_3)
destroy(this.st_1)
destroy(this.hsb_1)
destroy(this.cbx_move_all)
destroy(this.dw_preview)
destroy(this.st_7)
destroy(this.st_bold)
destroy(this.st_italic)
destroy(this.st_underline)
destroy(this.st_normal)
destroy(this.cb_14)
destroy(this.cb_7)
destroy(this.cb_advanced_screen)
destroy(this.cb_clear_design)
destroy(this.cb_clear_help)
destroy(this.dw_display)
destroy(this.rb_p)
destroy(this.rb_l)
destroy(this.cbx_crit)
destroy(this.gb_2)
destroy(this.st_font)
destroy(this.em_font)
destroy(this.cb_ruler)
destroy(this.st_obj_name)
end on

type gb_1 from groupbox within tabpage_preview
integer x = 27
integer y = 148
integer width = 2336
integer height = 388
integer taborder = 100
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long textcolor = 8388608
long backcolor = 33551856
string text = "Column Properties"
end type

type st_left from statictext within tabpage_preview
integer x = 1929
integer y = 264
integer width = 119
integer height = 80
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long textcolor = 33554432
long backcolor = 79741120
string text = "L"
alignment alignment = center!
boolean border = true
borderstyle borderstyle = styleraised!
boolean focusrectangle = false
end type

event clicked;IF ii_tag = 0 THEN
	MessageBox(gnv_app.iapp_object.DisplayName, "No object selected.")
	Return
END IF

This.BorderStyle = StyleLowered!
st_center.BorderStyle = StyleRaised!
st_right.BorderStyle = StyleRaised!

tab_1.tabpage_preview.dw_preview.Modify(ls_label_name[ii_tag] + ".alignment = '0'")
tab_1.tabpage_preview.dw_Display.Modify(ls_label_name[ii_tag] + ".alignment = '0'")
tab_1.tabpage_columns.dw_view_fields.SetItem(ii_tag,"label_align",0 )


//------------------- APPEON BEGIN -------------------
//$<delete> Evan 08.31.2010
//$<reason> V10.5-Advanced Report
/*
IF ii_tag = 0 THEN
	MessageBox("Object", "No object selected." )
	Return
END IF

Integer i

This.BorderStyle = StyleLowered!
st_center.BorderStyle = StyleRaised!
st_right.BorderStyle = StyleRaised!

//w_prac_data_design.tab_1.tabpage_design.uo_design.idw_detail.Modify( w_prac_data_design.tab_1.tabpage_design.uo_design.is_last_object[i] + ".alignment = '0'")
tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ ii_tag ] + ".alignment = '0'")		
tab_1.tabpage_columns.dw_view_fields.SetItem( ii_tag, "label_align", 0  )
*/
//------------------- APPEON END ---------------------
end event

type st_5 from statictext within tabpage_preview
integer x = 1929
integer y = 204
integer width = 352
integer height = 60
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long textcolor = 33554432
long backcolor = 33551856
boolean enabled = false
string text = "Label Alignment"
alignment alignment = center!
boolean focusrectangle = false
end type

type st_center from statictext within tabpage_preview
integer x = 2057
integer y = 264
integer width = 119
integer height = 80
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long textcolor = 33554432
long backcolor = 67108864
string text = "C"
alignment alignment = center!
boolean border = true
borderstyle borderstyle = styleraised!
boolean focusrectangle = false
end type

event clicked;IF ii_tag = 0 THEN
	MessageBox(gnv_app.iapp_object.DisplayName, "No object selected.")
	Return
END IF

This.BorderStyle = StyleLowered!
st_left.BorderStyle = StyleRaised!
st_right.BorderStyle = StyleRaised!

tab_1.tabpage_preview.dw_preview.Modify(ls_label_name[ii_tag] + ".alignment = '2'")
tab_1.tabpage_preview.dw_Display.Modify(ls_label_name[ii_tag] + ".alignment = '2'")
tab_1.tabpage_columns.dw_view_fields.SetItem(ii_tag,"label_align",2)

//------------------- APPEON BEGIN -------------------
//$<delete> Evan 08.31.2010
//$<reason> V10.5-Advanced Report
/*
IF ii_tag = 0 THEN
	MessageBox("Object", "No object selected." )
	Return
END IF

Integer i

This.BorderStyle = StyleLowered!
st_left.BorderStyle = StyleRaised!
st_right.BorderStyle = StyleRaised!

tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ ii_tag ] + ".alignment = '2'")		
tab_1.tabpage_columns.dw_view_fields.SetItem( ii_tag, "label_align", 2  )
*/
//------------------- APPEON END ---------------------


end event

type st_right from statictext within tabpage_preview
integer x = 2185
integer y = 264
integer width = 119
integer height = 80
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long textcolor = 33554432
long backcolor = 67108864
string text = "R"
alignment alignment = center!
boolean border = true
borderstyle borderstyle = styleraised!
boolean focusrectangle = false
end type

event clicked;IF ii_tag = 0 THEN
	MessageBox(gnv_app.iapp_object.DisplayName, "No object selected.")
	Return
END IF

This.BorderStyle = StyleLowered!
st_center.BorderStyle = StyleRaised!
st_left.BorderStyle = StyleRaised!

tab_1.tabpage_preview.dw_preview.Modify(ls_label_name[ii_tag] + ".alignment = '1'")		
tab_1.tabpage_preview.dw_Display.Modify(ls_label_name[ii_tag] + ".alignment = '1'")		
tab_1.tabpage_columns.dw_view_fields.SetItem(ii_tag,"label_align",1)	

//------------------- APPEON BEGIN -------------------
//$<delete> Evan 08.31.2010
//$<reason> V10.5-Advanced Report
/*
IF ii_tag = 0 THEN
	MessageBox("Object", "No object selected." )
	Return
END IF

Integer i

This.BorderStyle = StyleLowered!
st_center.BorderStyle = StyleRaised!
st_left.BorderStyle = StyleRaised!

tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ ii_tag ] + ".alignment = '1'")		
tab_1.tabpage_columns.dw_view_fields.SetItem( ii_tag, "label_align", 1  )
*/
//------------------- APPEON END ---------------------

end event

type st_f_right from statictext within tabpage_preview
integer x = 2185
integer y = 420
integer width = 119
integer height = 80
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long textcolor = 33554432
long backcolor = 67108864
string text = "R"
alignment alignment = center!
boolean border = true
borderstyle borderstyle = styleraised!
boolean focusrectangle = false
end type

event clicked;IF ii_tag = 0 THEN
	MessageBox(gnv_app.iapp_object.DisplayName, "No object selected.")
	Return
END IF

This.BorderStyle = StyleLowered!
st_f_center.BorderStyle = StyleRaised!
st_f_left.BorderStyle = StyleRaised!

tab_1.tabpage_preview.dw_preview.Modify(ls_column_name[ii_tag] + ".alignment = '1'")

tab_1.tabpage_preview.dw_Display.Modify(ls_column_name[ii_tag] + ".alignment = '1'")
tab_1.tabpage_preview.dw_Display.Modify(ls_column_name[ii_tag] + "_label.alignment = '1'")

tab_1.tabpage_columns.dw_view_fields.SetItem(ii_tag,"field_align",1)

//------------------- APPEON BEGIN -------------------
//$<delete> Evan 08.31.2010
//$<reason> V10.5-Advanced Report
/*
IF ii_tag = 0 THEN
	MessageBox("Object", "No object selected." )
	Return
END IF

Integer i

This.BorderStyle = StyleLowered!
st_f_center.BorderStyle = StyleRaised!
st_f_left.BorderStyle = StyleRaised!

tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + ".alignment = '1'")		
tab_1.tabpage_columns.dw_view_fields.SetItem( ii_tag, "field_align", 1  )
*/
//------------------- APPEON END ---------------------

end event

type st_f_center from statictext within tabpage_preview
integer x = 2057
integer y = 420
integer width = 119
integer height = 80
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long textcolor = 33554432
long backcolor = 67108864
string text = "C"
alignment alignment = center!
boolean border = true
borderstyle borderstyle = styleraised!
boolean focusrectangle = false
end type

event clicked;IF ii_tag = 0 THEN
	MessageBox(gnv_app.iapp_object.DisplayName, "No object selected.")
	Return
END IF

This.BorderStyle = StyleLowered!
st_f_left.BorderStyle = StyleRaised!
st_f_right.BorderStyle = StyleRaised!

tab_1.tabpage_preview.dw_preview.Modify(ls_column_name[ii_tag] + ".alignment = '2'")

tab_1.tabpage_preview.dw_Display.Modify(ls_column_name[ii_tag] + ".alignment = '2'")
tab_1.tabpage_preview.dw_Display.Modify(ls_column_name[ii_tag] + "_label.alignment = '2'")

tab_1.tabpage_columns.dw_view_fields.SetItem(ii_tag,"field_align",2)

//------------------- APPEON BEGIN -------------------
//$<delete> Evan 08.31.2010
//$<reason> V10.5-Advanced Report
/*
IF ii_tag = 0 THEN
	MessageBox("Object", "No object selected." )
	Return
END IF

Integer i

This.BorderStyle = StyleLowered!
st_f_left.BorderStyle = StyleRaised!
st_f_right.BorderStyle = StyleRaised!

tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + ".alignment = '2'")		
tab_1.tabpage_columns.dw_view_fields.SetItem( ii_tag, "field_align", 2  )	
*/
//------------------- APPEON END ---------------------

end event

type st_f_left from statictext within tabpage_preview
integer x = 1929
integer y = 420
integer width = 119
integer height = 80
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long textcolor = 33554432
long backcolor = 79741120
string text = "L"
alignment alignment = center!
boolean border = true
borderstyle borderstyle = styleraised!
boolean focusrectangle = false
end type

event clicked;IF ii_tag = 0 THEN
	MessageBox(gnv_app.iapp_object.DisplayName, "No object selected.")
	Return
END IF

This.BorderStyle = StyleLowered!
st_f_center.BorderStyle = StyleRaised!
st_f_right.BorderStyle = StyleRaised!

tab_1.tabpage_preview.dw_preview.Modify(ls_column_name[ii_tag] + ".alignment = '0'")

tab_1.tabpage_preview.dw_Display.Modify(ls_column_name[ii_tag] + ".alignment = '0'")
tab_1.tabpage_preview.dw_Display.Modify(ls_column_name[ii_tag] + "_label.alignment = '0'")

tab_1.tabpage_columns.dw_view_fields.SetItem(ii_tag,"field_align",0)

//------------------- APPEON BEGIN -------------------
//$<delete> Evan 08.31.2010
//$<reason> V10.5-Advanced Report
/*
IF ii_tag = 0 THEN
	MessageBox("Object", "No object selected." )
	Return
END IF

Integer i

This.BorderStyle = StyleLowered!
st_f_center.BorderStyle = StyleRaised!
st_f_right.BorderStyle = StyleRaised!

//w_prac_data_design.tab_1.tabpage_design.uo_design.idw_detail.Modify( w_prac_data_design.tab_1.tabpage_design.uo_design.is_last_object[i] + ".alignment = '0'")
tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + ".alignment = '0'")		
tab_1.tabpage_columns.dw_view_fields.SetItem( ii_tag, "field_align", 0  )	
*/
//------------------- APPEON END ---------------------

end event

type st_6 from statictext within tabpage_preview
integer x = 1925
integer y = 360
integer width = 398
integer height = 60
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long textcolor = 33554432
long backcolor = 33551856
boolean enabled = false
string text = "Column Alignment"
alignment alignment = center!
boolean focusrectangle = false
end type

type dw_label from datawindow within tabpage_preview
integer x = 462
integer y = 264
integer width = 768
integer height = 80
integer taborder = 10
boolean bringtotop = true
string dataobject = "d_design_label_editor"
boolean border = false
boolean livescroll = true
end type

event editchanged;//--------------------------- APPEON BEGIN ---------------------------
//$<modify> 04.20.2006 By: LeiWei
//$<reason> Fix a defect.
/*
tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ ii_tag ] + ".text='" + data + "'" )
//tab_1.tabpage_columns.dw_view_fields.SetItem( ii_tag, "field_alias", data )

tab_1.tabpage_columns.dw_view_fields.SetItem( ii_tag, "label_text", data )
*/
//IF ii_tag > 0 THEN
//	tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ ii_tag ] + ".text='" + data + "'" )
//	tab_1.tabpage_columns.dw_view_fields.SetItem( ii_tag, "label_text", data )
//END IF
//---------------------------- APPEON END ----------------------------

//------------------- APPEON BEGIN -------------------
//$<add> Evan 08.31.2010
//$<reason> V10.5-Advanced Report
string ls_alias
IF ii_tag > 0 THEN
	tab_1.tabpage_preview.dw_preview.Modify(ls_label_name[ii_tag] + ".text='" + data + "'")
	tab_1.tabpage_preview.dw_Display.Modify(ls_label_name[ii_tag] + ".text='" + data + "'")
	tab_1.tabpage_columns.dw_view_fields.SetItem(ii_tag,"label_text",data)	
END IF
//------------------- APPEON END ---------------------
end event

event constructor;This.InsertRow( 0 )
end event

type st_4 from statictext within tabpage_preview
integer x = 475
integer y = 208
integer width = 283
integer height = 60
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long textcolor = 33554432
long backcolor = 33551856
boolean enabled = false
string text = "Modify Label"
alignment alignment = center!
boolean focusrectangle = false
end type

type hsb_2 from hscrollbar within tabpage_preview
integer x = 73
integer y = 424
integer width = 347
integer height = 64
boolean bringtotop = true
integer minposition = 3
integer maxposition = 1
integer position = 2
end type

event lineleft;of_Move_Object_Position(-25)

//------------------- APPEON BEGIN -------------------
//$<delete> Evan 08.31.2010
//$<reason> V10.5-Advanced Report
/*
IF ii_tag = 0 THEN
	MessageBox("Object", "No object selected." )
	Return
END IF

IF st_obj_name.Text = "None" THEN
	Return
END IF

Long ll_x
Long ll_x_pos
Long ll_start_x
Integer i

ll_start_x = Long(tab_1.tabpage_preview.dw_preview.Describe( ls_label_name[ ii_tag ] + ".x" ))
IF cbx_move_all.Checked THEN
	FOR i = ii_tag TO ii_col_count
		ll_x_pos = tab_1.tabpage_columns.dw_view_fields.GetItemNumber( i, "field_x"  )			
		IF ll_x_pos >= ll_start_x THEN
			ll_x = Long(tab_1.tabpage_preview.dw_preview.Describe( ls_label_name[ i ] + ".x" ))		
			ll_x = ll_x - 25
			tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ i ] + ".x='" + String( ll_x ) + "'")		
			tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ i ] + ".x='" + String( ll_x ) + "'")			
			tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ i ] + "_label.x='" + String( ll_x ) + "'")						
			tab_1.tabpage_columns.dw_view_fields.SetItem( i, "field_x", ll_x  )			
		END IF
	END FOR
ELSE
	ll_x = Long(tab_1.tabpage_preview.dw_preview.Describe( ls_label_name[ ii_tag ] + ".x" ))
	ll_x = ll_x - 25
	tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ ii_tag ] + ".x='" + String( ll_x ) + "'")		
	tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + ".x='" + String( ll_x ) + "'")			
	tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + "_label.x='" + String( ll_x ) + "'")				
	tab_1.tabpage_columns.dw_view_fields.SetItem( ii_tag, "field_x", ll_x  )	
END IF
*/
//------------------- APPEON END ---------------------
end event

event lineright;of_Move_Object_Position(25)

//------------------- APPEON BEGIN -------------------
//$<delete> Evan 08.31.2010
//$<reason> V10.5-Advanced Report
/*
IF ii_tag = 0 THEN
	MessageBox("Object", "No object selected." )
	Return
END IF

IF st_obj_name.Text = "None" THEN
	Return
END IF

Long ll_x
Long ll_x_pos
Long ll_start_x
Integer i

ll_start_x = Long(tab_1.tabpage_preview.dw_preview.Describe( ls_label_name[ ii_tag ] + ".x" ))
IF cbx_move_all.Checked THEN
	FOR i = ii_tag TO ii_col_count
		ll_x_pos = tab_1.tabpage_columns.dw_view_fields.GetItemNumber( i, "field_x"  )			
		IF ll_x_pos >= ll_start_x THEN
			ll_x = Long(tab_1.tabpage_preview.dw_preview.Describe( ls_label_name[ i ] + ".x" ))		
			ll_x = ll_x + 25
			tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ i ] + ".x='" + String( ll_x ) + "'")		
			tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ i ] + ".x='" + String( ll_x ) + "'")			
			tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ i ] + "_label.x='" + String( ll_x ) + "'")						
			tab_1.tabpage_columns.dw_view_fields.SetItem( i, "field_x", ll_x  )			
		END IF
	END FOR
ELSE
	ll_x = Long(tab_1.tabpage_preview.dw_preview.Describe( ls_label_name[ ii_tag ] + ".x" ))
	ll_x = ll_x + 25
	tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ ii_tag ] + ".x='" + String( ll_x ) + "'")		
	tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + ".x='" + String( ll_x ) + "'")			
	tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + "_label.x='" + String( ll_x ) + "'")					
	tab_1.tabpage_columns.dw_view_fields.SetItem( ii_tag, "field_x", ll_x  )	
END IF
*/
//------------------- APPEON END ---------------------
end event

event pageleft;of_Move_Object_Position(-75)

//------------------- APPEON BEGIN -------------------
//$<delete> Evan 08.31.2010
//$<reason> V10.5-Advanced Report
/*
IF ii_tag = 0 THEN
	MessageBox("Object", "No object selected." )
	Return
END IF


IF st_obj_name.Text = "None" THEN
	Return
END IF

Long ll_x
Long ll_x_pos
Long ll_start_x
Integer i

ll_start_x = Long(tab_1.tabpage_preview.dw_preview.Describe( ls_label_name[ ii_tag ] + ".x" ))
IF cbx_move_all.Checked THEN
	FOR i = ii_tag TO ii_col_count
		ll_x_pos = tab_1.tabpage_columns.dw_view_fields.GetItemNumber( i, "field_x"  )			
		IF ll_x_pos >= ll_start_x THEN
			ll_x = Long(tab_1.tabpage_preview.dw_preview.Describe( ls_label_name[ i ] + ".x" ))		
			ll_x = ll_x - 75
			tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ i ] + ".x='" + String( ll_x ) + "'")		
			tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ i ] + ".x='" + String( ll_x ) + "'")			
			tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ i ] + "_label.x='" + String( ll_x ) + "'")						
			tab_1.tabpage_columns.dw_view_fields.SetItem( i, "field_x", ll_x  )			
		END IF
	END FOR
ELSE
	ll_x = Long(tab_1.tabpage_preview.dw_preview.Describe( ls_label_name[ ii_tag ] + ".x" ))
	ll_x = ll_x - 75
	tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ ii_tag ] + ".x='" + String( ll_x ) + "'")		
	tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + ".x='" + String( ll_x ) + "'")			
	tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + "_label.x='" + String( ll_x ) + "'")					
	tab_1.tabpage_columns.dw_view_fields.SetItem( ii_tag, "field_x", ll_x  )	
END IF
*/
//------------------- APPEON END ---------------------
end event

event pageright;of_Move_Object_Position(75)

//------------------- APPEON BEGIN -------------------
//$<delete> Evan 08.31.2010
//$<reason> V10.5-Advanced Report
/*
IF ii_tag = 0 THEN
	MessageBox("Object", "No object selected." )
	Return
END IF

IF st_obj_name.Text = "None" THEN
	Return
END IF

Long ll_x
Long ll_x_pos
Long ll_start_x
Integer i

ll_start_x = Long(tab_1.tabpage_preview.dw_preview.Describe( ls_label_name[ ii_tag ] + ".x" ))
IF cbx_move_all.Checked THEN
	FOR i = ii_tag TO ii_col_count
		ll_x_pos = tab_1.tabpage_columns.dw_view_fields.GetItemNumber( i, "field_x"  )			
		IF ll_x_pos >= ll_start_x THEN
			ll_x = Long(tab_1.tabpage_preview.dw_preview.Describe( ls_label_name[ i ] + ".x" ))		
			ll_x = ll_x + 75
			tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ i ] + ".x='" + String( ll_x ) + "'")		
			tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ i ] + ".x='" + String( ll_x ) + "'")			
			tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ i ] + "_label.x='" + String( ll_x ) + "'")						
			tab_1.tabpage_columns.dw_view_fields.SetItem( i, "field_x", ll_x  )			
		END IF
	END FOR
ELSE
	ll_x = Long(tab_1.tabpage_preview.dw_preview.Describe( ls_label_name[ ii_tag ] + ".x" ))
	ll_x = ll_x + 75
	tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ ii_tag ] + ".x='" + String( ll_x ) + "'")		
	tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + ".x='" + String( ll_x ) + "'")			
	tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + "_label.x='" + String( ll_x ) + "'")					
	tab_1.tabpage_columns.dw_view_fields.SetItem( ii_tag, "field_x", ll_x  )	
END IF
*/
//------------------- APPEON END ---------------------
end event

event constructor;This.MinPosition = 1
This.MaxPosition = 3
This.Position = 2
end event

type st_3 from statictext within tabpage_preview
integer x = 78
integer y = 228
integer width = 224
integer height = 60
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long textcolor = 33554432
long backcolor = 32891346
boolean enabled = false
string text = "Move "
boolean focusrectangle = false
end type

type st_1 from statictext within tabpage_preview
integer x = 78
integer y = 212
integer width = 366
integer height = 76
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long textcolor = 33554432
long backcolor = 33551856
boolean enabled = false
string text = "Adjust Width"
boolean focusrectangle = false
end type

type hsb_1 from hscrollbar within tabpage_preview
integer x = 73
integer y = 276
integer width = 352
integer height = 64
boolean bringtotop = true
end type

event lineleft;of_Adjust_Object_Width(-25)

//------------------- APPEON BEGIN -------------------
//$<delete> Evan 08.31.2010
//$<reason> V10.5-Advanced Report
/*
IF ii_tag = 0 THEN
	MessageBox("Object", "No object selected." )
	Return
END IF

IF st_obj_name.Text = "None" THEN
	Return
END IF

Long ll_width
Integer i
Integer li_start_col
Long ll_x

ll_width = Long( dw_preview.Describe( is_obj_name + ".width")	)

ll_width = ll_width - 25

tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ ii_tag ] + ".width='" + String( ll_width ) + "'")			
tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + ".width='" + String( ll_width ) + "'")			
tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + "_label.width='" + String( ll_width ) + "'")			

li_start_col = ii_tag + 1 

FOR i = li_start_col TO ii_col_count
	ll_x = Long(tab_1.tabpage_preview.dw_preview.Describe( ls_label_name[ i ] + ".x" ))
	ll_x = ll_x - 25
	tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ i ] + ".x='" + String( ll_x ) + "'")		
	tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ i ] + ".x='" + String( ll_x ) + "'")			
	tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ i ] + "_label.x='" + String( ll_x ) + "'")				
	tab_1.tabpage_columns.dw_view_fields.SetItem( i, "field_x", ll_x  )	
END FOR

tab_1.tabpage_columns.dw_view_fields.SetItem( ii_tag, "field_display_width", String( ll_width ) )
*/
//------------------- APPEON END ---------------------

end event

event lineright;of_Adjust_Object_Width(25)

//------------------- APPEON BEGIN -------------------
//$<delete> Evan 08.31.2010
//$<reason> V10.5-Advanced Report
/*
IF ii_tag = 0 THEN
	MessageBox("Object", "No object selected." )
	Return
END IF

IF st_obj_name.Text = "None" THEN
	Return
END IF

Long ll_width
Integer i
Integer li_start_col
Long ll_x

ll_width = Long( dw_preview.Describe( is_obj_name + ".width")	)

ll_width = ll_width + 25

tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ ii_tag ] + ".width='" + String( ll_width ) + "'")			
tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + ".width='" + String( ll_width ) + "'")	
tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + "_label.width='" + String( ll_width ) + "'")			

li_start_col = ii_tag + 1 

FOR i = li_start_col TO ii_col_count
	ll_x = Long(tab_1.tabpage_preview.dw_preview.Describe( ls_label_name[ i ] + ".x" ))
	ll_x = ll_x + 25
	tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ i ] + ".x='" + String( ll_x ) + "'")		
	tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ i ] + ".x='" + String( ll_x ) + "'")			
	tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ i ] + "_label.x='" + String( ll_x ) + "'")				
	tab_1.tabpage_columns.dw_view_fields.SetItem( i, "field_x", ll_x  )	
END FOR

tab_1.tabpage_columns.dw_view_fields.SetItem( ii_tag, "field_display_width", String( ll_width ) )
*/
//------------------- APPEON END ---------------------



end event

event constructor;This.MinPosition = 1
This.MaxPosition = 3
This.Position = 2
end event

event pageleft;of_Adjust_Object_Width(-75)

//------------------- APPEON BEGIN -------------------
//$<delete> Evan 08.31.2010
//$<reason> V10.5-Advanced Report
/*
IF ii_tag = 0 THEN
	MessageBox("Object", "No object selected." )
	Return
END IF

IF st_obj_name.Text = "None" THEN
	Return
END IF

Long ll_width
Integer i
Integer li_start_col
Long ll_x

ll_width = Long( dw_preview.Describe( is_obj_name + ".width")	)

ll_width = ll_width - 75

tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ ii_tag ] + ".width='" + String( ll_width ) + "'")			
tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + ".width='" + String( ll_width ) + "'")	
tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + "_label.width='" + String( ll_width ) + "'")			

li_start_col = ii_tag + 1 

FOR i = li_start_col TO ii_col_count
	ll_x = Long(tab_1.tabpage_preview.dw_preview.Describe( ls_label_name[ i ] + ".x" ))
	ll_x = ll_x - 75
	tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ i ] + ".x='" + String( ll_x ) + "'")		
	tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ i ] + ".x='" + String( ll_x ) + "'")			
	tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ i ] + "_label.x='" + String( ll_x ) + "'")				
	tab_1.tabpage_columns.dw_view_fields.SetItem( i, "field_x", ll_x  )	
END FOR

tab_1.tabpage_columns.dw_view_fields.SetItem( ii_tag, "field_display_width", String( ll_width ) )
*/
//------------------- APPEON END ---------------------



end event

event pageright;of_Adjust_Object_Width(75)

//------------------- APPEON BEGIN -------------------
//$<delete> Evan 08.31.2010
//$<reason> V10.5-Advanced Report
/*
IF ii_tag = 0 THEN
	MessageBox("Object", "No object selected." )
	Return
END IF

IF st_obj_name.Text = "None" THEN
	Return
END IF

Long ll_width
Integer i
Integer li_start_col
Long ll_x

ll_width = Long( dw_preview.Describe( is_obj_name + ".width")	)

ll_width = ll_width + 75

tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ ii_tag ] + ".width='" + String( ll_width ) + "'")			
tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + ".width='" + String( ll_width ) + "'")			
tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + "_label.width='" + String( ll_width ) + "'")			

li_start_col = ii_tag + 1 

FOR i = li_start_col TO ii_col_count
	ll_x = Long(tab_1.tabpage_preview.dw_preview.Describe( ls_label_name[ i ] + ".x" ))
	ll_x = ll_x + 75
	tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ i ] + ".x='" + String( ll_x ) + "'")		
	tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ i ] + ".x='" + String( ll_x ) + "'")			
	tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ i ] + "_label.x='" + String( ll_x ) + "'")				
	tab_1.tabpage_columns.dw_view_fields.SetItem( i, "field_x", ll_x  )	
END FOR

tab_1.tabpage_columns.dw_view_fields.SetItem( ii_tag, "field_display_width", String( ll_width ) )
*/
//------------------- APPEON END ---------------------



end event

type cbx_move_all from checkbox within tabpage_preview
integer x = 462
integer y = 420
integer width = 722
integer height = 76
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long textcolor = 33554432
long backcolor = 33551856
string text = "Move All (select first label)"
end type

type dw_preview from u_dw within tabpage_preview
boolean visible = false
integer y = 576
integer width = 4384
integer height = 1404
integer taborder = 11
boolean hscrollbar = true
end type

event clicked;call super::clicked;String ls_font_style
String ls_type
Integer li_align
Integer i

dw_label.SetItem( 1, "label", "" )
//$<add> 04.17.2008 by Andy
ii_tag = 0
//End add 04.17.2008

debugbreak()
ls_type = dwo.type
is_object_type = ls_type

IF ls_type = "column" OR ls_type = "text" THEN
	//<add> 12.19.2007 by: Andy
	if ls_type = "text" then 
		dw_label.setcolumn("label")
		dw_label.setfocus()
	end if
	//end of add 
	is_obj_name =  dwo.name
	IF PosA( is_obj_name, "_label" ) > 0 THEN
		//is_obj_name = Mid( is_obj_name, 1, Len( is_obj_name )-6 ) + "_t"
		ls_type = "column"
		is_object_type = ls_type
	END IF
	//messagebox("", is_obj_name )
	ii_tag = Integer( dwo.tag )
	st_obj_name.Text = is_obj_name
	FOR i = 1 TO ii_col_count
		tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ i ] + ".color='0'")		
		tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ i ] + "_label.color='0'")				
	END FOR	
	IF ii_tag > 0 THEN
		IF ls_type = "column" THEN
			tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + "_label.color='16711808'")				
		ELSE
			tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ ii_tag ] + ".color='16711808'")				
		END IF
	END IF
ELSE
	st_obj_name.Text = "None"
END IF

IF ls_type = "text"  And PosA( is_obj_name, "title" ) = 0 THEN
	dw_label.SetItem( 1, "label", dwo.Text )
END IF

IF ii_tag > 0 THEN
	
	//font
	IF ls_type = "text" THEN
		ls_font_style = tab_1.tabpage_columns.dw_view_fields.GetItemString( ii_tag, "label_font_style" )
	ELSE
		ls_font_style = tab_1.tabpage_columns.dw_view_fields.GetItemString( ii_tag, "field_font_style" )
	END IF
	
	tab_1.tabpage_preview.st_normal.BorderStyle = StyleRaised!
	tab_1.tabpage_preview.st_bold.BorderStyle = StyleRaised!
	tab_1.tabpage_preview.st_italic.BorderStyle = StyleRaised!
	tab_1.tabpage_preview.st_underline.BorderStyle = StyleRaised!

	IF PosA( ls_font_style, "N" ) > 0 THEN
		tab_1.tabpage_preview.st_normal.BorderStyle = StyleLowered!
	END IF
	IF PosA( ls_font_style, "B" ) > 0 THEN
		tab_1.tabpage_preview.st_bold.BorderStyle = StyleLowered!
	END IF
	IF PosA( ls_font_style, "I" ) > 0 THEN
		tab_1.tabpage_preview.st_italic.BorderStyle = StyleLowered!
	END IF
	IF PosA( ls_font_style, "U" ) > 0 THEN
		tab_1.tabpage_preview.st_underline.BorderStyle = StyleLowered!
	END IF
	
	//allign label
	li_align = tab_1.tabpage_columns.dw_view_fields.GetItemNumber( ii_tag, "label_align" )
	IF li_align = 0 THEN
		tab_1.tabpage_preview.st_left.BorderStyle = StyleLowered!
		tab_1.tabpage_preview.st_center.BorderStyle = StyleRaised!
		tab_1.tabpage_preview.st_right.BorderStyle = StyleRaised!		
	ELSEIF li_align = 2 THEN
		tab_1.tabpage_preview.st_left.BorderStyle = StyleRaised!
		tab_1.tabpage_preview.st_center.BorderStyle = StyleLowered!
		tab_1.tabpage_preview.st_right.BorderStyle = StyleRaised!				
	ELSEIF li_align = 1 THEN
		tab_1.tabpage_preview.st_left.BorderStyle = StyleRaised!
		tab_1.tabpage_preview.st_center.BorderStyle = StyleRaised!						
		tab_1.tabpage_preview.st_right.BorderStyle = StyleLowered!
	END IF

	//allign field
	li_align = tab_1.tabpage_columns.dw_view_fields.GetItemNumber( ii_tag, "field_align" )
	IF li_align = 0 THEN
		tab_1.tabpage_preview.st_f_left.BorderStyle = StyleLowered!
		tab_1.tabpage_preview.st_f_center.BorderStyle = StyleRaised!
		tab_1.tabpage_preview.st_f_right.BorderStyle = StyleRaised!		
	ELSEIF li_align = 2 THEN
		tab_1.tabpage_preview.st_f_left.BorderStyle = StyleRaised!
		tab_1.tabpage_preview.st_f_center.BorderStyle = StyleLowered!
		tab_1.tabpage_preview.st_f_right.BorderStyle = StyleRaised!				
	ELSEIF li_align = 1 THEN
		tab_1.tabpage_preview.st_f_left.BorderStyle = StyleRaised!
		tab_1.tabpage_preview.st_f_center.BorderStyle = StyleRaised!						
		tab_1.tabpage_preview.st_f_right.BorderStyle = StyleLowered!
	END IF	
END IF

end event

event retrieveend;call super::retrieveend;// Added by  Nova 08.18.2010---V10.5 SK IntelliReport
if rowcount>0 then
	st_obj_name.text="The Quick Preview returns only the first 100 records."
end if	
end event

type st_7 from statictext within tabpage_preview
integer x = 1371
integer y = 200
integer width = 352
integer height = 60
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long textcolor = 33554432
long backcolor = 33551856
boolean enabled = false
string text = "Font Style"
boolean focusrectangle = false
end type

type st_bold from statictext within tabpage_preview
integer x = 1499
integer y = 264
integer width = 119
integer height = 80
boolean bringtotop = true
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long textcolor = 33554432
long backcolor = 79741120
string text = "B"
alignment alignment = center!
boolean border = true
borderstyle borderstyle = styleraised!
boolean focusrectangle = false
end type

event clicked;if ii_tag = 0 then
	MessageBox(gnv_app.iapp_object.DisplayName, "No object selected.")
	Return
end if

if This.BorderStyle = StyleLowered! then
	st_normal.BorderStyle = StyleLowered!
	st_normal.PostEvent(Clicked!)
	This.BorderStyle = StyleRaised!
else
	This.BorderStyle = StyleLowered!
	st_normal.BorderStyle = StyleRaised!	
end if

of_Adjust_Font_Style()

//------------------- APPEON BEGIN -------------------
//$<delete> Evan 08.31.2010
//$<reason> V10.5-Advanced Report
/*
IF ii_tag = 0 THEN
	MessageBox("Object", "No object selected." )
	Return
END IF

Integer i
String ls_font_style

IF This.BorderStyle = StyleLowered! THEN
	st_normal.BorderStyle = StyleLowered!
	st_normal.PostEvent( Clicked! )		
	This.BorderStyle = StyleRaised!
ELSE
	This.BorderStyle = StyleLowered!
	st_normal.BorderStyle = StyleRaised!	
END IF

IF st_normal.BorderStyle = StyleLowered! THEN
	ls_font_style = ls_font_style + "N"
END IF

IF st_italic.BorderStyle = StyleLowered! THEN
	ls_font_style = ls_font_style + "I"
END IF
		
IF st_underline.BorderStyle = StyleLowered! THEN
	ls_font_style = ls_font_style + "U"
END IF

IF st_bold.BorderStyle = StyleLowered! THEN
	ls_font_style = ls_font_style + "B"
END IF

IF is_object_type = "text" THEN
	tab_1.tabpage_columns.dw_view_fields.SetItem( ii_tag, "label_font_style", ls_font_style  )	
	tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ ii_tag ] + ".font.italic ='0'")			
	tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ ii_tag ] + ".font.underline ='0'")			
ELSEIF is_object_type = "column" THEN
	tab_1.tabpage_columns.dw_view_fields.SetItem( ii_tag, "field_font_style", ls_font_style  )		
	tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + "_label.font.italic ='0'")			
	tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + "_label.font.underline ='0'")			
END IF


IF PosA( ls_font_style,"B" ) > 0 THEN
	IF is_object_type = "text" THEN
		tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ ii_tag ] + ".font.weight ='700'")			
	ELSE
		tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + ".font.weight ='700'")			
		tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + "_label.font.weight ='700'")					
	END IF
END IF
		
IF PosA( ls_font_style,"I" ) > 0 THEN
	IF is_object_type = "text" THEN	
		tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ ii_tag ] + ".font.italic ='1'")			
	ELSE
		tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + ".font.italic ='1'")					
		tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + "_label.font.italic ='1'")							
	END IF
END IF
			
IF PosA( ls_font_style,"U" ) > 0 THEN
	IF is_object_type = "text" THEN		
		tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ ii_tag ] + ".font.underline ='1'")			
	ELSE
		tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + ".font.underline ='1'")					
		tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + "_label.font.underline ='1'")							
	END IF
END IF	
		
IF PosA( ls_font_style,"N" ) > 0 THEN
	IF is_object_type = "text" THEN		
		tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ ii_tag ] + ".font.weight ='400'")			
	ELSE
		tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + ".font.weight ='400'")					
		tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + "_label.font.weight ='400'")							
	END IF
END IF	
*/
//------------------- APPEON END ---------------------
end event

type st_italic from statictext within tabpage_preview
integer x = 1627
integer y = 264
integer width = 119
integer height = 80
boolean bringtotop = true
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = roman!
string facename = "Times New Roman"
boolean italic = true
long textcolor = 33554432
long backcolor = 67108864
string text = "I"
alignment alignment = center!
boolean border = true
borderstyle borderstyle = styleraised!
boolean focusrectangle = false
end type

event clicked;if ii_tag = 0 then
	MessageBox(gnv_app.iapp_object.DisplayName, "No object selected.")
	Return
end if

if This.BorderStyle = StyleLowered! then
	This.BorderStyle = StyleRaised!
else
	This.BorderStyle = StyleLowered!
end if

of_Adjust_Font_Style()

//------------------- APPEON BEGIN -------------------
//$<delete> Evan 08.31.2010
//$<reason> V10.5-Advanced Report
/*
IF ii_tag = 0 THEN
	MessageBox("Object", "No object selected." )
	Return
END IF


Integer i
String ls_font_style

IF This.BorderStyle = StyleLowered! THEN
	This.BorderStyle = StyleRaised!
ELSE
	This.BorderStyle = StyleLowered!
END IF

IF st_normal.BorderStyle = StyleLowered! THEN
	ls_font_style = ls_font_style + "N"
END IF

IF st_italic.BorderStyle = StyleLowered! THEN
	ls_font_style = ls_font_style + "I"
END IF
		
IF st_underline.BorderStyle = StyleLowered! THEN
	ls_font_style = ls_font_style + "U"
END IF

IF st_bold.BorderStyle = StyleLowered! THEN
	ls_font_style = ls_font_style + "B"
END IF

IF is_object_type = "text" THEN
	tab_1.tabpage_columns.dw_view_fields.SetItem( ii_tag, "label_font_style", ls_font_style  )	
	tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ ii_tag ] + ".font.italic ='0'")			
	tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ ii_tag ] + ".font.underline ='0'")			
ELSEIF is_object_type = "column" THEN
	tab_1.tabpage_columns.dw_view_fields.SetItem( ii_tag, "field_font_style", ls_font_style  )		
	tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + "_label.font.italic ='0'")			
	tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + "_label.font.underline ='0'")			
END IF


IF PosA( ls_font_style,"B" ) > 0 THEN
	IF is_object_type = "text" THEN
		tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ ii_tag ] + ".font.weight ='700'")			
	ELSE
		tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + ".font.weight ='700'")			
		tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + "_label.font.weight ='700'")					
	END IF
END IF
		
IF PosA( ls_font_style,"I" ) > 0 THEN
	IF is_object_type = "text" THEN	
		tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ ii_tag ] + ".font.italic ='1'")			
	ELSE
		tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + ".font.italic ='1'")					
		tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + "_label.font.italic ='1'")							
	END IF
END IF
			
IF PosA( ls_font_style,"U" ) > 0 THEN
	IF is_object_type = "text" THEN		
		tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ ii_tag ] + ".font.underline ='1'")			
	ELSE
		tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + ".font.underline ='1'")					
		tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + "_label.font.underline ='1'")							
	END IF
END IF	
		
IF PosA( ls_font_style,"N" ) > 0 THEN
	IF is_object_type = "text" THEN		
		tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ ii_tag ] + ".font.weight ='400'")			
	ELSE
		tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + ".font.weight ='400'")					
		tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + "_label.font.weight ='400'")							
	END IF
END IF
*/
//------------------- APPEON END ---------------------





end event

type st_underline from statictext within tabpage_preview
integer x = 1755
integer y = 264
integer width = 119
integer height = 80
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
boolean underline = true
long textcolor = 33554432
long backcolor = 67108864
string text = "U"
alignment alignment = center!
boolean border = true
borderstyle borderstyle = styleraised!
boolean focusrectangle = false
end type

event clicked;if ii_tag = 0 then
	MessageBox(gnv_app.iapp_object.DisplayName, "No object selected.")
	Return
end if

if This.BorderStyle = StyleLowered! then
	This.BorderStyle = StyleRaised!
else
	This.BorderStyle = StyleLowered!
end if

of_Adjust_Font_Style()

//------------------- APPEON BEGIN -------------------
//$<delete> Evan 08.31.2010
//$<reason> V10.5-Advanced Report
/*
IF ii_tag = 0 THEN
	MessageBox("Object", "No object selected." )
	Return
END IF

Integer i
String ls_font_style

IF This.BorderStyle = StyleLowered! THEN
	This.BorderStyle = StyleRaised!
ELSE
	This.BorderStyle = StyleLowered!
END IF

IF st_normal.BorderStyle = StyleLowered! THEN
	ls_font_style = ls_font_style + "N"
END IF

IF st_italic.BorderStyle = StyleLowered! THEN
	ls_font_style = ls_font_style + "I"
END IF
		
IF st_underline.BorderStyle = StyleLowered! THEN
	ls_font_style = ls_font_style + "U"
END IF

IF st_bold.BorderStyle = StyleLowered! THEN
	ls_font_style = ls_font_style + "B"
END IF

IF is_object_type = "text" THEN
	tab_1.tabpage_columns.dw_view_fields.SetItem( ii_tag, "label_font_style", ls_font_style  )	
	tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ ii_tag ] + ".font.italic ='0'")			
	tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ ii_tag ] + ".font.underline ='0'")			
ELSEIF is_object_type = "column" THEN
	tab_1.tabpage_columns.dw_view_fields.SetItem( ii_tag, "field_font_style", ls_font_style  )		
	tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + "_label.font.italic ='0'")			
	tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + "_label.font.underline ='0'")			
END IF

IF PosA( ls_font_style,"B" ) > 0 THEN
	IF is_object_type = "text" THEN
		tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ ii_tag ] + ".font.weight ='700'")			
	ELSE
		tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + ".font.weight ='700'")			
		tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + "_label.font.weight ='700'")					
	END IF
END IF
		
IF PosA( ls_font_style,"I" ) > 0 THEN
	IF is_object_type = "text" THEN	
		tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ ii_tag ] + ".font.italic ='1'")			
	ELSE
		tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + ".font.italic ='1'")					
		tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + "_label.font.italic ='1'")							
	END IF
END IF
			
IF PosA( ls_font_style,"U" ) > 0 THEN
	IF is_object_type = "text" THEN		
		tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ ii_tag ] + ".font.underline ='1'")			
	ELSE
		tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + ".font.underline ='1'")					
		tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + "_label.font.underline ='1'")							
	END IF
END IF	
		
IF PosA( ls_font_style,"N" ) > 0 THEN
	IF is_object_type = "text" THEN		
		tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ ii_tag ] + ".font.weight ='400'")			
	ELSE
		tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + ".font.weight ='400'")					
		tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + "_label.font.weight ='400'")							
	END IF
END IF
*/
//------------------- APPEON END ---------------------
end event

type st_normal from statictext within tabpage_preview
integer x = 1371
integer y = 264
integer width = 119
integer height = 80
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long textcolor = 33554432
long backcolor = 79741120
string text = "N"
alignment alignment = center!
boolean border = true
borderstyle borderstyle = styleraised!
boolean focusrectangle = false
end type

event clicked;if ii_tag = 0 then
	MessageBox(gnv_app.iapp_object.DisplayName, "No object selected.")
	Return
end if

if st_normal.BorderStyle = StyleLowered! then
	st_normal.BorderStyle = StyleRaised!
else
	st_normal.BorderStyle = StyleLowered!
end if

st_bold.BorderStyle = StyleRaised!

of_Adjust_Font_Style()

//------------------- APPEON BEGIN -------------------
//$<delete> Evan 08.31.2010
//$<reason> V10.5-Advanced Report
/*
IF ii_tag = 0 THEN
	MessageBox("Object", "No object selected." )
	Return
END IF

Integer i
String ls_font_style

IF This.BorderStyle = StyleLowered! THEN
	This.BorderStyle = StyleRaised!
ELSE
	This.BorderStyle = StyleLowered!
END IF

st_bold.BorderStyle = StyleRaised!

IF st_normal.BorderStyle = StyleLowered! THEN
	ls_font_style = ls_font_style + "N"
END IF

IF st_italic.BorderStyle = StyleLowered! THEN
	ls_font_style = ls_font_style + "I"
END IF
		
IF st_underline.BorderStyle = StyleLowered! THEN
	ls_font_style = ls_font_style + "U"
END IF

IF st_bold.BorderStyle = StyleLowered! THEN
	ls_font_style = ls_font_style + "B"
END IF

//tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ ii_tag ] + ".font.italic ='0'")			
//tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ ii_tag ] + ".font.underline ='0'")			
//tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + "_label.font.italic ='0'")			
//tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + "_label.font.underline ='0'")			

IF is_object_type = "text" THEN
	tab_1.tabpage_columns.dw_view_fields.SetItem( ii_tag, "label_font_style", ls_font_style  )	
ELSEIF is_object_type = "column" THEN
	tab_1.tabpage_columns.dw_view_fields.SetItem( ii_tag, "field_font_style", ls_font_style  )		
END IF

IF PosA( ls_font_style,"B" ) > 0 THEN
	IF is_object_type = "text" THEN
		tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ ii_tag ] + ".font.weight ='700'")			
	ELSE
		tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + ".font.weight ='700'")			
		tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + "_label.font.weight ='700'")					
	END IF
END IF
		
IF PosA( ls_font_style,"I" ) > 0 THEN
	IF is_object_type = "text" THEN	
		tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ ii_tag ] + ".font.italic ='1'")			
	ELSE
		tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + ".font.italic ='1'")					
		tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + "_label.font.italic ='1'")							
	END IF
END IF
			
IF PosA( ls_font_style,"U" ) > 0 THEN
	IF is_object_type = "text" THEN		
		tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ ii_tag ] + ".font.underline ='1'")			
	ELSE
		tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + ".font.underline ='1'")					
		tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + "_label.font.underline ='1'")							
	END IF
END IF	
		
IF PosA( ls_font_style,"N" ) > 0 THEN
	IF is_object_type = "text" THEN		
		tab_1.tabpage_preview.dw_preview.Modify( ls_label_name[ ii_tag ] + ".font.weight ='400'")			
	ELSE
		tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + ".font.weight ='400'")					
		tab_1.tabpage_preview.dw_preview.Modify( ls_column_name[ ii_tag ] + "_label.font.weight ='400'")							
	END IF
END IF	
*/
//------------------- APPEON END ---------------------



end event

type cb_14 from commandbutton within tabpage_preview
integer x = 27
integer y = 28
integer width = 370
integer height = 84
integer taborder = 50
boolean bringtotop = true
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "&Save"
end type

event clicked;String		ls_Syntax
long			ll_Count
blob			lb_Syntax
DateTime		ldt_Today

ls_Syntax = tab_1.tabpage_Preview.dw_Preview.Describe("DataWindow.Syntax")
is_Origin_Syntax = ls_Syntax
lb_Syntax = Blob(ls_Syntax,EncodingAnsi!) //Encoding – Nova 11.16.2010

of_audit_set("D")//Start Code Change ----06.15.2016 #V152 maha

SELECT Count(*) INTO :ll_Count FROM ctx_report_syntax WHERE view_id = :il_view_id;

ldt_Today = Datetime(Today(),Now())

gnv_appeondb.of_startqueue( )

if ll_Count = 0 then
	INSERT ctx_report_syntax(view_id,dw_sql,modify_date) VALUES(:il_view_id,:ls_Syntax,:ldt_Today);
else
	UPDATE ctx_report_syntax SET dw_sql = :ls_Syntax,modify_date = :ldt_Today WHERE view_id = :il_view_id;
end if

UPDATEBLOB ctx_report_syntax SET dw_syntax = :lb_Syntax WHERE view_id=:il_view_id;

COMMIT;

dw_audit.update()  //Start Code Change ----06.15.2016 #V152 maha

gnv_appeondb.of_commitqueue( )

//------------------- APPEON BEGIN -------------------
//$<delete> Evan 09.02.2010
//$<reason> V10.5-Advanced Report
/*
//$<Modify> 04.15.2008 by Andy Reason:Optimize speed.
//of_save()
tab_1.tabpage_preview.dw_label.setfocus( )
tab_1.tabpage_browse.dw_detail.update( )
tab_1.tabpage_columns.dw_view_fields.update( )
//end Modify 04.15.2008

ib_new = False

tab_1.tabpage_browse.cb_select.enabled = true			//Added by Scofield on 2007-08-23
tab_1.tabpage_browse.cb_copy.enabled = true				//Added by Scofield on 2007-08-23
*/
//------------------- APPEON END ---------------------
end event

type cb_7 from commandbutton within tabpage_preview
integer x = 416
integer y = 28
integer width = 389
integer height = 84
integer taborder = 40
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "Quick &Preview"
end type

event clicked;tab_1.tabpage_preview.cb_14.TriggerEvent(Clicked!)

//Added By Alan on 2009-2-9
SetNull(idt_priordate)

IF This.Text = "&Remove Data" THEN
	This.Text = "Quick &Preview"
	ii_with_data = 0
	of_preview( dw_preview, 0 )
	of_modify_dw(dw_preview)
ELSE
	This.Text = "&Remove Data"	
	ii_with_data = 1
	of_preview( dw_preview, 0 )
	of_modify_dw(dw_preview)
END IF
dw_preview.GroupCalc()

//ii_with_data = 0 //comment by Appeon long.zhang 12.08.2014(V14.2 Testing/Bug# 4331)


//------------------- APPEON BEGIN -------------------
//$<delete> Evan 09.01.2010
//$<reason> V10.5-Advanced Report
/*
IF This.Text = "&Remove Data" THEN
	This.Text = "Quick &Preview"
	ii_with_data = 0
	//--------Begin Modified by  Nova 08.18.2010------------------------
	//8.18
	//of_preview( dw_preview)
	//--------End Modified --------------------------------------------
	of_preview( dw_preview,0 )
ELSE
	This.Text = "&Remove Data"	
	ii_with_data = 1
	//--------Begin Modified by  Nova 08.18.2010------------------------
	//8.18
	//of_preview( dw_preview)
	//--------End Modified --------------------------------------------
	of_preview( dw_preview,0 )
END IF

ii_with_data = 0
*/
//------------------- APPEON END ---------------------
end event

type cb_advanced_screen from commandbutton within tabpage_preview
integer x = 2386
integer y = 28
integer width = 603
integer height = 84
integer taborder = 60
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "Advanced Screen Design"
end type

event clicked;string ls_Syntax
datetime	ldt_modifydate
str_custom_report lstr

ls_Syntax = tab_1.tabpage_preview.dw_preview.Describe("datawindow.syntax")
if ls_Syntax = "" or ls_Syntax = "?" or ls_Syntax = "!" then Return

lstr.adw_preview = tab_1.tabpage_preview.dw_preview
lstr.al_view_id = il_view_id
OpenWithParm(w_intellicred_report_design,lstr)

if Not IsValid(w_custom_report) then Return
select modify_date into :ldt_modifydate from ctx_report_syntax where view_id=:il_view_id; 
if ldt_modifydate <= idt_priordate then Return

tab_1.tabpage_preview.dw_preview.SetRedraw(false)
of_Preview( tab_1.tabpage_preview.dw_preview, 0)
of_Modify_dw(tab_1.tabpage_preview.dw_preview)
tab_1.tabpage_preview.dw_preview.SetRedraw(true)

is_CurObject_Name = ""
ii_Tag = 0
end event

type cb_clear_design from commandbutton within tabpage_preview
integer x = 3008
integer y = 28
integer width = 512
integer height = 84
integer taborder = 70
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "Clear Screen Design"
end type

event clicked;//Start Code Change ----08.09.2012 #V12 maha
integer li_ans
long     ll_row

li_ans =messagebox("Clear Advanced Design","Are you sure you wish to clear the advanced design to start over?",question!,yesno!,2)

if li_ans = 1 then
	//messagebox("", il_view_id)
//	delete from ctx_report_syntax where view_id = il_view_id;
	delete from ctx_report_syntax where view_id = :il_view_id;//long.zhang 10.15.2012
	commit using sqlca;
else  //(Appeon)Stephen 07.11.2014 - Bug #4111: IntelliReport Clear Screen Design bug
	return
end if

//---------Begin Added by (Appeon)Stephen 05.21.2014 for IntelliReport Modifications 14.2--------
for ll_row = 1 to Tab_1.tabpage_columns.dw_view_fields.rowcount()
	Tab_1.tabpage_columns.dw_view_fields.setitem(ll_row, "field_font_size", 0)
	Tab_1.tabpage_columns.dw_view_fields.setitem(ll_row, "label_font_size", 0)
next
//---------End Added ------------------------------------------------------

tab_1.tabpage_preview.dw_preview.SetRedraw(false)
of_Preview( tab_1.tabpage_preview.dw_preview, 0)
of_Modify_dw(tab_1.tabpage_preview.dw_preview)
tab_1.tabpage_preview.dw_preview.SetRedraw(true)

end event

type cb_clear_help from commandbutton within tabpage_preview
integer x = 3529
integer y = 28
integer width = 142
integer height = 84
integer taborder = 80
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "?"
end type

event clicked;string s

s =  "The Clear Screen Design button will remove all formatting done in advanced screen design."
s += "~r~rIt will reset the screen as if new, except for the width of the fields."
s += "~r~rIf a field has been shrunk to the point it cannot be seen, the width can be reset on the Columns tab field detail to a minimal width, allowing the fields to be visible again in design."

messagebox("About Clear Screen Design",s)
end event

type dw_display from u_dw within tabpage_preview
integer y = 576
integer width = 4379
integer height = 1404
integer taborder = 31
boolean bringtotop = true
boolean hscrollbar = true
end type

event clicked;call super::clicked;String 	ls_Font_Style,ls_Type
string     ls_size
long 		ll_Align,ll_Tag

ls_Type = dwo.type
if ls_Type <> "column" and ls_Type <> "text" then Return

ll_Tag = Integer(dwo.tag)
if ll_Tag <= 0 then Return

is_PreObject_Name = is_CurObject_Name
is_CurObject_Name = dwo.name
ii_tag = ll_Tag

is_object_type = ls_Type

if PosA(is_CurObject_Name, "_label" ) > 0 then
	ls_Type = "column"
	is_object_type = ls_Type
	is_CurObject_Name = LeftA(is_CurObject_Name,LenA(is_CurObject_Name) - LenA("_label"))
end if

dw_label.SetItem(1, "label", "")

if ls_Type = "text" then 
	dw_label.SetColumn("label")
	dw_label.SetFocus()
end if

st_obj_name.Text = is_CurObject_Name

if is_PreObject_Name <> "" then
	if This.Describe(is_PreObject_Name + ".Type") = "column" then
		This.Modify(is_PreObject_Name + "_label.color='" + is_PreObject_Color + "'")
	else
		This.Modify(is_PreObject_Name + ".color='" + is_PreObject_Color + "'")
	end if
end if

if ls_Type = "column" then
	is_PreObject_Color = This.Describe(is_CurObject_Name + "_label.color")
	This.Modify(is_CurObject_Name + "_label.color='16711808'")
else
	is_PreObject_Color = This.Describe(is_CurObject_Name + ".color")
	This.Modify(is_CurObject_Name + ".color='16711808'")
end if

IF ls_Type = "text"  And PosA( is_CurObject_Name, "title" ) = 0 THEN
	dw_label.SetItem( 1, "label", dwo.Text )
END IF

IF ii_tag > 0 THEN	
	//---------Begin Added by (Appeon)Stephen 05.14.2014 for IntelliReport Modifications 14.2--------
	ls_size = This.Describe(is_CurObject_Name + ".Font.height")
	tab_1.tabpage_preview.em_font.text = string(abs(long(ls_size)))
	//---------End Added ------------------------------------------------------
	
	if This.Describe(is_CurObject_Name + ".Font.Weight") = "400" then
		ls_Font_Style += 'N'
	else
		ls_Font_Style += 'B'
	end if
	
	if This.Describe(is_CurObject_Name + ".Font.Italic") = "1" then ls_Font_Style += 'I'
	if This.Describe(is_CurObject_Name + ".Font.Underline") = "1" then ls_Font_Style += 'U'
	
	IF PosA( ls_Font_Style, "N" ) > 0 THEN
		tab_1.tabpage_preview.st_normal.BorderStyle = StyleLowered!
	else
		tab_1.tabpage_preview.st_normal.BorderStyle = StyleRaised!
	END IF
	
	IF PosA( ls_Font_Style, "B" ) > 0 THEN
		tab_1.tabpage_preview.st_bold.BorderStyle = StyleLowered!
	else
		tab_1.tabpage_preview.st_bold.BorderStyle = StyleRaised!
	END IF
	
	IF PosA( ls_Font_Style, "I" ) > 0 THEN
		tab_1.tabpage_preview.st_italic.BorderStyle = StyleLowered!
	else
		tab_1.tabpage_preview.st_italic.BorderStyle = StyleRaised!
	END IF
	
	IF PosA( ls_Font_Style, "U" ) > 0 THEN
		tab_1.tabpage_preview.st_underline.BorderStyle = StyleLowered!
	else
		tab_1.tabpage_preview.st_underline.BorderStyle = StyleRaised!
	END IF

	ll_Align = long(This.Describe(is_CurObject_Name + ".Alignment"))
	
	IF ls_Type = "text" THEN
		IF ll_Align = 0 THEN
			tab_1.tabpage_preview.st_left.BorderStyle = StyleLowered!
			tab_1.tabpage_preview.st_center.BorderStyle = StyleRaised!
			tab_1.tabpage_preview.st_right.BorderStyle = StyleRaised!		
		ELSEIF ll_Align = 2 THEN
			tab_1.tabpage_preview.st_left.BorderStyle = StyleRaised!
			tab_1.tabpage_preview.st_center.BorderStyle = StyleLowered!
			tab_1.tabpage_preview.st_right.BorderStyle = StyleRaised!				
		ELSEIF ll_Align = 1 THEN
			tab_1.tabpage_preview.st_left.BorderStyle = StyleRaised!
			tab_1.tabpage_preview.st_center.BorderStyle = StyleRaised!						
			tab_1.tabpage_preview.st_right.BorderStyle = StyleLowered!
		END IF
	else
		IF ll_Align = 0 THEN
			tab_1.tabpage_preview.st_f_left.BorderStyle = StyleLowered!
			tab_1.tabpage_preview.st_f_center.BorderStyle = StyleRaised!
			tab_1.tabpage_preview.st_f_right.BorderStyle = StyleRaised!		
		ELSEIF ll_Align = 2 THEN
			tab_1.tabpage_preview.st_f_left.BorderStyle = StyleRaised!
			tab_1.tabpage_preview.st_f_center.BorderStyle = StyleLowered!
			tab_1.tabpage_preview.st_f_right.BorderStyle = StyleRaised!				
		ELSEIF ll_Align = 1 THEN
			tab_1.tabpage_preview.st_f_left.BorderStyle = StyleRaised!
			tab_1.tabpage_preview.st_f_center.BorderStyle = StyleRaised!						
			tab_1.tabpage_preview.st_f_right.BorderStyle = StyleLowered!
		END IF
	end if
END IF

end event

type rb_p from radiobutton within tabpage_preview
integer x = 2459
integer y = 224
integer width = 352
integer height = 76
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long textcolor = 33554432
long backcolor = 33551856
string text = "Portrait"
boolean checked = true
end type

event clicked;tab_1.tabpage_browse.dw_detail.SetItem( tab_1.tabpage_browse.dw_detail.GetRow(), "orientation", "P" )

dw_preview.Modify("DataWindow.Print.Orientation= '2'")
dw_Display.Modify("DataWindow.Print.Orientation= '2'")

tab_1.tabpage_browse.dw_report_list.SetItem( tab_1.tabpage_browse.dw_report_list.GetRow(), "orientation", "P" ) 


//------------------- APPEON BEGIN -------------------
//$<delete> Evan 09.01.2010
//$<reason> V10.5-Advanced Report
/*
tab_1.tabpage_browse.dw_detail.SetItem( tab_1.tabpage_browse.dw_detail.GetRow(), "orientation", "P" )
dw_preview.Modify("DataWindow.Print.Orientation= '2'")

//--------------------------- APPEON BEGIN ---------------------------
//$<add> 04.26.2006 By: Rodger Wu
//$<reason> Fix a defect. 
tab_1.tabpage_browse.dw_report_list.SetItem( tab_1.tabpage_browse.dw_report_list.GetRow(), "orientation", "P" ) 
//---------------------------- APPEON END ----------------------------
*/
//------------------- APPEON END ---------------------
end event

type rb_l from radiobutton within tabpage_preview
integer x = 2459
integer y = 296
integer width = 352
integer height = 76
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long textcolor = 33554432
long backcolor = 33551856
string text = "Landscape "
end type

event clicked;tab_1.tabpage_browse.dw_detail.SetItem( tab_1.tabpage_browse.dw_detail.GetRow(), "orientation", "L" )

dw_preview.Modify("DataWindow.Print.Orientation= '1'")
dw_Display.Modify("DataWindow.Print.Orientation= '1'")

tab_1.tabpage_browse.dw_report_list.SetItem( tab_1.tabpage_browse.dw_report_list.GetRow(), "orientation", "L" )

//------------------- APPEON BEGIN -------------------
//$<delete> Evan 09.01.2010
//$<reason> V10.5-Advanced Report
/*
tab_1.tabpage_browse.dw_detail.SetItem( tab_1.tabpage_browse.dw_detail.GetRow(), "orientation", "L" )
dw_preview.Modify("DataWindow.Print.Orientation= '1'")

//--------------------------- APPEON BEGIN ---------------------------
//$<add> 04.26.2006 By: Rodger Wu
//$<reason> Fix a defect. 
tab_1.tabpage_browse.dw_report_list.SetItem( tab_1.tabpage_browse.dw_report_list.GetRow(), "orientation", "L" ) 
//---------------------------- APPEON END ----------------------------
*/
//------------------- APPEON END ---------------------
end event

type cbx_crit from checkbox within tabpage_preview
integer x = 2464
integer y = 368
integer width = 997
integer height = 84
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long backcolor = 33551856
string text = "Hide Header Criteria "
boolean checked = true
end type

event clicked;//Start Code Change ----09.25.2017 #V154 maha
if this.checked then 
	tab_1.tabpage_browse.dw_report_list.SetItem( tab_1.tabpage_browse.dw_report_list.GetRow(), "hide_crit", 1 ) 
else
	tab_1.tabpage_browse.dw_report_list.SetItem( tab_1.tabpage_browse.dw_report_list.GetRow(), "hide_crit", 0 ) 
end if
end event

type gb_2 from groupbox within tabpage_preview
integer x = 2395
integer y = 152
integer width = 1966
integer height = 388
integer taborder = 70
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long textcolor = 8388608
long backcolor = 33551856
string text = "Report Properties"
end type

type st_font from statictext within tabpage_preview
integer x = 3035
integer y = 236
integer width = 366
integer height = 60
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long textcolor = 33554432
long backcolor = 33551856
boolean enabled = false
string text = "Label Font Size"
alignment alignment = center!
boolean focusrectangle = false
end type

type em_font from editmask within tabpage_preview
integer x = 3406
integer y = 228
integer width = 247
integer height = 80
integer taborder = 90
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long textcolor = 33554432
string text = "Font Size"
borderstyle borderstyle = stylelowered!
string mask = "#####"
boolean spin = true
string minmax = "6~~14"
end type

event modified;Integer i, li_fontsize

FOR i = 1 TO ii_col_count
	dw_preview.Modify(ls_column_name[i] + ".Font.Face='Segoe UI'")
	dw_Display.Modify(ls_column_name[i] + ".Font.Face='Segoe UI'")
	//---------Begin Modified by (Appeon)Stephen 05.21.2014 for IntelliReport Modifications 14.2--------
	/*dw_preview.Modify(ls_column_name[i] + ".Font.Height='-" + This.Text + "'")
	dw_Display.Modify(ls_column_name[i] + ".Font.Height='-" + This.Text + "'")
	*/
	li_fontsize = Tab_1.tabpage_columns.dw_view_fields.getitemnumber(i, "field_font_size")
	if isnull(li_fontsize) or li_fontsize = 0 then
		dw_preview.Modify(ls_column_name[i] + ".Font.Height='-" + This.Text + "'")
		dw_Display.Modify(ls_column_name[i] + ".Font.Height='-" + This.Text + "'")
	else
		dw_preview.Modify(ls_column_name[i] + ".Font.Height='-" + string(li_fontsize) + "'")
		dw_Display.Modify(ls_column_name[i] + ".Font.Height='-" + string(li_fontsize) + "'")
	end if
	li_fontsize = 0
	li_fontsize = Tab_1.tabpage_columns.dw_view_fields.getitemnumber(i, "label_font_size")
	if isnull(li_fontsize) or li_fontsize = 0 then
		dw_preview.Modify(ls_label_name[i] + ".Font.Height='-" + This.Text + "'")
		dw_Display.Modify(ls_label_name[i] + ".Font.Height='-" + This.Text + "'")
	else
		dw_preview.Modify(ls_label_name[i] + ".Font.Height='-" + string(li_fontsize) + "'")
		dw_Display.Modify(ls_label_name[i] + ".Font.Height='-" +string(li_fontsize)+ "'")
	end if
	//---------End Modfiied ------------------------------------------------------
END FOR

tab_1.tabpage_browse.dw_report_list.SetItem( tab_1.tabpage_browse.dw_report_list.GetRow(), "font_size" , Integer(This.Text )) 
tab_1.tabpage_browse.dw_detail.SetItem( tab_1.tabpage_browse.dw_detail.GetRow(), "font_size" , Integer(This.Text ) )

//------------------- APPEON BEGIN -------------------
//$<delete> Evan 09.01.2010
//$<reason> V10.5-Advanced Report
/*
Integer i

FOR i = 1 TO ii_col_count
	dw_preview.Modify( ls_column_name[ i ] + ".Font.Face='Segoe UI'")		
	dw_preview.Modify( ls_column_name[ i ] + ".Font.Height='-" + This.Text + "'")	
	dw_preview.Modify( ls_label_name[ i ] + ".Font.Height='-" + This.Text + "'")		
END FOR

tab_1.tabpage_browse.dw_report_list.SetItem( tab_1.tabpage_browse.dw_report_list.GetRow(), "font_size" , Integer(This.Text )) 
//--------------------------- APPEON BEGIN ---------------------------
//$<add> 04.26.2006 By: Rodger Wu
//$<reason> Fix a defect. 
tab_1.tabpage_browse.dw_detail.SetItem( tab_1.tabpage_browse.dw_detail.GetRow(), "font_size" , Integer(This.Text ) )
//---------------------------- APPEON END ----------------------------
*/
//------------------- APPEON END ---------------------

end event

event other;//Integer i
//
//
//FOR i = 1 TO ii_col_count
//	dw_preview.Modify( ls_column_name[ i ] + ".Font.Face='Segoe UI'")		
//	dw_preview.Modify( ls_column_name[ i ] + ".Font.Height='-" + This.Text + "'")	
//	dw_preview.Modify( ls_label_name[ i ] + ".Font.Height='-" + This.Text + "'")		
//END FOR
//
////messagebox("",  ls_label_name[ 1 ] + ".Font.Height='-" + This.Text + "'" )
//
end event

type cb_ruler from commandbutton within tabpage_preview
integer x = 3835
integer y = 228
integer width = 311
integer height = 84
integer taborder = 100
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "View Ruler"
end type

event clicked;//---------Begin Modified by (Appeon)Toney 06.13.2013 for V141 ISG-CLX--------
//$Reason: Ability to show the ruler
 /*
	dw_preview.Modify("DataWindow.Print.Preview=Yes")
	dw_preview.Modify("DataWindow.Print.Preview.Rulers=Yes")
	
	dw_Display.Modify("DataWindow.Print.Preview=Yes")
	dw_Display.Modify("DataWindow.Print.Preview.Rulers=Yes")  
  */
  ///*
string   ls_showorhide
IF THIS.text = "View Ruler" THEN
	ii_with_ruler = 1 //Added by Appeon long.zhang 12.08.2014
	ls_showorhide = "Yes"
	THIS.Text = "Hide Ruler"
ELSE
	ii_with_ruler = 0 //Added by Appeon long.zhang 12.08.2014
	ls_showorhide = "No"
	THIS.Text = "View Ruler"
END IF
dw_preview.Modify("DataWindow.Print.Preview="+ls_showorhide)
dw_preview.Modify("DataWindow.Print.Preview.Rulers="+ls_showorhide)

dw_Display.Modify("DataWindow.Print.Preview="+ls_showorhide)
dw_Display.Modify("DataWindow.Print.Preview.Rulers="+ls_showorhide)  
//*/
//---------End Modfiied ------------------------------------------------------------------


end event

type st_obj_name from statictext within tabpage_preview
integer x = 2469
integer y = 448
integer width = 1673
integer height = 76
boolean bringtotop = true
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long textcolor = 33554432
long backcolor = 33551856
boolean enabled = false
string text = "None"
boolean border = true
boolean focusrectangle = false
end type

type tabpage_run from userobject within tab_1
event create ( )
event destroy ( )
integer x = 18
integer y = 100
integer width = 4398
integer height = 2004
boolean enabled = false
long backcolor = 33551856
string text = "Run Report"
long tabbackcolor = 79741120
long picturemaskcolor = 12632256
cb_store cb_store
dw_run dw_run
dw_save_sql dw_save_sql
st_sql st_sql
dw_wizard dw_wizard
cb_saveas cb_saveas
cb_print cb_print
cb_batch_filter cb_batch_filter
cb_filter cb_filter
cb_sort cb_sort
cb_13 cb_13
cb_showsql cb_showsql
cb_sql cb_sql
cb_next_run cb_next_run
cb_17 cb_17
st_step st_step
end type

on tabpage_run.create
this.cb_store=create cb_store
this.dw_run=create dw_run
this.dw_save_sql=create dw_save_sql
this.st_sql=create st_sql
this.dw_wizard=create dw_wizard
this.cb_saveas=create cb_saveas
this.cb_print=create cb_print
this.cb_batch_filter=create cb_batch_filter
this.cb_filter=create cb_filter
this.cb_sort=create cb_sort
this.cb_13=create cb_13
this.cb_showsql=create cb_showsql
this.cb_sql=create cb_sql
this.cb_next_run=create cb_next_run
this.cb_17=create cb_17
this.st_step=create st_step
this.Control[]={this.cb_store,&
this.dw_run,&
this.dw_save_sql,&
this.st_sql,&
this.dw_wizard,&
this.cb_saveas,&
this.cb_print,&
this.cb_batch_filter,&
this.cb_filter,&
this.cb_sort,&
this.cb_13,&
this.cb_showsql,&
this.cb_sql,&
this.cb_next_run,&
this.cb_17,&
this.st_step}
end on

on tabpage_run.destroy
destroy(this.cb_store)
destroy(this.dw_run)
destroy(this.dw_save_sql)
destroy(this.st_sql)
destroy(this.dw_wizard)
destroy(this.cb_saveas)
destroy(this.cb_print)
destroy(this.cb_batch_filter)
destroy(this.cb_filter)
destroy(this.cb_sort)
destroy(this.cb_13)
destroy(this.cb_showsql)
destroy(this.cb_sql)
destroy(this.cb_next_run)
destroy(this.cb_17)
destroy(this.st_step)
end on

type cb_store from commandbutton within tabpage_run
integer x = 3360
integer y = 28
integer width = 357
integer height = 84
integer taborder = 60
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "S&tore Report"
end type

event clicked;//====================================================================
//$<Event>: clicked
//$<Arguments>:
// 	%ScriptArgs%
//$<Return>:  long
//$<Description>: 
//$<Author>: (Appeon) Stephen 06.01.2017 (V15.4-WebView Reporting Functionality)
//--------------------------------------------------------------------
//$<Modify History>:
//====================================================================
string ls_path
string ls_filename
string ls_note
integer li_ret
long   ll_report_storage_id
long   ll_row
boolean ab_Version
str_b    lstr_rpt
appeon_pdfservice lnv_pdf
n_cst_excel lnv_excel

if il_view_id < 1 or isnull(il_view_id) then return

openwithparm(w_rpt_storage_select, "R-C:"+string(il_view_id))
lstr_rpt = message.powerobjectparm
ll_report_storage_id = lstr_rpt.i_count
ls_note = lstr_rpt.s_type
if ll_report_storage_id < 1 then
	messagebox("Prompt", "This record doesn’t have report storage information. Please set it up in Saved Report Setup window.")
	return
end if

li_ret = getfilesavename("Save As File", ls_path, ls_filename, "PDF", "Excel (*.xlsx),*.xlsx,Excel (*.xls),*.xls,PDF(*.pdf),*.pdf")///Modified by (Appeon)Gavin 12.07.2017 for V16.1  Export and excel
ChangeDirectory(gs_current_path)
if li_ret <> 1 then return

ll_row = dw_run.rowcount()

choose case upper(right(ls_filename,4))
	case ".PDF"
		lnv_pdf = Create appeon_pdfservice
		li_ret = lnv_pdf.of_Print(dw_run, ls_path)
		Destroy lnv_pdf
	case ".XLS",  "XLSX"	///Modified by (Appeon)Gavin 12.07.2017 for V16.1  Export and excel
		if integer(dw_run.describe("Datawindow.Processing")) > 1 then
			dw_run.SaveAs(ls_path, Excel!, true)
		else
			lnv_excel = create n_cst_excel
			if Integer( gf_GetExcelVersion( ) ) >=12 then
				ab_Version = true
			end if
			lnv_excel.ib_read = false
			lnv_excel.of_saveas_excel( dw_run, ls_path, true, ab_Version )
			destroy lnv_excel
		end if
end choose

datetime ldt_null
if fileexists(ls_path) and ll_report_storage_id>0 then
	f_report_storage(ll_report_storage_id, ls_path, ll_row, ldt_null, ldt_null, ls_note, 'M')
end if

end event

type dw_run from u_dw within tabpage_run
event ue_mail_current ( )
integer x = 1317
integer y = 156
integer width = 3077
integer height = 1848
integer taborder = 21
boolean bringtotop = true
boolean titlebar = true
string title = "Report Preview"
boolean hscrollbar = true
end type

event ue_mail_current();//--------------------------- APPEON BEGIN ---------------------------
//$<add> 02.14.2008 by Andy
long	ll_Rtn

ll_Rtn = EVENT ue_save_pdf_for_mailing( )
if ll_Rtn <> 0 then return
//Start Code Change ----10.09.2008 #V85 maha -  readded option to use outlook email
//EVENT ue_mail('IntelliReport','' )
//---------------------------- APPEON END ----------------------------

if gi_email_type = 1 then //outlook
	Super::EVENT ue_mail_bak('IntelliReport','' )
else
	Super::EVENT ue_mail('IntelliReport','' )
end if
//End Code Change---10.09.2008
end event

event constructor;call super::constructor;This.SetTransObject( SQLCA )
end event

event retrieveend;call super::retrieveend;tab_1.tabpage_run.st_step.Text = "Returned " + String( rowcount ) + " Rows"//Report 
end event

event resize;call super::resize;cb_print.BringToTop = True
cb_filter.BringToTop = True
cb_saveas.BringToTop = True
cb_sort.BringToTop = True

end event

event clicked;call super::clicked;//messagebox("", dw_run.GetClickedColumn ( ))
end event

event other;call super::other;//$<add> 04.17.2008 by Andy
if Message.WordParm = 61458 then 
	Message.Processed = true
	Message.ReturnValue = 0 
end if
end event

type dw_save_sql from datawindow within tabpage_run
boolean visible = false
integer x = 805
integer y = 1884
integer width = 142
integer height = 76
integer taborder = 40
boolean bringtotop = true
string dataobject = "d_print_space"
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

type st_sql from statictext within tabpage_run
integer y = 164
integer width = 1303
integer height = 1836
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long backcolor = 16777215
boolean enabled = false
boolean border = true
boolean focusrectangle = false
end type

type dw_wizard from u_dw within tabpage_run
integer y = 164
integer width = 1307
integer height = 1840
integer taborder = 11
string dragicon = "Rectangle!"
string dataobject = "d_crit_custom"
boolean hscrollbar = true
end type

event retrieveend;call super::retrieveend;This.InsertRow( 1 )
//--------Begin Modified by  Nova 08.19.2010-----------------------
//V10.5 SK IntelliReport
//IF This.DataObject <> "d_crit_date_range_custom" AND This.DataObject <> "d_crit_single_date_custom" AND This.DataObject <> "d_crit_facility" AND This.DataObject <> "d_crit_address_type_ir" AND This.DataObject <> "d_crit_net_dev_type_ir" AND This.DataObject <> "d_crit_app_payor"  THEN
IF This.DataObject <> "d_crit_date_range_custom" AND This.DataObject <> "d_crit_single_date_custom" AND This.DataObject <> "d_crit_facility" AND This.DataObject <> "d_crit_address_type_ir" AND This.DataObject <> "d_crit_net_dev_type_ir" AND This.DataObject <> "d_crit_app_payor" AND This.DataObject <> "d_crit_practitioner"  AND This.DataObject <> "d_crit_practice_locations" AND This.DataObject <> "d_crit_active_status" AND This.DataObject <> "d_crit_appmnt_status_ireport" THEN  //Start Code Change ----11.04.2014 #V14.2 maha - added status criteria
//--------End Modified --------------------------------------------	
	This.SetItem( 1, "selected", 1 )
	This.SetItem( 1, "lookup_code", 0 )
	This.SetItem( 1, "code", "All" )
	IF is_wizard_lookup_type[ ii_current_wizard_step ] = "C" THEN
		This.SetItem( 1, "description", "Include All selections" )		
	ELSE
		This.SetItem( 1, "entity_name", "Include All selections" )			
	END IF
ELSEIF This.DataObject = "d_crit_facility"  THEN
	This.SetItem( 1, "selected", 1 )
	This.SetItem( 1, "facility_id", 0 )
	This.SetItem( 1, "facility_name", "All" )	
ELSEIF This.DataObject = "d_crit_net_dev_type_ir"  THEN
	This.SetItem( 1, "selected", 1 )
	//This.SetItem( 1, "facility_id", 0 )
	This.SetItem( 1, "code", "All" )	
ELSEIF This.DataObject = "d_crit_app_payor"  THEN
	This.SetItem( 1, "selected", 1 )
	//This.SetItem( 1, "facility_id", 0 )
	This.SetItem( 1, "application_name", "All" )
//--------Begin Added by Nova 08.19.2010------------------------
//V10.5 SK IntelliReport
ELSEIF This.DataObject = "d_crit_practitioner"  THEN
	This.SetItem( 1, "selected", 1 )
	//This.SetItem( 1, "facility_id", 0 )
	This.SetItem( 1, "practitioner", "All" )
ELSEIF This.DataObject = "d_crit_practice_locations"  THEN
	This.SetItem( 1, "selected", 1 )
	//This.SetItem( 1, "facility_id", 0 )
	This.SetItem( 1, "street", "All" )
//--------End Added --------------------------------------------	
//---------Begin Added by (Appeon)Toney 06.13.2013 for V141 ISG-CLX--------
elseif this.dataobject = "d_crit_date_range_custom"	then   //Set default value --jervis 03.02.2011
	tab_1.tabpage_run.dw_wizard.SetItem( 1,'from_date',today())
	tab_1.tabpage_run.dw_wizard.SetItem( 1,'to_date',today())
elseif this.dataobject = "d_crit_single_date_custom" then
	tab_1.tabpage_run.dw_wizard.SetItem( 1,'from_date',today())
//---------End Added ------------------------------------------------------------------	
END IF
end event

event constructor;call super::constructor;//This.SetUpdatAble( False )

end event

event itemchanged;call super::itemchanged;IF data = "1" AND row = 1 THEN
	Integer li_rc
	Integer i
	li_rc = This.RowCount()
	FOR i = 2 TO li_rc
		This.SetItem( i, "selected", 0 )
	END FOR
ELSEIF data = "1" AND row <> 1 THEN
	This.SetItem( 1, "selected", 0 )
END IF
end event

event ue_key;call super::ue_key;// (Appeon)Harry 01.24.2014 - V142 ISG-CLX Copy from CLX12.0
//Added By Mark Lee 12/11/2012
if Key = KeyEnter! and keyflags = 0  then
	cb_next_run.event clicked()
end if
return 0
end event

type cb_saveas from commandbutton within tabpage_run
integer x = 3058
integer y = 28
integer width = 283
integer height = 84
integer taborder = 50
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "Sa&ve As.."
end type

event clicked;gnv_dw.of_SaveAs(dw_run)//.SaveAs() Modify by Evan 05.11.2010
yield()     //(Appeon)Stephen 2013-07-19 - Bug 3596
ChangeDirectory(gs_current_path)  //For restore Directory    Added by Nova 04.29.2008
w_custom_report.setredraw(true)  //(Appeon)Stephen 2013-07-19 - Bug 3596



end event

type cb_print from commandbutton within tabpage_run
integer x = 2638
integer y = 28
integer width = 402
integer height = 84
integer taborder = 40
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "Out&Put Options"
end type

event clicked;//--------------------------- APPEON BEGIN ---------------------------
//$<Modify> 2007-12-19 By: Andy

//dw_run.Print()
m_npdb_options NewMenu 
NewMenu = CREATE m_npdb_options
NewMenu.of_setparent(dw_run)
NewMenu.m_options.m_mailall.visible = false
NewMenu.m_options.m_printall.visible = false
NewMenu.m_options.m_printcurrent.text = 'Print'
NewMenu.m_options.m_mailcurrent.text = 'EMail'
NewMenu.m_options.PopMenu(w_mdi.pointerx(),w_mdi.pointerY())
//---------------------------- APPEON END ----------------------------
end event

type cb_batch_filter from commandbutton within tabpage_run
integer x = 2267
integer y = 28
integer width = 343
integer height = 84
integer taborder = 80
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "Batch Filter"
end type

event clicked;//Start Code Change ----10.19.2011 #V12 maha - added
long i
long ic
long li_prac_id
long li_find
long li_nr
string ls_filter
string ls_column
string s

string ls_full_name
gs_batch_search ist_search


if dw_run.rowcount() <1 then 
	return 0
end if 

//Start Code Change ----11.02.2011 #V12 maha  - added trap
if dw_run.Describe("v_basic_info_prac_id.ColType") <> "!" then
	ls_column = "v_basic_info_prac_id"
elseif dw_run.Describe("v_full_name_prac_id.ColType") <> "!" then
	ls_column = "v_full_name_prac_id"	
elseif dw_run.Describe("v_full_basic_prac_id.ColType") <> "!" then
	ls_column = "v_full_basic_prac_id"
elseif dw_run.Describe("v_basic_prac_id.ColType") <> "!" then
	ls_column = "v_basic_prac_id"
elseif tab_1.tabpage_run.dw_run.Describe("prac_id.ColType") <> "!" then
	ls_column = "prac_id"
else	
	messagebox("Filter option","To use this option the prac_id field from v_basic_info, v_basic,  v_full_name, or v_full_basic must be part of the query.  Check that the field alias is prac_id")
	return 0
end if
//End Code Change ----11.02.2011

openwithparm(w_batch_prac_select_new,"R")

if message.stringparm = "Cancel" then 	return

if not isvalid(message.powerobjectparm) then return 0
ist_search = message.powerobjectparm

ic = upperbound(ist_search.li_prac_id[])
for i = 1 to ic
	li_prac_id = ist_search.li_prac_id[i] 
	ls_filter+= String( li_prac_id )
	if i < ic then ls_filter+= ","
next

 ls_filter = "prac_id in (" + ls_filter + ")"
 
 i = dw_run.setfilter(ls_filter)
 
 if i < 0 then
	messagebox("Batch filter failed",ls_filter)
else
	dw_run.filter()
end if
	
ic = dw_run.RowCount( )
tab_1.tabpage_run.st_step.Text = "Returned " + String( ic ) + " Rows"

dw_run.SetFocus( )


end event

type cb_filter from commandbutton within tabpage_run
integer x = 2011
integer y = 28
integer width = 247
integer height = 84
integer taborder = 40
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "&Filter.."
end type

event clicked;String ls_null
Long ll_row_count

SetNull( ls_null )

dw_run.SetFilter( ls_null )
dw_run.Filter()

//------------------- APPEON BEGIN -------------------
//<$>added:long.zhang 02.04.2016
//<$>reason:Walkaround for IE, Bug id 4969 - Error in IE when filtering in Intellireport.
//dw_run.groupcalc()//Added by Nova.zhang on 10.22.2008
If  dw_run.RowCount( ) > 0 Then dw_run.groupcalc()
//------------------- APPEON END -------------------

ll_row_count = dw_run.RowCount( )

tab_1.tabpage_run.st_step.Text = "Returned " + String( ll_row_count ) + " Rows"//Report 
end event

type cb_sort from commandbutton within tabpage_run
integer x = 1746
integer y = 28
integer width = 247
integer height = 84
integer taborder = 40
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "S&ort.."
end type

event clicked;String ls_null

SetNull( ls_null )

dw_run.SetSort( ls_null )
dw_run.Sort()
dw_run.groupcalc()
end event

type cb_13 from commandbutton within tabpage_run
integer x = 1335
integer y = 28
integer width = 393
integer height = 84
integer taborder = 50
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "&Collapse Detail"
end type

event clicked;IF This.Text = "&Collapse Detail" THEN
	dw_run.Modify("DataWindow.detail.Height='0'")	
	This.Text = "Show D&etail"
ELSE
	dw_run.Modify("DataWindow.detail.Height='75'")	
	This.Text = "&Collapse Detail"	
END IF
end event

type cb_showsql from commandbutton within tabpage_run
integer x = 905
integer y = 28
integer width = 407
integer height = 84
integer taborder = 50
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "&Hide SQL"
end type

event clicked;//--------------------------- APPEON BEGIN ---------------------------
//$<add> 10.11.2006 By: LeiWei
//$<reason> Fix a defect.

IF ii_total_wizard_steps > 0 THEN
//	dw_run.x = 1358
//	dw_run.width = 2098

	dw_run.x = dw_wizard.x + dw_wizard.width + 32
	dw_run.width = tab_1.tabpage_run.width - dw_wizard.width - 32*3
	//$<modify> 05.27.2008 add:&
	IF This.Text = "Previe&w SQL" THEN
		This.Text = "S&how Wizard"
		cb_17.visible = False
		cb_next_run.visible = False
		cb_sql.visible = True
		st_sql.visible = True
		dw_wizard.visible = false
	ELSE
		This.Text = "Previe&w SQL"
		cb_17.visible = True
		cb_next_run.visible = True
		cb_sql.visible = False
		st_sql.visible = False
		dw_wizard.visible = True
	END IF
	RETURN
END IF

dw_wizard.visible = False

//---------------------------- APPEON END ----------------------------

//--------------------------- APPEON BEGIN ---------------------------
//$<add> 2006-09-06 By: Rodger Wu (Contract)
//$<reason> Add this button to toggle between showing sql dw and not.

IF This.Text = "Sho&w SQL" THEN
//	dw_run.x = 1358
//	dw_run.width = 2098
	dw_run.x = dw_wizard.x + dw_wizard.width + 32
	dw_run.width = tab_1.tabpage_run.width - dw_wizard.width - 32*3
	
	This.Text = "&Hide SQL"
	//---------Begin Commented by (Appeon)Harry 05.31.2013  V141 for BugH081602 of History Issues--------
	//cb_17.visible = True
	//cb_next_run.visible = True
	//---------End Commented ------------------------------------------------------
	cb_sql.visible = True
	st_sql.visible = True
ELSE
	cb_17.visible = False
	cb_next_run.visible = False
	cb_sql.visible = False
	st_sql.visible = False
	This.Text = "Sho&w SQL"
	
	dw_run.x = 32
	dw_run.width = tab_1.tabpage_run.width - 64
	dw_run.bringtotop = True
END IF
//---------------------------- APPEON END ----------------------------
end event

type cb_sql from commandbutton within tabpage_run
integer x = 590
integer y = 28
integer width = 297
integer height = 84
integer taborder = 40
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
boolean enabled = false
string text = "&Save SQL"
end type

event clicked;string ls_sql


ls_sql = tab_1.tabpage_run.st_sql.Text
clipboard(ls_sql)

messagebox("Saved","On Clipboard")



end event

type cb_next_run from commandbutton within tabpage_run
integer x = 297
integer y = 28
integer width = 274
integer height = 84
integer taborder = 30
boolean bringtotop = true
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "Ne&xt-->"
end type

event clicked;//debugbreak()
of_next_wizard()
//added by nova 11.18.2010
if tab_1.tabpage_run.dw_wizard.Visible and tab_1.tabpage_run.dw_wizard.RowCount() < 1 then
			tab_1.tabpage_run.dw_wizard.Event RetrieveEnd(0)
end if
//dw_run.Describe("<Reportname>.Name")
//dw_run.Modify("Width='<the width of the object in the units specified for the DataWindow>'")

//dw_run.Modify("DataWindow.Print.Paper.Size='1'")
//IF tab_1.tabpage_browse.dw_report_list.GetItemString( tab_1.tabpage_browse.dw_report_list.GetRow(), "orientation" ) =  "P" THEN
//	dw_run.Modify("DataWindow.Print.Orientation= '2'")
//ELSE
//	dw_run.Modify("DataWindow.Print.Orientation= '1'")	
//END IF
//

//of_preview( dw_run )
end event

type cb_17 from commandbutton within tabpage_run
integer x = 32
integer y = 28
integer width = 247
integer height = 84
integer taborder = 50
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "&Reset"
end type

event clicked;//--------------------------- APPEON BEGIN ---------------------------
//$<add> 2007-12-19 By: Andy
dw_run.x = dw_wizard.x + dw_wizard.width + 32
dw_run.width = tab_1.tabpage_run.width - dw_wizard.width - 32*3
tab_1.tabpage_run.dw_wizard.visible = true
//---------------------------- APPEON END ----------------------------

is_filter = ""
//$<add> 04.25.2008 by Andy
is_sql_where = ""
//end add 04.25.2008
debugbreak()
SetNull(idt_priordate)//add Michael 06.27.2012 Bug 3160 ignores the grouping functions when click 'reset' button
of_wizard_setup()
tab_1.tabpage_run.st_sql.Text = ""
tab_1.tabpage_run.st_sql.Visible = False
tab_1.tabpage_run.cb_next_run.Enabled = True

//------------------- APPEON BEGIN -------------------
//$<add> Evan 02.11.2011
//$<reason> No record in dw_wizard
if dw_wizard.Visible and dw_wizard.RowCount() < 1 then
	dw_wizard.Event RetrieveEnd(0)
end if
//------------------- APPEON END ---------------------
end event

type st_step from statictext within tabpage_run
integer x = 3758
integer y = 28
integer width = 594
integer height = 112
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long textcolor = 8388608
long backcolor = 33551856
boolean enabled = false
boolean border = true
boolean focusrectangle = false
end type

