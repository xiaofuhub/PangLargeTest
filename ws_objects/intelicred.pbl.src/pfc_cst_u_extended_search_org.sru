$PBExportHeader$pfc_cst_u_extended_search_org.sru
forward
global type pfc_cst_u_extended_search_org from userobject
end type
type cb_dept_help from commandbutton within pfc_cst_u_extended_search_org
end type
type cb_facility_help from commandbutton within pfc_cst_u_extended_search_org
end type
type cb_view_help from commandbutton within pfc_cst_u_extended_search_org
end type
type cb_loc from commandbutton within pfc_cst_u_extended_search_org
end type
type cbx_valid from checkbox within pfc_cst_u_extended_search_org
end type
type pb_lost from picturebutton within pfc_cst_u_extended_search_org
end type
type dw_prof_suffix from datawindow within pfc_cst_u_extended_search_org
end type
type r_new from rectangle within pfc_cst_u_extended_search_org
end type
type gb_department from groupbox within pfc_cst_u_extended_search_org
end type
type gb_view from groupbox within pfc_cst_u_extended_search_org
end type
type cb_29 from u_search_letter_button within pfc_cst_u_extended_search_org
end type
type rb_appr from radiobutton within pfc_cst_u_extended_search_org
end type
type rb_ver from radiobutton within pfc_cst_u_extended_search_org
end type
type rb_de from radiobutton within pfc_cst_u_extended_search_org
end type
type cb_27 from u_search_letter_button within pfc_cst_u_extended_search_org
end type
type cb_26 from u_search_letter_button within pfc_cst_u_extended_search_org
end type
type cb_1 from u_search_letter_button within pfc_cst_u_extended_search_org
end type
type cb_2 from u_search_letter_button within pfc_cst_u_extended_search_org
end type
type cb_3 from u_search_letter_button within pfc_cst_u_extended_search_org
end type
type cb_4 from u_search_letter_button within pfc_cst_u_extended_search_org
end type
type cb_5 from u_search_letter_button within pfc_cst_u_extended_search_org
end type
type cb_6 from u_search_letter_button within pfc_cst_u_extended_search_org
end type
type cb_7 from u_search_letter_button within pfc_cst_u_extended_search_org
end type
type cb_8 from u_search_letter_button within pfc_cst_u_extended_search_org
end type
type cb_9 from u_search_letter_button within pfc_cst_u_extended_search_org
end type
type cb_10 from u_search_letter_button within pfc_cst_u_extended_search_org
end type
type cb_11 from u_search_letter_button within pfc_cst_u_extended_search_org
end type
type cb_12 from u_search_letter_button within pfc_cst_u_extended_search_org
end type
type cb_13 from u_search_letter_button within pfc_cst_u_extended_search_org
end type
type cb_14 from u_search_letter_button within pfc_cst_u_extended_search_org
end type
type cb_15 from u_search_letter_button within pfc_cst_u_extended_search_org
end type
type cb_16 from u_search_letter_button within pfc_cst_u_extended_search_org
end type
type cb_17 from u_search_letter_button within pfc_cst_u_extended_search_org
end type
type cb_18 from u_search_letter_button within pfc_cst_u_extended_search_org
end type
type cb_19 from u_search_letter_button within pfc_cst_u_extended_search_org
end type
type cb_20 from u_search_letter_button within pfc_cst_u_extended_search_org
end type
type cb_21 from u_search_letter_button within pfc_cst_u_extended_search_org
end type
type cb_22 from u_search_letter_button within pfc_cst_u_extended_search_org
end type
type cb_23 from u_search_letter_button within pfc_cst_u_extended_search_org
end type
type cb_24 from u_search_letter_button within pfc_cst_u_extended_search_org
end type
type cb_25 from u_search_letter_button within pfc_cst_u_extended_search_org
end type
type cb_clear from u_search_letter_button within pfc_cst_u_extended_search_org
end type
type dw_department from datawindow within pfc_cst_u_extended_search_org
end type
type cb_iverify from commandbutton within pfc_cst_u_extended_search_org
end type
type ddlb_search_type from dropdownlistbox within pfc_cst_u_extended_search_org
end type
type cbx_status from checkbox within pfc_cst_u_extended_search_org
end type
type dw_view from u_dw within pfc_cst_u_extended_search_org
end type
type cb_select from commandbutton within pfc_cst_u_extended_search_org
end type
type cb_search from u_cb within pfc_cst_u_extended_search_org
end type
type gb_letters from groupbox within pfc_cst_u_extended_search_org
end type
type gb_status from groupbox within pfc_cst_u_extended_search_org
end type
type cb_close from commandbutton within pfc_cst_u_extended_search_org
end type
type dw_dept from datawindow within pfc_cst_u_extended_search_org
end type
type dw_org_facility_select from pfc_cst_u_org_facility_selector_vertical within pfc_cst_u_extended_search_org
end type
type gb_facility from groupbox within pfc_cst_u_extended_search_org
end type
type ddlb_status from dropdownlistbox within pfc_cst_u_extended_search_org
end type
type gb_search from groupbox within pfc_cst_u_extended_search_org
end type
type cb_new from commandbutton within pfc_cst_u_extended_search_org
end type
type rb_aud from radiobutton within pfc_cst_u_extended_search_org
end type
type sle_srch_val from singlelineedit within pfc_cst_u_extended_search_org
end type
type dw_search from u_dw within pfc_cst_u_extended_search_org
end type
end forward

global type pfc_cst_u_extended_search_org from userobject
integer width = 3547
integer height = 1940
boolean border = true
long backcolor = 16777215
long tabtextcolor = 33554432
long picturemaskcolor = 536870912
event ue_cb_select ( )
cb_dept_help cb_dept_help
cb_facility_help cb_facility_help
cb_view_help cb_view_help
cb_loc cb_loc
cbx_valid cbx_valid
pb_lost pb_lost
dw_prof_suffix dw_prof_suffix
r_new r_new
gb_department gb_department
gb_view gb_view
cb_29 cb_29
rb_appr rb_appr
rb_ver rb_ver
rb_de rb_de
cb_27 cb_27
cb_26 cb_26
cb_1 cb_1
cb_2 cb_2
cb_3 cb_3
cb_4 cb_4
cb_5 cb_5
cb_6 cb_6
cb_7 cb_7
cb_8 cb_8
cb_9 cb_9
cb_10 cb_10
cb_11 cb_11
cb_12 cb_12
cb_13 cb_13
cb_14 cb_14
cb_15 cb_15
cb_16 cb_16
cb_17 cb_17
cb_18 cb_18
cb_19 cb_19
cb_20 cb_20
cb_21 cb_21
cb_22 cb_22
cb_23 cb_23
cb_24 cb_24
cb_25 cb_25
cb_clear cb_clear
dw_department dw_department
cb_iverify cb_iverify
ddlb_search_type ddlb_search_type
cbx_status cbx_status
dw_view dw_view
cb_select cb_select
cb_search cb_search
gb_letters gb_letters
gb_status gb_status
cb_close cb_close
dw_dept dw_dept
dw_org_facility_select dw_org_facility_select
gb_facility gb_facility
ddlb_status ddlb_status
gb_search gb_search
cb_new cb_new
rb_aud rb_aud
sle_srch_val sle_srch_val
dw_search dw_search
end type
global pfc_cst_u_extended_search_org pfc_cst_u_extended_search_org

type variables
Long ll_all_departments[]

Integer il_facility_id
Integer li_num_of_departments
Integer li_num_of_departments_user_has_rights_to
String is_open_for
String is_select = 'S'
String is_status //long.zhang 04.06.2012

long il_dept = 0
long il_prof = 0 //maha 12.06.2012
long il_loc_id = 0 //maha 04.10.2014
integer ii_user_view

w_prac_data_1 iw_prac_folder

n_tr SQLCA_1

//--------------------------- APPEON BEGIN ---------------------------
//$<ID> PT-01
//$<add> 01.24.2006 By: Cao YongWang
//$<reason> Performance tuning
//$<modification> Define two datastores for caching data.
n_ds ids_views

n_ds ids_facilitys
//---------------------------- APPEON END ----------------------------

end variables

forward prototypes
public function integer of_close (integer ai_value)
public function integer of_set_open_for (string as_open_for)
public function integer of_set_parent (w_prac_data_1 aw_win)
public function integer of_set_transaction (n_tr as_trans)
public function integer of_open_from_dash ()
public function integer of_select_all ()
public function integer of_se ()
public function integer of_hide_ssn ()
public function integer of_search_old (string letter)
public function integer of_search (string as_letter)
public function integer of_search_new (string as_letter)
public function integer of_search_trap (string as_type, string as_val)
public subroutine of_init_dddw ()
public function integer of_delete_prac (long al_prac)
public function string of_get_batch (integer ai_batch)
public function integer of_bg_color (long al_rgb)
public function integer of_get_photo_data (long al_prac)
public function integer of_select_prac (long ai_row)
public function integer of_validate (string as_field, string as_value)
public function integer of_ddlb_deleteitem (string as_name)
end prototypes

event ue_cb_select();////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  [PUBLIC]   : ue_cb_select
//==================================================================================================================
//  Purpose   	: Moved the code from the clicked event to this new event so that the it can bea accessed 
//==================================================================================================================
//  Arguments 	: [none] 
//==================================================================================================================
//  Returns   	: [long]     
//==================================================================================================================
//  Notes     	: 	  
//==================================================================================================================
//  Created By	: Michael Skinner  Thursday  October 28, 2004
//==================================================================================================================
//  Modification Log
//   Changed By             Change Date                                               Reason
// ------------------------------------------------------------------------------------------------------------------
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

IF dw_search.RowCount() > 0 THEN
	of_select_prac( dw_search.GetRow() )
END IF
end event

public function integer of_close (integer ai_value);CloseWithReturn( Parent, ai_value )

Return 0
end function

public function integer of_set_open_for (string as_open_for);is_open_for = as_open_for
Integer li_facility
Boolean lb_from_dash = False
//debugbreak()
//messagebox("",is_open_for)
//messagebox("",1)
//Start Code Change ----07.25.2011 #V11 maha - stripped cb_new codes to separate if to simplify
cb_iverify.Visible = false

If  is_open_for = "DATAENTRY" THEN
	cb_new.Visible = true
	r_new.visible = true  //Start Code Change ----07.25.2011 #V11 maha 
ELSE
	cb_new.Visible = False
	r_new.visible = false  //Start Code Change ----07.25.2011 #V11 maha 
END IF

IF is_open_for = "AUDIT" THEN
	//cb_new.Visible = False
ELSEIF LeftA(is_open_for, 7 ) = "REPORTS" THEN //includes REPORTS1
	li_facility = Integer( MidA( is_open_for , 8, 10 ) )
	dw_org_facility_select.SetItem( 1, "facility_id", li_facility )	
	is_open_for = "REPORTS"
	dw_view.Visible = False
	cb_view_help.Visible = False //Start Code Change ----06.18.2014 #V14.2 maha 
	gb_view.Visible = False
	dw_view.Object.data_view_id.Background.Color= String( RGB(192,192,192))		
	//dw_org_facility_select.Enabled = False
	//dw_org_facility_select.Object.facility_id.Background.Color= String( RGB(192,192,192))
ELSEIF LeftA( is_open_for, 10 ) = "INTELLIAPP" THEN //used when selecting providers for app printing
	li_facility = Integer( MidA( is_open_for , 11, 10 ) )
	//if open from the dash board then facility id will be 999.  Set facility to 0 =all
	IF li_facility = 999 THEN
		lb_from_dash = True
		li_facility = 0
		dw_org_facility_select.SetItem( 1, "facility_id", li_facility ) //maha moved here 020805 to allow user default facility
	END IF
	//dw_org_facility_select.SetItem( 1, "facility_id", li_facility )	
	is_open_for = "INTELLIAPP"
	//dw_search.DataObject = "d_extended_search_list_intelliapp" //removed maha 093005 set in of_search
	//dw_search.SetTransObject( SQLCA )
	dw_view.Visible = False
	cb_view_help.Visible = False //Start Code Change ----06.18.2014 #V14.2 maha 
	gb_view.Visible = False
	cb_loc.visible = true //Start Code Change ----04.25.2014 #V14.2 maha
	dw_view.Object.data_view_id.Background.Color= String( RGB(192,192,192))	
	ddlb_search_type.Text = "Apps Needing Printing" ////Start Code Change ----09.03.2009 #V92 maha - changed from "...Printed"
	IF lb_from_dash THEN
		cb_search.Event Clicked()
		of_select_all(  )
		cb_select.Event Clicked( )
		Return 1
	END IF
ELSEIF is_open_for = "DELETE" THEN
	is_open_for = "DELETE"
	cbx_status.Checked = False
	cbx_status.Enabled = False
elseif is_open_for = "ACTIONITEMS" or is_open_for = 'MEETINGS' or is_open_for = "PRIVILEGE" or  is_open_for = "SURVEY" then //02.25.2011 By Evan
	//cb_new.Visible = False
	dw_view.Visible = False //Start Code Change ----03.18.2013 #V12 maha
	cb_view_help.Visible = False //Start Code Change ----06.18.2014 #V14.2 maha 
	gb_view.Visible = False
//Start Code Change ----04.15.2014 #V14.2 maha - added type for application location search
elseif is_open_for = 'MEETINGS*LOC' then
	dw_view.Visible = False //Start Code Change ----03.18.2013 #V12 maha
	gb_view.Visible = False
	cb_view_help.Visible = False //Start Code Change ----06.18.2014 #V14.2 maha 
	cb_loc.visible = true
	is_open_for = 'MEETINGS'
//End Code Change ----04.15.2014
ELSEIF is_open_for = "PROFILE" THEN //Start Code Change ----09.11.2009 #V92 maha - for profiles screen(QA)
	li_facility = integer(gnv_data.of_getitem('security_users','default_search_facility',"upper(user_id)='"+upper(gs_user_id) + "'"))
	IF Not IsNull( li_facility ) THEN
		dw_org_facility_select.SetItem( 1, "facility_id", li_facility )
	END IF
ELSEIF LeftA(is_open_for, 7 ) = "ADDRESS" THEN//For batch add address  Added by Nova 03.26.2009
	is_open_for = "ADDRESS"
	dw_view.Visible = False
	cb_view_help.Visible = False //Start Code Change ----06.18.2014 #V14.2 maha 
	gb_view.Visible = False
	dw_view.Object.data_view_id.Background.Color= String( RGB(192,192,192))	
//ELSEIF  is_open_for = "SKF"  or is_open_for = "SKF" THEN
ELSEIF  is_open_for = "SKF"  or is_open_for = "SKS" or is_open_for = "SKL" THEN	//SK Practitioner Folder - alfee 09.03.2010	//maha added slk
	dw_view.Visible = False
	cb_view_help.Visible = False //Start Code Change ----06.18.2014 #V14.2 maha 
	gb_view.Visible = False
END IF
//End Code Change ----07.25.2011

//is_original_sql = dw_search.Object.DataWindow.Table.Select
//------Begin Modified by alfee 09.03.2010 ------------
//SK Practitioner Folder
IF is_open_for <> "SKF"  and is_open_for <> "SKS"  and is_open_for <> "SKL" THEN //mahaadded SKL
	gl_prac_id = 0
	gl_facility_id = 0
END IF
//gl_prac_id = 0
//gl_facility_id = 0
//------End Modified -------------------------------------

dw_search.SetFocus()
//debugbreak()
IF gb_se_version THEN
	of_se( )
END IF


Return 0
end function

public function integer of_set_parent (w_prac_data_1 aw_win);iw_prac_folder = aw_win

Return 0
end function

public function integer of_set_transaction (n_tr as_trans);SQLCA_1 = CREATE n_tr;

Integer i

//SELECT data_view.data_view_id
//Into: dd
//FROM data_view  
//WHERE data_view.data_view_id = 1
//using sqlca_1;
//
//IF SQLCA.SQLCODE = -1 THEN
//	messagebox("", sqlca_1.sqlerrtext)
//END IF

SQLCA_1 = as_trans

dw_view.of_SetTransObject( sqlca_1 )
dw_view.of_SetUpdateAble( False )
//dw_view.InsertRow( 0 )//commented by Nova 10.23.2009
if dw_view.rowcount() < 1 then dw_view.InsertRow( 0 ) //alfee 11.24.2009

DatawindowChild dwchild
dw_view.GetChild( "data_view_id", dwchild )
dwchild.SetTransObject( sqlca_1 )
//--------------------------- APPEON BEGIN ---------------------------
//$<ID> PT-04
//$<modify> 01.24.2006 By: Cao YongWang
//$<reason> Write script to retrieve data from a cache instead of from the database.
//dwchild.Retrieve( gs_user_id )
If not isvalid(ids_views) Then of_init_dddw()
dwchild.reset()
ids_views.rowscopy(1,ids_views.rowcount(),Primary!,dwchild,1,primary!)
//---------------------------- APPEON END ----------------------------

if ii_user_view > 0 then //maha 052104
	dw_view.SetItem( 1, "data_view_id", ii_user_view )
else
	dw_view.SetItem( 1, "data_view_id", 1 )
end if
dw_view.SetRow( 1 )
dw_view.ScrollToRow( 1 )

dw_org_facility_select.SetTransObject( sqlca_1 )
//dw_org_facility_select.InsertRow( 0 )//commented by Nova 10.23.2009
if dw_org_facility_select.rowcount() < 1 then dw_org_facility_select.InsertRow( 0 ) //alfee 11.24.2009

dw_org_facility_select.GetChild( "facility_id", dwchild )
dwchild.SetTransObject( SQLCA_1 )
//--------------------------- APPEON BEGIN ---------------------------
//$<ID> PT-05
//$<modify> 01.24.2006 By: Cao YongWang
//$<reason> Performance tuning
//$<reason> Write script to retrieve data from a cache instead of from the database.
//dwchild.Retrieve( gs_user_id )
dwchild.reset()
ids_facilitys.rowscopy(1,ids_facilitys.rowcount(),primary!, dwchild,1,primary!)
//---------------------------- APPEON END ----------------------------
dwchild.InsertRow(1)
dwchild.SetItem( 1, "facility_name", "All" )
dwchild.SetItem( 1, "facility_id", 0 )

dw_org_facility_select.SetItem( 1, "facility_id", 0 )

Integer li_facility_id
Integer li_find
String ls_facility_name

//--------------------------- APPEON BEGIN ---------------------------
//$<ID> PT-06
//$<modify> 01.24.2006 By: Cao YongWang
//$<reason> Performance tuning
//$<reason> Write script to retrieve data from a cache instead of from the database.
//SELECT security_users.default_search_facility  
//INTO :li_facility_id  
//FROM security_users  
//WHERE security_users.user_id = :gs_user_id;
li_facility_id = integer(gnv_data.of_getitem('security_users','default_search_facility',"upper(user_id)='"+upper(gs_user_id) + "'"))
//---------------------------- APPEON END ----------------------------


IF Not IsNull( li_facility_id ) THEN
	dw_org_facility_select.SetItem( 1, "facility_id", li_facility_id )
END IF

//dw_org_facility_select.GetChild( "facility_id", dwchild )
//
//li_find = dwchild.Find( "facility_id = " + String( li_facility_id ), 1, 100 )
//ls_facility_name = dwchild.GetItemString( li_find, "facility_name" )
//dw_org_facility_select.SetText( ls_facility_name ) 
//

// mskinner 15 Dec 2005 -- begin
// if there are less then 50 we retrieve the dw_search the problem is that there is no check box untill
// seach is clicked

IF UPPER(PARENT.CLASSNAME()) <> 'W_EXTENDED_SEARCH_NEW' THEN
	IF gi_auto_search = 1 THEN
		//cb_search.TriggerEvent( Clicked! )
		cb_search.postevent( Clicked!)	//long.zhang 09.22.2011 Department Secuirty and Profile Module - Bug id 2658
	END IF
END IF 

// mskinner 15 Dec 2005 -- end

	

Return 1
end function

public function integer of_open_from_dash ();cb_search.Event Clicked( )

Return 1

end function

public function integer of_select_all ();Integer i
Integer li_rc

li_rc = dw_search.RowCount()

FOR i = 1 TO li_rc
	IF is_select = "S" THEN
		dw_search.SetItem( i, "rec_id", 1 )
	ELSE
		dw_search.SetItem( i, "rec_id", 0 )
	END IF
END FOR
	
IF is_select = "S" THEN
	is_select = "U"
ELSE
	is_select = "S"
END IF

//IF is_open_for = "INTELLIAPP" THEN
//	MessageBox("Select", "You must check of the select box and then click the Select button to select practitioners.")
//	Return 0
//END IF

Return 0
end function

public function integer of_se ();gb_facility.Visible = False
dw_org_facility_select.Visible = False
dw_view.Visible = False
gb_view.Visible = False

gb_search.y =  26
ddlb_search_type.y = 90
cb_search.y = 90
sle_srch_val.y =  195
cbx_status.y =  290

//gb_search.y = gb_search.y - 1130
//cbx_status.y = cbx_status.y - 1125
//sle_srch_val.y = sle_srch_val.y - 1125
//cb_search.y = cb_search.y - 1125
//ddlb_search_type.y = ddlb_search_type.y - 1125


Return 1
end function

public function integer of_hide_ssn ();//function added maha app102405 called from search button and of_search()

integer i

i = of_get_app_setting("set_42","I")

if i = 1 then
	dw_search.modify("ssn.visible = false")
	dw_search.modify("date_of_birth.visible = false")
elseif i = 2 then
	dw_search.modify("ssn.visible = false")
end if


return 1



end function

public function integer of_search_old (string letter);//created maha 112205 as a backup to original code not used in program

String ls_sql
String ls_depart_sql
Integer li_rc
Integer i
DataWindowChild dwchild
String ls_all_facilities

ls_depart_sql = ""

dw_search.SetRedraw( False )

IF is_open_for = "INTELLIAPP" THEN
	dw_search.DataObject = "d_extended_search_list_intelliapp"			
elseIF is_open_for = "REPORTS" THEN //maha 091605
	dw_search.DataObject = "d_extended_search_list_multi"	
ELSE
	dw_search.DataObject = "d_extended_search_list"	
END IF

letter = Upper(letter)

//Start Code Change ---- 01.13.2006 #196 maha
if of_search_trap( ddlb_search_type.Text, sle_srch_val.Text) = -1 then return -1
 
if of_get_app_setting("set_37","I") = 1 and li_num_of_departments_user_has_rights_to = 0 then
	messagebox("Department Security", "Your user_id has no rights to any departments.  You will not be able to view practitioner data.")
	return -1
end if
//End Code Change---01.13.2005
IF li_num_of_departments_user_has_rights_to <> li_num_of_departments THEN
	dw_department.GetChild( "department", dwchild )
	li_rc = dwchild.RowCount()
	ls_depart_sql = "("
	//start with 2 because 0 = all
	FOR i = 2 TO li_rc
		ls_depart_sql = ls_depart_sql + String( dwchild.GetItemNumber( i, "lookup_code" ) ) + ","
	END FOR
	ls_depart_sql = MidA( ls_depart_sql, 1, LenA( ls_depart_sql ) -1 )
	ls_depart_sql = ls_depart_sql + ")"
END IF

sle_srch_val.Text = letter
//JAD 1/5/2001  need to keep apps needing printing where clause attached
IF ddlb_search_type.Text <> "Apps Needing Printed" OR is_open_for <> "INTELLIAPP" THEN
	ddlb_search_type.Text = "Last Name"
	dw_dept.visible = false
END IF

il_facility_id = dw_org_facility_select.GetItemNumber( 1, "facility_id" )


ls_sql =   "SELECT DISTINCT pd_basic.first_name, "+&   
         "pd_basic.middle_name,"+&      
         "pd_basic.title,"+&      
         "pd_basic.name_suffix,"+&      
         "pd_basic.prof_suffix,"+&      
         "pd_basic.ssn,"+&      
         "pd_basic.sex,"+&      
         "pd_basic.prac_category,"+&      
         "pd_basic.date_of_birth,"+&      
         "pd_basic.rec_id,"+&      
         "pd_basic.prac_id,"+&      
         "pd_affil_stat.parent_facility_id,"+&      
         "facility.facility_name,"+&      
         "facility.default_data_view_id,"+&      
         "pd_basic.last_name,"+&      
         "code_lookup.code "
    	IF is_open_for = "INTELLIAPP" THEN
//			IF ddlb_search_type.Text = "Apps Needing Printed" THEN //maha attempting to remove duplicates
          ls_sql = ls_sql + ",net_dev_action_items.action_type,"+&      
         "net_dev_action_items.app_id,"+&      	    
         "net_dev_action_items.action_status " +&
	   	"FROM {oj pd_basic  LEFT OUTER JOIN code_lookup  ON pd_basic.name_suffix = code_lookup.lookup_code}, "+&
	   	"{oj pd_affil_stat  LEFT OUTER JOIN net_dev_action_items  ON pd_affil_stat.parent_facility_id =  "+&
	  		"net_dev_action_items.facility_id AND pd_affil_stat.prac_id = net_dev_action_items.prac_id}, "+&      
     	   "facility "+&     
	  		"WHERE ( pd_basic.prac_id = pd_affil_stat.prac_id ) and "+&     
     	   "( pd_affil_stat.parent_facility_id = facility.facility_id ) "
//			else
//	   	ls_sql = ls_sql + "FROM {oj pd_basic  LEFT OUTER JOIN code_lookup  ON pd_basic.name_suffix = code_lookup.lookup_code}, "+&
//	   	"{oj pd_affil_stat  LEFT OUTER JOIN net_dev_action_items  ON pd_affil_stat.parent_facility_id =  "+&
//	  		"net_dev_action_items.facility_id AND pd_affil_stat.prac_id = net_dev_action_items.prac_id}, "+&      
//     	   "facility "+&     
//	  		"WHERE ( pd_basic.prac_id = pd_affil_stat.prac_id ) and "+&     
//     	   "( pd_affil_stat.parent_facility_id = facility.facility_id ) "
//			end if
	ELSE
		ls_sql = ls_sql + ",pd_affil_stat.date_app_audit_completed," +&   
      "pd_affil_stat.date_data_entry_completed," +&
	   "pd_affil_stat.date_verif_completed," +&  
     	"pd_affil_stat.apptmnt_start_date, " +&  
     	"pd_affil_stat.active_status "
	
		if is_open_for = "REPORTS" then
			ls_sql = ls_sql + ", selected = 0,  v_full_name.full_name "
		end if
		  		
     	ls_sql = ls_sql +  "FROM {oj pd_basic  LEFT OUTER JOIN code_lookup  ON pd_basic.name_suffix = code_lookup.lookup_code}, "+&
     	"facility, "+&   
		"pd_affil_stat "
		
		//if one department is selected or if all departments are selected and the number of departments the users
		//has rights to is less then the number of departments in lookup table then do this
		//if the number of departments in lookup are the same as the number of departments the user has rights to
		//then the department security is turned off or they have rights to all departments so do nothing
		if il_dept > 0 OR ( il_dept = 0 AND li_num_of_departments <> li_num_of_departments_user_has_rights_to ) then //maha 121002
			ls_sql = ls_sql + ", pd_affil_dept "
		end if
		
     	ls_sql = ls_sql +  "WHERE ( pd_basic.prac_id = pd_affil_stat.prac_id ) and "+&     
     		 "( pd_affil_stat.parent_facility_id = facility.facility_id ) "
		
		//if only 1 department is selected then do a regular where clause
		if il_dept > 0 then //maha 121002
			ls_sql = ls_sql + "and ( pd_affil_stat.rec_id = pd_affil_dept.rec_id ) and "+& 
			"( pd_affil_dept.primary_dept = 1 ) "
			ls_sql = ls_sql + " AND (pd_affil_dept.department = " + string(il_dept) + ")"
		//if ALL is selected and number of departments in lookup is not = to number of depart user has
		//rights to then department security is turned on so do this.
		elseif il_dept = 0 AND li_num_of_departments <> li_num_of_departments_user_has_rights_to THEN
				ls_sql = ls_sql + " and ( pd_affil_stat.rec_id = pd_affil_dept.rec_id ) and "+& 
			"( pd_affil_dept.primary_dept = 1 ) "
			//if il_dept > 0 then 
				ls_sql = ls_sql + " AND (pd_affil_dept.department in " + ls_depart_sql + ")"			
		end if
	END IF	    

//JAD 1/5/2001  when in intelliapp printing just want to show apps that need printing
IF is_open_for = "INTELLIAPP" THEN
	long anp 
	long ll_i
	long ll_c
	select lookup_code into :anp from code_lookup where code = 'App Out To MD';		
	select lookup_code into :ll_i from code_lookup where lookup_name = 'Action Status' and code = 'Incomplete';	
	select lookup_code into :ll_c from code_lookup where lookup_name = 'Action Status' and code = 'Complete';
	IF ddlb_search_type.Text = "Apps Needing Printed" THEN
		//\/maha 032002 replacing hard coded numbers
		ls_sql = ls_sql + "AND action_type = " + string(anp) + " AND action_status = " + string(ll_i)
		//ls_sql = ls_sql + "AND action_type = -3 AND action_status = -110"  //org
	else
		//ls_sql = ls_sql + " AND action_status not in(" + string(ll_i) + "," +string(ll_c) + ")"
	end if
end if



IF il_facility_id <> 0 THEN
	ls_sql = ls_sql + " AND pd_affil_stat.parent_facility_id = " + String( il_facility_id )
ELSE
	dw_org_facility_select.GetChild( "facility_id", dwchild )
	FOR i = 1 TO dwchild.RowCount()
		ls_all_facilities = ls_all_facilities + String( dwchild.GetItemNumber( i, "facility_id" ) ) + ","
	END FOR
	ls_all_facilities = MidA( ls_all_facilities , 1 , LenA( ls_all_facilities ) -1 )
	ls_sql = ls_sql + " AND pd_affil_stat.parent_facility_id in (" + ls_all_facilities + ")"	
END IF

IF is_open_for <> "DELETE" THEN
	IF cbx_status.Checked = True THEN
		ls_sql = ls_sql + " AND (pd_affil_stat.active_status = 1 OR pd_affil_stat.active_status = 3 OR pd_affil_stat.active_status = 4)"  
	ELSE
		ls_sql = ls_sql + " AND (pd_affil_stat.active_status = 1 OR pd_affil_stat.active_status = 4 or pd_affil_stat.active_status = 5)"
	END IF
END IF

IF is_open_for = "DELETE" THEN
	ls_sql = ls_sql + " AND pd_affil_stat.active_status = 2 " 
END IF

ls_sql = ls_sql + " AND {fn left(pd_basic.last_name,1 )} = '" + letter + "'"

ls_sql = ls_sql + " ORDER BY pd_basic.last_name ASC"   



//clipboard(ls_sql)

dw_search.SetSQLSelect ( ls_sql )
dw_search.SetTransObject( SQLCA_1 )
li_rc = dw_search.Retrieve( )

FOR i = 1 TO li_rc
	dw_search.SetItem( i, "rec_id", 0 )
END FOR


dw_search.SetRedraw( True )
IF dw_search.RowCount() > 0 THEN
	dw_search.SelectRow( 0, False )
	dw_search.SelectRow( 1, True )
END IF

of_hide_ssn() //maha app102405


Return 0
end function

public function integer of_search (string as_letter);//Start Code Change ---- 11.22.2005 #105 maha
//modified maha 112205 so search code could be combined.  Original of_search is in of_search_old.

string ls_letter

ls_letter = upper(as_letter)

sle_srch_val.text = ls_letter

IF ddlb_search_type.Text <> "Apps Needing Printed" OR is_open_for <> "INTELLIAPP" THEN
	ddlb_search_type.Text = "Last Name"
	dw_dept.visible = false
END IF

of_search_new(ls_letter)
	
return 0
//End Code Change---11.22.2005 
end function

public function integer of_search_new (string as_letter);
//Start Code Change ---- 11.22.2005 #106 maha
//maha created 112205 to combine two separate search codes into 1

String ls_fld
String ls_sql
String ls_ssn
String ls_name
String ls_depart_sql
string ls_prac_list
string ls_search_type  //maha 100208
string ls_status		//maha 022310
Integer li_name_len
long li_Rc
Integer li_val_len
Integer i
integer li_standing //maha 02.01.2011
String ls_all_facilities
Long ll_action_type
Long ll_action_status
long fp //maha 022610
DataWindowChild dwchild
Long ll_ctx_id //(Appeon)Harry 08.13.2014 - BugS072201
String ls_contract_name //(Appeon)Harry 08.13.2014 - BugS072201

ls_status = ddlb_status.text //Start Code Change ----02.23.2010 #V10 maha
is_status = ls_status //long.zhang 04.06.2012
ls_search_type = ddlb_search_type.Text //moved from below

//Start Code Change ----02.26.2010 #V10 maha - added for auto refresh bypass of Custom Search
If as_letter = "Refresh" then
	if ls_search_type = "Custom Search" or ls_search_type = "Batch Search" or dw_search.rowcount() = 0 then //Start Code Change ----02.26.2010 #V10 maha -  added trap for unsearched
		return 0 
	end if
end if
//End Code Change---02.26.2010

//Start Code Change ----01.16.2014 #V14 maha
if cbx_valid.checked and cbx_valid.visible then
	choose case ddlb_search_type.Text
		case "Address - Tax Id", "NPI #" , "SS #"
			if of_validate( ddlb_search_type.Text, sle_srch_val.Text) = -1 then return -1
	end choose
end if


//Start Code Change ---- 01.13.2006 #196 maha
if of_search_trap( ddlb_search_type.Text, sle_srch_val.Text) = -1 then return -1
 
if of_get_app_setting("set_37","I") = 1 and li_num_of_departments_user_has_rights_to = 0 then
	messagebox("Department Security", "Your user_id has no rights to any departments.  You will not be able to view practitioner data.")
	return -1
end if
//End Code Change---01.13.2005


IF li_num_of_departments_user_has_rights_to <> li_num_of_departments THEN
	dw_department.GetChild( "department", dwchild )
	li_rc = dwchild.RowCount()
	ls_depart_sql = "("
	//start with 2 because 0 = all
	FOR i = 2 TO li_rc
		ls_depart_sql = ls_depart_sql + String( dwchild.GetItemNumber( i, "lookup_code" ) ) + ","
	END FOR
	ls_depart_sql = MidA( ls_depart_sql, 1, LenA( ls_depart_sql ) -1 )
	ls_depart_sql = ls_depart_sql + ")"
END IF


//messagebox("",is_open_for)
 IF is_open_for = "INTELLIAPP" THEN
	dw_search.DataObject = "d_extended_search_list_intelliapp"
elseif is_open_for = "REPORTS"  or is_open_for = "ADDRESS" THEN//For batch add address  Added by Nova 03.26.2009
	dw_search.DataObject = "d_extended_search_list_multi"
elseif  is_open_for = "SKS"  or is_open_for = "SKF" or is_open_for = "SKL" THEN //maha added SKL 12.13.10
	dw_search.DataObject = "d_extended_search_sk"
elseif  is_open_for = "WV"  THEN //maha added WV 2011.08.24
	dw_search.DataObject = "d_extended_search_list_wv"
ELSE
	 //Start Code Change ----07.30.2010 #V10 maha - change object for app
	IF gs_cust_type = "I" THEN	
		dw_search.DataObject = "d_extended_search_list_app"
	else
		dw_search.DataObject = "d_extended_search_list"	
	end if
	 //End Code Change ----07.30.2010
END IF

//Start Code Change ----10.02.2008 #V85 maha - added batch search; added variable; changed to case 
//ls_search_type = ddlb_search_type.Text 

if as_letter = "BAT1" then ls_search_type = "BAT1"
if as_letter = "BAT2" then ls_search_type = "BAT2"

Choose case ls_search_type
	Case	"Prac ID"   //Start Code Change ----01.28.2013 #V12 maha - changed from I.D.
	//case "I.D."
		ls_fld = "prac_id"
	case  "Last Name" 
		ls_fld = "last_name"
	case "SS #" 
		ls_fld = "ssn"
	case "Provider ID" 
		ls_fld = "provider_id"
	case "Apps Needing Printing" 
		ls_fld = "Apps Needing Printing"
		dw_search.DataObject = "d_extended_search_list_intelliapp"
	case "Primary Department" 
		ls_fld = "Primary Department"
	case "Custom Search"
		ls_fld = "Custom Search"
		open(w_search_query)
		//open(w_custom_search)
		ls_prac_list = message.stringparm
		if ls_prac_list = "Cancel" then return -1
	case "Address - Street 1" 
		ls_fld = "street"
	case "Address - Street 2" 
		ls_fld = "street_2"
	case "Address - Tax Id"
		ls_fld = "tax_id"
	case "NPI #" 
		ls_fld = "npi_number"
	case "BAT1"
		ls_fld = "BAT1"
		ls_prac_list = of_get_batch( 1)
		if ls_prac_list = "Cancel" or ls_prac_list = "" then return -1 ////Start Code Change ----09.09.2011 #V12 maha - added trap for empty string
	case "BAT2"
		ls_fld = "BAT2"
		ls_prac_list = of_get_batch( 2)
		if ls_prac_list = "Cancel" or ls_prac_list = "" then return -1
	case	"Standing/Flag"  //Start Code Change ----02.01.2011 #V11 maha 
		ls_fld = "in_good_standing"
		open(w_standing_search_select)
		if message.stringparm = "Cancel" then 
			return -1
		else
			li_standing = message.doubleparm
		end if
	case  "WebView Tracking (name)" //Start Code Change ----08.25.2011 #V11 maha 
		ls_fld = "last_name"
		dw_search.DataObject = "d_extended_search_list_wv"
	case "Professional Suffix"  //Start Code Change ----12.04.2012 #V12 maha
		ls_fld = "Professional Suffix"
	case "Assigned User"		//Start Code Change ----12.13.2012 #V12 maha
		ls_fld = "Assigned User"	
	case "Contract" //(Appeon)Harry 08.13.2014 - BugS072201
		ls_fld = "Contract"
		Openwithparm(w_mastert_contract_search,'ALL')
		ls_contract_name = message.stringparm  
		ll_ctx_id = long(mid(ls_contract_name,1,pos(ls_contract_name,'-') - 1))  
		if ll_ctx_id <= 0 then return -1
END Choose



li_val_len = LenA(sle_srch_val.Text)


il_facility_id = dw_org_facility_select.GetItemNumber( 1, "facility_id" )

//Note: if adding additional fields to the data object, the new field(s) must be added to the following ls_sql set
//Also each of the dw objects must have the new fields added in the same order in the select statement before the adds below
//Start Code Change ---- 10.31.2007 #V7 maha	 added provider_id
ls_sql =   "SELECT DISTINCT pd_basic.first_name, "+&   
         "pd_basic.middle_name,"+&      
         "pd_basic.title,"+&      
         "pd_basic.name_suffix,"+&      
         "pd_basic.prof_suffix,"+&      
         "pd_basic.ssn,"+&      
         "pd_basic.sex,"+&      
         "pd_basic.prac_category,"+&      
         "pd_basic.date_of_birth,"+&      
         "pd_basic.rec_id,"+&      
         "pd_basic.prac_id,"+& 
         "pd_affil_stat.parent_facility_id,"+&      
         "facility.facility_name,"+&      
         "facility.default_data_view_id,"+&      
         "pd_basic.last_name,"+&  
	      "code_lookup_a.code,"+&   
         "code_lookup_b.code prof_code,"+&
	"pd_basic.provider_id, " +&
	"pd_basic.npi_number "
IF is_open_for = "INTELLIAPP"  or ls_fld = "Apps Needing Printing" THEN
   // 	IF ls_fld = "Apps Needing Printed" THEN
	//add "net_dev_action_items.action_status " +& Michael 11.08.2011 Fixed Bug#2772:Problem with saving printed apps to database 
          ls_sql = ls_sql + ",net_dev_action_items.action_type,"+&      
         "net_dev_action_items.app_id,"+& 
			"net_dev_action_items.rec_id,"+& 
         "net_dev_action_items.action_status, net_dev_action_items.gp_id " +&
	   "FROM {oj pd_basic  LEFT OUTER JOIN code_lookup code_lookup_a  ON pd_basic.name_suffix = code_lookup_a.lookup_code " + & 
		"LEFT OUTER JOIN code_lookup code_lookup_b  ON pd_basic.prof_suffix = code_lookup_b.lookup_code}, "+&
	    "{oj pd_affil_stat  LEFT OUTER JOIN net_dev_action_items  ON pd_affil_stat.parent_facility_id =  "+&
	    "net_dev_action_items.facility_id AND pd_affil_stat.prac_id = net_dev_action_items.prac_id}, "+&      
     	    "facility "
				
		//if one department is selected or if all departments are selected and the number of departments the users
		//has rights to is less then the number of departments in lookup table then do this
		//if the number of departments in lookup are the same as the number of departments the user has rights to
		//then the department security is turned off or they have rights to all departments so do nothing
		if il_dept > 0 OR ( il_dept = 0 AND li_num_of_departments <> li_num_of_departments_user_has_rights_to ) then //maha 121002
			ls_sql = ls_sql + ", pd_affil_dept "
		end if
		
     	ls_sql = ls_sql +  "WHERE ( pd_basic.prac_id = pd_affil_stat.prac_id ) and "+&     
     		 "( pd_affil_stat.parent_facility_id = facility.facility_id ) "
		
		//if only 1 department is selected then do a regular where clause
		if il_dept > 0 then //maha 121002
			ls_sql = ls_sql + "and ( pd_affil_stat.rec_id = pd_affil_dept.rec_id ) " //and "//+& 
			//"( pd_affil_dept.primary_dept = 1 ) "
			ls_sql = ls_sql + " AND (pd_affil_dept.department = " + string(il_dept) + ")"
		//if ALL is selected and number of departments in lookup is not = to number of depart user has
		//rights to then department security is turned on so do this.
		elseif il_dept = 0 AND li_num_of_departments <> li_num_of_departments_user_has_rights_to THEN
				ls_sql = ls_sql + " and ( pd_affil_stat.rec_id = pd_affil_dept.rec_id ) " //and "//+& 
		//"( pd_affil_dept.primary_dept = 1 ) " //Start Code Change ----09.04.2009 #V92 maha - removed primary requirement for search
			//if il_dept > 0 then 
				ls_sql = ls_sql + " AND (pd_affil_dept.department in " + ls_depart_sql + ")"			
		end if
ELSE
		//------------------- APPEON BEGIN -------------------
		//$<modify> Michael 08.10.2011
		//$<reason>IntelliApp Practitioner Data Search error
		/*ls_sql = ls_sql + ",pd_affil_stat.date_app_audit_completed," +&   
      "pd_affil_stat.date_data_entry_completed," +&
	   "pd_affil_stat.date_verif_completed," +&  
     	"pd_affil_stat.apptmnt_start_date, " +& 
		"pd_affil_stat.active_status,  "  +&
		"pd_affil_stat.apptmnt_type, " +&
		"pd_affil_stat.apptmnt_end_date,"  +&      
		"pd_affil_stat.in_good_standing , standing_lookup.flag_type "//Start Code Change ----09.11.2009 #V92 maha - added field to search
		*/
		if dw_search.DataObject = "d_extended_search_list_app" then //added rec_id for bugA121701 - alfee 12.17.2014
			ls_sql = ls_sql + ",pd_affil_stat.date_app_audit_completed," +&   
			"pd_affil_stat.date_data_entry_completed," +&
			"pd_affil_stat.date_verif_completed," +&  
			"pd_affil_stat.apptmnt_start_date, " +& 
			"pd_affil_stat.active_status,  "  +&
			"pd_affil_stat.rec_id,  "  +&	
			 "pd_affil_stat.apptmnt_type,  "  +&
			 "pd_affil_stat.in_good_standing,  "  +&
			"pd_affil_stat.apptmnt_start_date,  "  +&
			"pd_affil_stat.apptmnt_end_date,  "  +&
			"standing_lookup.flag_type  "
		else	
			ls_sql = ls_sql + ",pd_affil_stat.date_app_audit_completed," +&   
			"pd_affil_stat.date_data_entry_completed," +&
			"pd_affil_stat.date_verif_completed," +&  
			"pd_affil_stat.apptmnt_start_date, " +& 
			"pd_affil_stat.active_status,  "  +&
			"pd_affil_stat.rec_id,  "  +&
			"pd_affil_stat.apptmnt_type, " +&
			"pd_affil_stat.apptmnt_end_date,"  +&      
			"pd_affil_stat.in_good_standing , standing_lookup.flag_type "//Start Code Change ----09.11.2009 #V92 maha - added field to search
			//Start Code Change ----12.08.2014 #V14.2 maha - rec_id field to query
		end if	
		//------------------- APPEON BEGIN -------------------
		
		If dw_search.DataObject = "d_extended_search_list_wv" then //Start Code Change ----08.24.2011 #V11 maha 
			ls_sql = ls_sql + ", wv_prac_tracking.de_compl,  " +&    
         " wv_prac_tracking.document_compl,"   +&    
         "wv_prac_tracking.attest_compl,  " +&    
         "wv_prac_tracking.priv_compl,"   +&    
        " wv_prac_tracking.agree_compl,"   +&    
       "  wv_prac_tracking.final_compl "
		End If
		
		//Start Code Change ----08.02.2011 #V11 maha  - appt start and end dates added
		if dw_search.DataObject = "d_extended_search_list_multi" then //maha added 091605 not used
			ls_sql += "  , selected = 0,  v_full_name.full_name  "
		end if
		
		//--------------------------- APPEON BEGIN ---------------------------
		//$<modify> 10.11.2006 By: Jack (Inova)
		//$<reason> Add ability to search on practitioner search screen by Street 1 or Street 2 values.
		/*
	   ls_sql = ls_sql +  "FROM {oj pd_basic  LEFT OUTER JOIN code_lookup  ON pd_basic.name_suffix = code_lookup.lookup_code}, "+&
     	"facility, "+&   
		"pd_affil_stat "
		*/
		
		if ddlb_search_type.Text = "Address - Street 1" or ddlb_search_type.Text = "Address - Street 2"  or ddlb_search_type.Text = "Address - Tax Id" then
     		ls_sql = ls_sql +  "FROM   {oj pd_basic  LEFT OUTER JOIN code_lookup code_lookup_a  ON pd_basic.name_suffix = code_lookup_a.lookup_code "+&
										  "LEFT OUTER JOIN code_lookup code_lookup_b  ON pd_basic.prof_suffix = code_lookup_b.lookup_code "+&
										  "LEFT OUTER JOIN pd_address ON pd_basic.prac_id = pd_address.prac_id}, "+&
										  "{oj pd_affil_stat LEFT OUTER JOIN standing_lookup ON pd_affil_stat.in_good_standing = standing_lookup.lu_id},"+&
										   "facility "
		else
			ls_sql = ls_sql +  "FROM {oj pd_basic  LEFT OUTER JOIN code_lookup code_lookup_a  ON pd_basic.name_suffix = code_lookup_a.lookup_code "+&
															"LEFT OUTER JOIN code_lookup code_lookup_b  ON pd_basic.prof_suffix = code_lookup_b.lookup_code}, "+&
															"{oj pd_affil_stat LEFT OUTER JOIN standing_lookup ON pd_affil_stat.in_good_standing = standing_lookup.lu_id},"+&
										"facility "			
		end if
		//---------------------------- APPEON END ----------------------------
		
		IF dw_search.dataobject = "d_extended_search_list_multi" then  //Start Code Change ----08.25.2011 #V11 maha 
			ls_sql += ", v_full_name "
		end if
			
			
		if dw_search.DataObject = "d_extended_search_list_wv" then  //Start Code Change ----08.25.2011 #V11 maha 
			ls_sql += ", wv_prac_tracking "
		end if
		
		
		//if one department is selected or if all departments are selected and the number of departments the users
		//has rights to is less then the number of departments in lookup table then do this
		//if the number of departments in lookup are the same as the number of departments the user has rights to
		//then the department security is turned off or they have rights to all departments so do nothing
		if il_dept > 0 OR ( il_dept = 0 AND li_num_of_departments <> li_num_of_departments_user_has_rights_to ) then //maha 121002
			ls_sql = ls_sql + ", pd_affil_dept "
		end if
		
     		ls_sql = ls_sql +  "WHERE ( pd_basic.prac_id = pd_affil_stat.prac_id ) and "+&     
     		 "( pd_affil_stat.parent_facility_id = facility.facility_id ) "
		
		//if only 1 department is selected then do a regular where clause
		if il_dept > 0 then //maha 121002
			ls_sql = ls_sql + "and ( pd_affil_stat.rec_id = pd_affil_dept.rec_id ) " //and "  +& 
			//"( pd_affil_dept.primary_dept = 1 ) "
			ls_sql = ls_sql + " AND (pd_affil_dept.department = " + string(il_dept) + ")"
		//if ALL is selected and number of departments in lookup is not = to number of depart user has
		//rights to then department security is turned on so do this.
		elseif il_dept = 0 AND li_num_of_departments <> li_num_of_departments_user_has_rights_to THEN
				ls_sql = ls_sql + " and ( pd_affil_stat.rec_id = pd_affil_dept.rec_id ) " //and "// +& 
			//"( pd_affil_dept.primary_dept = 1 ) "//Start Code Change ----09.04.2009 #V92 maha - removed primary requirement
			//if il_dept > 0 then 
				ls_sql = ls_sql + " AND (pd_affil_dept.department in " + ls_depart_sql + ")"			
		end if
		if dw_search.DataObject = "d_extended_search_list_multi" then
			ls_sql += " and ( v_full_name.prac_id = pd_basic.prac_id ) "
		end if

		if dw_search.DataObject = "d_extended_search_list_wv" then  //Start Code Change ----08.25.2011 #V11 maha 
			ls_sql += " and ( pd_affil_stat.rec_id =  wv_prac_tracking.appt_stat_id  ) "
		end if
		
END IF	

//@@@ filters
 //  "FROM {oj pd_basic  LEFT OUTER JOIN code_lookup  ON pd_basic.name_suffix = code_lookup.lookup_code}, "+&   	    
IF il_facility_id <> 0 THEN
	ls_sql = ls_sql + " AND pd_affil_stat.parent_facility_id = " + String( il_facility_id )
ELSE
	dw_org_facility_select.GetChild( "facility_id", dwchild )
	FOR i = 1 TO dwchild.RowCount()
		ls_all_facilities = ls_all_facilities + String( dwchild.GetItemNumber( i, "facility_id" ) ) + ","
	END FOR
	ls_all_facilities = MidA( ls_all_facilities , 1 , LenA( ls_all_facilities ) -1 ) //gets rid of the extra comma
	ls_sql = ls_sql + " AND pd_affil_stat.parent_facility_id in (" + ls_all_facilities + ")"
END IF

//Start Code Change ---- 12.13.2005 #169 maha  correction for deletes
IF is_open_for = "DELETE" THEN
	ls_sql = ls_sql + " AND pd_affil_stat.active_status = 2 " 
else
//Start Code Change ----02.23.2010 #V10 maha - change to ddlb from checkbox
	choose case ls_status
		case "Active and Pending"
			ls_sql = ls_sql + " AND (pd_affil_stat.active_status in (1,4 )) " 
		case "Include Inactive"
			ls_sql = ls_sql + " AND (pd_affil_stat.active_status in (1,4,3 ))"
		case "Active Only"
			ls_sql = ls_sql + " AND (pd_affil_stat.active_status in (1 ))"
		case "Inactive Only"
			ls_sql = ls_sql + " AND (pd_affil_stat.active_status in (3 ))"
		case "Pending Only"
			ls_sql = ls_sql + " AND (pd_affil_stat.active_status in (4 ))"
		case"Mid-cycle"
			ls_sql = ls_sql + " AND (pd_affil_stat.active_status in (6 ))"
	end choose
	
//	IF cbx_status.Checked = True THEN
//		ls_sql = ls_sql + " AND (pd_affil_stat.active_status = 1 OR pd_affil_stat.active_status = 5 OR pd_affil_stat.active_status = 3 OR pd_affil_stat.active_status = 4 )" 
//	ELSE
//		ls_sql = ls_sql + " AND (pd_affil_stat.active_status = 1 OR pd_affil_stat.active_status = 4 or pd_affil_stat.active_status = 5)" 	
//	END IF
//End Code Change---02.23.2010
END IF
//End Code Change---12.13.2005 

//Start Code Change ----10.29.2009 #V10 maha - filter on lights
if rb_aud.checked  then
	ls_sql = ls_sql + " AND (pd_affil_stat.date_app_audit_completed is Null) "
elseif rb_de.checked  then
	ls_sql = ls_sql + " AND (pd_affil_stat.date_data_entry_completed is Null) "
elseif rb_ver.checked then
	ls_sql = ls_sql + " AND (pd_affil_stat.date_verif_completed is Null) "
elseif rb_appr.checked then
	ls_sql = ls_sql + " AND (pd_affil_stat.apptmnt_start_date is Null) "
end if
//End Code Change---10.29.2009

//WEBVIEW
if dw_search.DataObject = "d_extended_search_list_wv" then  //Start Code Change ----08.25.2011 #V11 maha 
	ls_sql += " and ( pd_affil_stat.apptmnt_start_date is null ) "
end if

//messagebox("",ls_sql)
IF ls_fld = "Custom Search" THEN //maha 100604
		ls_sql = ls_sql + " AND pd_basic.prac_id in (" + ls_prac_list + ")"
//---------Begin Added by (Appeon)Harry 08.13.2014 for BugS072201--------
ELSEIF  ls_fld = "Contract" THEN
	ls_sql = ls_sql + " AND exists (select 1 from ctx_prac_link where ctx_prac_link.prac_id = pd_basic.prac_id and ctx_prac_link.ctx_id = " + string(ll_ctx_id) + ")"
	sle_srch_val.text = String(ll_ctx_id)  //(Appeon)Harry 08.20.2014
//---------End Added ------------------------------------------------------	
ELSEIF ls_fld = "BAT1"  or ls_fld = "BAT2" THEN //Start Code Change ----10.02.2008 #V85 maha
		ls_sql = ls_sql + " AND pd_basic.prac_id in (" + ls_prac_list + ")"
		ddlb_search_type.Text = "Custom Search"  //Start Code Change ----04.21.2010 #V10 maha - trap for refresh function
elseif ls_fld = "in_good_standing" then  //Start Code Change ----02.01.2011 #V11 maha 
	if li_standing = -1 then
		ls_sql = ls_sql + " AND pd_affil_stat.in_good_standing > 0" 
	else
		ls_sql = ls_sql + " AND pd_affil_stat.in_good_standing = " + string(li_standing)
	end if
ELSEIF ls_fld = "Professional Suffix" THEN  //Start Code Change ----12.04.2012 #V12 maha
		ls_sql = ls_sql + " AND ( prof_suffix = "  + string(il_prof) + ") "	
ELSEIF ls_fld = "Assigned User" THEN  //Start Code Change ----12.13.2012 #V12 maha
		ls_sql = ls_sql + " AND ( upper(priority_user) = '"  + upper(sle_srch_val.Text) + "') "			
ELSEIF LenA(sle_srch_val.Text) > 0 OR ls_fld = "Apps Needing Printing" THEN
	IF ls_fld = "prac_id" THEN
		ls_sql = ls_sql + " AND pd_basic.prac_id = " + sle_srch_val.Text
		
	ELSEIF ls_fld = "last_name" THEN
		ls_name = sle_srch_val.Text
		li_name_len = LenA( ls_name )
		FOR i = 1 TO li_name_len
			IF MidA(ls_name, i,1 )  = "'" THEN
				ls_name = MidA(ls_name, 1, i ) + "'" + MidA(ls_name, i+1 , 100 )
				i++
		END IF	
		END FOR
//Start Code Change ----06.08.2010 #V102 maha - correction on ASA 7 DB
	//	ls_sql = ls_sql + " AND {fn left(pd_basic.last_name," + String( li_name_len ) + ")}  = '" + Upper(ls_name) + "'"
		ls_sql = ls_sql + " AND  left(pd_basic.last_name," + String( li_name_len ) + ")  = '" + Upper(ls_name) + "'"
//End Code Change---06.08.2010	
	ELSEIF ls_fld = "ssn" THEN
		ls_ssn = sle_srch_val.Text
		IF PosA( ls_ssn, "-" ) > 0 THEN
		 	ls_ssn = MidA( sle_srch_val.Text, 1, 3 ) + MidA( sle_srch_val.Text, 5, 2 ) + MidA( sle_srch_val.Text, 8, 4 )
		END IF
		ls_sql = ls_sql + " AND pd_basic.ssn = '" + ls_ssn + "'"  //Start Code Change ----08.21.2013 #V14 maha - added table name
	ELSEIF ls_fld = "npi_number" THEN
		ls_ssn = sle_srch_val.Text
		IF PosA( ls_ssn, "-" ) > 0 THEN
		 	ls_ssn = MidA( sle_srch_val.Text, 1, 3 ) + MidA( sle_srch_val.Text, 5, 2 ) + MidA( sle_srch_val.Text, 8, 4 )
		END IF
		ls_sql = ls_sql + " AND pd_basic.npi_number = '" + ls_ssn + "'"   //Start Code Change ----08.21.2013 #V14 maha - added table name for 'reports' searches.
	ELSEIF ls_fld = "provider_id" THEN //maha 081202
		ls_sql = ls_sql + " AND pd_basic.provider_id = '" + sle_srch_val.Text + "'"
	//--------------------------- APPEON BEGIN ---------------------------
	//$<add> 10.11.2006 By: Jack (Inova)
	//$<reason> Add ability to search on practitioner search screen by Street 1 or Street 2 values.
	ELSEIF ls_fld = "street" THEN
		ls_sql = ls_sql + " AND pd_address.street like '" + sle_srch_val.Text + "%'"
	ELSEIF ls_fld = "street_2" THEN
		ls_sql = ls_sql + " AND pd_address.street_2 like '" + sle_srch_val.Text + "%'"
	//---------------------------- APPEON END ----------------------------
	
	//Start Code Change ----12.06.2012 #V12 maha - added additional search types
	ELSEIF ls_fld = "tax_id" THEN
		ls_sql = ls_sql + " AND ( pd_address.tax_id like '" + sle_srch_val.Text + "%') "
	END IF
	//End Code Change ----12.06.2012
	
	IF ls_fld = "Apps Needing Printing" THEN
		//\/maha 032102
		select lookup_code into :ll_action_type from code_lookup where lookup_name = 'Action Type' and code = 'App Out To MD';		
		IF SQLCA.SQLCODE = 100 THEN
				MessageBox("Error", "You need to add 'App Out To MD' to the Action Type lookup table." )
				Return -1
		end if
		select lookup_code into :ll_action_status from code_lookup where lookup_name = 'Action Status' and code = 'Incomplete';
		IF SQLCA.SQLCODE = 100 THEN
				MessageBox("Error", "You will need to add 'Incomplete' to the Action Status lookup table." )
				Return -1
		END IF
		//\maha
		ls_sql = ls_sql + "AND action_type = " + String( ll_action_type ) + " AND action_status = " + string(ll_action_status)  //-3 AND action_status = -110"
		
	END IF
	

	
END IF

		

ls_sql = ls_sql + " ORDER BY pd_basic.last_name ASC"   
//openwithparm (w_sql_msg, ls_sql)
//CLIPBOARD( LS_SQL )
//messagebox("", dw_search.DataObject )
IF NOT IsValid(SQLCA_1) THEN SQLCA_1 = SQLCA //add a trap for a system error issue - alfee 06.18.2010
dw_search.SetTransObject( SQLCA_1 )

dw_search.SetSQLSelect ( ls_sql )
li_rc = dw_search.Retrieve( )

if li_rc < 0 then
	openwithparm (w_sql_msg, ls_sql)
end if

IF is_open_for = "INTELLIAPP" THEN	//2007.07.27 By Jervis Fix Web performance Bug
	FOR i = 1 TO li_rc
		dw_search.SetItem( i, "rec_id", 0 )
	END FOR
end if

//Start Code Change ----02.26.2010 #V10 maha - added for auto refresh functionality
if as_letter = "Refresh" then
	fp = dw_search.find("prac_id = " + string(gl_prac_id), 1,li_rc ) 
	if fp> 0 then
		dw_search.setrow(fp)
		dw_search.scrolltorow(fp)
		dw_search.selectrow(0,false)
		dw_search.selectrow(fp,true)
	end if
end if
//End Code Change---02.26.2010	

of_hide_ssn()


sle_srch_val.SetFocus()			//Modified By Scofield on 2008-03-07

return 0


end function

public function integer of_search_trap (string as_type, string as_val);//Start Code Change ---- 01.12.2006 #194 maha
//function created 011306 to trap for search value called from of_search_new()

choose case as_type
	case "Prac ID", "SS #"//(Appeon)Toney 11.14.2013 - V141 ISG-CLX,fix BugT110703,changed "I.D." to "Prac ID"
		if not isnumber(as_val) then
			Messagebox( "Search error","The search value must be a number for the search type " + as_type)
			return -1
		end if
	case else
		return 1
end choose
		
return 1
//End Code Change---01.12.2005 
end function

public subroutine of_init_dddw ();//////////////////////////////////////////////////////////////////////
// $<function>pfc_cst_u_extended_searchof_init_dddw()
// $<arguments>
//		value	integer		
// $<returns> integer
// $<description>
// $<description>
//////////////////////////////////////////////////////////////////////
// $<add> 02.08.2006 by Cao YongWang
//////////////////////////////////////////////////////////////////////
//--------------------------- APPEON BEGIN ---------------------------
//$<ID> PT-07
//$<reason> Performance tuning
//$<reason> Retrieve data for ids_views and ids_facilitys from the database. (Pre-select data approach)
ids_views = create n_ds
ids_facilitys = create n_ds
ids_views.dataobject = 'd_dddw_select_view_with_user_param_bak'  //Start Code Change ---- 08.9.2007 #V7 maha changed from d_dddw_select_view_with_user_param because it didn't work properly
ids_facilitys.dataobject = 'd_dddw_facility_w_picture'

ids_views.of_settransobject(SQLCA)
ids_facilitys.of_settransobject(SQLCA)

gnv_appeondb.of_startqueue()
//--------------------------- APPEON BEGIN ---------------------------
//$<add> 07.20.2006 By: Liang QingShi
//$<reason> Contract Modify.
ids_views.retrieve(gs_user_id,'P')

//---------------------------- APPEON END ----------------------------
ids_facilitys.retrieve(gs_user_id)
gnv_appeondb.of_commitqueue()
//---------------------------- APPEON END ----------------------------

end subroutine

public function integer of_delete_prac (long al_prac);//Start Code Change ----04.14.2008 #V8 maha
//new function copied from w_mdi so that multiple pracs can be deleted without closing the search screen.
Long ll_prac_id
Integer li_ans
//gs_search lstr_search
n_ds lds_tables
integer t
integer tc
string ls_tname
string ls_sql


ll_prac_id = al_prac
 //Start Code Change ----03.18.2015 #V15 maha - made message stronger
li_ans = MessageBox("DELETE", "This will delete ALL of the data for ALL the Facilities associated with the Practitioner. EVERYTHING. Continue?", Information!, YesNo!, 2 )

IF li_ans = 1 THEN
	li_ans = MessageBox("DELETE", "This will PERMENANTLY delete ALL Data for this provider.  Are you sure?", Information!, YesNo!, 2 )
	IF li_ans = 2 THEN
		RETURN -1
	END IF
ELSE
	RETURN -1
END IF

COMMIT USING SQLCA;

//Start Code Change ----06.23.2009 #V92 maha - changed to use application function instead
of_delete_provider_data(al_prac)
//// code rewritten maha 061804 (4.187)to catch all pd tables including customs.
//lds_tables = create n_ds
//lds_tables.dataobject = "d_pd_tables_for_prac_delete"
//lds_tables.settransobject(sqlca)
//
////--------------------------- APPEON BEGIN ---------------------------
////$<modify> 2005-11-11 By: owen chen
////$<reason> add database option for sql excution
//
//string ls_sqlsyntax
////ls_sqlsyntax =   " SELECT systable.table_id, "+&  
////						"systable.table_name "+& 
////						"FROM systable "+& 
////						"WHERE systable.table_name like 'pd%'"  
//
//choose case gs_dbtype
//	case 'ASA'
//		ls_sqlsyntax =   " SELECT systable.table_id, "+&  
//         					"systable.table_name "+& 
//    							"FROM systable "+& 
//   							"WHERE systable.table_name like 'pd%'"  
//	case 'SQL'
//		ls_sqlsyntax =  " SELECT v_systable.table_id, "+&  
//        						"v_systable.table_name "+& 
//    							"FROM v_systable "+& 
//   							"WHERE v_systable.table_name like 'pd%' "    
//end choose
//lds_tables.setSqlSelect(ls_sqlsyntax)
//
////---------------------------- APPEON END ----------------------------
//
//
//
//
//
//tc = lds_tables.retrieve()
//
////--------------------------- APPEON BEGIN ---------------------------
////$<ID> PT-03
////$<add> 03.21.2006 By: LeiWei
////$<reason> Performance tuning
////$<modification> Add Appeon Queue labels to reduce client-server interactions to improve runtime performance.
// 
//gnv_appeondb.of_startqueue( )
////---------------------------- APPEON END ----------------------------
//
//for t = 1 to tc
//	ls_tname = lds_tables.getitemstring(t,"table_name")
//	choose case ls_tname
//		case "pd_basic", "pd_affil_stat"
//			continue
//		case else
//			ls_sql = "DELETE FROM " + ls_tname + " where prac_id = " + string(ll_prac_id) + ";"
//			execute immediate :ls_sql using sqlca;
//			commit using sqlca;
//	end choose
//next
//	
//delete from pd_affil_stat
//where prac_id = :ll_prac_id;
//IF SQLCA.SQLCODE = -1 THEN
//	MessageBox("Delete", SQLCA.SQLERRTEXT )
//	RETURN -1
//END IF
//
//delete from verif_info
//where prac_id = :ll_prac_id;
//IF SQLCA.SQLCODE = -1 THEN
//	MessageBox("Delete", SQLCA.SQLERRTEXT )
//	RETURN -1
//END IF
//
//delete from net_dev_ids
//where prac_id = :ll_prac_id;
//IF SQLCA.SQLCODE = -1 THEN
//	MessageBox("Delete", SQLCA.SQLERRTEXT )
//	RETURN -1
//END IF
//
//delete from net_dev_action_items
//where prac_id = :ll_prac_id;
//IF SQLCA.SQLCODE = -1 THEN
//	MessageBox("Delete", SQLCA.SQLERRTEXT )
//	RETURN -1
//END IF
//
////--------------------------- APPEON BEGIN ---------------------------
////$<Modify> 2008-07-10 By: Scofield
////$<Reason> Delete pd_photo's picture.
//
//delete from pd_photo
//where prac_id = :ll_prac_id;
//IF SQLCA.SQLCODE = -1 THEN
//	MessageBox("Delete", SQLCA.SQLERRTEXT )
//	RETURN -1
//END IF
////---------------------------- APPEON END ----------------------------
//
//delete from pd_basic
//where prac_id = :ll_prac_id;
//IF SQLCA.SQLCODE = -1 THEN
//	MessageBox("Delete", SQLCA.SQLERRTEXT )
//	RETURN -1
//END IF
//
//COMMIT USING SQLCA;
//
////--------------------------- APPEON BEGIN ---------------------------
////$<ID> PT-04
////$<add> 03.21.2006 By: LeiWei
////$<reason> Performance tuning
////$<modification> Add Appeon Queue labels to reduce client-server interactions to improve runtime performance.
// 
//gnv_appeondb.of_commitqueue( )
//---------------------------- APPEON END ----------------------------
//End Code Change---06.23.2009

MessageBox("DELETE", "The record has been deleted.", Information! )

RETURN 0
end function

public function string of_get_batch (integer ai_batch);long li_batch
integer res
long i
long ic
long ll_prac
string ls_pracs
n_ds lds_batch
gs_batch_search lstr_batch

//get the user's batch for the button
if ai_batch = 1 then
	select set_1 into :li_batch from security_users where user_id = :gs_user_id;
elseif ai_batch = 2 then
	select set_2 into :li_batch from security_users where user_id = :gs_user_id;
end if

if isnull(li_batch ) or li_batch < 1 then
	res = messagebox("Batch search Providers","This button can be set to search a selected IntelliBatch.~rWould you like to select a batch that will be linked to this button for you.",question!,yesno!,1)
	if res = 2 then
		return "Cancel"
	end if 
end if
		
openwithparm(w_prac_batch_search,li_batch)
debugbreak()

//------------------- APPEON BEGIN -------------------
//$<modify> Stephen 09.19.2011
//$<reason> The My Batch 1 / My Batch 2 button in Practitioner Folder can’t work -BugS090702
/*
if message.stringparm = "C" then
	return "Cancel"
else
	li_batch = message.doubleparm
end if
*/
if message.stringparm = "C" then
	return "Cancel"
elseif message.doubleparm = 0 or isnull(message.doubleparm) then
	lstr_batch = message.powerobjectparm
else
	li_batch = message.doubleparm
end if
//------------------- APPEON END -------------------

//------------------- APPEON BEGIN -------------------
//$<add> Stephen 09.19.2011
//$<reason> The My Batch 1 / My Batch 2 button in Practitioner Folder can’t work -BugS090702
if message.doubleparm = 0 or isnull(message.doubleparm) then
	if not isvalid(lstr_batch) then return "Cancel"
	ic = upperbound(lstr_batch.li_prac_id)
	for i = 1 to ic
		ls_pracs += string(lstr_batch.li_prac_id[i]) + ", "
	next
	ls_pracs = MidA(ls_pracs,1,LenA(ls_pracs  ) - 2 ) 
else
//------------------- APPEON END ---------------------

	lds_batch = CREATE n_ds
	lds_batch.DataObject = "d_batch_items_list"
	lds_batch.of_SetTransObject( SQLCA )
	ic = lds_batch.retrieve(li_batch) 
	//debugbreak()
	for i = 1 to ic
		ls_pracs += string(lds_batch.getitemnumber(i,"prac_id")) + ", "
	next
	
	ls_pracs = MidA(ls_pracs,1,LenA(ls_pracs  ) - 2 ) 
	//messagebox("",ls_pracs)
	destroy lds_batch	
end if

if ai_batch = 1 then
	update security_users set set_1= :li_batch  where user_id = :gs_user_id;
elseif ai_batch = 2 then
	update security_users set set_2 = :li_batch  where user_id = :gs_user_id;
end if

return ls_pracs



end function

public function integer of_bg_color (long al_rgb);//Start Code Change ----05.25.2010 #V10 maha
this.backcolor = al_rgb
gb_letters.backcolor = al_rgb
gb_department.backcolor = al_rgb
gb_facility.backcolor = al_rgb
gb_search.backcolor = al_rgb
gb_status.backcolor = al_rgb
gb_view.backcolor = al_rgb
rb_appr.backcolor = al_rgb
rb_aud.backcolor = al_rgb
rb_de.backcolor = al_rgb
rb_ver.backcolor = al_rgb

return 1
end function

public function integer of_get_photo_data (long al_prac);////Start Code Change ----06.17.2010 #V10 maha //search screen photo
//string ls_picname
//
//	if isvalid(iw_prac_folder) then
//		if dw_search.rowcount() > 0 then
//			ls_picname = of_photo_download(al_prac)
//			
//			if 	ls_picname = "None" then
//				iw_prac_folder.tab_1.tabpage_search.p_prac_photo.PictureName = "nophoto2.jpg"
//			else
//				if FileExists(ls_PicName) then
//					iw_prac_folder.tab_1.tabpage_search.p_prac_photo.PictureName = ls_picname
//				end if
//			end if
//			iw_prac_folder.tab_1.tabpage_search.dw_p_data.retrieve(al_prac)
//			iw_prac_folder.tab_1.tabpage_search.p_prac_photo.visible = true
//			iw_prac_folder.tab_1.tabpage_search.dw_p_data.visible= true
//		else
//			iw_prac_folder.tab_1.tabpage_search.p_prac_photo.visible = false
//			iw_prac_folder.tab_1.tabpage_search.dw_p_data.visible= false
//		end if
//	end if
//	
return 1
////End Code Change ----06.17.2010

end function

public function integer of_select_prac (long ai_row);Long ll_prac_id
Integer li_parent_facility_id
Integer li_cnt
Integer li_active_status
String ls_full_name
String ls_names[]
Integer li_msg_ans
Integer li_rc
Integer i
integer r
Long ll_seq
Long ll_prac_ids[]
long li_facility_ids[]
long ll_affil_rec //maha 121702
gs_batch_search ist_search //maha 06.28.2010 move here
//debugbreak()
IF ai_row < 1 THEN
	RETURN -1
END IF

//multiple provider selection
if dw_search.DataObject = "d_extended_search_list_multi" then //maha 091505 for multi select of practitioners from reports meetings and letters
	for i = 1 to dw_search.rowcount()
		if dw_search.getitemnumber(i,"selected" ) = 1 then
			r++
			ist_search.li_prac_id[r] = dw_search.getitemnumber(i,"prac_id")
			ist_search.ls_name[r] = dw_search.getitemstring(i,"v_full_name_full_name")
			ist_search.ll_facility[r]=dw_search.getitemnumber(i,"parent_facility_id")//For batch add address  Added by Nova 03.26.2009
		end if
	next
	
	//--------------APPEON BEGIN-------------------
	//$<add> 04.05.2012 By: long.zhang
	//$<reason> Correct the active status display on w_batch_add_address window
	if is_open_for ='ADDRESS'  then
		if  isvalid(w_batch_add_address) then
			choose case is_status
				case "Active and Pending"
					w_batch_add_address.is_appmnt_status ='1,4'
				case "Include Inactive"
					w_batch_add_address.is_appmnt_status ='1,4,3'
				case "Active Only"
					w_batch_add_address.is_appmnt_status ='1'
				case "Inactive Only"
					w_batch_add_address.is_appmnt_status ='3'
				case "Pending Only"
					w_batch_add_address.is_appmnt_status ='4'
			end choose
		end if
	end if	
	//--------------APPEON END---------------------
	
	//--------------------------- APPEON BEGIN ---------------------------
	//$<add> 03/19/2008 By: Ken.Guo
	//$<reason> Add Trap,Fix BugS030510
	If UpperBound(ist_search.li_prac_id[]) = 0 Then Return -1
	//---------------------------- APPEON END ----------------------------
	Closewithreturn( Parent, ist_search)	
	RETURN 0	
end if  //multiple provider selection

ll_prac_id = dw_search.GetItemNumber(ai_row, "prac_id")
//gl_prac_id = ll_prac_id - for DataEntry only - commented by alfee 11.30.2012
gi_parent_facility = dw_search.GetItemNumber( ai_row, "parent_facility_id" )
if isnull(is_open_for) or LenA(is_open_for) < 1 then return 0

//DATA ENTRY
IF is_open_for = "DATAENTRY" THEN
	gl_prac_id = ll_prac_id
	dw_view.AcceptText()
	IF dw_view.GetText() = "" OR IsNull( dw_view.GetText() )  THEN
		MessageBox("View", "Please select a view." )
		Return -1
	END IF
	gl_data_view_id = dw_view.GetItemNumber( 1, "data_view_id" )
	gi_parent_facility = dw_search.GetItemNumber( ai_row, "parent_facility_id" )
	ll_affil_rec = dw_search.GetItemNumber( ai_row, "pd_affil_stat_rec_id" )  //Start Code Change ----12.08.2014 #V14.2 maha - added
	li_active_status = dw_search.GetItemNumber( ai_row, "active_status" )  //Start Code Change ----12.08.2014 #V14.2 maha - added
	
	if w_mdi.of_security_access(120) = 2 and w_mdi.of_security_access(125) = 1 then  //Start Code Change ----02.01.2010 #V10 maha - added active status field security
	//if w_mdi.of_security_access(120) = 2 then //maha modified 040204 to only allow change of status if user has full rights to appt stat

//		SELECT pd_affil_stat.active_status  //Start Code Change ----12.08.2014 #V14.2 maha - removed as the active status is part of the record
//		INTO :li_active_status  
//		  FROM pd_affil_stat  
//		  WHERE ( pd_affil_stat.prac_id = :gl_prac_id ) AND  
//				  ( pd_affil_stat.parent_facility_id = :gi_parent_facility ) AND
//				pd_affil_stat.active_status <> 0;  // line added 091500 maha
	
		IF li_active_status = 3  THEN
			if iw_prac_folder.ib_skip_inactive_mess = true then 
				//skip the message
				li_msg_ans = 0
//				iw_prac_folder.ib_skip_inactive_mess = false  //Commented by (Appeon)Stephen 03.02.2016 - Bug id 5016 - 'Hide Do you want to re-activate practitioner' message
			else
				li_msg_ans = MessageBox("Inactive", "This is an Inactive Appointment record. Do you want to Re-Activate it?", Question!, YesNo!, 2 ) //Start Code Change ----02.01.2010 #V10 maha - changed default to No
				IF li_msg_ans = 1 THEN
					li_parent_facility_id = dw_search.GetItemNumber( ai_row, "parent_facility_id" )
					//REACTIVATE CODE
//					select rec_id into :ll_affil_rec from pd_affil_stat //Start Code Change ----12.08.2014 #V14.2 maha - removed as recid is in the record
//					WHERE ( pd_affil_stat.prac_id = :ll_prac_id ) AND 
//					( pd_affil_stat.parent_facility_id = :li_parent_facility_id )and (pd_affil_stat.active_status = 3);//maha 121702
					
					gnv_appeondb.of_startqueue( )
					
					UPDATE pd_affil_stat  
					SET active_status = 1
					  where rec_id = :ll_affil_rec; 
		
					UPDATE pd_comm_review
					SET active_status = 1 
					  where rec_id = :ll_affil_rec; 
							
					UPDATE pd_affil_dept  
					SET active_status = 1
					where rec_id = :ll_affil_rec; 
							
					UPDATE pd_affil_staff_cat 
					SET active_status = 1
					where rec_id = :ll_affil_rec;
					
					UPDATE pd_affil_staff_leave 
					SET active_status = 1 
					where rec_id = :ll_affil_rec; 
		
					//Start Code Change ---- 03.29.2006 #357 maha add audit record
					select max(seq_no) into :ll_seq from sys_audit where rec_id = :ll_affil_rec and field_id = 100000;
					
					gnv_appeondb.of_commitqueue( )
					
					if isnull(ll_seq) then ll_seq = 0
					ll_seq++
					
					gnv_appeondb.of_startqueue( )
					
					INSERT INTO sys_audit (rec_id,field_id,seq_no,table_id,prac_id,old_value,new_value,user_id,date_time_modified, audit_type,exported,facility_id) VALUES (:ll_affil_rec	,	100000,	:ll_seq,	43,	:ll_prac_id,	'3',	'1',	:gs_user_id,	getdate(),	'E',	1,	:gi_parent_facility);
					commit using sqlca;
					
					gnv_appeondb.of_commitqueue( )

					
					//--------------------------- APPEON BEGIN ---------------------------
					//$<add> 12.22.2006 By: Jervis
					//$<reason> Added for Work Flow
					n_cst_workflow_triggers lnv_workflow
					long ll_wf_id
					str_action_item lstr_action
					
					If gb_workflow Then 
						lnv_workflow = create n_cst_workflow_triggers
						ll_wf_id = long(gnv_data.of_getitem("facility","facility_wf_practitioner_status_change","facility_id="+string(li_parent_facility_id)))
						
						//If there is no work flow is related to the facility, then return 
						If not isnull(ll_wf_id) and  ll_wf_id > 0 Then
							lstr_action.prac_id = ll_prac_id
							lstr_action.rec_id = ll_affil_rec
							lstr_action.facility_id = li_parent_facility_id
							lstr_action.wf_id = ll_wf_id
							lstr_action.screen_id = -10
							lnv_workflow.of_workflow_create_action_items(lstr_action)
						end if
						 
						if isvalid(lnv_workflow) then destroy lnv_workflow
					end if
					//---------------------------- APPEON END ----------------------------
	
					
	
				END IF
			end if
		END IF
	end if
	//Start Code Change ----12.15.2014 #V14.2 maha
	if isValid(iw_prac_folder) then 
		iw_prac_folder.il_prac_id = ll_prac_id	//added by long.zhang appeon 06.20.2013 refresh issue
		iw_prac_folder.il_affil_rec_id = ll_affil_rec  //Start Code Change ----12.08.2014 #V14.2 maha
		iw_prac_folder.of_retrieve_prac()
	elseif isValid(w_qa_peer_profile_screen) then 
		w_qa_peer_profile_screen.il_appt_rec = ll_affil_rec	
	end if
	Return 0
	//END DATA ENTRY
ELSEIF is_open_for = "INTELLIAPP" THEN
	li_rc = dw_search.RowCount()
	gl_prac_ids = ll_prac_ids
	gl_facility_ids = li_facility_ids
	gs_names = ls_names
	FOR i = 1 TO li_rc
		IF dw_search.GetItemNumber( i, "rec_id" ) = 0 THEN
			CONTINUE
		END IF
		li_cnt++
		gi_app_ids[ li_cnt ] = dw_search.GetItemNumber( i, "app_id" )
		gl_prac_ids[ li_cnt ] = dw_search.GetItemNumber( i, "prac_id" )
		gl_rec_id[ li_cnt ] = dw_search.GetItemNumber( i, "net_dev_action_items_rec_id" )//add Michael 11.08.2011 Fixed Bug#2772:Problem with saving printed apps to database 
		gl_facility_ids[ li_cnt ] = dw_search.GetItemNumber( i, "parent_facility_id" )		
		IF Not IsNull( dw_search.GetItemString( i, "first_name" ) ) THEN
			ls_full_name = dw_search.GetItemString( i, "first_name" ) + " "
		END IF
		IF Not IsNull( dw_search.GetItemString( i, "middle_name" ) ) THEN
			ls_full_name = ls_full_name + dw_search.GetItemString( i, "middle_name" ) + " "
		END IF
		gs_names[ li_cnt ] = ls_full_name + dw_search.GetItemString( i, "last_name" )
		if il_loc_id > 0 then  //Start Code Change ----10.14.2014 #V14.2 maha
			gl_locations = il_loc_id
		end if
	END FOR
	Close( Parent ) //Start Code Change ----04.14.2008 #V8 maha -
ELSEIF is_open_for = "DELETE" THEN
	//Start Code Change ----04.14.2008 #V8 maha 
	//gl_prac_id = ll_prac_id
	//----Begin Modified by Alfee 12.11.2008 ----------------
	//of_delete_prac( ll_prac_id)
	//dw_search.deleterow(ai_row)
	IF of_delete_prac( ll_prac_id) >= 0 THEN dw_search.deleterow(ai_row)
	//----End Modified --------------------------------------
	//End Code Change---04.14.2008
ELSEIF is_open_for = "AUDIT" THEN
	//---Begin Modified by Alfee 11.30.2012 ------
	//gl_prac_id = ll_prac_id
	//Close( Parent ) //Start Code Change ----04.14.2008 #V8 maha - 
	ClosewithReturn(Parent, ll_prac_id)
	//---End Modified --------------------------------
ELSEIF is_open_for = "MEETINGS" OR is_open_for = "REPORTS" or is_open_for = "SKL" or is_open_for = "SURVEY" THEN ////Start Code Change ----12.13.2010 #V10 maha - added SKL option
	gi_parent_facility = dw_search.GetItemNumber( ai_row, "parent_facility_id" )
	IF Not IsNull( dw_search.GetItemString( ai_row, "first_name" ) ) THEN
		ls_full_name = dw_search.GetItemString( ai_row, "first_name" ) + " "
	END IF
	IF Not IsNull( dw_search.GetItemString( ai_row, "middle_name" ) ) THEN
		ls_full_name = ls_full_name + dw_search.GetItemString( ai_row, "middle_name" ) + " "
	END IF
	ls_full_name = ls_full_name + dw_search.GetItemString( ai_row, "last_name" )
	if il_loc_id > 0 then ls_full_name+= "*" + string(il_loc_id)  //Start Code Change ----06.03.2014 #V14.2 maha
	CloseWithReturn( Parent, String( ll_prac_id ) + "-" + ls_full_name )
	Return -1
//ELSEIF is_open_for = "ACTIONITEMS" or  is_open_for = "SKS" THEN  //Start Code Change ----06.28.2010 #V10 maha - added SKS
ELSEIF is_open_for = "ACTIONITEMS" THEN  //SK Practitioner Folder - alfee 08.31.2010		
	CloseWithReturn( Parent, String( ll_prac_id ))
	Return -1
ELSEIF is_open_for = "PRIVILEGE" THEN //02.25.2011 By Evan
	ist_search.li_prac_id[1] = ll_prac_id
	ist_search.ll_facility[1] = gi_parent_facility
	Closewithreturn(Parent, ist_search)
ELSEIF is_open_for = "SKF"	then  //Start Code Change ----06.28.2010 #V10 maha - added SKF (filter)
	for i = 1 to dw_search.rowcount()
		ist_search.li_prac_id[i] = dw_search.getitemnumber(i,"prac_id")
		ist_search.ll_facility[i] = dw_search.getitemnumber(i,"parent_facility_id")	//SK Practitioner Folder - alfee 08.31.2010			
	next

	If UpperBound(ist_search.li_prac_id[]) = 0 Then Return -1
	
	Closewithreturn( Parent, ist_search)	
ELSEIF is_open_for = "SKS" then  //SK Practitioner Folder - alfee 08.31.2010	
	ist_search.li_prac_id[1] = ll_prac_id
	ist_search.ll_facility[1] = gi_parent_facility
	Closewithreturn( Parent, ist_search)	
END IF

//Close( Parent )  //Start Code Change ----04.14.2008 #V8 maha - removed so delete does not close window

RETURN 0


end function

public function integer of_validate (string as_field, string as_value);//Start Code Change ----01.16.2014 #V14 maha
string ls_ret

ls_ret = of_validate_crit(as_field, as_value) 

choose case ls_ret
	case "OK"
		//continue
	case "NUM"
		messagebox("Search Validation", "The criteria for " + as_field + " must be a numeric value.")
		return -1
	case "NPI"
		messagebox("Search Validation", "The criteria for " + as_field + " must be a 10 digits.")
		return -1
	case "TAX", "SSN"
		messagebox("Search Validation", "The criteria for " + as_field + " must be a 9 digits.")
		return -1
end choose

return 1
end function

public function integer of_ddlb_deleteitem (string as_name);//////////////////////////////////////////////////////////////////////
// $<function>of_ddlb_deleteitem()
// $<arguments>
//		value	string	as_name 		
// $<returns> integer
// $<description>Delete item from ddlb.
// $<description>
//////////////////////////////////////////////////////////////////////
// $Added by (Appeon)Harry 08.13.2014 for BugS072201
//////////////////////////////////////////////////////////////////////

integer li_Index
li_Index = ddlb_search_type.FindItem(as_name, 1)
if li_Index > 0 then
	ddlb_search_type.DeleteItem( li_Index)
end if
Return 1
end function

on pfc_cst_u_extended_search_org.create
this.cb_dept_help=create cb_dept_help
this.cb_facility_help=create cb_facility_help
this.cb_view_help=create cb_view_help
this.cb_loc=create cb_loc
this.cbx_valid=create cbx_valid
this.pb_lost=create pb_lost
this.dw_prof_suffix=create dw_prof_suffix
this.r_new=create r_new
this.gb_department=create gb_department
this.gb_view=create gb_view
this.cb_29=create cb_29
this.rb_appr=create rb_appr
this.rb_ver=create rb_ver
this.rb_de=create rb_de
this.cb_27=create cb_27
this.cb_26=create cb_26
this.cb_1=create cb_1
this.cb_2=create cb_2
this.cb_3=create cb_3
this.cb_4=create cb_4
this.cb_5=create cb_5
this.cb_6=create cb_6
this.cb_7=create cb_7
this.cb_8=create cb_8
this.cb_9=create cb_9
this.cb_10=create cb_10
this.cb_11=create cb_11
this.cb_12=create cb_12
this.cb_13=create cb_13
this.cb_14=create cb_14
this.cb_15=create cb_15
this.cb_16=create cb_16
this.cb_17=create cb_17
this.cb_18=create cb_18
this.cb_19=create cb_19
this.cb_20=create cb_20
this.cb_21=create cb_21
this.cb_22=create cb_22
this.cb_23=create cb_23
this.cb_24=create cb_24
this.cb_25=create cb_25
this.cb_clear=create cb_clear
this.dw_department=create dw_department
this.cb_iverify=create cb_iverify
this.ddlb_search_type=create ddlb_search_type
this.cbx_status=create cbx_status
this.dw_view=create dw_view
this.cb_select=create cb_select
this.cb_search=create cb_search
this.gb_letters=create gb_letters
this.gb_status=create gb_status
this.cb_close=create cb_close
this.dw_dept=create dw_dept
this.dw_org_facility_select=create dw_org_facility_select
this.gb_facility=create gb_facility
this.ddlb_status=create ddlb_status
this.gb_search=create gb_search
this.cb_new=create cb_new
this.rb_aud=create rb_aud
this.sle_srch_val=create sle_srch_val
this.dw_search=create dw_search
this.Control[]={this.cb_dept_help,&
this.cb_facility_help,&
this.cb_view_help,&
this.cb_loc,&
this.cbx_valid,&
this.pb_lost,&
this.dw_prof_suffix,&
this.r_new,&
this.gb_department,&
this.gb_view,&
this.cb_29,&
this.rb_appr,&
this.rb_ver,&
this.rb_de,&
this.cb_27,&
this.cb_26,&
this.cb_1,&
this.cb_2,&
this.cb_3,&
this.cb_4,&
this.cb_5,&
this.cb_6,&
this.cb_7,&
this.cb_8,&
this.cb_9,&
this.cb_10,&
this.cb_11,&
this.cb_12,&
this.cb_13,&
this.cb_14,&
this.cb_15,&
this.cb_16,&
this.cb_17,&
this.cb_18,&
this.cb_19,&
this.cb_20,&
this.cb_21,&
this.cb_22,&
this.cb_23,&
this.cb_24,&
this.cb_25,&
this.cb_clear,&
this.dw_department,&
this.cb_iverify,&
this.ddlb_search_type,&
this.cbx_status,&
this.dw_view,&
this.cb_select,&
this.cb_search,&
this.gb_letters,&
this.gb_status,&
this.cb_close,&
this.dw_dept,&
this.dw_org_facility_select,&
this.gb_facility,&
this.ddlb_status,&
this.gb_search,&
this.cb_new,&
this.rb_aud,&
this.sle_srch_val,&
this.dw_search}
end on

on pfc_cst_u_extended_search_org.destroy
destroy(this.cb_dept_help)
destroy(this.cb_facility_help)
destroy(this.cb_view_help)
destroy(this.cb_loc)
destroy(this.cbx_valid)
destroy(this.pb_lost)
destroy(this.dw_prof_suffix)
destroy(this.r_new)
destroy(this.gb_department)
destroy(this.gb_view)
destroy(this.cb_29)
destroy(this.rb_appr)
destroy(this.rb_ver)
destroy(this.rb_de)
destroy(this.cb_27)
destroy(this.cb_26)
destroy(this.cb_1)
destroy(this.cb_2)
destroy(this.cb_3)
destroy(this.cb_4)
destroy(this.cb_5)
destroy(this.cb_6)
destroy(this.cb_7)
destroy(this.cb_8)
destroy(this.cb_9)
destroy(this.cb_10)
destroy(this.cb_11)
destroy(this.cb_12)
destroy(this.cb_13)
destroy(this.cb_14)
destroy(this.cb_15)
destroy(this.cb_16)
destroy(this.cb_17)
destroy(this.cb_18)
destroy(this.cb_19)
destroy(this.cb_20)
destroy(this.cb_21)
destroy(this.cb_22)
destroy(this.cb_23)
destroy(this.cb_24)
destroy(this.cb_25)
destroy(this.cb_clear)
destroy(this.dw_department)
destroy(this.cb_iverify)
destroy(this.ddlb_search_type)
destroy(this.cbx_status)
destroy(this.dw_view)
destroy(this.cb_select)
destroy(this.cb_search)
destroy(this.gb_letters)
destroy(this.gb_status)
destroy(this.cb_close)
destroy(this.dw_dept)
destroy(this.dw_org_facility_select)
destroy(this.gb_facility)
destroy(this.ddlb_status)
destroy(this.gb_search)
destroy(this.cb_new)
destroy(this.rb_aud)
destroy(this.sle_srch_val)
destroy(this.dw_search)
end on

event constructor;IF gs_user_id = "SE" THEN
	dw_view.Visible = False
	gb_view.Visible = False
	dw_org_facility_select.Visible = False
	gb_facility.Visible = False
	cb_iverify.Visible = False	
	gb_search.y = 24
	ddlb_search_type.Y = 84
	cb_search.Y = 84
	sle_srch_val.Y = 196
END IF
//--------------------------- APPEON BEGIN ---------------------------
//$<ID> PT-08
//$<modify> 01.24.2006 By: Cao YongWang
//$<reason> Performance tuning
//$<reason> Write script to retrieve data from a cache instead of from the database.
//select default_view into :ii_user_view from security_users where user_id = :gs_user_id; //maha 073103
ii_user_view = integer(gnv_data.of_getitem('security_users','default_view',"upper(user_id)='" + upper(gs_user_id) + "'"))
//---------------------------- APPEON END ----------------------------

Integer li_dept_secure_setting
Integer i
integer li_stat

//SELECT set_37
//INTO: li_dept_secure_setting
//FROM icred_settings;
//li_dept_secure_setting = of_get_app_setting("set_37","I")

IF gi_dept_security = 1 THEN
	gb_department.Visible = True
	dw_department.Visible = True
	cb_dept_help.Visible = True
	dw_department.settransobject( SQLCA )
	//--------------------------- APPEON BEGIN ---------------------------
	//$<ID> PT-09
   //$<modify> 02.17.2006 By: Cao YongWang
	//$<reason> Performance tuning.
	//$<reason> Add Appeon Queue labels to reduce client-server interactions to improve runtime performance.
   //$<modification> Add the Appeon Start Queue label.
	/*
	dw_department.retrieve( )
	dw_department.insertrow(1)

	DataWindowChild dwchild
	
	dw_department.GetChild( "department", dwchild )
	dwchild.SetTransObject( SQLCA )
	dwchild.Retrieve( gs_user_id )
	
	//find out how many departments the user has access to 
	//(do this to determine if users have rights to all or only some of the departments)
	li_num_of_departments_user_has_rights_to = dwchild.RowCount( )

	dwchild.InsertRow( 1 )
	dwchild.SetItem( 1, "description","All" )
	dwchild.SetItem( 1, "lookup_code", 0 )	
	dw_department.SetItem( 1, "department", "All" )
	
	//find out how many departments in all there are
	//(do this to determine if users have rights to all or only some of the departments)
	SELECT Count( lookup_code )
	INTO :li_num_of_departments
	FROM code_lookup
	WHERE lookup_name = 'department';
	IF SQLCA.SQLCODE = -1 THEN
		MessageBox( "SQL Error", SQLCA.SQLERRTEXT )
		RETURN -1
	END IF	
	*/
	//Appeon start queue label
	gnv_appeondb.of_startqueue()
	
	dw_department.retrieve( )
	//dw_department.insertrow(1)

	DataWindowChild dwchild
	
	dw_department.GetChild( "department", dwchild )
	dwchild.SetTransObject( SQLCA )
	dwchild.Retrieve( gs_user_id )
	//
	SELECT Count( lookup_code )
	INTO :li_num_of_departments
	FROM code_lookup
	WHERE lookup_name = 'department';
	//Add the Appeon Commit Queue label
	gnv_appeondb.of_commitqueue()
	//find out how many departments the user has access to 
	//(do this to determine if users have rights to all or only some of the departments)
	li_num_of_departments_user_has_rights_to = dwchild.RowCount( )
   dw_department.insertrow(1)
	dwchild.InsertRow( 1 )
	dwchild.SetItem( 1, "description","All" )
	dwchild.SetItem( 1, "lookup_code", 0 )	
	dw_department.SetItem( 1, "department", "All" )
	
	//find out how many departments in all there are
	//(do this to determine if users have rights to all or only some of the departments)
//	SELECT Count( lookup_code )
//	INTO :li_num_of_departments
//	FROM code_lookup
//	WHERE lookup_name = 'department';
//	IF SQLCA.SQLCODE = -1 THEN
//		MessageBox( "SQL Error", SQLCA.SQLERRTEXT )
//		RETURN -1
//	END IF
	//---------------------------- APPEON END ----------------------------
	dw_department.SetItem( 1, "department", 0 )
ELSE 
	li_num_of_departments = 0
	li_num_of_departments_user_has_rights_to = 0
	SetNull( il_dept )
//	dw_view.x = dw_department.x
//	dw_view.y = dw_department.y
//	gb_view.x = gb_department.x
//	gb_view.y = gb_department.y
END IF

if isnull(ii_user_view) then ii_user_view = 0

//$<add> 07.07.2008 by Andy
String ls_label
SELECT TOP 1 app_stat_facility_label INTO :ls_label FROM icred_settings;

if LenA(trim(ls_label)) > 0 then 
	gb_facility.text = 'Select ' + ls_label
end if
//end add 07.07.2008
//Start Code Change ----02.23.2010 #V10 maha
select set_3 into :li_stat from security_users where user_id = :gs_user_id;
if isnull(li_stat) then li_stat = 0
choose case li_stat
	case 0
		ddlb_status.text = "Active and Pending"
	case 1
		ddlb_status.text = "Include Inactive"
	case 2
		ddlb_status.text = "Active Only"
	case 3
		ddlb_status.text = "Inactive Only"
	case 4
		ddlb_status.text = "Pending Only"
	case else
		ddlb_status.text = "Active and Pending"
end choose
//End Code Change ----02.23.2010 #V10 maha

//Start Code Change ----08.25.2010 #V10 maha - mod for intelliapp
if gs_cust_type = "I" then
	rb_appr.x = rb_ver.x
	rb_appr.text = "Affil"
	rb_ver.visible = false
	dw_search.dataobject = "d_extended_search_list_app"
end if
//End Code Change ----08.25.2010 

//---------Begin Added by (Appeon)Harry 08.13.2014 for BugS072201--------
if gs_cust_type = "I" or of_get_app_setting("set_9","I") = 0 then
	if not gb_contract_module then
		of_ddlb_deleteitem("Contract")
	end if
else
	of_ddlb_deleteitem("Contract")
end if
//---------End Added ------------------------------------------------------
end event

type cb_dept_help from commandbutton within pfc_cst_u_extended_search_org
boolean visible = false
integer x = 960
integer y = 392
integer width = 87
integer height = 80
integer taborder = 320
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "?"
end type

event clicked;//Start Code Change ----06.18.2014 #V14.2 maha - added
string s

s = "Department Security is a program option set in the Application Settings.~r~r"
s+= "User access to specific Departments is set in the User configuration.~r~r"
s+= "Users can only Providers connected to Departments to which they have security access.~r~r"
s+= "If providers have no Department record, they will not appear in search except to a user with rights to ALL Departments .~r~r"

messagebox("About Department Security", s )

cb_search.setfocus( )  //Start Code Change ----08.05.2014 #V14.2 maha
end event

type cb_facility_help from commandbutton within pfc_cst_u_extended_search_org
integer x = 960
integer y = 68
integer width = 87
integer height = 80
integer taborder = 290
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "?"
end type

event clicked;//Start Code Change ----06.18.2014 #V14.2 maha - added
string s

s = "User access to Facilities/Groups is set in the User configuration.~r~r"
s+= "Users can only select Facilities/Groups to which they have security access.~r~r"
s+= "All means only the Facilities/Groups to which they have security access."


messagebox("About Facilities/Groups", s )

cb_search.setfocus( )  //Start Code Change ----08.05.2014 #V14.2 maha
end event

type cb_view_help from commandbutton within pfc_cst_u_extended_search_org
integer x = 960
integer y = 232
integer width = 87
integer height = 80
integer taborder = 300
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "?"
end type

event clicked;//Start Code Change ----06.18.2014 #V14.2 maha - added
string s

s = "User access to views is set in the User configuration.~r~r"
s+= "Users can only select view to which they have security access.~r~r"
s+= "Both a User and a Facility can have a Default view set.~r~r"
s+= "The User Default view has priority over the Facility Default view.~r~r"
s+= "As a provider is selected, the view selection may change based on the defaults."

messagebox("About Views", s )

cb_search.setfocus( )  //Start Code Change ----08.05.2014 #V14.2 maha
end event

type cb_loc from commandbutton within pfc_cst_u_extended_search_org
boolean visible = false
integer x = 3145
integer y = 196
integer width = 384
integer height = 92
integer taborder = 140
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "Select Location"
end type

event clicked;//Start Code Change ----04.10.2014 #V14.2 maha

open(w_select_group_location)

if message.stringparm = "Cancel" then 
	return
else
	il_loc_id = message.doubleparm
end if

cb_search.setfocus( )  //Start Code Change ----08.05.2014 #V14.2 maha
end event

type cbx_valid from checkbox within pfc_cst_u_extended_search_org
boolean visible = false
integer x = 2510
integer y = 156
integer width = 594
integer height = 64
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long backcolor = 16777215
string text = "Validate Numeric Values"
end type

type pb_lost from picturebutton within pfc_cst_u_extended_search_org
integer x = 3182
integer y = 196
integer width = 329
integer height = 92
integer taborder = 130
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "Lost Help"
boolean originalsize = true
vtextalign vtextalign = vcenter!
long textcolor = 255
long backcolor = 31580641
end type

event clicked;//Start Code Change ----01.08.2014 #V14 maha - added
open(w_lost_provider_message)

cb_search.setfocus( )  //Start Code Change ----08.05.2014 #V14.2 maha
end event

type dw_prof_suffix from datawindow within pfc_cst_u_extended_search_org
boolean visible = false
integer x = 2162
integer y = 304
integer width = 965
integer height = 92
integer taborder = 50
boolean bringtotop = true
string dataobject = "d_prof_suffix_search"
boolean border = false
boolean livescroll = true
end type

event itemchanged;il_prof = long(data)
end event

type r_new from rectangle within pfc_cst_u_extended_search_org
long linecolor = 65535
integer linethickness = 4
long fillcolor = 65535
integer x = 3168
integer y = 32
integer width = 357
integer height = 108
end type

type gb_department from groupbox within pfc_cst_u_extended_search_org
boolean visible = false
integer x = 5
integer y = 340
integer width = 1061
integer height = 156
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long textcolor = 128
long backcolor = 16777215
string text = "Select Department"
end type

type gb_view from groupbox within pfc_cst_u_extended_search_org
integer x = 5
integer y = 176
integer width = 1061
integer height = 152
integer taborder = 120
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long textcolor = 128
long backcolor = 16777215
string text = "Select View"
end type

type cb_29 from u_search_letter_button within pfc_cst_u_extended_search_org
integer x = 1285
integer y = 400
integer width = 155
integer height = 76
integer taborder = 440
boolean bringtotop = true
integer textsize = -8
integer weight = 700
string facename = "Segoe UI"
string text = "Z"
end type

event clicked;call super::clicked;of_search(This.Text)
end event

type rb_appr from radiobutton within pfc_cst_u_extended_search_org
integer x = 2743
integer y = 68
integer width = 224
integer height = 64
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long textcolor = 33554432
long backcolor = 16777215
string text = "Appr"
end type

type rb_ver from radiobutton within pfc_cst_u_extended_search_org
integer x = 2578
integer y = 68
integer width = 224
integer height = 64
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long textcolor = 33554432
long backcolor = 16777215
string text = "Ver"
end type

type rb_de from radiobutton within pfc_cst_u_extended_search_org
integer x = 2391
integer y = 68
integer width = 201
integer height = 64
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long textcolor = 33554432
long backcolor = 16777215
string text = "D/E"
end type

type cb_27 from u_search_letter_button within pfc_cst_u_extended_search_org
integer x = 1755
integer y = 400
integer width = 311
integer height = 76
integer taborder = 460
boolean bringtotop = true
integer textsize = -8
integer weight = 700
string facename = "Segoe UI"
string text = "My Batch 2"
end type

event clicked;call super::clicked;//Start Code Change ----10.02.2008 #V85 maha - search function for batch
of_search_new("BAT2")
end event

type cb_26 from u_search_letter_button within pfc_cst_u_extended_search_org
integer x = 1440
integer y = 400
integer width = 311
integer height = 76
integer taborder = 450
boolean bringtotop = true
integer textsize = -8
integer weight = 700
string facename = "Segoe UI"
string text = "My Batch 1"
end type

event clicked;call super::clicked;//Start Code Change ----10.02.2008 #V85 maha - search function for batch
of_search_new("BAT1")

end event

type cb_1 from u_search_letter_button within pfc_cst_u_extended_search_org
integer x = 1129
integer y = 64
integer width = 155
integer height = 76
integer taborder = 160
boolean bringtotop = true
integer textsize = -8
integer weight = 700
string facename = "Segoe UI"
string text = "A"
end type

event clicked;of_search(This.Text)
end event

type cb_2 from u_search_letter_button within pfc_cst_u_extended_search_org
integer x = 1285
integer y = 64
integer width = 155
integer height = 76
integer taborder = 170
boolean bringtotop = true
integer textsize = -8
integer weight = 700
string facename = "Segoe UI"
string text = "B"
end type

event clicked;call super::clicked;of_search(This.Text)
end event

type cb_3 from u_search_letter_button within pfc_cst_u_extended_search_org
integer x = 1440
integer y = 64
integer width = 155
integer height = 76
integer taborder = 180
boolean bringtotop = true
integer textsize = -8
integer weight = 700
string facename = "Segoe UI"
string text = "C"
end type

event clicked;call super::clicked;of_search(This.Text)
end event

type cb_4 from u_search_letter_button within pfc_cst_u_extended_search_org
integer x = 1600
integer y = 64
integer width = 155
integer height = 76
integer taborder = 190
boolean bringtotop = true
integer textsize = -8
integer weight = 700
string facename = "Segoe UI"
string text = "D"
end type

event clicked;call super::clicked;of_search(This.Text)
end event

type cb_5 from u_search_letter_button within pfc_cst_u_extended_search_org
integer x = 1755
integer y = 64
integer width = 155
integer height = 76
integer taborder = 200
boolean bringtotop = true
integer textsize = -8
integer weight = 700
string facename = "Segoe UI"
string text = "E"
end type

event clicked;call super::clicked;of_search(This.Text)
end event

type cb_6 from u_search_letter_button within pfc_cst_u_extended_search_org
integer x = 1911
integer y = 64
integer width = 155
integer height = 76
integer taborder = 210
boolean bringtotop = true
integer textsize = -8
integer weight = 700
string facename = "Segoe UI"
string text = "F"
end type

event clicked;call super::clicked;of_search(This.Text)
end event

type cb_7 from u_search_letter_button within pfc_cst_u_extended_search_org
integer x = 1129
integer y = 148
integer width = 155
integer height = 76
integer taborder = 220
boolean bringtotop = true
integer textsize = -8
integer weight = 700
string facename = "Segoe UI"
string text = "G"
end type

event clicked;call super::clicked;of_search(This.Text)
end event

type cb_8 from u_search_letter_button within pfc_cst_u_extended_search_org
integer x = 1285
integer y = 148
integer width = 155
integer height = 76
integer taborder = 230
boolean bringtotop = true
integer textsize = -8
integer weight = 700
string facename = "Segoe UI"
string text = "H"
end type

event clicked;call super::clicked;of_search(This.Text)
end event

type cb_9 from u_search_letter_button within pfc_cst_u_extended_search_org
integer x = 1440
integer y = 148
integer width = 155
integer height = 76
integer taborder = 240
boolean bringtotop = true
integer textsize = -8
integer weight = 700
string facename = "Segoe UI"
string text = "I"
end type

event clicked;call super::clicked;of_search(This.Text)
end event

type cb_10 from u_search_letter_button within pfc_cst_u_extended_search_org
integer x = 1600
integer y = 148
integer width = 151
integer height = 76
integer taborder = 250
boolean bringtotop = true
integer textsize = -8
integer weight = 700
string facename = "Segoe UI"
string text = "J"
end type

event clicked;call super::clicked;of_search(This.Text)
end event

type cb_11 from u_search_letter_button within pfc_cst_u_extended_search_org
integer x = 1755
integer y = 148
integer width = 151
integer height = 76
integer taborder = 260
boolean bringtotop = true
integer textsize = -8
integer weight = 700
string facename = "Segoe UI"
string text = "K"
end type

event clicked;call super::clicked;of_search(This.Text)
end event

type cb_12 from u_search_letter_button within pfc_cst_u_extended_search_org
integer x = 1911
integer y = 148
integer width = 155
integer height = 76
integer taborder = 270
boolean bringtotop = true
integer textsize = -8
integer weight = 700
string facename = "Segoe UI"
string text = "L"
end type

event clicked;call super::clicked;of_search(This.Text)
end event

type cb_13 from u_search_letter_button within pfc_cst_u_extended_search_org
integer x = 1129
integer y = 232
integer width = 155
integer height = 76
integer taborder = 280
boolean bringtotop = true
integer textsize = -8
integer weight = 700
string facename = "Segoe UI"
string text = "M"
end type

event clicked;call super::clicked;of_search(This.Text)
end event

type cb_14 from u_search_letter_button within pfc_cst_u_extended_search_org
integer x = 1285
integer y = 232
integer width = 155
integer height = 76
integer taborder = 310
boolean bringtotop = true
integer textsize = -8
integer weight = 700
string facename = "Segoe UI"
string text = "N"
end type

event clicked;call super::clicked;of_search(This.Text)
end event

type cb_15 from u_search_letter_button within pfc_cst_u_extended_search_org
integer x = 1440
integer y = 232
integer width = 155
integer height = 76
integer taborder = 330
boolean bringtotop = true
integer textsize = -8
integer weight = 700
string facename = "Segoe UI"
string text = "O"
end type

event clicked;call super::clicked;of_search(This.Text)
end event

type cb_16 from u_search_letter_button within pfc_cst_u_extended_search_org
integer x = 1600
integer y = 232
integer width = 151
integer height = 76
integer taborder = 340
boolean bringtotop = true
integer textsize = -8
integer weight = 700
string facename = "Segoe UI"
string text = "P"
end type

event clicked;call super::clicked;of_search(This.Text)
end event

type cb_17 from u_search_letter_button within pfc_cst_u_extended_search_org
integer x = 1755
integer y = 232
integer width = 151
integer height = 76
integer taborder = 350
boolean bringtotop = true
integer textsize = -8
integer weight = 700
string facename = "Segoe UI"
string text = "Q"
end type

event clicked;call super::clicked;of_search(This.Text)
end event

type cb_18 from u_search_letter_button within pfc_cst_u_extended_search_org
integer x = 1911
integer y = 232
integer width = 155
integer height = 76
integer taborder = 360
boolean bringtotop = true
integer textsize = -8
integer weight = 700
string facename = "Segoe UI"
string text = "R"
end type

event clicked;call super::clicked;of_search(This.Text)
end event

type cb_19 from u_search_letter_button within pfc_cst_u_extended_search_org
integer x = 1129
integer y = 316
integer width = 155
integer height = 76
integer taborder = 370
boolean bringtotop = true
integer textsize = -8
integer weight = 700
string facename = "Segoe UI"
string text = "S"
end type

event clicked;call super::clicked;of_search(This.Text)
end event

type cb_20 from u_search_letter_button within pfc_cst_u_extended_search_org
integer x = 1285
integer y = 316
integer width = 155
integer height = 76
integer taborder = 380
boolean bringtotop = true
integer textsize = -8
integer weight = 700
string facename = "Segoe UI"
string text = "T"
end type

event clicked;call super::clicked;of_search(This.Text)
end event

type cb_21 from u_search_letter_button within pfc_cst_u_extended_search_org
integer x = 1440
integer y = 316
integer width = 155
integer height = 76
integer taborder = 390
boolean bringtotop = true
integer textsize = -8
integer weight = 700
string facename = "Segoe UI"
string text = "U"
end type

event clicked;call super::clicked;of_search(This.Text)
end event

type cb_22 from u_search_letter_button within pfc_cst_u_extended_search_org
integer x = 1600
integer y = 316
integer width = 151
integer height = 76
integer taborder = 400
boolean bringtotop = true
integer textsize = -8
integer weight = 700
string facename = "Segoe UI"
string text = "V"
end type

event clicked;call super::clicked;of_search(This.Text)
end event

type cb_23 from u_search_letter_button within pfc_cst_u_extended_search_org
integer x = 1755
integer y = 316
integer width = 151
integer height = 76
integer taborder = 410
boolean bringtotop = true
integer textsize = -8
integer weight = 700
string facename = "Segoe UI"
string text = "W"
end type

event clicked;call super::clicked;of_search(This.Text)
end event

type cb_24 from u_search_letter_button within pfc_cst_u_extended_search_org
integer x = 1911
integer y = 316
integer width = 155
integer height = 76
integer taborder = 420
boolean bringtotop = true
integer textsize = -8
integer weight = 700
string facename = "Segoe UI"
string text = "X"
end type

event clicked;call super::clicked;of_search(This.Text)
end event

type cb_25 from u_search_letter_button within pfc_cst_u_extended_search_org
integer x = 1125
integer y = 400
integer width = 155
integer height = 76
integer taborder = 430
boolean bringtotop = true
integer textsize = -8
integer weight = 700
string facename = "Segoe UI"
string text = "Y"
end type

event clicked;call super::clicked;of_search(This.Text)
end event

type cb_clear from u_search_letter_button within pfc_cst_u_extended_search_org
integer x = 2967
integer y = 68
integer width = 155
integer height = 64
integer taborder = 470
boolean bringtotop = true
integer textsize = -8
string facename = "Segoe UI"
string text = "Clear"
end type

event clicked;call super::clicked;//Start Code Change ----10.29.2009 #V10 maha - added
rb_aud.checked = false
rb_de.checked = false
rb_ver.checked = false
rb_appr.checked = false

cb_search.setfocus() //Start Code Change ----08.05.2014 #V14.2 maha
end event

type dw_department from datawindow within pfc_cst_u_extended_search_org
boolean visible = false
integer x = 14
integer y = 396
integer width = 937
integer height = 76
integer taborder = 110
boolean bringtotop = true
string dataobject = "d_department_lookup_with_security"
boolean border = false
boolean livescroll = true
end type

event itemchanged;il_dept = long(data)
end event

type cb_iverify from commandbutton within pfc_cst_u_extended_search_org
boolean visible = false
integer x = 3470
integer y = 1316
integer width = 334
integer height = 84
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "&iVerify Add"
end type

event clicked;//gs_pass_ids gs_passed_parms
//
//gs_passed_parms.s_ids[1] = "New"
//
//OpenWithParm( w_iverify_summary, gs_passed_parms )
//
//Return 0
end event

type ddlb_search_type from dropdownlistbox within pfc_cst_u_extended_search_org
integer x = 2162
integer y = 220
integer width = 955
integer height = 904
integer taborder = 30
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long textcolor = 33554432
long backcolor = 16777215
boolean vscrollbar = true
string item[] = {"Last Name","Prac ID","SS #","NPI #","Provider ID","Primary Department","Custom Search","Apps Needing Printing","Address - Street 1","Address - Street 2","Address - Tax Id","Standing/Flag","WebView Tracking (name)","Professional Suffix","Assigned User","Contract"}
borderstyle borderstyle = stylelowered!
end type

event selectionchanged;if this.text = "Primary Department" then
	dw_dept.visible = true
	dw_dept.bringtotop = true
	sle_srch_val.text = ""
	dw_dept.settransobject(sqlca)
	dw_dept.retrieve()
	dw_dept.insertrow(1)
elseif this.text = "Professional Suffix" then  //Start Code Change ----12.06.2012 #V12 maha - new search
	dw_prof_suffix.visible = true
	dw_prof_suffix.bringtotop = true
	sle_srch_val.text = ""
	dw_prof_suffix.settransobject(sqlca)
	dw_prof_suffix.retrieve()
	dw_prof_suffix.insertrow(1)
else
	dw_dept.visible = false
	dw_prof_suffix.visible = false
	il_dept = 0
	il_prof = 0
end if



if this.text = "WebView Tracking (name)" then  //Start Code Change ----08.25.2011 #V11 maha 
	gb_letters.bringtotop = true
else
	gb_letters.bringtotop = false
end if

//Start Code Change ---- 02.08.2006 #262 maha
if this.text = "Custom Search" then
	cb_search.triggerevent(clicked!)
elseif this.text = "Standing/Flag" then  //Start Code Change ----02.01.2011 #V11 maha 
	cb_search.triggerevent(clicked!)
elseif  this.text = "Assigned User" then  //Start Code Change ----12.13.2012 #V12 maha - new search
	sle_srch_val.SetFocus()
	sle_srch_val.text = gs_user_id
elseif this.text = "Contract" then //(Appeon)Harry 08.13.2014 - BugS072201
	cb_search.triggerevent(clicked!)
else
	sle_srch_val.SetFocus()
	sle_srch_val.text = ""  //maha 011306
end if
//End Code Change---02.08.2006

//Start Code Change ----01.16.2014 #V14 maha - added
choose case this.text
	case "Address - Tax Id", "NPI #" , "SS #"
		cbx_valid.visible = true
	case else 
		cbx_valid.visible = false
end choose

end event

event constructor;This.Text = "Last Name"
if gb_webview = false then this.deleteitem( 15) //Start Code Change ----08.25.2011 #V11 maha - hide webview tracking if webview not in system //Start Code Change ----06.13.2013 #V14 maha - changed from 12
end event

type cbx_status from checkbox within pfc_cst_u_extended_search_org
boolean visible = false
integer x = 3470
integer y = 1600
integer width = 786
integer height = 76
boolean bringtotop = true
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = roman!
string facename = "Poor Richard"
long textcolor = 33554432
long backcolor = 67108864
string text = "Include Inactive files in search"
end type

type dw_view from u_dw within pfc_cst_u_extended_search_org
integer x = 14
integer y = 228
integer width = 933
integer height = 80
integer taborder = 150
boolean bringtotop = true
string dataobject = "d_select_views_dddw_list_with_user_param"
boolean vscrollbar = false
boolean border = false
boolean livescroll = false
borderstyle borderstyle = stylebox!
end type

event constructor;//
//
This.of_SetTransObject( sqlca_1 )
This.of_SetUpdateAble( False )
//This.InsertRow( 0 )
if This.RowCount() < 1 Then This.InsertRow( 0 )//alfee 11.24.2009

DatawindowChild dwchild
This.GetChild( "data_view_id", dwchild )
dwchild.SetTransObject( sqlca )
//--------------------------- APPEON BEGIN ---------------------------
//$<ID> PT-10
//$<modify> 01.24.2006 By: Cao YongWang
//$<reason> Performance tuning
//$<reason> Write script to retrieve data from a cache instead of from the database.
//dwchild.Retrieve( gs_user_id )
If not isvalid(ids_views) Then of_init_dddw()
dwchild.reset()
long ll_i
ll_i = ids_views.rowscopy(1,ids_views.rowcount() , primary! , dwchild, 1, primary!)

//---------------------------- APPEON END ----------------------------

//This.SetItem( 1, "data_view_id", 1 )
//This.SetRow( 1 )
//This.ScrollToRow( 1 )

//
//
//
end event

type cb_select from commandbutton within pfc_cst_u_extended_search_org
integer x = 3182
integer y = 400
integer width = 329
integer height = 84
integer taborder = 70
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "&Select"
end type

event clicked;//debugbreak()

parent.event ue_cb_select( )  //calls of_select_prac( dw_search.GetRow() )


end event

type cb_search from u_cb within pfc_cst_u_extended_search_org
integer x = 3182
integer y = 304
integer width = 329
integer height = 84
integer taborder = 40
boolean bringtotop = true
fontcharset fontcharset = ansi!
string text = "S&earch"
boolean default = true
end type

event clicked;of_search_new("")

//String ls_fld
//String ls_sql
//String ls_ssn
//String ls_name
//String ls_depart_sql
//string ls_prac_list
//Integer li_name_len
//Integer li_Rc
//Integer li_val_len
//Integer i
//String ls_all_facilities
//Long ll_action_type
//Long ll_action_status
//DataWindowChild dwchild
//
//IF li_num_of_departments_user_has_rights_to <> li_num_of_departments THEN
//	dw_department.GetChild( "department", dwchild )
//	li_rc = dwchild.RowCount()
//	ls_depart_sql = "("
//	//start with 2 because 0 = all
//	FOR i = 2 TO li_rc
//		ls_depart_sql = ls_depart_sql + String( dwchild.GetItemNumber( i, "lookup_code" ) ) + ","
//	END FOR
//	ls_depart_sql = Mid( ls_depart_sql, 1, Len( ls_depart_sql ) -1 )
//	ls_depart_sql = ls_depart_sql + ")"
//END IF
////messagebox("",is_open_for)
//IF is_open_for = "INTELLIAPP" THEN
//	dw_search.DataObject = "d_extended_search_list_intelliapp"
//elseif is_open_for = "REPORTS" THEN
//	dw_search.DataObject = "d_extended_search_list_multi"
//ELSE
//	dw_search.DataObject = "d_extended_search_list"	
//	
//END IF
//
//IF ddlb_search_type.Text = "I.D." THEN
//	ls_fld = "prac_id"
//ELSEIF ddlb_search_type.Text = "Last Name" THEN
//	ls_fld = "last_name"
//ELSEIF ddlb_search_type.Text = "SS #" THEN
//	ls_fld = "ssn"
//ELSEIF ddlb_search_type.Text = "Provider ID" THEN //maha 081202
//	ls_fld = "provider_id"
//ELSEIF ddlb_search_type.Text = "Apps Needing Printed" THEN
//	ls_fld = "Apps Needing Printed"	
//ELSEIF ddlb_search_type.Text = "Primary Department" THEN
//	ls_fld = "Primary Department"
//ELSEIF ddlb_search_type.Text = "Custom Search" THEN //maha 1000604
//	ls_fld = "Custom Search"
//	open(w_search_query)
//	ls_prac_list = message.stringparm
//	if ls_prac_list = "Cancel" then return
//	//ls_prac_list = "1,2,3,4,5"
//	
//END IF
//debugbreak()
//li_val_len = Len(sle_srch_val.Text)
//
//
//il_facility_id = dw_org_facility_select.GetItemNumber( 1, "facility_id" )
//
//ls_sql =   "SELECT DISTINCT pd_basic.first_name, "+&   
//         "pd_basic.middle_name,"+&      
//         "pd_basic.title,"+&      
//         "pd_basic.name_suffix,"+&      
//         "pd_basic.prof_suffix,"+&      
//         "pd_basic.ssn,"+&      
//         "pd_basic.sex,"+&      
//         "pd_basic.prac_category,"+&      
//         "pd_basic.date_of_birth,"+&      
//         "pd_basic.rec_id,"+&      
//         "pd_basic.prac_id,"+&      
//         "pd_affil_stat.parent_facility_id,"+&      
//         "facility.facility_name,"+&      
//         "facility.default_data_view_id,"+&      
//         "pd_basic.last_name,"+&      
//         "code_lookup.code "
//	  IF is_open_for = "INTELLIAPP" THEN
//   // 	IF ls_fld = "Apps Needing Printed" THEN	    
//          ls_sql = ls_sql + ",net_dev_action_items.action_type,"+&      
//         "net_dev_action_items.app_id,"+&      	    
//         "net_dev_action_items.action_status " +&
//	   "FROM {oj pd_basic  LEFT OUTER JOIN code_lookup  ON pd_basic.name_suffix = code_lookup.lookup_code}, "+&
//	    "{oj pd_affil_stat  LEFT OUTER JOIN net_dev_action_items  ON pd_affil_stat.parent_facility_id =  "+&
//	    "net_dev_action_items.facility_id AND pd_affil_stat.prac_id = net_dev_action_items.prac_id}, "+&      
//     	    "facility "
//				
//		//if one department is selected or if all departments are selected and the number of departments the users
//		//has rights to is less then the number of departments in lookup table then do this
//		//if the number of departments in lookup are the same as the number of departments the user has rights to
//		//then the department security is turned off or they have rights to all departments so do nothing
//		if il_dept > 0 OR ( il_dept = 0 AND li_num_of_departments <> li_num_of_departments_user_has_rights_to ) then //maha 121002
//			ls_sql = ls_sql + ", pd_affil_dept "
//		end if
//		
//     	ls_sql = ls_sql +  "WHERE ( pd_basic.prac_id = pd_affil_stat.prac_id ) and "+&     
//     		 "( pd_affil_stat.parent_facility_id = facility.facility_id ) "
//		
//		//if only 1 department is selected then do a regular where clause
//		if il_dept > 0 then //maha 121002
//			ls_sql = ls_sql + "and ( pd_affil_stat.rec_id = pd_affil_dept.rec_id ) and "+& 
//			"( pd_affil_dept.primary_dept = 1 ) "
//			ls_sql = ls_sql + " AND (pd_affil_dept.department = " + string(il_dept) + ")"
//		//if ALL is selected and number of departments in lookup is not = to number of depart user has
//		//rights to then department security is turned on so do this.
//		elseif il_dept = 0 AND li_num_of_departments <> li_num_of_departments_user_has_rights_to THEN
//				ls_sql = ls_sql + " and ( pd_affil_stat.rec_id = pd_affil_dept.rec_id ) and "+& 
//			"( pd_affil_dept.primary_dept = 1 ) "
//			//if il_dept > 0 then 
//				ls_sql = ls_sql + " AND (pd_affil_dept.department in " + ls_depart_sql + ")"			
//		end if
//	ELSE
//		ls_sql = ls_sql + ",pd_affil_stat.date_app_audit_completed," +&   
//      "pd_affil_stat.date_data_entry_completed," +&
//	   "pd_affil_stat.date_verif_completed," +&  
//     	"pd_affil_stat.apptmnt_start_date, " +& 
//		"pd_affil_stat.active_status " 
//		if dw_search.DataObject = "d_extended_search_list_multi" then //maha added 091605 not used
//			ls_sql += " , 0 as selected, v_full_name.full_name "
//		end if
//     	ls_sql = ls_sql +  "FROM {oj pd_basic  LEFT OUTER JOIN code_lookup  ON pd_basic.name_suffix = code_lookup.lookup_code}, "+&
//     	"facility, "+&   
//		"pd_affil_stat "
//		if dw_search.DataObject = "d_extended_search_list_multi" then
//			ls_sql += ", v_full_name "
//		end if
//		
//		
//		//if one department is selected or if all departments are selected and the number of departments the users
//		//has rights to is less then the number of departments in lookup table then do this
//		//if the number of departments in lookup are the same as the number of departments the user has rights to
//		//then the department security is turned off or they have rights to all departments so do nothing
//		if il_dept > 0 OR ( il_dept = 0 AND li_num_of_departments <> li_num_of_departments_user_has_rights_to ) then //maha 121002
//			ls_sql = ls_sql + ", pd_affil_dept "
//		end if
//		
//     	ls_sql = ls_sql +  "WHERE ( pd_basic.prac_id = pd_affil_stat.prac_id ) and "+&     
//     		 "( pd_affil_stat.parent_facility_id = facility.facility_id ) "
//		
//		//if only 1 department is selected then do a regular where clause
//		if il_dept > 0 then //maha 121002
//			ls_sql = ls_sql + "and ( pd_affil_stat.rec_id = pd_affil_dept.rec_id ) and "+& 
//			"( pd_affil_dept.primary_dept = 1 ) "
//			ls_sql = ls_sql + " AND (pd_affil_dept.department = " + string(il_dept) + ")"
//		//if ALL is selected and number of departments in lookup is not = to number of depart user has
//		//rights to then department security is turned on so do this.
//		elseif il_dept = 0 AND li_num_of_departments <> li_num_of_departments_user_has_rights_to THEN
//				ls_sql = ls_sql + " and ( pd_affil_stat.rec_id = pd_affil_dept.rec_id ) and "+& 
//			"( pd_affil_dept.primary_dept = 1 ) "
//			//if il_dept > 0 then 
//				ls_sql = ls_sql + " AND (pd_affil_dept.department in " + ls_depart_sql + ")"			
//		end if
//		if dw_search.DataObject = "d_extended_search_list_multi" then
//			ls_sql += " and ( v_full_name.prac_id = pd_basic.prac_id ) "
//		end if
//	END IF	    
// //  "FROM {oj pd_basic  LEFT OUTER JOIN code_lookup  ON pd_basic.name_suffix = code_lookup.lookup_code}, "+&   	    
//IF il_facility_id <> 0 THEN
//	ls_sql = ls_sql + " AND pd_affil_stat.parent_facility_id = " + String( il_facility_id )
//ELSE
//	dw_org_facility_select.GetChild( "facility_id", dwchild )
//	FOR i = 1 TO dwchild.RowCount()
//		ls_all_facilities = ls_all_facilities + String( dwchild.GetItemNumber( i, "facility_id" ) ) + ","
//	END FOR
//	ls_all_facilities = Mid( ls_all_facilities , 1 , Len( ls_all_facilities ) -1 ) //gets rid of the extra comma
//	ls_sql = ls_sql + " AND pd_affil_stat.parent_facility_id in (" + ls_all_facilities + ")"
//END IF
//
//IF cbx_status.Checked = True THEN
//	ls_sql = ls_sql + " AND (pd_affil_stat.active_status = 1 OR pd_affil_stat.active_status = 5 OR pd_affil_stat.active_status = 3 OR pd_affil_stat.active_status = 4 )" 
//ELSE
//	ls_sql = ls_sql + " AND (pd_affil_stat.active_status = 1 OR pd_affil_stat.active_status = 4 or pd_affil_stat.active_status = 5)" 	
//END IF
//IF is_open_for = "DELETE" THEN
//	ls_sql = ls_sql + " AND pd_affil_stat.active_status = 2 " 
//END IF
//
//IF ls_fld = "Custom Search" THEN //maha 1000604
//		ls_sql = ls_sql + " AND pd_basic.prac_id in (" + ls_prac_list + ")"
//ELSEIF Len(sle_srch_val.Text) > 0 OR ls_fld = "Apps Needing Printed" THEN
//	IF ls_fld = "prac_id" THEN
//		ls_sql = ls_sql + " AND pd_basic.prac_id = " + sle_srch_val.Text
//	ELSEIF ls_fld = "last_name" THEN
//		ls_name = sle_srch_val.Text
//		li_name_len = Len( ls_name )
//		FOR i = 1 TO li_name_len
//			IF Mid(ls_name, i,1 )  = "'" THEN
//				ls_name = Mid(ls_name, 1, i ) + "'" + Mid(ls_name, i+1 , 100 )
//				i++
//		END IF	
//		END FOR
//		ls_sql = ls_sql + " AND {fn left(pd_basic.last_name," + String( li_name_len ) + ")}  = '" + Upper(ls_name) + "'"
//	ELSEIF ls_fld = "ssn" THEN
//		ls_ssn = sle_srch_val.Text
//		IF Pos( ls_ssn, "-" ) > 0 THEN
//		 	ls_ssn = Mid( sle_srch_val.Text, 1, 3 ) + Mid( sle_srch_val.Text, 5, 2 ) + Mid( sle_srch_val.Text, 8, 4 )
//		END IF
//		ls_sql = ls_sql + " AND ssn = '" + ls_ssn + "'"
//	elseIF ls_fld = "provider_id" THEN //maha 081202
//		ls_sql = ls_sql + " AND pd_basic.provider_id = '" + sle_srch_val.Text + "'"
//	end if
//	IF ls_fld = "Apps Needing Printed" THEN
//		//\/maha 032102
//		select lookup_code into :ll_action_type from code_lookup where lookup_name = 'Action Type' and code = 'App Out To MD';		
//		IF SQLCA.SQLCODE = 100 THEN
//				MessageBox("Error", "You need to add 'App Out To MD' to the Action Type lookup table." )
//				Return -1
//		end if
//		select lookup_code into :ll_action_status from code_lookup where lookup_name = 'Action Status' and code = 'Incomplete';
//		IF SQLCA.SQLCODE = 100 THEN
//				MessageBox("Error", "You will need to add 'Incomplete' to the Action Status lookup table." )
//				Return -1
//		END IF
//		//\maha
//		ls_sql = ls_sql + "AND action_type = " + String( ll_action_type ) + " AND action_status = " + string(ll_action_status)  //-3 AND action_status = -110"
//		
//	END IF
//
//	
//END IF
//
//
//
//ls_sql = ls_sql + " ORDER BY pd_basic.last_name ASC"   
////messagebox("", ls_sql )
////CLIPBOARD( LS_SQL )
////messagebox("", dw_search.DataObject )
//dw_search.SetTransObject( SQLCA_1 )
//
//
//dw_search.SetSQLSelect ( ls_sql )
//li_rc = dw_search.Retrieve( )
//
//FOR i = 1 TO li_rc
//	dw_search.SetItem( i, "rec_id", 0 )
//END FOR
//
//of_hide_ssn()
//
//
//dw_search.SetFocus()
//	
end event

type gb_letters from groupbox within pfc_cst_u_extended_search_org
integer x = 1093
integer y = 8
integer width = 1015
integer height = 496
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long textcolor = 128
long backcolor = 16777215
string text = "First Letter of Last Name Search"
end type

type gb_status from groupbox within pfc_cst_u_extended_search_org
integer x = 2139
integer y = 4
integer width = 1006
integer height = 140
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long textcolor = 128
long backcolor = 16777215
string text = "Filter on Incomplete Status"
end type

type cb_close from commandbutton within pfc_cst_u_extended_search_org
integer x = 3182
integer y = 44
integer width = 329
integer height = 84
integer taborder = 480
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "&Close"
end type

event clicked;of_Close( -1)
end event

type dw_dept from datawindow within pfc_cst_u_extended_search_org
boolean visible = false
integer x = 2153
integer y = 304
integer width = 965
integer height = 92
integer taborder = 10
boolean bringtotop = true
string dataobject = "d_departments_lookup"
boolean border = false
boolean livescroll = true
end type

event constructor;//this.settransobject(sqlca)
//this.retrieve()
//this.insertrow(1)

end event

event itemchanged;il_dept = long(data)
end event

type dw_org_facility_select from pfc_cst_u_org_facility_selector_vertical within pfc_cst_u_extended_search_org
integer x = 18
integer y = 64
integer width = 933
integer height = 80
integer taborder = 100
string dataobject = "d_org_facility_select_vertical_no_label"
end type

event constructor;//This.Object.facilities_t.Visible = False
//--------------------------- APPEON BEGIN ---------------------------
//$<ID> PT-11
//$<modify> 01.24.2006 By: Cao YongWang
//$<reason> Performance tuning
//$<modification> The following script is copied from the ancester object pfc_cst_u_org_facility_selector_vertical.
//$<modification> Uncheck the Extend Ancester Script item from PowerBuilder painter.
DataWindowChild dwchild

This.SetTransObject( SQLCA )
//This.InsertRow( 0 )
If This.RowCount() < 1 Then This.InsertRow(0) //alfee 11.24.2009

This.GetChild( "facility_id", dwchild )
dwchild.SetTransObject( SQLCA )
//dwchild.Retrieve( gs_user_id )
//Write scripts to retrieve data from the cache instead of retrieve.
If not isvalid(ids_facilitys) Then of_init_dddw()
dwchild.reset()
ids_facilitys.rowscopy(1, ids_facilitys.rowcount(),Primary!, dwchild , 1, Primary!)
dwchild.InsertRow(1)
dwchild.SetItem( 1, "facility_name", "All" )
dwchild.SetItem( 1, "facility_id", 0 )

//This.SetItem( 1, "facility_id", 0 )
IF IsNull(this.getItemNumber(1,"facility_id")) then This.SetItem( 1, "facility_id", 0 )	//long.zhang 09.26.2011 Department Secuirty and Profile Module - Bug id 2658
//---------------------------- APPEON END ----------------------------

end event

type gb_facility from groupbox within pfc_cst_u_extended_search_org
integer x = 5
integer y = 8
integer width = 1061
integer height = 160
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long textcolor = 128
long backcolor = 16777215
string text = "Select Facility"
end type

event constructor;//BEGIN---Delete by Evan 09/19/2008
/*
IF gs_cust_type = "C" THEN
	This.Text = 'Client'
ELSEIF gs_cust_type = "I" THEN
	This.Text = 'Payor/Hospital'
END IF
*/
//BEGIN---Delete by Evan 09/19/2008
end event

type ddlb_status from dropdownlistbox within pfc_cst_u_extended_search_org
integer x = 2162
integer y = 396
integer width = 955
integer height = 676
integer taborder = 80
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long textcolor = 33554432
boolean sorted = false
boolean vscrollbar = true
string item[] = {"Active and Pending","Include Inactive","Active Only","Inactive Only","Pending Only","Mid-cycle",""}
borderstyle borderstyle = stylelowered!
end type

type gb_search from groupbox within pfc_cst_u_extended_search_org
integer x = 2135
integer y = 160
integer width = 1006
integer height = 340
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long textcolor = 128
long backcolor = 16777215
string text = "Search On:"
end type

type cb_new from commandbutton within pfc_cst_u_extended_search_org
integer x = 3182
integer y = 44
integer width = 329
integer height = 84
integer taborder = 90
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
string text = "&New"
end type

event clicked;Integer li_rec_cnt
String ls_demo
string ls_ssn
integer chk
integer ssncnt
gs_pass_ids lst_ids   //maha 01.14.2014

IF dw_view.GetText() = "" OR IsNull( dw_view.GetText() )  THEN
	MessageBox("View", "Please select a view." )
	Return -1
END IF


ls_demo = ProfileString(gs_IniFilePathName, "setup", "demo", "None")
IF ls_demo = "1" THEN
	SELECT Count(prac_id)  
	INTO :li_rec_cnt  
	FROM pd_basic  ;
	IF li_rec_cnt > 10 THEN
		MessageBox("Limit", "You can only have up to 10 records in the trial version.")
		Return -1
	END IF
END IF

//Start Code Change ----05.28.2014 #V14.2 maha
li_rec_cnt = of_check_prac_facility_max("P") 
if li_rec_cnt > 0 then
	MessageBox("Practitioner Limit", "You have reached the limit of providers ( "  + string(li_rec_cnt) + " ) as defined by the system setup, and cannot add any additional providers.  Contact IntelliSoft Group for Options.")
	this.enabled = false
	Return -1
END IF
//End Code Change ----05.28.2014

gl_prac_id = -9
iw_prac_folder.il_prac_id = gl_prac_id  //Start Code Change ----07.02.2013 #V12 maha
gi_parent_facility = 0
dw_view.AcceptText()
IF dw_view.GetText() = "" OR IsNull( dw_view.GetText() )  THEN
	MessageBox("View", "Please select a view." )
	Return -1
END IF
gl_data_view_id = dw_view.GetItemNumber( 1, "data_view_id" )




//select set_4 into :chk from icred_settings;
chk = of_get_app_setting("set_4","I")
if chk > 0 then //Start Code Change ----04.14.2008 #V8 maha - changed to allow other than ssn search
//if chk = 1 then
	//open( w_get_ssn)
	//ls_ssn = message.stringparm
	//messagebox("ls_ssn",ls_ssn)
	//select count(prac_id) into :ssncnt from pd_basic where ssn = :ls_ssn;
	//if ssncnt > 0 then
		openwithparm(w_ssn_check_prac_info, chk) //Start Code Change ----04.14.2008 #V8 maha - changed to allow other than ssn search
		//Start Code Change ----01.14.2014 #V14 maha
		lst_ids = message.powerobjectparm
		//gl_prac_id = message.doubleparm
		gl_prac_id = lst_ids.prac_id
		//End Code Change ----01.14.2014 	
		iw_prac_folder.il_prac_id = gl_prac_id  //Start Code Change ----07.02.2013 #V12 maha

	//end if
	//---------Begin Modified by (Appeon)Stephen 01.14.2014 for Bug 3827--------
	//if gl_prac_id > 0 then iw_prac_folder.ib_from_ssn = true //Start Code Change ---- 10.03.2006 #621 maha variable to allow found prac to be selected
	if gl_prac_id > 0 then 
		iw_prac_folder.ib_from_ssn = true //Start Code Change ---- 10.03.2006 #621 maha variable to allow found prac to be selected
		iw_prac_folder.ii_parent_facility_id = lst_ids.facility_id  //Start Code Change ----01.14.2014 #V14 maha
		gi_parent_facility = lst_ids.facility_id   //Start Code Change ----01.25.2014 #V14 maha
		iw_prac_folder.of_setup_title_search()  //Start Code Change ----01.25.2014 #V14 maha
		iw_prac_folder.of_get_photo_data(gl_prac_id , lst_ids.facility_id)   //Start Code Change ----01.25.2014 #V14 maha
//		ddlb_search_type.text = 'Prac ID'
//		sle_srch_val.text = string(gl_prac_id)
//		dw_org_facility_select.setitem( 1, "facility_id", 0 )
//		ddlb_status.text = 'Include Inactive'
//		of_search_new("")		
//		if dw_search.rowcount() > 0 then
//			gi_parent_facility = dw_search.getitemnumber(1,"parent_facility_id")
//		else 
//			gi_parent_facility = lst_ids.facility_id  //Start Code Change ----01.14.2014 #V14 maha
//		end if
	else
		iw_prac_folder.is_prac_title =  "New Provider"  //Start Code Change ----01.25.2014 #V14 maha
	end if

	
	//---------End Modfiied ------------------------------------------------------
end if

//Start Code Change ----11.17.2009 #V92 maha
if gl_prac_id = -123 then 
	iw_prac_folder.ib_from_ssn = true
	gs_ssnnpi = ""
	return
end if
//End Code Change---11.17.2009 - modified for obscure bug
//\maha


iw_prac_folder.of_retrieve_prac() 
//iw_prac_folder.tab_1.selecttab(2)  //Start Code Change ----01.25.2014 #V14 maha

Return 0



end event

type rb_aud from radiobutton within pfc_cst_u_extended_search_org
integer x = 2158
integer y = 68
integer width = 219
integer height = 64
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long textcolor = 33554432
long backcolor = 16777215
string text = "Check"
end type

type sle_srch_val from singlelineedit within pfc_cst_u_extended_search_org
integer x = 2167
integer y = 316
integer width = 955
integer height = 72
integer taborder = 60
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Segoe UI"
long textcolor = 33554432
boolean autohscroll = false
borderstyle borderstyle = stylelowered!
end type

type dw_search from u_dw within pfc_cst_u_extended_search_org
event ue_save_as_batch ( )
event ue_print_practitioner ( )
event ue_print_verification ( )
event ue_print_applications ( )
event ue_print_missing ( )
integer x = 14
integer y = 516
integer width = 3497
integer height = 1396
integer taborder = 20
boolean bringtotop = true
string dataobject = "d_extended_search_list"
boolean hscrollbar = true
end type

event ue_save_as_batch();//////////////////////////////////////////////////////////////////////
// $<event>u_dwue_save_as_batch()
// $<arguments>
//		value	integer		
// $<returns> 
// $<description> Right Click Functionality on Practitioner Search Screen.
// $<description>
//////////////////////////////////////////////////////////////////////
// $<add> 10.09.2006 by Jack (Inova)
//////////////////////////////////////////////////////////////////////

long ll_prac_id[]
long i,ll_rowcount
string ls_sql

dw_search.accepttext()
ll_rowcount = dw_search.rowcount()
if ll_rowcount <= 0 then return
for i = 1 to ll_rowcount
	ll_prac_id[i] = dw_search.getitemnumber(i,'prac_id')
next

ls_sql = dw_search.Object.DataWindow.Table.Select  //Start Code Change ----06.04.2013 #V14 maha - changed from datawindow.syntax
//ls_sql = dw_search.describe("datawindow.syntax")


of_create_batch(ll_prac_id,'',ls_sql)

end event

event ue_print_practitioner();//////////////////////////////////////////////////////////////////////
// $<event>u_dwue_print_practitioner()
// $<arguments>
//		value	integer		
// $<returns> 
// $<description> Right Click Functionality on Practitioner Search Screen.
// $<description> 1 New window: w_print_practitioner_verification,1 New structure: str_prac_id.
//////////////////////////////////////////////////////////////////////
// $<add> 10.09.2006 by Jack (Inova)
//////////////////////////////////////////////////////////////////////

str_prac_id lstr_prac_id

dw_search.accepttext()
lstr_prac_id.prac_id = dw_search.getitemnumber(dw_search.getrow(),'prac_id')
lstr_prac_id.facility_id = dw_search.getitemnumber(dw_search.getrow(),'parent_facility_id')
lstr_prac_id.view_id= dw_search.getitemnumber(dw_search.getrow(),'data_view_id')
lstr_prac_id.types = 'P'
openwithparm(w_print_practitioner_verification,lstr_prac_id)


end event

event ue_print_verification();//////////////////////////////////////////////////////////////////////
// $<event>u_dwue_print_practitioner()
// $<arguments>
//		value	integer		
// $<returns> 
// $<description> Right Click Functionality on Practitioner Search Screen.
// $<description>
//////////////////////////////////////////////////////////////////////
// $<add> 10.10.2006 by Jack (Inova)
//////////////////////////////////////////////////////////////////////

str_prac_id lstr_prac_id

dw_search.accepttext()
lstr_prac_id.prac_id = dw_search.getitemnumber(dw_search.getrow(),'prac_id')
lstr_prac_id.facility_id = dw_search.getitemnumber(dw_search.getrow(),'parent_facility_id')
lstr_prac_id.types = 'V'
openwithparm(w_print_practitioner_verification,lstr_prac_id)


end event

event ue_print_applications();//////////////////////////////////////////////////////////////////////
// $<event>u_dwue_print_practitioner()
// $<arguments>
//		value	integer		
// $<returns> 
// $<description> Right Click Functionality on Practitioner Search Screen.
// $<description>
//////////////////////////////////////////////////////////////////////
// $<add> 10.10.2006 by Jack (Inova)
//////////////////////////////////////////////////////////////////////
long ll_prac_id

dw_search.accepttext()
ll_prac_id = dw_search.getitemnumber(dw_search.getrow(),'prac_id')

Open( w_IntelliApp_Print )

w_IntelliApp_Print.uo_print.of_from_prac_folder( ll_prac_id )
w_IntelliApp_Print.uo_print.ib_open_from_prac_folder = True

end event

event ue_print_missing();//////////////////////////////////////////////////////////////////////
// $<event> ue_print_missing()
// $<arguments>
//		value	integer		
// $<returns> 
// $<description> Right Click Functionality on Practitioner Search Screen.
// $<description>
//////////////////////////////////////////////////////////////////////
// $<add> 10.10.2006 by Jack (Inova)
//////////////////////////////////////////////////////////////////////
datastore lds_app_audit_rqrd_data
datastore lds_app_audit_browse
long ll_facility_id,ll_prac_id,ll_rec_id,ll_rowcount

//Start Code Change ---- 05.21.2007 #V7 maha
// corrected error where facility was selected form facility search rather than the selected record causing an application error when the selector is set to ALL.
//ll_facility_id = dw_org_facility_select.getitemnumber(dw_org_facility_select.getrow(),'facility_id')
ll_facility_id = dw_search.getitemnumber(dw_search.getrow(),'parent_facility_id')
//End Code Change---05.21.2007
ll_prac_id = dw_search.getitemnumber(dw_search.getrow(),'prac_id')

lds_app_audit_rqrd_data = create datastore
lds_app_audit_rqrd_data.dataobject = 'd_pd_app_audit_rqrd_data_inova_1'
lds_app_audit_rqrd_data.settransobject(sqlca)

lds_app_audit_browse = create datastore
lds_app_audit_browse.dataobject = 'd_app_audit_browse'
lds_app_audit_browse.settransobject(sqlca)

lds_app_audit_browse.retrieve(ll_prac_id,ll_facility_id)
ll_rec_id = lds_app_audit_browse.GetItemNumber( 1, 'rec_id' )
ll_rowcount = lds_app_audit_rqrd_data.retrieve(ll_rec_id)

//--------------------------- APPEON BEGIN ---------------------------
//$<Add> 08.23.2007 By: Evan
//$<Reason> Need to destroy object.
if IsValid(lds_app_audit_browse) then Destroy lds_app_audit_browse
if IsValid(lds_app_audit_rqrd_data) then Destroy lds_app_audit_rqrd_data
//---------------------------- APPEON END ----------------------------

if ll_rowcount < 1 then
	messagebox('Print Missing Letter','There is no missing info letter to print.')
	return
end if

iw_prac_folder.tab_1.selecttab(3)
iw_prac_folder.event dynamic pfc_cst_compose_request()

end event

event constructor;This.of_SetSort(True)
This.inv_sort.of_SetStyle(3)
This.of_SetReqColumn(True)
This.of_SetUpdateable( False )

This.inv_sort.of_SetColumnHeader(True)

IF gs_cust_type = "C" THEN
	This.Modify( "facility_name_t.text = 'Client'" )
ELSEIF gs_cust_type = "I" THEN
	This.Modify( "facility_name_t.text = 'Payor/Hospital'" )
END IF

this.of_setrowselect( true)
this.inv_rowselect.of_SetStyle(this.inv_rowselect.single )


end event

event doubleclicked;IF dwo.Name = "select_t" THEN
	of_select_all(  )
	Return
END IF

IF is_open_for = "INTELLIAPP" THEN
	MessageBox("Select", "You must check of the select box and then click the Select button to select practitioners.")
	Return 0
END IF





parent.event ue_cb_select( )
// mskinner 04 nov 2004 -- begin
//of_select_prac( row )
// mskinner 04 nov 2004 -- end
end event

event retrieveend;call super::retrieveend;Integer li_default_data_view_id
Integer li_found
String ls_null
long ll_prac //maha 06.17.10
long ll_facil //maha 06.24.10
DataWindowChild dwchild

SetNull( ls_null )

This.SelectRow(0, False)
This.SelectRow(1, True)

IF This.RowCount() > 0 THEN
	This.SelectRow(0, False)
	This.SelectRow(This.GetRow(), True)
	if ii_user_view > 0 then //maha 073103 check user default view
		dw_view.GetChild( "data_view_id", dwchild )
		li_found = dwchild.Find( "data_view_id = " + String( ii_user_view ),1, 1000 )
		IF li_found > 0 THEN
			dw_view.SetItem( 1, "data_view_id", ii_user_view )
		end if
	else //if no user default view use the facility default view
		li_default_data_view_id = This.GetItemNumber( This.GetRow(), "data_view_id" )
		dw_view.GetChild( "data_view_id", dwchild )
		li_found = dwchild.Find( "data_view_id = " + String( li_default_data_view_id ),1, 1000 )
		IF li_found > 0 THEN
			dw_view.SetItem( 1, "data_view_id", li_default_data_view_id )
		ELSE
			dw_view.Reset()
			dw_view.InsertRow( 0 )
		END IF
	end if
	//Start Code Change ----06.17.2010 #V10 maha //search screen photo
	ll_prac = this.getitemnumber(1,"prac_id")
	ll_facil = this.getitemnumber(1,"parent_facility_id")
	
	//Start Code Change ----05.17.2011 #V11 maha
	if isvalid(iw_prac_folder) then
		iw_prac_folder.il_prac_id = ll_prac
		iw_prac_folder.ii_parent_facility_id = ll_facil
	end if
	//end Code Change ----05.17.2011
	
	if isvalid( iw_prac_folder) then
		if ll_prac > 0 then iw_prac_folder.of_get_photo_data(ll_prac,ll_facil)
	end if
	//End Code Change ----06.17.2010
else
	 //iw_prac_folder.of_get_photo_data(0,0)
	 if isvalid( iw_prac_folder) then iw_prac_folder.of_get_photo_data(0,0) //SK Practitioner Folder - alfee 08.31.2010	 
END IF


//IF This.RowCount() > 0 THEN
//	li_default_data_view_id = This.GetItemNumber( 1, "data_view_id" )
//	
//	dw_view.GetChild( "data_view_id", dwchild )
//	li_found = dwchild.Find( "data_view_id = " + String( li_default_data_view_id ),1, 1000 )
//	IF li_found > 0 THEN
//		dw_view.SetItem( 1, "data_view_id", li_default_data_view_id )
//	ELSE
//		dw_view.Reset()
//		dw_view.InsertRow( 0 )
//	END IF
//END IF
end event

event rowfocuschanged;call super::rowfocuschanged;Integer li_default_data_view_id
Integer li_found
String ls_null
string ls_picname //maha 06.17.10
long ll_prac
long ll_facil //maha 06.24.10
DataWindowChild dwchild
window activesheet //Added by  02.23.2010
activesheet = w_mdi.GetActiveSheet()

SetNull( ls_null )

IF currentrow > 0 THEN
	ll_prac = this.getitemnumber(currentrow,"prac_id")
//	ll_facil = this.getitemnumber(1,"parent_facility_id")
	ll_facil = this.getitemnumber(currentrow,"parent_facility_id") //Start Code Change ----12.15.2011 #V12 maha - corrected bug (was getting row 1)
	if ii_user_view > 0 then //maha 073103 check user default view
		dw_view.GetChild( "data_view_id", dwchild )
		li_found = dwchild.Find( "data_view_id = " + String( ii_user_view ),1, 1000 )
		IF li_found > 0 THEN
			dw_view.SetItem( 1, "data_view_id", ii_user_view )
		end if
	else //if no user default view use the facility default view
		li_default_data_view_id = This.GetItemNumber( currentrow, "data_view_id" )
		dw_view.GetChild( "data_view_id", dwchild )
		li_found = dwchild.Find( "data_view_id = " + String( li_default_data_view_id ),1, 1000 )
		IF li_found > 0 THEN
			dw_view.SetItem( 1, "data_view_id", li_default_data_view_id )
		ELSE
			dw_view.Reset()
			dw_view.InsertRow( 0 )
		END IF
	end if
	//--------------------------- APPEON BEGIN ---------------------------
	//$<add> 10.10.2006 By: Jack (Inova)
	//$<reason> Right Click Functionality on Practitioner Search Screen.
	
	if isvalid(iw_prac_folder) then
		//messagebox("il_prac",iw_prac_folder.il_prac_id)
		//if dw_search.getrow() > 0 /*1*/ then //modify by stephen 06/21/2011 --Fixed Bug 2479 for Refresh on Practitioner Search Screen
		if dw_search.getrow() > 0  then	//long.zhang 06.21.2013
			//Start Code Change ----05.17.2011 #V11 maha 
			iw_prac_folder.il_prac_id = ll_prac
			iw_prac_folder.ii_parent_facility_id = ll_facil
			//End Code Change ----05.17.2011
			iw_prac_folder.of_setup_title_search()
		end if
		//Start Code Change ----06.17.2010 #V10 maha //search screen photo
		if ll_prac > 0 then 
			 iw_prac_folder.of_get_photo_data(ll_prac,ll_facil)
		else
			 iw_prac_folder.of_get_photo_data(0,0)
		end if
		//End Code Change ----06.17.2010
	end if


	//Added by  Nova 02.23.2010
   if isvalid(activesheet) then
		if dw_search.getrow() >= 1  and activesheet.Tag = 'Quality Profiles' then
			w_qa_peer_profile_screen.of_setup_title_search()
		end if
	end if
	
	//---------------------------- APPEON END ----------------------------
END IF

end event

event rbuttonup;//--------------------------- APPEON BEGIN ---------------------------
//$<add> 10.09.2006 By: Jack (Inova)
//$<reason> Right Click Functionality on Practitioner Search Screen.
//$<reason> 1 New menu: m_inova

m_inova				lm_dw
integer li_set_iapps,li_num = 0,li_cnt,i
datetime ldt_date_app_audit_completed
long ll_prac_id,ll_action_type,ll_action_status
li_set_iapps = of_get_app_setting("set_iapps","I")

if this.rowcount() < 1 then return 0 //Start Code Change ---- 04.12.2007 #V7 maha trap user error
if this.DataObject = "d_extended_search_list_intelliapp" then return 0 //Start Code Change ---- 04.12.2007 #V7 maha trap user error

ldt_date_app_audit_completed = dw_search.getitemdatetime(dw_search.getrow(),'pd_affil_stat_date_app_audit_completed')
ll_prac_id = dw_search.getitemnumber(dw_search.getrow(),'prac_id')
ll_action_type = long(gnv_data.of_getitem("code_lookup","lookup_code","lookup_name = 'Action Type' and code = 'App Out To MD'"))
ll_action_status = long(gnv_data.of_getitem("code_lookup","lookup_code","lookup_name = 'Action Status' and code = 'Incomplete'"))

SELECT count(net_dev_action_items.rec_id) into :li_num  FROM net_dev_action_items  
WHERE ( net_dev_action_items.prac_id = :ll_prac_id ) AND  
      ( net_dev_action_items.action_type = :ll_action_type ) AND  
      ( net_dev_action_items.action_status = :ll_action_status );


// Create popup menu
lm_dw = Create m_inova
lm_dw.of_SetParent (This)

if li_set_iapps = 1 then
	lm_dw.m_table.m_printapplications.visible = true
else 
	lm_dw.m_table.m_printapplications.visible = false
end if

//--------------------------- APPEON BEGIN ---------------------------
//$<add> 05/28/2008 By: Ken.Guo
//$<reason> Fix BugN050704. For w_extended_search_new
If Not isvalid(iw_prac_folder) Then
	lm_dw.m_table.m_printmissing.visible = False
End If
//---------------------------- APPEON END ----------------------------

if not isnull(ldt_date_app_audit_completed) then
	//lm_dw.m_table.m_printmissing.enabled = false
	gnv_app.of_modify_menu_attr( lm_dw.m_table.m_printmissing,'enabled', false)
else
	//lm_dw.m_table.m_printmissing.enabled = true
	gnv_app.of_modify_menu_attr( lm_dw.m_table.m_printmissing,'enabled', true)
end if

li_cnt = UpperBound( w_mdi.ii_security_action_id )

FOR i = 1 TO li_cnt
   IF w_mdi.ii_security_action_id[ i ] = 1580 THEN
      IF w_mdi.ii_security_action_value[ i ] = 0 THEN
			lm_dw.m_table.m_printpractitioner.visible = false
			lm_dw.m_table.m_printverification.visible = false
		ELSE
			lm_dw.m_table.m_printpractitioner.visible = true
			lm_dw.m_table.m_printverification.visible = true
      END IF
   END IF  
	//Start Code Change ---- 10.24.2006  maha
   IF w_mdi.ii_security_action_id[ i ] = 5820 THEN
      IF w_mdi.ii_security_action_value[ i ] = 0 THEN
			lm_dw.m_table.m_printsearch.visible = false
			lm_dw.m_table.m_printsearchpdf.visible = false
			lm_dw.m_table.m_exportsearch.visible = false
		ELSE
			lm_dw.m_table.m_printsearch.visible = true
			lm_dw.m_table.m_printsearchpdf.visible = false
			lm_dw.m_table.m_exportsearch.visible = true
      END IF
   END IF  
    IF w_mdi.ii_security_action_id[ i ] = 2000 THEN //save as IntelliBatch
      IF w_mdi.ii_security_action_value[ i ] = 0 THEN
		lm_dw.m_table.m_saveresults.visible = false
	ELSE
		lm_dw.m_table.m_saveresults.visible = true
      END IF
   END IF


NEXT

if li_num < 1 then
	//lm_dw.m_table.m_printapplications.enabled = false
	gnv_app.of_modify_menu_attr( lm_dw.m_table.m_printapplications,'enabled', false)
	lm_dw.m_table.m_printapplications.text = 'Print Applications (' + string(li_num) + ')'
else
	//lm_dw.m_table.m_printapplications.enabled = true
	gnv_app.of_modify_menu_attr( lm_dw.m_table.m_printapplications,'enabled', true)
	lm_dw.m_table.m_printapplications.text = 'Print Applications (' + string(li_num) + ')'
end if
//End Code Change---10.24.2006
// Popup menu

//lm_dw.m_table.PopMenu (iw_prac_folder.PointerX() + 5, iw_prac_folder.PointerY() + 210)
lm_dw.m_table.PopMenu ( w_mdi.PointerX(), w_mdi.PointerY() ) //Rodger wu changed on Oct 26, 2006

Destroy lm_dw

Return 1
//---------------------------- APPEON END ----------------------------



end event

event clicked;call super::clicked;//--------------------------- APPEON BEGIN ---------------------------
//$<add> 10.10.2006 By: Jack (Inova)
//$<reason> Right Click Functionality on Practitioner Search Screen.
if dw_search.getrow() = 1 then
//	iw_prac_folder.of_setup_title_search()
end if
//---------------------------- APPEON END ----------------------------

end event

